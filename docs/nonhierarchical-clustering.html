<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 비계층적 군집방법 | 데이터마이닝 with R</title>
  <meta name="description" content="전치혁 교수님의 책 을 기반으로 한 R 예제" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 비계층적 군집방법 | 데이터마이닝 with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://youngroklee-ml.github.io/data-mining-book/" />
  
  <meta property="og:description" content="전치혁 교수님의 책 을 기반으로 한 R 예제" />
  <meta name="github-repo" content="youngroklee-ml/data-mining-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 비계층적 군집방법 | 데이터마이닝 with R" />
  
  <meta name="twitter:description" content="전치혁 교수님의 책 을 기반으로 한 R 예제" />
  

<meta name="author" content="전치혁, 이혜선, 이종석, 이영록" />


<meta name="date" content="2021-07-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hierarchical-clustering.html"/>
<link rel="next" href="cluster-solution-evaluation.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">데이터마이닝 with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>개요</a></li>
<li class="chapter" data-level="1" data-path="datamining-overview.html"><a href="datamining-overview.html"><i class="fa fa-check"></i><b>1</b> 데이터마이닝 개요</a></li>
<li class="part"><span><b>I 1부 - 예측</b></span></li>
<li class="chapter" data-level="2" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>2</b> 회귀분석</a>
<ul>
<li class="chapter" data-level="2.1" data-path="regression.html"><a href="regression.html#regression-packages-install"><i class="fa fa-check"></i><b>2.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="2.2" data-path="regression.html"><a href="regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>2.2</b> 다중회귀모형</a></li>
<li class="chapter" data-level="2.3" data-path="regression.html"><a href="regression.html#regression-response-confidence-prediction"><i class="fa fa-check"></i><b>2.3</b> 반응치에 대한 추정 및 예측</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="regression.html"><a href="regression.html#regression-response-confidence"><i class="fa fa-check"></i><b>2.3.1</b> 평균반응치의 추정</a></li>
<li class="chapter" data-level="2.3.2" data-path="regression.html"><a href="regression.html#regression-response-prediction"><i class="fa fa-check"></i><b>2.3.2</b> 미래반응치의 예측</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="regression.html"><a href="regression.html#regression-indicator-variable"><i class="fa fa-check"></i><b>2.4</b> 지시변수와 회귀모형</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="regression.html"><a href="regression.html#regression-indicator-variable-basic-script"><i class="fa fa-check"></i><b>2.4.1</b> 기본 R 스트립트</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>3</b> 주성분분석</a>
<ul>
<li class="chapter" data-level="3.1" data-path="pca.html"><a href="pca.html#pca-packages-install"><i class="fa fa-check"></i><b>3.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="3.2" data-path="pca.html"><a href="pca.html#pca-matrix-factorization"><i class="fa fa-check"></i><b>3.2</b> 행렬의 분해</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="pca.html"><a href="pca.html#pca-matrix-factorization-basic-script"><i class="fa fa-check"></i><b>3.2.1</b> 기본 R 스트립트</a></li>
<li class="chapter" data-level="3.2.2" data-path="pca.html"><a href="pca.html#pca-ss"><i class="fa fa-check"></i><b>3.2.2</b> 변수의 변동과 제곱합</a></li>
<li class="chapter" data-level="3.2.3" data-path="pca.html"><a href="pca.html#pca-intro"><i class="fa fa-check"></i><b>3.2.3</b> 주성분의 이해 및 행렬의 분해</a></li>
<li class="chapter" data-level="3.2.4" data-path="pca.html"><a href="pca.html#pca-svd"><i class="fa fa-check"></i><b>3.2.4</b> 특이치분해 (Singular Value Decomposition)</a></li>
<li class="chapter" data-level="3.2.5" data-path="pca.html"><a href="pca.html#pca-spectral"><i class="fa fa-check"></i><b>3.2.5</b> 분광분해 (Spectral Decomposition)</a></li>
<li class="chapter" data-level="3.2.6" data-path="pca.html"><a href="pca.html#pca-nipals"><i class="fa fa-check"></i><b>3.2.6</b> NIPALS 알고리즘</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="pca.html"><a href="pca.html#pca-regression"><i class="fa fa-check"></i><b>3.3</b> 주성분 회귀분석</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="pca.html"><a href="pca.html#pcr-basic-script"><i class="fa fa-check"></i><b>3.3.1</b> 기본 R 스트립트</a></li>
<li class="chapter" data-level="3.3.2" data-path="pca.html"><a href="pca.html#pcr-regression-coefficient"><i class="fa fa-check"></i><b>3.3.2</b> 주성분 회귀계수 추정</a></li>
<li class="chapter" data-level="3.3.3" data-path="pca.html"><a href="pca.html#pcr-regression-transform"><i class="fa fa-check"></i><b>3.3.3</b> 회귀계수 선형변환</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plsr.html"><a href="plsr.html"><i class="fa fa-check"></i><b>4</b> 부분최소자승법</a>
<ul>
<li class="chapter" data-level="4.1" data-path="plsr.html"><a href="plsr.html#plsr-packages-install"><i class="fa fa-check"></i><b>4.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="4.2" data-path="plsr.html"><a href="plsr.html#plsr-single-target"><i class="fa fa-check"></i><b>4.2</b> 하나의 종속변수의 경우</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="plsr.html"><a href="plsr.html#plsr-basic-script"><i class="fa fa-check"></i><b>4.2.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="4.2.2" data-path="plsr.html"><a href="plsr.html#plsr-model"><i class="fa fa-check"></i><b>4.2.2</b> PLS 모형</a></li>
<li class="chapter" data-level="4.2.3" data-path="plsr.html"><a href="plsr.html#plsr-single-nipals"><i class="fa fa-check"></i><b>4.2.3</b> NIPALS 알고리즘</a></li>
<li class="chapter" data-level="4.2.4" data-path="plsr.html"><a href="plsr.html#plsr-single-transform"><i class="fa fa-check"></i><b>4.2.4</b> 회귀식 변환</a></li>
<li class="chapter" data-level="4.2.5" data-path="plsr.html"><a href="plsr.html#plsr-sst"><i class="fa fa-check"></i><b>4.2.5</b> 제곱합 분해</a></li>
<li class="chapter" data-level="4.2.6" data-path="plsr.html"><a href="plsr.html#plsr-variable-importance"><i class="fa fa-check"></i><b>4.2.6</b> 독립변수의 중요도</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-target"><i class="fa fa-check"></i><b>4.3</b> 다수의 종속변수의 경우</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-basic-script"><i class="fa fa-check"></i><b>4.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="4.3.2" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-model"><i class="fa fa-check"></i><b>4.3.2</b> PLS 모형</a></li>
<li class="chapter" data-level="4.3.3" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-nipals"><i class="fa fa-check"></i><b>4.3.3</b> NIPALS 알고리즘</a></li>
<li class="chapter" data-level="4.3.4" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-transform"><i class="fa fa-check"></i><b>4.3.4</b> 회귀식 변환</a></li>
<li class="chapter" data-level="4.3.5" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-sst"><i class="fa fa-check"></i><b>4.3.5</b> 제곱합 분해</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II 2부 - 분류분석</b></span></li>
<li class="chapter" data-level="5" data-path="classification-analysis.html"><a href="classification-analysis.html"><i class="fa fa-check"></i><b>5</b> 분류분석 개요</a>
<ul>
<li class="chapter" data-level="5.1" data-path="classification-analysis.html"><a href="classification-analysis.html#classification-packages-install"><i class="fa fa-check"></i><b>5.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="5.2" data-path="classification-analysis.html"><a href="classification-analysis.html#classification-problem-methods"><i class="fa fa-check"></i><b>5.2</b> 분류문제 및 분류기법</a></li>
<li class="chapter" data-level="5.3" data-path="classification-analysis.html"><a href="classification-analysis.html#simple-classification-methods"><i class="fa fa-check"></i><b>5.3</b> 기본적인 분류기법</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="classification-analysis.html"><a href="classification-analysis.html#nearest-neighbor-classification"><i class="fa fa-check"></i><b>5.3.1</b> 인접객체법</a></li>
<li class="chapter" data-level="5.3.2" data-path="classification-analysis.html"><a href="classification-analysis.html#naive-bayes"><i class="fa fa-check"></i><b>5.3.2</b> 나이브 베이지안 분류법</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>6</b> 로지스틱 회귀분석</a>
<ul>
<li class="chapter" data-level="6.1" data-path="logistic-regression.html"><a href="logistic-regression.html#logistic-packages-install"><i class="fa fa-check"></i><b>6.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="6.2" data-path="logistic-regression.html"><a href="logistic-regression.html#binary-logistic-regression"><i class="fa fa-check"></i><b>6.2</b> 이분 로지스틱 회귀모형</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="logistic-regression.html"><a href="logistic-regression.html#bianry-logistic-reg-basic-script"><i class="fa fa-check"></i><b>6.2.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="6.2.2" data-path="logistic-regression.html"><a href="logistic-regression.html#binary-logistic-reg-model"><i class="fa fa-check"></i><b>6.2.2</b> 회귀모형</a></li>
<li class="chapter" data-level="6.2.3" data-path="logistic-regression.html"><a href="logistic-regression.html#binary-logistic-reg-estimation"><i class="fa fa-check"></i><b>6.2.3</b> 회귀계수 추정</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="logistic-regression.html"><a href="logistic-regression.html#nominal-logistic-regression"><i class="fa fa-check"></i><b>6.3</b> 명목 로지스틱 회귀모형</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="logistic-regression.html"><a href="logistic-regression.html#nominal-logistic-reg-basic-script"><i class="fa fa-check"></i><b>6.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="6.3.2" data-path="logistic-regression.html"><a href="logistic-regression.html#baseline-category-logit-model"><i class="fa fa-check"></i><b>6.3.2</b> 기준범주 로짓모형</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="logistic-regression.html"><a href="logistic-regression.html#ordinal-logistic-regression"><i class="fa fa-check"></i><b>6.4</b> 서열 로지스틱 회귀모형</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="logistic-regression.html"><a href="logistic-regression.html#ordinal-logistic-basic-script"><i class="fa fa-check"></i><b>6.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="6.4.2" data-path="logistic-regression.html"><a href="logistic-regression.html#cumulative-logit-model"><i class="fa fa-check"></i><b>6.4.2</b> 누적 로짓모형</a></li>
<li class="chapter" data-level="6.4.3" data-path="logistic-regression.html"><a href="logistic-regression.html#adjacent-categories-logit-model"><i class="fa fa-check"></i><b>6.4.3</b> 인근범주 로짓모형</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="da.html"><a href="da.html"><i class="fa fa-check"></i><b>7</b> 판별분석</a>
<ul>
<li class="chapter" data-level="7.1" data-path="da.html"><a href="da.html#da-overview"><i class="fa fa-check"></i><b>7.1</b> 개요</a></li>
<li class="chapter" data-level="7.2" data-path="da.html"><a href="da.html#da-packages-install"><i class="fa fa-check"></i><b>7.2</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="7.3" data-path="da.html"><a href="da.html#da-fisher"><i class="fa fa-check"></i><b>7.3</b> 피셔 방법</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="da.html"><a href="da.html#da-fisher-basic-script"><i class="fa fa-check"></i><b>7.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="7.3.2" data-path="da.html"><a href="da.html#피셔-판별함수"><i class="fa fa-check"></i><b>7.3.2</b> 피셔 판별함수</a></li>
<li class="chapter" data-level="7.3.3" data-path="da.html"><a href="da.html#분류-규칙"><i class="fa fa-check"></i><b>7.3.3</b> 분류 규칙</a></li>
<li class="chapter" data-level="7.3.4" data-path="da.html"><a href="da.html#r-패키지를-이용한-분류규칙-도출"><i class="fa fa-check"></i><b>7.3.4</b> R 패키지를 이용한 분류규칙 도출</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="da.html"><a href="da.html#lda"><i class="fa fa-check"></i><b>7.4</b> 의사결정론에 의한 선형분류규칙</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="da.html"><a href="da.html#lda-basic-script"><i class="fa fa-check"></i><b>7.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="7.4.2" data-path="da.html"><a href="da.html#lda-function"><i class="fa fa-check"></i><b>7.4.2</b> 선형판별함수</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="da.html"><a href="da.html#lda-misclassification-cost"><i class="fa fa-check"></i><b>7.5</b> 오분류비용을 고려한 분류규칙</a></li>
<li class="chapter" data-level="7.6" data-path="da.html"><a href="da.html#qda"><i class="fa fa-check"></i><b>7.6</b> 이차판별분석</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="da.html"><a href="da.html#qda-basic-script"><i class="fa fa-check"></i><b>7.6.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="7.6.2" data-path="da.html"><a href="da.html#qda-function"><i class="fa fa-check"></i><b>7.6.2</b> 이차 판별함수</a></li>
<li class="chapter" data-level="7.6.3" data-path="da.html"><a href="da.html#qda-discriminant-rule"><i class="fa fa-check"></i><b>7.6.3</b> 이차판별함수에 의한 분류</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="da.html"><a href="da.html#da-multiclass"><i class="fa fa-check"></i><b>7.7</b> 세 범주 이상의 분류</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="da.html"><a href="da.html#mutliclass-da-basic-script"><i class="fa fa-check"></i><b>7.7.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="7.7.2" data-path="da.html"><a href="da.html#mutliclass-generalized-discriminant-function"><i class="fa fa-check"></i><b>7.7.2</b> 일반화된 판별함수</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tree-based-method.html"><a href="tree-based-method.html"><i class="fa fa-check"></i><b>8</b> 트리기반 기법</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-overview"><i class="fa fa-check"></i><b>8.1</b> CART 개요</a></li>
<li class="chapter" data-level="8.2" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-packages-install"><i class="fa fa-check"></i><b>8.2</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="8.3" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-build"><i class="fa fa-check"></i><b>8.3</b> CART 트리 생성</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-basic-r-script"><i class="fa fa-check"></i><b>8.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="8.3.2" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-notation"><i class="fa fa-check"></i><b>8.3.2</b> 기호 정의</a></li>
<li class="chapter" data-level="8.3.3" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-impurity"><i class="fa fa-check"></i><b>8.3.3</b> 노드 및 트리의 불순도</a></li>
<li class="chapter" data-level="8.3.4" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-split"><i class="fa fa-check"></i><b>8.3.4</b> 분지기준</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-pruning-complete"><i class="fa fa-check"></i><b>8.4</b> 가지치기 및 최종 트리 선정</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-pruning"><i class="fa fa-check"></i><b>8.4.1</b> 가지치기</a></li>
<li class="chapter" data-level="8.4.2" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-best-tree"><i class="fa fa-check"></i><b>8.4.2</b> 최적 트리의 선정</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-r-pkg"><i class="fa fa-check"></i><b>8.5</b> R패키지 내 분류 트리 방법</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-r-pkg-split"><i class="fa fa-check"></i><b>8.5.1</b> 트리 확장</a></li>
<li class="chapter" data-level="8.5.2" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-r-pkg-pruning"><i class="fa fa-check"></i><b>8.5.2</b> 가지치기</a></li>
<li class="chapter" data-level="8.5.3" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-r-pkg-param"><i class="fa fa-check"></i><b>8.5.3</b> 파라미터값 결정</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="svm.html"><a href="svm.html"><i class="fa fa-check"></i><b>9</b> 서포트 벡터 머신</a>
<ul>
<li class="chapter" data-level="9.1" data-path="svm.html"><a href="svm.html#svm-overview"><i class="fa fa-check"></i><b>9.1</b> 개요</a></li>
<li class="chapter" data-level="9.2" data-path="svm.html"><a href="svm.html#svm-packages-install"><i class="fa fa-check"></i><b>9.2</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="9.3" data-path="svm.html"><a href="svm.html#linear-svm-separable"><i class="fa fa-check"></i><b>9.3</b> 선형 SVM - 분리 가능 경우</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="svm.html"><a href="svm.html#linear-svm-separable-basic-script"><i class="fa fa-check"></i><b>9.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="9.3.2" data-path="svm.html"><a href="svm.html#linear-svm-notation"><i class="fa fa-check"></i><b>9.3.2</b> 기호 정의</a></li>
<li class="chapter" data-level="9.3.3" data-path="svm.html"><a href="svm.html#linear-svm-separable-hyperplane"><i class="fa fa-check"></i><b>9.3.3</b> 최적 하이퍼플레인</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="svm.html"><a href="svm.html#linear-svm-inseparable"><i class="fa fa-check"></i><b>9.4</b> 선형 SVM - 분리 불가능 경우</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="svm.html"><a href="svm.html#linear-svm-inseparable-basic-script"><i class="fa fa-check"></i><b>9.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="9.4.2" data-path="svm.html"><a href="svm.html#linear-svm-inseparable-hyperplane"><i class="fa fa-check"></i><b>9.4.2</b> 최적 하이퍼플레인</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="svm.html"><a href="svm.html#nonlinear-svm"><i class="fa fa-check"></i><b>9.5</b> 비선형 SVM</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="svm.html"><a href="svm.html#nonlinear-svm-basic-script"><i class="fa fa-check"></i><b>9.5.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="9.5.2" data-path="svm.html"><a href="svm.html#nonlinear-svm-hyperplane"><i class="fa fa-check"></i><b>9.5.2</b> 최적 하이퍼플레인</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="svm.html"><a href="svm.html#svm-r-pkg"><i class="fa fa-check"></i><b>9.6</b> R패키지 내 SVM</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="svm.html"><a href="svm.html#svm-kernel-function"><i class="fa fa-check"></i><b>9.6.1</b> 커널함수</a></li>
<li class="chapter" data-level="9.6.2" data-path="svm.html"><a href="svm.html#svm-nu-classification"><i class="fa fa-check"></i><b>9.6.2</b> <span class="math inline">\(\nu\)</span>-SVC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html"><i class="fa fa-check"></i><b>10</b> 분류규칙의 성능 평가</a>
<ul>
<li class="chapter" data-level="10.1" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#classifier-evaluation-packages-install"><i class="fa fa-check"></i><b>10.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="10.2" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#classifier-evaluation-misclassification-rate"><i class="fa fa-check"></i><b>10.2</b> 분류오류율</a></li>
<li class="chapter" data-level="10.3" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#precision-sensitivity-specificity"><i class="fa fa-check"></i><b>10.3</b> 정확도, 민감도 및 특이도</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#confusion-matrix-r-package"><i class="fa fa-check"></i><b>10.3.1</b> R 패키지 내 정오분류표</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#roc-curve"><i class="fa fa-check"></i><b>10.4</b> ROC 곡선</a></li>
<li class="chapter" data-level="10.5" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#gain-chart"><i class="fa fa-check"></i><b>10.5</b> 이익도표</a></li>
</ul></li>
<li class="part"><span><b>III 3부 - 군집분석</b></span></li>
<li class="chapter" data-level="11" data-path="clustering-overview.html"><a href="clustering-overview.html"><i class="fa fa-check"></i><b>11</b> 군집분석 개요</a>
<ul>
<li class="chapter" data-level="11.1" data-path="clustering-overview.html"><a href="clustering-overview.html#clustering-overview-packages-install"><i class="fa fa-check"></i><b>11.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="11.2" data-path="clustering-overview.html"><a href="clustering-overview.html#clustering-method"><i class="fa fa-check"></i><b>11.2</b> 군집분석 기법</a></li>
<li class="chapter" data-level="11.3" data-path="clustering-overview.html"><a href="clustering-overview.html#object-similarity-metric"><i class="fa fa-check"></i><b>11.3</b> 객체 간의 유사성 척도</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="clustering-overview.html"><a href="clustering-overview.html#object-distance-metric"><i class="fa fa-check"></i><b>11.3.1</b> 거리 관련 척도</a></li>
<li class="chapter" data-level="11.3.2" data-path="clustering-overview.html"><a href="clustering-overview.html#object-correlation-metric"><i class="fa fa-check"></i><b>11.3.2</b> 상관계수 관련 척도</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="clustering-overview.html"><a href="clustering-overview.html#category-similarity-metric"><i class="fa fa-check"></i><b>11.4</b> 범주형 객체의 유사성 척도</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="clustering-overview.html"><a href="clustering-overview.html#binary-similarity-metric"><i class="fa fa-check"></i><b>11.4.1</b> 이분형 변수의 경우</a></li>
<li class="chapter" data-level="11.4.2" data-path="clustering-overview.html"><a href="clustering-overview.html#ordinal-similarity-metric"><i class="fa fa-check"></i><b>11.4.2</b> 서열형 변수의 경우</a></li>
<li class="chapter" data-level="11.4.3" data-path="clustering-overview.html"><a href="clustering-overview.html#nominal-similarity-metric"><i class="fa fa-check"></i><b>11.4.3</b> 명목형 변수의 경우</a></li>
<li class="chapter" data-level="11.4.4" data-path="clustering-overview.html"><a href="clustering-overview.html#mixed-similarity-metric"><i class="fa fa-check"></i><b>11.4.4</b> 혼합형의 경우</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html"><i class="fa fa-check"></i><b>12</b> 계층적 군집방법</a>
<ul>
<li class="chapter" data-level="12.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#hierarchical-clustering-packages-install"><i class="fa fa-check"></i><b>12.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="12.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#distance-between-clusters"><i class="fa fa-check"></i><b>12.2</b> 군집 간 거리척도 및 연결법</a></li>
<li class="chapter" data-level="12.3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#linkage-method"><i class="fa fa-check"></i><b>12.3</b> 연결법의 군집 알고리즘</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#linkage-method-basic-script"><i class="fa fa-check"></i><b>12.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="12.3.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#linkage-method-algorithm"><i class="fa fa-check"></i><b>12.3.2</b> 연결법 군집 알고리즘</a></li>
<li class="chapter" data-level="12.3.3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#hclust"><i class="fa fa-check"></i><b>12.3.3</b> R 패키지 내 연결법</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#ward-method"><i class="fa fa-check"></i><b>12.4</b> 워드 방법</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#ward-method-basic-script"><i class="fa fa-check"></i><b>12.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="12.4.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#ward-method-algorithm"><i class="fa fa-check"></i><b>12.4.2</b> 워드 군집 알고리즘</a></li>
<li class="chapter" data-level="12.4.3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#ward-rpackages"><i class="fa fa-check"></i><b>12.4.3</b> R 패키지 내 워드 방법</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#diana"><i class="fa fa-check"></i><b>12.5</b> 분리적 방법 - 다이아나</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#diana-basic-script"><i class="fa fa-check"></i><b>12.5.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="12.5.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#diana-algorithm"><i class="fa fa-check"></i><b>12.5.2</b> 다이아나 알고리즘</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#hierarchical-cluster-number"><i class="fa fa-check"></i><b>12.6</b> 군집수의 결정</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html"><i class="fa fa-check"></i><b>13</b> 비계층적 군집방법</a>
<ul>
<li class="chapter" data-level="13.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#nonhierarchical-clustering-packages-install"><i class="fa fa-check"></i><b>13.1</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="13.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans"><i class="fa fa-check"></i><b>13.2</b> K-means 알고리즘</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans-basic-script"><i class="fa fa-check"></i><b>13.2.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="13.2.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans-algorithm"><i class="fa fa-check"></i><b>13.2.2</b> 알고리즘</a></li>
<li class="chapter" data-level="13.2.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans-user-defined-functions"><i class="fa fa-check"></i><b>13.2.3</b> R 스크립트 구현</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmedoids"><i class="fa fa-check"></i><b>13.3</b> K-medoids 군집방법</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#pam"><i class="fa fa-check"></i><b>13.3.1</b> PAM 알고리즘</a></li>
<li class="chapter" data-level="13.3.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#clara"><i class="fa fa-check"></i><b>13.3.2</b> CLARA 알고리즘</a></li>
<li class="chapter" data-level="13.3.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#clarans"><i class="fa fa-check"></i><b>13.3.3</b> CLARANS 알고리즘</a></li>
<li class="chapter" data-level="13.3.4" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans-like"><i class="fa fa-check"></i><b>13.3.4</b> K-means-like 알고리즘</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#fuzzy-kmeans"><i class="fa fa-check"></i><b>13.4</b> 퍼지 K-means 알고리즘</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#fuzzy-kmeans-basic-script"><i class="fa fa-check"></i><b>13.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="13.4.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#fuzzy-kmeans-algorithm"><i class="fa fa-check"></i><b>13.4.2</b> 알고리즘</a></li>
<li class="chapter" data-level="13.4.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#fuzzy-kmeans-script-implement"><i class="fa fa-check"></i><b>13.4.3</b> R 스크립트 구현</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#model-based-clustering"><i class="fa fa-check"></i><b>13.5</b> 모형기반 군집방법</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#model-based-clustering-basic-script"><i class="fa fa-check"></i><b>13.5.1</b> 기본 R script</a></li>
<li class="chapter" data-level="13.5.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#model-based-clustering-em"><i class="fa fa-check"></i><b>13.5.2</b> EM 알고리즘</a></li>
<li class="chapter" data-level="13.5.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#model-based-clustering-script-implement"><i class="fa fa-check"></i><b>13.5.3</b> R 스크립트 구현</a></li>
<li class="chapter" data-level="13.5.4" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#r-packages-model-based-clustering"><i class="fa fa-check"></i><b>13.5.4</b> R 패키지 내 모형기반 군집분석</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html"><i class="fa fa-check"></i><b>14</b> 군집해의 평가 및 해석</a>
<ul>
<li class="chapter" data-level="14.1" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-solution-evaluation-packages-install"><i class="fa fa-check"></i><b>14.1</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="14.2" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-solution-evaluation-metric"><i class="fa fa-check"></i><b>14.2</b> 군집해의 평가</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-evaluation-external-index"><i class="fa fa-check"></i><b>14.2.1</b> 외부평가지수</a></li>
<li class="chapter" data-level="14.2.2" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-evaluation-internal-index"><i class="fa fa-check"></i><b>14.2.2</b> 내부평가지수</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-solution-interpretation"><i class="fa fa-check"></i><b>14.3</b> 군집해의 해석</a></li>
</ul></li>
<li class="part"><span><b>IV 4부 - 연관규칙</b></span></li>
<li class="chapter" data-level="15" data-path="association-rule.html"><a href="association-rule.html"><i class="fa fa-check"></i><b>15</b> 연관규칙</a>
<ul>
<li class="chapter" data-level="15.1" data-path="association-rule.html"><a href="association-rule.html#association-packages-install"><i class="fa fa-check"></i><b>15.1</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="15.2" data-path="association-rule.html"><a href="association-rule.html#association-rule-definition-metric"><i class="fa fa-check"></i><b>15.2</b> 연관규칙의 정의 및 성능척도</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="association-rule.html"><a href="association-rule.html#association-rule-support"><i class="fa fa-check"></i><b>15.2.1</b> 지지도</a></li>
<li class="chapter" data-level="15.2.2" data-path="association-rule.html"><a href="association-rule.html#association-rule-confidence"><i class="fa fa-check"></i><b>15.2.2</b> 신뢰도</a></li>
<li class="chapter" data-level="15.2.3" data-path="association-rule.html"><a href="association-rule.html#association-rule-lift"><i class="fa fa-check"></i><b>15.2.3</b> 개선도</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="association-rule.html"><a href="association-rule.html#association-rule-exploration"><i class="fa fa-check"></i><b>15.3</b> 연관규칙의 탐사</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="association-rule.html"><a href="association-rule.html#apriori-large-itemsets"><i class="fa fa-check"></i><b>15.3.1</b> 빈발항목집합 생성</a></li>
<li class="chapter" data-level="15.3.2" data-path="association-rule.html"><a href="association-rule.html#apriori-rule-exploration"><i class="fa fa-check"></i><b>15.3.2</b> 규칙의 탐사</a></li>
<li class="chapter" data-level="15.3.3" data-path="association-rule.html"><a href="association-rule.html#apriori-r-package"><i class="fa fa-check"></i><b>15.3.3</b> R 패키지 내 Apriori</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="association-rule.html"><a href="association-rule.html#association-sequential-pattern"><i class="fa fa-check"></i><b>15.4</b> 순차적 패턴의 탐사</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="association-rule.html"><a href="association-rule.html#association-aprioriall"><i class="fa fa-check"></i><b>15.4.1</b> AprioriAll 알고리즘</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="recommender-system.html"><a href="recommender-system.html"><i class="fa fa-check"></i><b>16</b> 추천시스템</a>
<ul>
<li class="chapter" data-level="16.1" data-path="recommender-system.html"><a href="recommender-system.html#recommender-packages-install"><i class="fa fa-check"></i><b>16.1</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="16.2" data-path="recommender-system.html"><a href="recommender-system.html#content-based-recommender"><i class="fa fa-check"></i><b>16.2</b> 내용기반 추천시스템</a></li>
<li class="chapter" data-level="16.3" data-path="recommender-system.html"><a href="recommender-system.html#collaborative-filtering"><i class="fa fa-check"></i><b>16.3</b> 협업 필터링</a></li>
<li class="chapter" data-level="16.4" data-path="recommender-system.html"><a href="recommender-system.html#market-basket"><i class="fa fa-check"></i><b>16.4</b> 시장바구니 데이터를 이용한 협업 필터링</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">데이터마이닝 with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nonhierarchical-clustering" class="section level1" number="13">
<h1><span class="header-section-number">Chapter 13</span> 비계층적 군집방법</h1>
<p>비계층적 군집방법(Nonhierarchical clustering)은 분할방법(Partitioning method)이라고도 하는데, 군집의 수 <span class="math inline">\(K\)</span>를 사전에 지정하고 대상 객체들을 적절한 군집에 배정하는 방법이다. 즉, 이 방법은 <span class="math inline">\(n\)</span>개의 객체를 <span class="math inline">\(K\)</span>개의 군집에 할당하는 최적화 문제로 간주할 수 있다. 본 장에서는 분할방법의 대표적인 K-means 알고리즘, K-medoids 군집방법, 퍼지 K-means 알고리즘, 그리고 모형기반 군집방법에 대하여 주로 알아본다.</p>
<div id="nonhierarchical-clustering-packages-install" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> 필요 R package 설치</h2>
<p>본 장에서 필요한 R 패키지들은 아래와 같다.</p>
<table>
<thead>
<tr class="header">
<th align="left">package</th>
<th align="left">version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">1.3.1</td>
</tr>
<tr class="even">
<td align="left">stats</td>
<td align="left">4.1.0</td>
</tr>
<tr class="odd">
<td align="left">cluster</td>
<td align="left">2.1.2</td>
</tr>
<tr class="even">
<td align="left">flexclust</td>
<td align="left">1.4-0</td>
</tr>
<tr class="odd">
<td align="left">mclust</td>
<td align="left">5.4.7</td>
</tr>
<tr class="even">
<td align="left">mvtnorm</td>
<td align="left">1.1-2</td>
</tr>
</tbody>
</table>
</div>
<div id="kmeans" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> K-means 알고리즘</h2>
<p>K-means 알고리즘은 비계층적 군집방법 중 가장 널리 사용되는 것으로 <span class="math inline">\(K\)</span>개 군집의 중심좌표를 고려하여 각 객체를 가까운 군집에 배정하는 반복적 알고리즘이다.</p>
<div id="kmeans-basic-script" class="section level3" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> 기본 R 스크립트</h3>
<p>10명에 대한 PC의 사용경력(<span class="math inline">\(x_1\)</span>)과 주당 사용시간(<span class="math inline">\(x_2\)</span>)이 다음과 같다.</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="nonhierarchical-clustering.html#cb446-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb446-2"><a href="nonhierarchical-clustering.html#cb446-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>x1, <span class="sc">~</span>x2,</span>
<span id="cb446-3"><a href="nonhierarchical-clustering.html#cb446-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">14</span>,</span>
<span id="cb446-4"><a href="nonhierarchical-clustering.html#cb446-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">13</span>,</span>
<span id="cb446-5"><a href="nonhierarchical-clustering.html#cb446-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">14</span>, <span class="dv">6</span>,</span>
<span id="cb446-6"><a href="nonhierarchical-clustering.html#cb446-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">11</span>, <span class="dv">8</span>,</span>
<span id="cb446-7"><a href="nonhierarchical-clustering.html#cb446-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">7</span>,</span>
<span id="cb446-8"><a href="nonhierarchical-clustering.html#cb446-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">15</span>,</span>
<span id="cb446-9"><a href="nonhierarchical-clustering.html#cb446-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">7</span>, <span class="dv">13</span>, <span class="dv">6</span>,</span>
<span id="cb446-10"><a href="nonhierarchical-clustering.html#cb446-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">4</span>,</span>
<span id="cb446-11"><a href="nonhierarchical-clustering.html#cb446-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9</span>, <span class="dv">3</span>, <span class="dv">3</span>,</span>
<span id="cb446-12"><a href="nonhierarchical-clustering.html#cb446-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">2</span></span>
<span id="cb446-13"><a href="nonhierarchical-clustering.html#cb446-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb446-14"><a href="nonhierarchical-clustering.html#cb446-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-15"><a href="nonhierarchical-clustering.html#cb446-15" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb446-16"><a href="nonhierarchical-clustering.html#cb446-16" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb446-17"><a href="nonhierarchical-clustering.html#cb446-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb446-18"><a href="nonhierarchical-clustering.html#cb446-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>),</span>
<span id="cb446-19"><a href="nonhierarchical-clustering.html#cb446-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb446-20"><a href="nonhierarchical-clustering.html#cb446-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;객체번호&#39;</span>, </span>
<span id="cb446-21"><a href="nonhierarchical-clustering.html#cb446-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;사용경력($x_1$)&#39;</span>, <span class="st">&#39;사용시간($x_2$)&#39;</span></span>
<span id="cb446-22"><a href="nonhierarchical-clustering.html#cb446-22" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb446-23"><a href="nonhierarchical-clustering.html#cb446-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&#39;PC 사용 데이터&#39;</span></span>
<span id="cb446-24"><a href="nonhierarchical-clustering.html#cb446-24" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:kmeans-train-data">Table 13.1: </span>PC 사용 데이터</caption>
<thead>
<tr class="header">
<th align="right">객체번호</th>
<th align="right">사용경력(<span class="math inline">\(x_1\)</span>)</th>
<th align="right">사용시간(<span class="math inline">\(x_2\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">8</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">14</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">11</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">7</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">13</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">5</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>아래와 같이 <code>stats</code> 패키지의 <code>kmeans</code> 함수를 이용하여 K-means 알고리즘 수행 결과를 얻을 수 있다. 아래 스크립트는 군집 수가 <span class="math inline">\(K = 3\)</span>라 가정하여 수행한 예이다.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="nonhierarchical-clustering.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb447-2"><a href="nonhierarchical-clustering.html#cb447-2" aria-hidden="true" tabindex="-1"></a>kmeans_solution <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(<span class="at">x =</span> df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">centers =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>위 스크립트 실행 결과 도출된 군집 중심좌표는 위에서 얻어진 <code>kmeans</code> 클래스 객체의 <code>centers</code>값에 저장된다.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="nonhierarchical-clustering.html#cb448-1" aria-hidden="true" tabindex="-1"></a>kmeans_solution<span class="sc">$</span>centers</span></code></pre></div>
<pre><code>##          x1    x2
## 1 13.250000  6.75
## 2  3.666667  3.00
## 3  7.000000 14.00</code></pre>
<p>또한 각 학습 데이터가 속한 군집은 <code>cluster</code>값에 저장된다.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="nonhierarchical-clustering.html#cb450-1" aria-hidden="true" tabindex="-1"></a>kmeans_solution<span class="sc">$</span>cluster</span></code></pre></div>
<pre><code>##  [1] 3 3 1 1 1 3 1 2 2 2</code></pre>
<p>객체의 군집결과는 아래와 같이 도식화하여 보일 수 있다.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="nonhierarchical-clustering.html#cb452-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb452-2"><a href="nonhierarchical-clustering.html#cb452-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">as.factor</span>(kmeans_solution<span class="sc">$</span>cluster)) <span class="sc">%&gt;%</span></span>
<span id="cb452-3"><a href="nonhierarchical-clustering.html#cb452-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2)) <span class="sc">+</span></span>
<span id="cb452-4"><a href="nonhierarchical-clustering.html#cb452-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> id, <span class="at">color =</span> cluster))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:kmeans-cluster"></span>
<img src="data-mining-book_files/figure-html/kmeans-cluster-1.png" alt="K-means 수행 결과" width="672" />
<p class="caption">
Figure 13.1: K-means 수행 결과
</p>
</div>
</div>
<div id="kmeans-algorithm" class="section level3" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> 알고리즘</h3>
<p>K-means 알고리즘의 구체적 절차는 아래와 같다. Table <a href="nonhierarchical-clustering.html#tab:kmeans-train-data">13.1</a>에 대한 각 단계의 결과를 함께 살펴보자.</p>
<p><strong>[단계 0] (초기 객체 선정)</strong> 어떤 규칙에 의하여 <span class="math inline">\(K\)</span>개의 객체의 좌표를 초기 군집의 중심좌표(centroid)로 선정한다. 군집 <span class="math inline">\(j\)</span>의 중심좌표를 <span class="math inline">\(\mathbf{c}_j = \left(\bar{x}^{(j)}_1, \cdots, \bar{x}^{(j)}_p\right)^\top\)</span>라 하자. 초기 군집 중심좌표 <span class="math inline">\(\mathbf{c}_1, \cdots, \mathbf{c}_K\)</span>를 선정하는 방법은 예를 들어 다음과 같은 규칙이 사용된다.</p>
<ul>
<li>무작위 방법: 대상 객체 중 무작위로 <span class="math inline">\(K\)</span>개를 선정한다.</li>
<li>외각 객체 선정: 전체 객체의 중심좌표에서 가장 멀리 위치하는 <span class="math inline">\(K\)</span>개의 객체를 선정한다.</li>
</ul>
<p>[단계 0] 무작위 방법을 이용하여 Table <a href="nonhierarchical-clustering.html#tab:kmeans-train-data">13.1</a>으로부터 3개의 객체를 초기 군집 중심좌표로 선정하자.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="nonhierarchical-clustering.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb453-2"><a href="nonhierarchical-clustering.html#cb453-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-3"><a href="nonhierarchical-clustering.html#cb453-3" aria-hidden="true" tabindex="-1"></a>init_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">k =</span> <span class="dv">1</span>) {</span>
<span id="cb453-4"><a href="nonhierarchical-clustering.html#cb453-4" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">min</span>(k, <span class="fu">nrow</span>(df))</span>
<span id="cb453-5"><a href="nonhierarchical-clustering.html#cb453-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb453-6"><a href="nonhierarchical-clustering.html#cb453-6" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb453-7"><a href="nonhierarchical-clustering.html#cb453-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample_n</span>(k)</span>
<span id="cb453-8"><a href="nonhierarchical-clustering.html#cb453-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb453-9"><a href="nonhierarchical-clustering.html#cb453-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-10"><a href="nonhierarchical-clustering.html#cb453-10" aria-hidden="true" tabindex="-1"></a>cluster_df <span class="ot">&lt;-</span> <span class="fu">init_cluster</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">3</span>)</span>
<span id="cb453-11"><a href="nonhierarchical-clustering.html#cb453-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-12"><a href="nonhierarchical-clustering.html#cb453-12" aria-hidden="true" tabindex="-1"></a>cluster_df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      x1    x2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1    14     6
## 2     3     2
## 3     8    13</code></pre>
<p><strong>[단계 1] (객체의 군집 배정)</strong> 각 객체에 대하여 <span class="math inline">\(K\)</span>개의 군집 중심좌표(centroid)와의 거리(주로 유클리드 거리 사용)를 산출한 후 가장 가까운 군집에 그 객체를 배정한다.</p>
<p><span class="math display">\[\begin{equation*}
a_{ij} = \begin{cases}
1 &amp; \text{if } j = \arg\,\max_k d(\mathbf{x}_i, \mathbf{c}_k)\\
0 &amp; \text{otherwise}
\end{cases}, \, i = 1, \cdots, n, \, j = 1, \cdots, K
\end{equation*}\]</span></p>
<p>각 객체에 대하여 3개의 군집 중심좌표와의 거리를 산출해보면 아래와 같다.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="nonhierarchical-clustering.html#cb455-1" aria-hidden="true" tabindex="-1"></a>flexclust<span class="sc">::</span><span class="fu">dist2</span>(df[, <span class="sc">-</span><span class="dv">1</span>], cluster_df)</span></code></pre></div>
<pre><code>##            [,1]      [,2]      [,3]
##  [1,] 11.313708 12.369317  2.236068
##  [2,]  9.219544 12.083046  0.000000
##  [3,]  0.000000 11.704700  9.219544
##  [4,]  3.605551 10.000000  5.830952
##  [5,]  1.414214 13.000000  9.219544
##  [6,] 11.401754 13.601471  2.236068
##  [7,]  1.000000 10.770330  8.602325
##  [8,]  9.219544  2.828427  9.486833
##  [9,] 11.401754  1.000000 11.180340
## [10,] 11.704700  0.000000 12.083046</code></pre>
<p>이에 각 객체들에 대해 거리가 가장 가까운 군집에 그 객체를 배정한다.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="nonhierarchical-clustering.html#cb457-1" aria-hidden="true" tabindex="-1"></a>assign_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(df, cluster_df) {</span>
<span id="cb457-2"><a href="nonhierarchical-clustering.html#cb457-2" aria-hidden="true" tabindex="-1"></a>  cluster_ind <span class="ot">&lt;-</span> flexclust<span class="sc">::</span><span class="fu">dist2</span>(df, cluster_df) <span class="sc">%&gt;%</span></span>
<span id="cb457-3"><a href="nonhierarchical-clustering.html#cb457-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span>(<span class="dv">1</span>, which.min)</span>
<span id="cb457-4"><a href="nonhierarchical-clustering.html#cb457-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb457-5"><a href="nonhierarchical-clustering.html#cb457-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="fu">unique</span>(cluster_ind), <span class="sc">~</span><span class="fu">which</span>(cluster_ind <span class="sc">==</span> .))</span>
<span id="cb457-6"><a href="nonhierarchical-clustering.html#cb457-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb457-7"><a href="nonhierarchical-clustering.html#cb457-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-8"><a href="nonhierarchical-clustering.html#cb457-8" aria-hidden="true" tabindex="-1"></a>cluster_objects <span class="ot">&lt;-</span> <span class="fu">assign_cluster</span>(df[, <span class="sc">-</span><span class="dv">1</span>], cluster_df)</span>
<span id="cb457-9"><a href="nonhierarchical-clustering.html#cb457-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-10"><a href="nonhierarchical-clustering.html#cb457-10" aria-hidden="true" tabindex="-1"></a>cluster_objects</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 6
## 
## [[2]]
## [1] 3 4 5 7
## 
## [[3]]
## [1]  8  9 10</code></pre>
<p><strong>[단계 2] (군집 중심좌표의 산출)</strong> 새로운 군집에 대한 중심좌표를 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
\bar{x}^{(j)}_l = \frac{\sum_{i} a_{ij} x_{li}}{\sum_{i} a_{ij}}, \, l = 1, \cdots, p, \, j = 1, \cdots, K
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="nonhierarchical-clustering.html#cb459-1" aria-hidden="true" tabindex="-1"></a>find_center <span class="ot">&lt;-</span> <span class="cf">function</span>(df, cluster) {</span>
<span id="cb459-2"><a href="nonhierarchical-clustering.html#cb459-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(cluster, <span class="sc">~</span>df[., ] <span class="sc">%&gt;%</span> <span class="fu">summarize_all</span>(mean)) </span>
<span id="cb459-3"><a href="nonhierarchical-clustering.html#cb459-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb459-4"><a href="nonhierarchical-clustering.html#cb459-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-5"><a href="nonhierarchical-clustering.html#cb459-5" aria-hidden="true" tabindex="-1"></a>new_cluster_df <span class="ot">&lt;-</span> <span class="fu">find_center</span>(df[, <span class="sc">-</span><span class="dv">1</span>], cluster_objects)</span>
<span id="cb459-6"><a href="nonhierarchical-clustering.html#cb459-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-7"><a href="nonhierarchical-clustering.html#cb459-7" aria-hidden="true" tabindex="-1"></a>new_cluster_df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      x1    x2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  7    14   
## 2 13.2   6.75
## 3  3.67  3</code></pre>
<p><strong>[단계 3] (수렴 조건 점검)</strong> 새로 산출된 중심좌표값과 이전 좌표값을 비교하여 수렴 조건 내에 들면 마치며, 그렇지 않으면 단계 1을 반복한다.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="nonhierarchical-clustering.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(cluster_df, new_cluster_df)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>위의 경우, 군집 중심좌표가 다르므로 다음 iteration을 진행한다.</p>
</div>
<div id="kmeans-user-defined-functions" class="section level3" number="13.2.3">
<h3><span class="header-section-number">13.2.3</span> R 스크립트 구현</h3>
<p>위의 과정을 군집해가 수렴할 때까지 반복하도록 아래와 같이 R 스크립트를 구현해보자.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="nonhierarchical-clustering.html#cb463-1" aria-hidden="true" tabindex="-1"></a>init_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">k =</span> <span class="dv">1</span>) {</span>
<span id="cb463-2"><a href="nonhierarchical-clustering.html#cb463-2" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">min</span>(k, <span class="fu">nrow</span>(df))</span>
<span id="cb463-3"><a href="nonhierarchical-clustering.html#cb463-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-4"><a href="nonhierarchical-clustering.html#cb463-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(k)</span>
<span id="cb463-5"><a href="nonhierarchical-clustering.html#cb463-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb463-6"><a href="nonhierarchical-clustering.html#cb463-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-7"><a href="nonhierarchical-clustering.html#cb463-7" aria-hidden="true" tabindex="-1"></a>assign_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(df, cluster_df) {</span>
<span id="cb463-8"><a href="nonhierarchical-clustering.html#cb463-8" aria-hidden="true" tabindex="-1"></a>  cluster_ind <span class="ot">&lt;-</span> flexclust<span class="sc">::</span><span class="fu">dist2</span>(df, cluster_df) <span class="sc">%&gt;%</span></span>
<span id="cb463-9"><a href="nonhierarchical-clustering.html#cb463-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span>(<span class="dv">1</span>, which.min)</span>
<span id="cb463-10"><a href="nonhierarchical-clustering.html#cb463-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-11"><a href="nonhierarchical-clustering.html#cb463-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="fu">unique</span>(cluster_ind), <span class="sc">~</span><span class="fu">which</span>(cluster_ind <span class="sc">==</span> .))</span>
<span id="cb463-12"><a href="nonhierarchical-clustering.html#cb463-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb463-13"><a href="nonhierarchical-clustering.html#cb463-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-14"><a href="nonhierarchical-clustering.html#cb463-14" aria-hidden="true" tabindex="-1"></a>find_center <span class="ot">&lt;-</span> <span class="cf">function</span>(df, cluster) {</span>
<span id="cb463-15"><a href="nonhierarchical-clustering.html#cb463-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(cluster, <span class="sc">~</span>df[., ] <span class="sc">%&gt;%</span> <span class="fu">summarize_all</span>(mean)) </span>
<span id="cb463-16"><a href="nonhierarchical-clustering.html#cb463-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb463-17"><a href="nonhierarchical-clustering.html#cb463-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-18"><a href="nonhierarchical-clustering.html#cb463-18" aria-hidden="true" tabindex="-1"></a>kmeans_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb463-19"><a href="nonhierarchical-clustering.html#cb463-19" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">min</span>(k, <span class="fu">nrow</span>(df))</span>
<span id="cb463-20"><a href="nonhierarchical-clustering.html#cb463-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-21"><a href="nonhierarchical-clustering.html#cb463-21" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> 0L</span>
<span id="cb463-22"><a href="nonhierarchical-clustering.html#cb463-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-23"><a href="nonhierarchical-clustering.html#cb463-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 단계 0</span></span>
<span id="cb463-24"><a href="nonhierarchical-clustering.html#cb463-24" aria-hidden="true" tabindex="-1"></a>  cluster_df <span class="ot">&lt;-</span> <span class="fu">init_cluster</span>(df, k)</span>
<span id="cb463-25"><a href="nonhierarchical-clustering.html#cb463-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-26"><a href="nonhierarchical-clustering.html#cb463-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(<span class="cn">TRUE</span>) {</span>
<span id="cb463-27"><a href="nonhierarchical-clustering.html#cb463-27" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> 1L</span>
<span id="cb463-28"><a href="nonhierarchical-clustering.html#cb463-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb463-29"><a href="nonhierarchical-clustering.html#cb463-29" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 단계 1</span></span>
<span id="cb463-30"><a href="nonhierarchical-clustering.html#cb463-30" aria-hidden="true" tabindex="-1"></a>    cluster_objects <span class="ot">&lt;-</span> <span class="fu">assign_cluster</span>(df, cluster_df)</span>
<span id="cb463-31"><a href="nonhierarchical-clustering.html#cb463-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verbose) { <span class="co"># 군집해 출력</span></span>
<span id="cb463-32"><a href="nonhierarchical-clustering.html#cb463-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">&quot;Iteration&quot;</span>, i, <span class="st">&quot;:&quot;</span>, </span>
<span id="cb463-33"><a href="nonhierarchical-clustering.html#cb463-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">map</span>(cluster_objects, <span class="sc">~</span> <span class="fu">str_c</span>(<span class="st">&quot;{&quot;</span>, <span class="fu">str_c</span>(., <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;}&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb463-34"><a href="nonhierarchical-clustering.html#cb463-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>),</span>
<span id="cb463-35"><a href="nonhierarchical-clustering.html#cb463-35" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb463-36"><a href="nonhierarchical-clustering.html#cb463-36" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb463-37"><a href="nonhierarchical-clustering.html#cb463-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb463-38"><a href="nonhierarchical-clustering.html#cb463-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb463-39"><a href="nonhierarchical-clustering.html#cb463-39" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 단계 2</span></span>
<span id="cb463-40"><a href="nonhierarchical-clustering.html#cb463-40" aria-hidden="true" tabindex="-1"></a>    new_cluster_df <span class="ot">&lt;-</span> <span class="fu">find_center</span>(df, cluster_objects)</span>
<span id="cb463-41"><a href="nonhierarchical-clustering.html#cb463-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-42"><a href="nonhierarchical-clustering.html#cb463-42" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 단계 3</span></span>
<span id="cb463-43"><a href="nonhierarchical-clustering.html#cb463-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">identical</span>(cluster_df, new_cluster_df)) <span class="cf">break</span></span>
<span id="cb463-44"><a href="nonhierarchical-clustering.html#cb463-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb463-45"><a href="nonhierarchical-clustering.html#cb463-45" aria-hidden="true" tabindex="-1"></a>    cluster_df <span class="ot">&lt;-</span> new_cluster_df</span>
<span id="cb463-46"><a href="nonhierarchical-clustering.html#cb463-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb463-47"><a href="nonhierarchical-clustering.html#cb463-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-48"><a href="nonhierarchical-clustering.html#cb463-48" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb463-49"><a href="nonhierarchical-clustering.html#cb463-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_centers =</span> cluster_df,</span>
<span id="cb463-50"><a href="nonhierarchical-clustering.html#cb463-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">assgined_objects =</span> cluster_objects,</span>
<span id="cb463-51"><a href="nonhierarchical-clustering.html#cb463-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_iteration =</span> i</span>
<span id="cb463-52"><a href="nonhierarchical-clustering.html#cb463-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb463-53"><a href="nonhierarchical-clustering.html#cb463-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-54"><a href="nonhierarchical-clustering.html#cb463-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (res)</span>
<span id="cb463-55"><a href="nonhierarchical-clustering.html#cb463-55" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="nonhierarchical-clustering.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb464-2"><a href="nonhierarchical-clustering.html#cb464-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-3"><a href="nonhierarchical-clustering.html#cb464-3" aria-hidden="true" tabindex="-1"></a>kmeans_solution <span class="ot">&lt;-</span> <span class="fu">kmeans_cluster</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">k =</span> <span class="dv">3</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Iteration 1 : {1, 2, 6}, {3, 4, 5, 7}, {8, 9, 10} 
## Iteration 2 : {1, 2, 6}, {3, 4, 5, 7}, {8, 9, 10}</code></pre>
<p>위와 같이 2번째 Iteration에서 군집해가 수렴하였으며, 최종 군집해는 아래와 같다.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="nonhierarchical-clustering.html#cb466-1" aria-hidden="true" tabindex="-1"></a>kmeans_solution<span class="sc">$</span>assgined_objects</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 6
## 
## [[2]]
## [1] 3 4 5 7
## 
## [[3]]
## [1]  8  9 10</code></pre>
</div>
</div>
<div id="kmedoids" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> K-medoids 군집방법</h2>
<p>K-means 알고리즘에서는 각 군집의 중심좌표(centroid)를 군집 중심으로 고려하고 있는 반면, K-medoids 군집방법에서는 각 군집의 대표객체를 군집 중심으로 고려한다.</p>
<p>K-medoids 군집방법의 알고리즘으로 잘 알려진 것에는 다음과 같은 것들이 있다.</p>
<ol style="list-style-type: decimal">
<li>PAM(Partitioning Around Medoids)</li>
<li>CLARA(Clustering LARge Applications)</li>
<li>CLARANS(Clustering Large Applications based on RANdomized Search)</li>
<li>K-means-like 알고리즘</li>
</ol>
<div id="pam" class="section level3" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> PAM 알고리즘</h3>
<p>PAM 알고리즘은 <span class="citation"><a href="#ref-kaufman1990finding" role="doc-biblioref">Kaufman and Rousseeuw</a> (<a href="#ref-kaufman1990finding" role="doc-biblioref">1990</a>)</span> 에 의하여 발표된 것으로, 초기 대표객체를 선정하는 방법인 <strong>BUILD</strong>와 더 나은 군집해를 찾아나가는 과정인 <strong>SWAP</strong>의 두 부분으로 구성되어 있다.</p>
<div id="pam-basic-script" class="section level4" number="13.3.1.1">
<h4><span class="header-section-number">13.3.1.1</span> 기본 R 스크립트</h4>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="nonhierarchical-clustering.html#cb468-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb468-2"><a href="nonhierarchical-clustering.html#cb468-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>x1, <span class="sc">~</span>x2,</span>
<span id="cb468-3"><a href="nonhierarchical-clustering.html#cb468-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>,</span>
<span id="cb468-4"><a href="nonhierarchical-clustering.html#cb468-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>,</span>
<span id="cb468-5"><a href="nonhierarchical-clustering.html#cb468-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">11</span>, <span class="dv">8</span>,</span>
<span id="cb468-6"><a href="nonhierarchical-clustering.html#cb468-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">13</span>, <span class="dv">6</span>,</span>
<span id="cb468-7"><a href="nonhierarchical-clustering.html#cb468-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span>, <span class="dv">14</span>, <span class="dv">6</span>,</span>
<span id="cb468-8"><a href="nonhierarchical-clustering.html#cb468-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>, <span class="dv">15</span>, <span class="dv">7</span></span>
<span id="cb468-9"><a href="nonhierarchical-clustering.html#cb468-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb468-10"><a href="nonhierarchical-clustering.html#cb468-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-11"><a href="nonhierarchical-clustering.html#cb468-11" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb468-12"><a href="nonhierarchical-clustering.html#cb468-12" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb468-13"><a href="nonhierarchical-clustering.html#cb468-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb468-14"><a href="nonhierarchical-clustering.html#cb468-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>),</span>
<span id="cb468-15"><a href="nonhierarchical-clustering.html#cb468-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb468-16"><a href="nonhierarchical-clustering.html#cb468-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;객체번호&#39;</span>, </span>
<span id="cb468-17"><a href="nonhierarchical-clustering.html#cb468-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;사용경력($x_1$)&#39;</span>, <span class="st">&#39;사용시간($x_2$)&#39;</span></span>
<span id="cb468-18"><a href="nonhierarchical-clustering.html#cb468-18" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb468-19"><a href="nonhierarchical-clustering.html#cb468-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&#39;PC 사용자 데이터&#39;</span></span>
<span id="cb468-20"><a href="nonhierarchical-clustering.html#cb468-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:pam-train-data">Table 13.2: </span>PC 사용자 데이터</caption>
<thead>
<tr class="header">
<th align="right">객체번호</th>
<th align="right">사용경력(<span class="math inline">\(x_1\)</span>)</th>
<th align="right">사용시간(<span class="math inline">\(x_2\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">5</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">11</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">13</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">14</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
<p>PAM 알고리즘은 <code>cluster</code> 패키지 내의 함수 <code>pam</code>을 이용하여 아래와 같이 간단하게 실행할 수 있다.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="nonhierarchical-clustering.html#cb469-1" aria-hidden="true" tabindex="-1"></a>pam_solution <span class="ot">&lt;-</span> cluster<span class="sc">::</span><span class="fu">pam</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>얻어진 <code>pam</code> 객체의 원소 <code>id.med</code>는 몇 번째 객체가 군집의 대표객체로 선정되었는지를 나타낸다.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="nonhierarchical-clustering.html#cb470-1" aria-hidden="true" tabindex="-1"></a>pam_solution<span class="sc">$</span>id.med</span></code></pre></div>
<pre><code>## [1] 2 5</code></pre>
<p>또한 <code>pam</code> 객체의 원소 <code>clustering</code>은 각 객체가 어떠한 군집에 할당되었는지를 보여준다.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="nonhierarchical-clustering.html#cb472-1" aria-hidden="true" tabindex="-1"></a>pam_solution<span class="sc">$</span>clustering</span></code></pre></div>
<pre><code>## [1] 1 1 2 2 2 2</code></pre>
</div>
<div id="pam-algorithm" class="section level4" number="13.3.1.2">
<h4><span class="header-section-number">13.3.1.2</span> PAM 알고리즘</h4>
<p>PAM 알고리즘의 각 단계를 Table <a href="nonhierarchical-clustering.html#tab:pam-train-data">13.2</a>의 예제 데이터에 적용하여 살펴보기로 하자.</p>
<div id="pam-build" class="section level5" number="13.3.1.2.1">
<h5><span class="header-section-number">13.3.1.2.1</span> BUILD</h5>
<p>BUILD는 다음 절차들을 거쳐서 <span class="math inline">\(K\)</span>개의 초기 대표객체를 구하는 과정이다.</p>
<p><strong>[단계 0]</strong> 우선 각 객체별로 다른 객체 간의 거리를 구한 후, 그 합이 가장 작은 객체 하나를 대표객체로 선정한다. 선정된 대표객체집합을 <span class="math inline">\(M\)</span>이라 하자.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="nonhierarchical-clustering.html#cb474-1" aria-hidden="true" tabindex="-1"></a>pairwise_distance_df <span class="ot">&lt;-</span> <span class="fu">dist</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">upper =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb474-2"><a href="nonhierarchical-clustering.html#cb474-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb474-3"><a href="nonhierarchical-clustering.html#cb474-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.factor, <span class="sc">~</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb474-4"><a href="nonhierarchical-clustering.html#cb474-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-5"><a href="nonhierarchical-clustering.html#cb474-5" aria-hidden="true" tabindex="-1"></a>M_idx <span class="ot">&lt;-</span> pairwise_distance_df <span class="sc">%&gt;%</span></span>
<span id="cb474-6"><a href="nonhierarchical-clustering.html#cb474-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb474-7"><a href="nonhierarchical-clustering.html#cb474-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sum_distance =</span> <span class="fu">sum</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb474-8"><a href="nonhierarchical-clustering.html#cb474-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">1</span>, sum_distance) <span class="sc">%&gt;%</span></span>
<span id="cb474-9"><a href="nonhierarchical-clustering.html#cb474-9" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>item1</span>
<span id="cb474-10"><a href="nonhierarchical-clustering.html#cb474-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-11"><a href="nonhierarchical-clustering.html#cb474-11" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> df[M_idx, ]</span>
<span id="cb474-12"><a href="nonhierarchical-clustering.html#cb474-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-13"><a href="nonhierarchical-clustering.html#cb474-13" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##      id    x1    x2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     4    13     6</code></pre>
<p><strong>[단계 1]</strong> 대표객체로 선정되지 않은 객체 <span class="math inline">\(j\)</span>에 대하여, 이전에 대표객체로 선정된 객체들 중 객체 <span class="math inline">\(j\)</span>에 가장 가까운 거리 <span class="math inline">\(D_j\)</span>를 구한다. 즉,</p>
<p><span class="math display">\[\begin{equation*}
D_j = \min_{k \in M} d(j, k), \, j \notin M
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="nonhierarchical-clustering.html#cb476-1" aria-hidden="true" tabindex="-1"></a>D_j <span class="ot">&lt;-</span> pairwise_distance_df <span class="sc">%&gt;%</span></span>
<span id="cb476-2"><a href="nonhierarchical-clustering.html#cb476-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb476-3"><a href="nonhierarchical-clustering.html#cb476-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>item1 <span class="sc">%in%</span> M<span class="sc">$</span>id,</span>
<span id="cb476-4"><a href="nonhierarchical-clustering.html#cb476-4" aria-hidden="true" tabindex="-1"></a>    item2 <span class="sc">%in%</span> M<span class="sc">$</span>id</span>
<span id="cb476-5"><a href="nonhierarchical-clustering.html#cb476-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb476-6"><a href="nonhierarchical-clustering.html#cb476-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb476-7"><a href="nonhierarchical-clustering.html#cb476-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">1</span>, distance) <span class="sc">%&gt;%</span></span>
<span id="cb476-8"><a href="nonhierarchical-clustering.html#cb476-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb476-9"><a href="nonhierarchical-clustering.html#cb476-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">D_j =</span> distance) <span class="sc">%&gt;%</span></span>
<span id="cb476-10"><a href="nonhierarchical-clustering.html#cb476-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>item2)</span>
<span id="cb476-11"><a href="nonhierarchical-clustering.html#cb476-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-12"><a href="nonhierarchical-clustering.html#cb476-12" aria-hidden="true" tabindex="-1"></a>D_j</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   item1   D_j
##   &lt;int&gt; &lt;dbl&gt;
## 1     1 10.4 
## 2     2  8.25
## 3     3  2.83
## 4     5  1   
## 5     6  2.24</code></pre>
<p>그리고 대표객체로 선정되지 않은 두 객체 <span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span>에 대하여 다음을 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
C_{ji} = \max \left(D_j - d(j, i), 0\right)
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="nonhierarchical-clustering.html#cb478-1" aria-hidden="true" tabindex="-1"></a>d_ji <span class="ot">&lt;-</span> pairwise_distance_df <span class="sc">%&gt;%</span></span>
<span id="cb478-2"><a href="nonhierarchical-clustering.html#cb478-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb478-3"><a href="nonhierarchical-clustering.html#cb478-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>item1 <span class="sc">%in%</span> M<span class="sc">$</span>id,</span>
<span id="cb478-4"><a href="nonhierarchical-clustering.html#cb478-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>item2 <span class="sc">%in%</span> M<span class="sc">$</span>id</span>
<span id="cb478-5"><a href="nonhierarchical-clustering.html#cb478-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb478-6"><a href="nonhierarchical-clustering.html#cb478-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-7"><a href="nonhierarchical-clustering.html#cb478-7" aria-hidden="true" tabindex="-1"></a>C_ji <span class="ot">&lt;-</span> D_j <span class="sc">%&gt;%</span></span>
<span id="cb478-8"><a href="nonhierarchical-clustering.html#cb478-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(d_ji, <span class="at">by =</span> <span class="st">&quot;item1&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb478-9"><a href="nonhierarchical-clustering.html#cb478-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">C_ji =</span> <span class="fu">pmax</span>(D_j <span class="sc">-</span> distance, <span class="dv">0</span>))</span>
<span id="cb478-10"><a href="nonhierarchical-clustering.html#cb478-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-11"><a href="nonhierarchical-clustering.html#cb478-11" aria-hidden="true" tabindex="-1"></a>C_ji</span></code></pre></div>
<pre><code>## # A tibble: 20 x 5
##    item1   D_j item2 distance  C_ji
##    &lt;int&gt; &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1     1 10.4      2     2.24 8.20 
##  2     1 10.4      3     9.43 1.01 
##  3     1 10.4      5    11.4  0    
##  4     1 10.4      6    12.6  0    
##  5     2  8.25     1     2.24 6.01 
##  6     2  8.25     3     7.21 1.04 
##  7     2  8.25     5     9.22 0    
##  8     2  8.25     6    10.4  0    
##  9     3  2.83     1     9.43 0    
## 10     3  2.83     2     7.21 0    
## 11     3  2.83     5     3.61 0    
## 12     3  2.83     6     4.12 0    
## 13     5  1        1    11.4  0    
## 14     5  1        2     9.22 0    
## 15     5  1        3     3.61 0    
## 16     5  1        6     1.41 0    
## 17     6  2.24     1    12.6  0    
## 18     6  2.24     2    10.4  0    
## 19     6  2.24     3     4.12 0    
## 20     6  2.24     5     1.41 0.822</code></pre>
<p>이는 객체 <span class="math inline">\(i\)</span>가 추가로 대표객체가 된다고 할 때, 객체 <span class="math inline">\(j\)</span>의 입장에서 거리 감소량이다.</p>
<p><strong>[단계 2]</strong> 다음과 같이 거리감소량이 가장 큰 객체 <span class="math inline">\(m\)</span>을 대표객체에 포함시키고,</p>
<p><span class="math display">\[\begin{equation*}
m = \arg\,\max_{i \notin M} \sum_{j \notin M} C_{ji}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="nonhierarchical-clustering.html#cb480-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> C_ji <span class="sc">%&gt;%</span></span>
<span id="cb480-2"><a href="nonhierarchical-clustering.html#cb480-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(item2) <span class="sc">%&gt;%</span></span>
<span id="cb480-3"><a href="nonhierarchical-clustering.html#cb480-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sum_C_ji =</span> <span class="fu">sum</span>(C_ji)) <span class="sc">%&gt;%</span></span>
<span id="cb480-4"><a href="nonhierarchical-clustering.html#cb480-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">1</span>, sum_C_ji) <span class="sc">%&gt;%</span></span>
<span id="cb480-5"><a href="nonhierarchical-clustering.html#cb480-5" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>item2</span>
<span id="cb480-6"><a href="nonhierarchical-clustering.html#cb480-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-7"><a href="nonhierarchical-clustering.html#cb480-7" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>대표객체집합을 수정한다.</p>
<p><span class="math display">\[\begin{equation*}
M \leftarrow M \cup \{m\}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="nonhierarchical-clustering.html#cb482-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> M <span class="sc">%&gt;%</span></span>
<span id="cb482-2"><a href="nonhierarchical-clustering.html#cb482-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df[m, ])</span></code></pre></div>
<p><strong>[단계 3]</strong> <span class="math inline">\(K\)</span>개의 대표객체가 선정되었으면 Stop, 그렇지 않은 경우에는 [단계 1]로 되돌아간다.</p>
</div>
<div id="pam-swap" class="section level5" number="13.3.1.2.2">
<h5><span class="header-section-number">13.3.1.2.2</span> SWAP</h5>
<p>SWAP은 대표객체로 선정되어 있는 객체 <span class="math inline">\(i\)</span>와 선정되지 않은 객체 <span class="math inline">\(h\)</span>를 교환할 때 목적함수의 변화량을 산출해 더 나은 목적함수값을 찾아가는 과정이다.</p>
<p><strong>[단계 1]</strong> 객체 <span class="math inline">\(i\)</span>와 객체 <span class="math inline">\(h\)</span>를 교환할 때 목적함수의 변화량을 산출하기 위하여 우선, 대표객체로 선정되지 않은 임의의 객체 <span class="math inline">\(j \neq h\)</span>에서의 변화량을 다음과 같이 산출한다.</p>
<p><span class="math display">\[\begin{eqnarray*}
C_{jih} &amp;=&amp; \text{($i$와 $h$를 교환 후 객체 $j$와 대표객체와의 거리)}\\
 &amp; &amp; - \text{(교환 전 객체 $j$와 대표객체와의 거리)},\\
 &amp; &amp; \, (j \notin M, i \in M, h \notin M)
\end{eqnarray*}\]</span></p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="nonhierarchical-clustering.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 교환 전 각 객체와 대표 객체와의 거리</span></span>
<span id="cb483-2"><a href="nonhierarchical-clustering.html#cb483-2" aria-hidden="true" tabindex="-1"></a>D_j <span class="ot">&lt;-</span> pairwise_distance_df <span class="sc">%&gt;%</span></span>
<span id="cb483-3"><a href="nonhierarchical-clustering.html#cb483-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb483-4"><a href="nonhierarchical-clustering.html#cb483-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>item1 <span class="sc">%in%</span> M<span class="sc">$</span>id,</span>
<span id="cb483-5"><a href="nonhierarchical-clustering.html#cb483-5" aria-hidden="true" tabindex="-1"></a>    item2 <span class="sc">%in%</span> M<span class="sc">$</span>id</span>
<span id="cb483-6"><a href="nonhierarchical-clustering.html#cb483-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb483-7"><a href="nonhierarchical-clustering.html#cb483-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb483-8"><a href="nonhierarchical-clustering.html#cb483-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">1</span>, distance) <span class="sc">%&gt;%</span></span>
<span id="cb483-9"><a href="nonhierarchical-clustering.html#cb483-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb483-10"><a href="nonhierarchical-clustering.html#cb483-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">j =</span> item1) <span class="sc">%&gt;%</span></span>
<span id="cb483-11"><a href="nonhierarchical-clustering.html#cb483-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>item2)</span>
<span id="cb483-12"><a href="nonhierarchical-clustering.html#cb483-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-13"><a href="nonhierarchical-clustering.html#cb483-13" aria-hidden="true" tabindex="-1"></a>D_j</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##       j distance
##   &lt;int&gt;    &lt;dbl&gt;
## 1     1     2.24
## 2     3     2.83
## 3     5     1   
## 4     6     2.24</code></pre>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="nonhierarchical-clustering.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 교환할 객체</span></span>
<span id="cb485-2"><a href="nonhierarchical-clustering.html#cb485-2" aria-hidden="true" tabindex="-1"></a>swap_ids <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb485-3"><a href="nonhierarchical-clustering.html#cb485-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">i =</span> <span class="fu">rep</span>(M<span class="sc">$</span>id, <span class="at">each =</span> <span class="fu">nrow</span>(df) <span class="sc">-</span> <span class="fu">nrow</span>(M)),</span>
<span id="cb485-4"><a href="nonhierarchical-clustering.html#cb485-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">rep</span>(<span class="fu">setdiff</span>(df<span class="sc">$</span>id, M<span class="sc">$</span>id), <span class="fu">nrow</span>(M))</span>
<span id="cb485-5"><a href="nonhierarchical-clustering.html#cb485-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb485-6"><a href="nonhierarchical-clustering.html#cb485-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-7"><a href="nonhierarchical-clustering.html#cb485-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 교환 후 각 객체와 대표 객체와의 거리</span></span>
<span id="cb485-8"><a href="nonhierarchical-clustering.html#cb485-8" aria-hidden="true" tabindex="-1"></a>update_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(i, h, distance_df, center_ids) {</span>
<span id="cb485-9"><a href="nonhierarchical-clustering.html#cb485-9" aria-hidden="true" tabindex="-1"></a>  new_center_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">setdiff</span>(center_ids, i), h)</span>
<span id="cb485-10"><a href="nonhierarchical-clustering.html#cb485-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-11"><a href="nonhierarchical-clustering.html#cb485-11" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> distance_df <span class="sc">%&gt;%</span></span>
<span id="cb485-12"><a href="nonhierarchical-clustering.html#cb485-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb485-13"><a href="nonhierarchical-clustering.html#cb485-13" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>item1 <span class="sc">%in%</span> <span class="fu">c</span>(center_ids, h),</span>
<span id="cb485-14"><a href="nonhierarchical-clustering.html#cb485-14" aria-hidden="true" tabindex="-1"></a>      item2 <span class="sc">%in%</span> new_center_ids</span>
<span id="cb485-15"><a href="nonhierarchical-clustering.html#cb485-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb485-16"><a href="nonhierarchical-clustering.html#cb485-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb485-17"><a href="nonhierarchical-clustering.html#cb485-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">1</span>, distance) <span class="sc">%&gt;%</span></span>
<span id="cb485-18"><a href="nonhierarchical-clustering.html#cb485-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb485-19"><a href="nonhierarchical-clustering.html#cb485-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">j =</span> item1) <span class="sc">%&gt;%</span></span>
<span id="cb485-20"><a href="nonhierarchical-clustering.html#cb485-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>item2) <span class="sc">%&gt;%</span></span>
<span id="cb485-21"><a href="nonhierarchical-clustering.html#cb485-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb485-22"><a href="nonhierarchical-clustering.html#cb485-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">i =</span> i,</span>
<span id="cb485-23"><a href="nonhierarchical-clustering.html#cb485-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">h =</span> h</span>
<span id="cb485-24"><a href="nonhierarchical-clustering.html#cb485-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb485-25"><a href="nonhierarchical-clustering.html#cb485-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb485-26"><a href="nonhierarchical-clustering.html#cb485-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb485-27"><a href="nonhierarchical-clustering.html#cb485-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb485-28"><a href="nonhierarchical-clustering.html#cb485-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-29"><a href="nonhierarchical-clustering.html#cb485-29" aria-hidden="true" tabindex="-1"></a>D_jih <span class="ot">&lt;-</span> <span class="fu">pmap_dfr</span>(</span>
<span id="cb485-30"><a href="nonhierarchical-clustering.html#cb485-30" aria-hidden="true" tabindex="-1"></a>  swap_ids, </span>
<span id="cb485-31"><a href="nonhierarchical-clustering.html#cb485-31" aria-hidden="true" tabindex="-1"></a>  update_distance,</span>
<span id="cb485-32"><a href="nonhierarchical-clustering.html#cb485-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance_df =</span> pairwise_distance_df,</span>
<span id="cb485-33"><a href="nonhierarchical-clustering.html#cb485-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">center_ids =</span> M<span class="sc">$</span>id</span>
<span id="cb485-34"><a href="nonhierarchical-clustering.html#cb485-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb485-35"><a href="nonhierarchical-clustering.html#cb485-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-36"><a href="nonhierarchical-clustering.html#cb485-36" aria-hidden="true" tabindex="-1"></a>D_jih</span></code></pre></div>
<pre><code>## # A tibble: 24 x 4
##        j distance     i     h
##    &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     3     7.21     4     1
##  2     5     9.22     4     1
##  3     6    10.4      4     1
##  4     1     2.24     4     3
##  5     5     3.61     4     3
##  6     6     4.12     4     3
##  7     1     2.24     4     5
##  8     3     3.61     4     5
##  9     6     1.41     4     5
## 10     1     2.24     4     6
## # … with 14 more rows</code></pre>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="nonhierarchical-clustering.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 거리의 변화량</span></span>
<span id="cb487-2"><a href="nonhierarchical-clustering.html#cb487-2" aria-hidden="true" tabindex="-1"></a>C_jih <span class="ot">&lt;-</span> D_j <span class="sc">%&gt;%</span></span>
<span id="cb487-3"><a href="nonhierarchical-clustering.html#cb487-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(D_jih, <span class="at">by =</span> <span class="st">&quot;j&quot;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_new&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb487-4"><a href="nonhierarchical-clustering.html#cb487-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_distance =</span> distance_new <span class="sc">-</span> distance)</span>
<span id="cb487-5"><a href="nonhierarchical-clustering.html#cb487-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-6"><a href="nonhierarchical-clustering.html#cb487-6" aria-hidden="true" tabindex="-1"></a>C_jih</span></code></pre></div>
<pre><code>## # A tibble: 24 x 6
##        j distance distance_new     i     h diff_distance
##    &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1     1     2.24         2.24     4     3         0    
##  2     1     2.24         2.24     4     5         0    
##  3     1     2.24         2.24     4     6         0    
##  4     1     2.24         9.43     2     3         7.20 
##  5     1     2.24        10.4      2     5         8.20 
##  6     1     2.24        10.4      2     6         8.20 
##  7     3     2.83         7.21     4     1         4.38 
##  8     3     2.83         3.61     4     5         0.777
##  9     3     2.83         4.12     4     6         1.29 
## 10     3     2.83         2.83     2     1         0    
## # … with 14 more rows</code></pre>
<p><strong>[단계 2]</strong> 대표객체 <span class="math inline">\(i\)</span>를 <span class="math inline">\(h\)</span>로 교환하는 경우 총 변화량은 다음과 같다.</p>
<p><span class="math display">\[\begin{equation*}
T_{ih} = \sum_{j} C_{jih}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="nonhierarchical-clustering.html#cb489-1" aria-hidden="true" tabindex="-1"></a>T_ih <span class="ot">&lt;-</span> C_jih <span class="sc">%&gt;%</span></span>
<span id="cb489-2"><a href="nonhierarchical-clustering.html#cb489-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i, h) <span class="sc">%&gt;%</span></span>
<span id="cb489-3"><a href="nonhierarchical-clustering.html#cb489-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_diff_distance =</span> <span class="fu">sum</span>(diff_distance))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;i&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="nonhierarchical-clustering.html#cb491-1" aria-hidden="true" tabindex="-1"></a>T_ih</span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
## # Groups:   i [2]
##       i     h total_diff_distance
##   &lt;dbl&gt; &lt;dbl&gt;               &lt;dbl&gt;
## 1     2     1              0     
## 2     2     3              7.20  
## 3     2     5              7.38  
## 4     2     6              8.20  
## 5     4     1             20.8   
## 6     4     3              4.49  
## 7     4     5             -0.0447
## 8     4     6              1.71</code></pre>
<p>이 때 <span class="math inline">\(\min_{i, h} T_{ih}\)</span>에 대응하는 객체 <span class="math inline">\(i^*\)</span>와 <span class="math inline">\(h^*\)</span>를 찾아 <span class="math inline">\(T_{i^*h^*} &lt; 0\)</span>이면 교환한 후에 다시 [단계 1]으로 돌아가고, <span class="math inline">\(T_{i^*h^*} \geq 0\)</span>이면 교환하지 않고 stop.</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="nonhierarchical-clustering.html#cb493-1" aria-hidden="true" tabindex="-1"></a>swap_ih <span class="ot">&lt;-</span> T_ih <span class="sc">%&gt;%</span></span>
<span id="cb493-2"><a href="nonhierarchical-clustering.html#cb493-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_diff_distance <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb493-3"><a href="nonhierarchical-clustering.html#cb493-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">1</span>, total_diff_distance)</span>
<span id="cb493-4"><a href="nonhierarchical-clustering.html#cb493-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-5"><a href="nonhierarchical-clustering.html#cb493-5" aria-hidden="true" tabindex="-1"></a>swap_ih</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
## # Groups:   i [1]
##       i     h total_diff_distance
##   &lt;dbl&gt; &lt;dbl&gt;               &lt;dbl&gt;
## 1     4     5             -0.0447</code></pre>
<p>본 예제의 경우 객체 4 대신 객체 5가 새로운 대표객체로 선택되고, 다시 [단계 1]로 넘어간다.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="nonhierarchical-clustering.html#cb495-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> M <span class="sc">%&gt;%</span></span>
<span id="cb495-2"><a href="nonhierarchical-clustering.html#cb495-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(df[swap_ih<span class="sc">$</span>i, ]) <span class="sc">%&gt;%</span></span>
<span id="cb495-3"><a href="nonhierarchical-clustering.html#cb495-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df[swap_ih<span class="sc">$</span>h, ])</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;id&quot;, &quot;x1&quot;, &quot;x2&quot;)</code></pre>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="nonhierarchical-clustering.html#cb497-1" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##      id    x1    x2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     2     5     4
## 2     5    14     6</code></pre>
<p>SWAP 과정이 종료된 후, 최종 군집해는 각 객체를 가장 가까운 대표객체가 속한 군집에 할당함으로써 얻어진다.</p>
</div>
</div>
<div id="pam-user-defined-functions" class="section level4" number="13.3.1.3">
<h4><span class="header-section-number">13.3.1.3</span> R 스크립트 구현</h4>
<p>일련의 과정을 함수로 구현해보자.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="nonhierarchical-clustering.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 각 객체로부터 가장 가까운 대표객체까지의 거리</span></span>
<span id="cb499-2"><a href="nonhierarchical-clustering.html#cb499-2" aria-hidden="true" tabindex="-1"></a>distance_from_medoids <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, medoids_ids) {</span>
<span id="cb499-3"><a href="nonhierarchical-clustering.html#cb499-3" aria-hidden="true" tabindex="-1"></a>  distance_df <span class="sc">%&gt;%</span></span>
<span id="cb499-4"><a href="nonhierarchical-clustering.html#cb499-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb499-5"><a href="nonhierarchical-clustering.html#cb499-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>item1 <span class="sc">%in%</span> medoids_ids,</span>
<span id="cb499-6"><a href="nonhierarchical-clustering.html#cb499-6" aria-hidden="true" tabindex="-1"></a>      item2 <span class="sc">%in%</span> medoids_ids</span>
<span id="cb499-7"><a href="nonhierarchical-clustering.html#cb499-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb499-8"><a href="nonhierarchical-clustering.html#cb499-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb499-9"><a href="nonhierarchical-clustering.html#cb499-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(distance) <span class="sc">%&gt;%</span></span>
<span id="cb499-10"><a href="nonhierarchical-clustering.html#cb499-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb499-11"><a href="nonhierarchical-clustering.html#cb499-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb499-12"><a href="nonhierarchical-clustering.html#cb499-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">j =</span> item1) <span class="sc">%&gt;%</span></span>
<span id="cb499-13"><a href="nonhierarchical-clustering.html#cb499-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>item2)</span>
<span id="cb499-14"><a href="nonhierarchical-clustering.html#cb499-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb499-15"><a href="nonhierarchical-clustering.html#cb499-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-16"><a href="nonhierarchical-clustering.html#cb499-16" aria-hidden="true" tabindex="-1"></a><span class="co"># k개의 초기 대표객체를 선정</span></span>
<span id="cb499-17"><a href="nonhierarchical-clustering.html#cb499-17" aria-hidden="true" tabindex="-1"></a>build_medoids <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, <span class="at">k =</span> 1L) {</span>
<span id="cb499-18"><a href="nonhierarchical-clustering.html#cb499-18" aria-hidden="true" tabindex="-1"></a>  k  <span class="ot">&lt;-</span> <span class="fu">min</span>(k, <span class="fu">length</span>(<span class="fu">unique</span>(distance_df<span class="sc">$</span>item1)))</span>
<span id="cb499-19"><a href="nonhierarchical-clustering.html#cb499-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-20"><a href="nonhierarchical-clustering.html#cb499-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 첫 번째 대표객체 선정</span></span>
<span id="cb499-21"><a href="nonhierarchical-clustering.html#cb499-21" aria-hidden="true" tabindex="-1"></a>  medoids_ids <span class="ot">&lt;-</span> distance_df <span class="sc">%&gt;%</span></span>
<span id="cb499-22"><a href="nonhierarchical-clustering.html#cb499-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb499-23"><a href="nonhierarchical-clustering.html#cb499-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">sum_distance =</span> <span class="fu">sum</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb499-24"><a href="nonhierarchical-clustering.html#cb499-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(sum_distance) <span class="sc">%&gt;%</span></span>
<span id="cb499-25"><a href="nonhierarchical-clustering.html#cb499-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb499-26"><a href="nonhierarchical-clustering.html#cb499-26" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>item1</span>
<span id="cb499-27"><a href="nonhierarchical-clustering.html#cb499-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-28"><a href="nonhierarchical-clustering.html#cb499-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="fu">length</span>(medoids_ids) <span class="sc">&lt;</span> k) {</span>
<span id="cb499-29"><a href="nonhierarchical-clustering.html#cb499-29" aria-hidden="true" tabindex="-1"></a>    D_j <span class="ot">&lt;-</span> <span class="fu">distance_from_medoids</span>(distance_df, medoids_ids)</span>
<span id="cb499-30"><a href="nonhierarchical-clustering.html#cb499-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-31"><a href="nonhierarchical-clustering.html#cb499-31" aria-hidden="true" tabindex="-1"></a>    d_ji <span class="ot">&lt;-</span> distance_df <span class="sc">%&gt;%</span></span>
<span id="cb499-32"><a href="nonhierarchical-clustering.html#cb499-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb499-33"><a href="nonhierarchical-clustering.html#cb499-33" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span>item1 <span class="sc">%in%</span> medoids_ids,</span>
<span id="cb499-34"><a href="nonhierarchical-clustering.html#cb499-34" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span>item2 <span class="sc">%in%</span> medoids_ids</span>
<span id="cb499-35"><a href="nonhierarchical-clustering.html#cb499-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb499-36"><a href="nonhierarchical-clustering.html#cb499-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">j =</span> item1, <span class="at">i =</span> item2)</span>
<span id="cb499-37"><a href="nonhierarchical-clustering.html#cb499-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-38"><a href="nonhierarchical-clustering.html#cb499-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 거리 감소량</span></span>
<span id="cb499-39"><a href="nonhierarchical-clustering.html#cb499-39" aria-hidden="true" tabindex="-1"></a>    C_ji <span class="ot">&lt;-</span> D_j <span class="sc">%&gt;%</span></span>
<span id="cb499-40"><a href="nonhierarchical-clustering.html#cb499-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">inner_join</span>(d_ji, <span class="at">by =</span> <span class="st">&quot;j&quot;</span>,</span>
<span id="cb499-41"><a href="nonhierarchical-clustering.html#cb499-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_new&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb499-42"><a href="nonhierarchical-clustering.html#cb499-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">diff_distance =</span> <span class="fu">pmax</span>(distance <span class="sc">-</span> distance_new, <span class="dv">0</span>))</span>
<span id="cb499-43"><a href="nonhierarchical-clustering.html#cb499-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb499-44"><a href="nonhierarchical-clustering.html#cb499-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 거리 감소량이 가장 큰 객체 선택</span></span>
<span id="cb499-45"><a href="nonhierarchical-clustering.html#cb499-45" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> C_ji <span class="sc">%&gt;%</span></span>
<span id="cb499-46"><a href="nonhierarchical-clustering.html#cb499-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(i) <span class="sc">%&gt;%</span></span>
<span id="cb499-47"><a href="nonhierarchical-clustering.html#cb499-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">total_diff_distance =</span> <span class="fu">sum</span>(diff_distance)) <span class="sc">%&gt;%</span></span>
<span id="cb499-48"><a href="nonhierarchical-clustering.html#cb499-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(total_diff_distance)) <span class="sc">%&gt;%</span></span>
<span id="cb499-49"><a href="nonhierarchical-clustering.html#cb499-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb499-50"><a href="nonhierarchical-clustering.html#cb499-50" aria-hidden="true" tabindex="-1"></a>      .<span class="sc">$</span>i</span>
<span id="cb499-51"><a href="nonhierarchical-clustering.html#cb499-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb499-52"><a href="nonhierarchical-clustering.html#cb499-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 대표객체에 추가</span></span>
<span id="cb499-53"><a href="nonhierarchical-clustering.html#cb499-53" aria-hidden="true" tabindex="-1"></a>    medoids_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(medoids_ids, m)</span>
<span id="cb499-54"><a href="nonhierarchical-clustering.html#cb499-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb499-55"><a href="nonhierarchical-clustering.html#cb499-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-56"><a href="nonhierarchical-clustering.html#cb499-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(medoids_ids)</span>
<span id="cb499-57"><a href="nonhierarchical-clustering.html#cb499-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb499-58"><a href="nonhierarchical-clustering.html#cb499-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-59"><a href="nonhierarchical-clustering.html#cb499-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 교환 후 각 객체와 대표 객체와의 거리</span></span>
<span id="cb499-60"><a href="nonhierarchical-clustering.html#cb499-60" aria-hidden="true" tabindex="-1"></a>update_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(i, h, distance_df, medoids_ids) {</span>
<span id="cb499-61"><a href="nonhierarchical-clustering.html#cb499-61" aria-hidden="true" tabindex="-1"></a>  new_medoids_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">setdiff</span>(medoids_ids, i), h)</span>
<span id="cb499-62"><a href="nonhierarchical-clustering.html#cb499-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-63"><a href="nonhierarchical-clustering.html#cb499-63" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">distance_from_medoids</span>(distance_df, new_medoids_ids) <span class="sc">%&gt;%</span></span>
<span id="cb499-64"><a href="nonhierarchical-clustering.html#cb499-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(j <span class="sc">!=</span> h) <span class="sc">%&gt;%</span></span>
<span id="cb499-65"><a href="nonhierarchical-clustering.html#cb499-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb499-66"><a href="nonhierarchical-clustering.html#cb499-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">i =</span> i,</span>
<span id="cb499-67"><a href="nonhierarchical-clustering.html#cb499-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">h =</span> h</span>
<span id="cb499-68"><a href="nonhierarchical-clustering.html#cb499-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb499-69"><a href="nonhierarchical-clustering.html#cb499-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-70"><a href="nonhierarchical-clustering.html#cb499-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb499-71"><a href="nonhierarchical-clustering.html#cb499-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb499-72"><a href="nonhierarchical-clustering.html#cb499-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-73"><a href="nonhierarchical-clustering.html#cb499-73" aria-hidden="true" tabindex="-1"></a><span class="co"># 교환할 medoid 선택</span></span>
<span id="cb499-74"><a href="nonhierarchical-clustering.html#cb499-74" aria-hidden="true" tabindex="-1"></a>swap_medoids <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, medoids_ids) {</span>
<span id="cb499-75"><a href="nonhierarchical-clustering.html#cb499-75" aria-hidden="true" tabindex="-1"></a>  observation_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(distance_df<span class="sc">$</span>item1)</span>
<span id="cb499-76"><a href="nonhierarchical-clustering.html#cb499-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-77"><a href="nonhierarchical-clustering.html#cb499-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 교환 전 각 객체와 대표 객체와의 거리</span></span>
<span id="cb499-78"><a href="nonhierarchical-clustering.html#cb499-78" aria-hidden="true" tabindex="-1"></a>  D_j <span class="ot">&lt;-</span> <span class="fu">distance_from_medoids</span>(distance_df, medoids_ids)</span>
<span id="cb499-79"><a href="nonhierarchical-clustering.html#cb499-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-80"><a href="nonhierarchical-clustering.html#cb499-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 교환할 객체</span></span>
<span id="cb499-81"><a href="nonhierarchical-clustering.html#cb499-81" aria-hidden="true" tabindex="-1"></a>  swap_ids <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb499-82"><a href="nonhierarchical-clustering.html#cb499-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> <span class="fu">rep</span>(medoids_ids, </span>
<span id="cb499-83"><a href="nonhierarchical-clustering.html#cb499-83" aria-hidden="true" tabindex="-1"></a>            <span class="at">each =</span> <span class="fu">length</span>(observation_ids) <span class="sc">-</span> <span class="fu">length</span>(medoids_ids)),</span>
<span id="cb499-84"><a href="nonhierarchical-clustering.html#cb499-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">h =</span> <span class="fu">rep</span>(<span class="fu">setdiff</span>(observation_ids, medoids_ids), </span>
<span id="cb499-85"><a href="nonhierarchical-clustering.html#cb499-85" aria-hidden="true" tabindex="-1"></a>            <span class="fu">length</span>(medoids_ids))</span>
<span id="cb499-86"><a href="nonhierarchical-clustering.html#cb499-86" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb499-87"><a href="nonhierarchical-clustering.html#cb499-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-88"><a href="nonhierarchical-clustering.html#cb499-88" aria-hidden="true" tabindex="-1"></a>  D_jih <span class="ot">&lt;-</span> <span class="fu">pmap_dfr</span>(</span>
<span id="cb499-89"><a href="nonhierarchical-clustering.html#cb499-89" aria-hidden="true" tabindex="-1"></a>    swap_ids, </span>
<span id="cb499-90"><a href="nonhierarchical-clustering.html#cb499-90" aria-hidden="true" tabindex="-1"></a>    update_distance,</span>
<span id="cb499-91"><a href="nonhierarchical-clustering.html#cb499-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_df =</span> distance_df,</span>
<span id="cb499-92"><a href="nonhierarchical-clustering.html#cb499-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">medoids_ids =</span> medoids_ids</span>
<span id="cb499-93"><a href="nonhierarchical-clustering.html#cb499-93" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb499-94"><a href="nonhierarchical-clustering.html#cb499-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-95"><a href="nonhierarchical-clustering.html#cb499-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 거리의 변화량</span></span>
<span id="cb499-96"><a href="nonhierarchical-clustering.html#cb499-96" aria-hidden="true" tabindex="-1"></a>  C_jih <span class="ot">&lt;-</span> D_j <span class="sc">%&gt;%</span></span>
<span id="cb499-97"><a href="nonhierarchical-clustering.html#cb499-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(D_jih, <span class="at">by =</span> <span class="st">&quot;j&quot;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_new&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb499-98"><a href="nonhierarchical-clustering.html#cb499-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diff_distance =</span> distance_new <span class="sc">-</span> distance)</span>
<span id="cb499-99"><a href="nonhierarchical-clustering.html#cb499-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-100"><a href="nonhierarchical-clustering.html#cb499-100" aria-hidden="true" tabindex="-1"></a>  T_ih <span class="ot">&lt;-</span> C_jih <span class="sc">%&gt;%</span></span>
<span id="cb499-101"><a href="nonhierarchical-clustering.html#cb499-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(i, h) <span class="sc">%&gt;%</span></span>
<span id="cb499-102"><a href="nonhierarchical-clustering.html#cb499-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">total_diff_distance =</span> <span class="fu">sum</span>(diff_distance))</span>
<span id="cb499-103"><a href="nonhierarchical-clustering.html#cb499-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-104"><a href="nonhierarchical-clustering.html#cb499-104" aria-hidden="true" tabindex="-1"></a>  swap_ih <span class="ot">&lt;-</span> T_ih <span class="sc">%&gt;%</span></span>
<span id="cb499-105"><a href="nonhierarchical-clustering.html#cb499-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(total_diff_distance <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb499-106"><a href="nonhierarchical-clustering.html#cb499-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(total_diff_distance) <span class="sc">%&gt;%</span></span>
<span id="cb499-107"><a href="nonhierarchical-clustering.html#cb499-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb499-108"><a href="nonhierarchical-clustering.html#cb499-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-109"><a href="nonhierarchical-clustering.html#cb499-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">remove =</span> swap_ih<span class="sc">$</span>i, <span class="at">add =</span> swap_ih<span class="sc">$</span>h))</span>
<span id="cb499-110"><a href="nonhierarchical-clustering.html#cb499-110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb499-111"><a href="nonhierarchical-clustering.html#cb499-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-112"><a href="nonhierarchical-clustering.html#cb499-112" aria-hidden="true" tabindex="-1"></a><span class="co"># 전체 PAM 알고리즘</span></span>
<span id="cb499-113"><a href="nonhierarchical-clustering.html#cb499-113" aria-hidden="true" tabindex="-1"></a>pam_medoids <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, <span class="at">k =</span> 1L) {</span>
<span id="cb499-114"><a href="nonhierarchical-clustering.html#cb499-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># BUILD</span></span>
<span id="cb499-115"><a href="nonhierarchical-clustering.html#cb499-115" aria-hidden="true" tabindex="-1"></a>  medoids_ids <span class="ot">&lt;-</span> <span class="fu">build_medoids</span>(distance_df, k)</span>
<span id="cb499-116"><a href="nonhierarchical-clustering.html#cb499-116" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">length</span>(medoids_ids)</span>
<span id="cb499-117"><a href="nonhierarchical-clustering.html#cb499-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-118"><a href="nonhierarchical-clustering.html#cb499-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SWAP</span></span>
<span id="cb499-119"><a href="nonhierarchical-clustering.html#cb499-119" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb499-120"><a href="nonhierarchical-clustering.html#cb499-120" aria-hidden="true" tabindex="-1"></a>    swap_medoids <span class="ot">&lt;-</span> <span class="fu">swap_medoids</span>(distance_df, medoids_ids)</span>
<span id="cb499-121"><a href="nonhierarchical-clustering.html#cb499-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_empty</span>(swap_medoids<span class="sc">$</span>remove)) {</span>
<span id="cb499-122"><a href="nonhierarchical-clustering.html#cb499-122" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb499-123"><a href="nonhierarchical-clustering.html#cb499-123" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb499-124"><a href="nonhierarchical-clustering.html#cb499-124" aria-hidden="true" tabindex="-1"></a>      medoids_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb499-125"><a href="nonhierarchical-clustering.html#cb499-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setdiff</span>(medoids_ids, swap_medoids<span class="sc">$</span>remove),</span>
<span id="cb499-126"><a href="nonhierarchical-clustering.html#cb499-126" aria-hidden="true" tabindex="-1"></a>        swap_medoids<span class="sc">$</span>add</span>
<span id="cb499-127"><a href="nonhierarchical-clustering.html#cb499-127" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb499-128"><a href="nonhierarchical-clustering.html#cb499-128" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb499-129"><a href="nonhierarchical-clustering.html#cb499-129" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb499-130"><a href="nonhierarchical-clustering.html#cb499-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-131"><a href="nonhierarchical-clustering.html#cb499-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (medoids_ids)</span>
<span id="cb499-132"><a href="nonhierarchical-clustering.html#cb499-132" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>위 구현한 함수를 이용하여 아래와 같이 PAM을 실행해보자.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="nonhierarchical-clustering.html#cb500-1" aria-hidden="true" tabindex="-1"></a>pairwise_distance_df <span class="ot">&lt;-</span> <span class="fu">dist</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">upper =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb500-2"><a href="nonhierarchical-clustering.html#cb500-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb500-3"><a href="nonhierarchical-clustering.html#cb500-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.factor, <span class="sc">~</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb500-4"><a href="nonhierarchical-clustering.html#cb500-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-5"><a href="nonhierarchical-clustering.html#cb500-5" aria-hidden="true" tabindex="-1"></a>medoids_ids <span class="ot">&lt;-</span> <span class="fu">pam_medoids</span>(pairwise_distance_df, <span class="at">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;i&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;i&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="nonhierarchical-clustering.html#cb502-1" aria-hidden="true" tabindex="-1"></a>df[medoids_ids, ]</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##      id    x1    x2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     2     5     4
## 2     5    14     6</code></pre>
<p>위와 같이 2개의 대표객체 2, 5가 선정된다.</p>
<p>최종 군집해는 각 객체를 가장 가까운 대표객체가 속한 군집에 할당함으로써 얻어진다.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="nonhierarchical-clustering.html#cb504-1" aria-hidden="true" tabindex="-1"></a>assign_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, medoids_ids) {</span>
<span id="cb504-2"><a href="nonhierarchical-clustering.html#cb504-2" aria-hidden="true" tabindex="-1"></a>  distance_df <span class="sc">%&gt;%</span></span>
<span id="cb504-3"><a href="nonhierarchical-clustering.html#cb504-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb504-4"><a href="nonhierarchical-clustering.html#cb504-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>item1 <span class="sc">%in%</span> medoids_ids,</span>
<span id="cb504-5"><a href="nonhierarchical-clustering.html#cb504-5" aria-hidden="true" tabindex="-1"></a>      item2 <span class="sc">%in%</span> medoids_ids</span>
<span id="cb504-6"><a href="nonhierarchical-clustering.html#cb504-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb504-7"><a href="nonhierarchical-clustering.html#cb504-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb504-8"><a href="nonhierarchical-clustering.html#cb504-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(distance) <span class="sc">%&gt;%</span></span>
<span id="cb504-9"><a href="nonhierarchical-clustering.html#cb504-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb504-10"><a href="nonhierarchical-clustering.html#cb504-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb504-11"><a href="nonhierarchical-clustering.html#cb504-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb504-12"><a href="nonhierarchical-clustering.html#cb504-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb504-13"><a href="nonhierarchical-clustering.html#cb504-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">item1 =</span> medoids_ids,</span>
<span id="cb504-14"><a href="nonhierarchical-clustering.html#cb504-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">item2 =</span> medoids_ids,</span>
<span id="cb504-15"><a href="nonhierarchical-clustering.html#cb504-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">distance =</span> <span class="dv">0</span></span>
<span id="cb504-16"><a href="nonhierarchical-clustering.html#cb504-16" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb504-17"><a href="nonhierarchical-clustering.html#cb504-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb504-18"><a href="nonhierarchical-clustering.html#cb504-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">object =</span> item1) <span class="sc">%&gt;%</span></span>
<span id="cb504-19"><a href="nonhierarchical-clustering.html#cb504-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(object) <span class="sc">%&gt;%</span></span>
<span id="cb504-20"><a href="nonhierarchical-clustering.html#cb504-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item2) <span class="sc">%&gt;%</span></span>
<span id="cb504-21"><a href="nonhierarchical-clustering.html#cb504-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">str_c</span>(<span class="st">&quot;{&quot;</span>, <span class="fu">str_c</span>(object, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;}&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb504-22"><a href="nonhierarchical-clustering.html#cb504-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb504-23"><a href="nonhierarchical-clustering.html#cb504-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>item2)</span>
<span id="cb504-24"><a href="nonhierarchical-clustering.html#cb504-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb504-25"><a href="nonhierarchical-clustering.html#cb504-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-26"><a href="nonhierarchical-clustering.html#cb504-26" aria-hidden="true" tabindex="-1"></a><span class="fu">assign_cluster</span>(pairwise_distance_df, medoids_ids)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   object distance cluster     
##    &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;       
## 1      1     2.24 {1, 2}      
## 2      2     0    {1, 2}      
## 3      3     3.61 {3, 4, 5, 6}
## 4      4     1    {3, 4, 5, 6}
## 5      5     0    {3, 4, 5, 6}
## 6      6     1.41 {3, 4, 5, 6}</code></pre>
</div>
</div>
<div id="clara" class="section level3" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> CLARA 알고리즘</h3>
<p>PAM 알고리즘은 SWAP 부분에서 모든 가능한 경우를 고려하기 때문에, 전체 객체 수가 많은 경우 계산 시간이 매우 길다는 단점이 있다. 이를 보완하기 위해 CLARA는 적절한 수의 객체를 샘플링한 후 이들에 대해 PAM 알고리즘을 적용하여 중심객체를 선정하는 방법이다. 이러한 샘플링을 여러 번 한 후, 이 중 가장 좋은 결과를 택하는 것인데, 반복수는 5번으로 충분한 것으로 분석되고 있다.</p>
<p>자세한 내용은 교재 <span class="citation">(<a href="#ref-jun2012datamining" role="doc-biblioref">전치혁 2012</a>)</span> 참조</p>
<div id="clara-basic-script" class="section level4" number="13.3.2.1">
<h4><span class="header-section-number">13.3.2.1</span> 기본 R 스크립트</h4>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="nonhierarchical-clustering.html#cb506-1" aria-hidden="true" tabindex="-1"></a>clara_solution <span class="ot">&lt;-</span> cluster<span class="sc">::</span><span class="fu">clara</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>얻어진 <code>clara</code> 객체의 원소 <code>i.med</code>는 몇 번째 객체가 군집의 대표객체로 선정되었는지를 나타낸다.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="nonhierarchical-clustering.html#cb507-1" aria-hidden="true" tabindex="-1"></a>clara_solution<span class="sc">$</span>i.med</span></code></pre></div>
<pre><code>## [1] 2 5</code></pre>
<p>또한 <code>clara</code> 객체의 원소 <code>clustering</code>은 각 객체가 어떠한 군집에 할당되었는지를 보여준다.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="nonhierarchical-clustering.html#cb509-1" aria-hidden="true" tabindex="-1"></a>clara_solution<span class="sc">$</span>clustering</span></code></pre></div>
<pre><code>## [1] 1 1 2 2 2 2</code></pre>
</div>
</div>
<div id="clarans" class="section level3" number="13.3.3">
<h3><span class="header-section-number">13.3.3</span> CLARANS 알고리즘</h3>
<p>교재 <span class="citation">(<a href="#ref-jun2012datamining" role="doc-biblioref">전치혁 2012</a>)</span> 참조</p>
</div>
<div id="kmeans-like" class="section level3" number="13.3.4">
<h3><span class="header-section-number">13.3.4</span> K-means-like 알고리즘</h3>
<p>본 알고리즘은 PAM 알고리즘의 단점을 보완하고자 <span class="citation"><a href="#ref-park2009simple" role="doc-biblioref">Park and Jun</a> (<a href="#ref-park2009simple" role="doc-biblioref">2009</a>)</span> 에 의해 제안된 것으로, 대표객체를 반복적으로 수정하는데 K-means 알고리즘의 작동 원리를 모방한 K-medoids 군집 방법이다. 따라서 간단하며 계산 시간이 빠른 것이 장점이라 하겠다. 이 알고리즘은 다음과 같이 3단계로 구성되어 있다. 알고리즘의 각 단계를 Table <a href="nonhierarchical-clustering.html#tab:pam-train-data">13.2</a>의 예제 데이터에 적용하여 살펴보기로 하자.</p>
<p><strong>[단계 1]</strong> (초기 대표객체 선정) <span class="math inline">\(K\)</span>개의 초기 대표객체를 선정하며, 각 객체를 가장 가까운 대표객체에 배정하여 초기 군집해를 얻는다.</p>
<p>객체들 간의 거리 <span class="math inline">\(d(i, j), \, i, j = 1, \cdots, n\)</span>를 구한다.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="nonhierarchical-clustering.html#cb511-1" aria-hidden="true" tabindex="-1"></a>pairwise_distance_df <span class="ot">&lt;-</span> <span class="fu">dist</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">upper =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb511-2"><a href="nonhierarchical-clustering.html#cb511-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb511-3"><a href="nonhierarchical-clustering.html#cb511-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.factor, <span class="sc">~</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(.)))</span></code></pre></div>
<p>각 객체 <span class="math inline">\(j = 1, \cdots, n\)</span>에 대하여 다음을 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
v_j = \sum_{i = 1}^{n} \frac{d(i, j)}{\sum_{k = 1}^{n} d(i, k)}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="nonhierarchical-clustering.html#cb512-1" aria-hidden="true" tabindex="-1"></a>v_j <span class="ot">&lt;-</span> pairwise_distance_df <span class="sc">%&gt;%</span></span>
<span id="cb512-2"><a href="nonhierarchical-clustering.html#cb512-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(item2) <span class="sc">%&gt;%</span></span>
<span id="cb512-3"><a href="nonhierarchical-clustering.html#cb512-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> distance <span class="sc">/</span> <span class="fu">sum</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb512-4"><a href="nonhierarchical-clustering.html#cb512-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb512-5"><a href="nonhierarchical-clustering.html#cb512-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb512-6"><a href="nonhierarchical-clustering.html#cb512-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sum_prop =</span> <span class="fu">sum</span>(prop)) <span class="sc">%&gt;%</span></span>
<span id="cb512-7"><a href="nonhierarchical-clustering.html#cb512-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">j =</span> item1)</span>
<span id="cb512-8"><a href="nonhierarchical-clustering.html#cb512-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-9"><a href="nonhierarchical-clustering.html#cb512-9" aria-hidden="true" tabindex="-1"></a>v_j</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##       j sum_prop
##   &lt;int&gt;    &lt;dbl&gt;
## 1     1    1.67 
## 2     2    1.33 
## 3     3    0.781
## 4     4    0.661
## 5     5    0.713
## 6     6    0.849</code></pre>
<p>이후 <span class="math inline">\(v_j\)</span>값들을 오름차순으로 정렬하여 가장 작은 <span class="math inline">\(K\)</span>개의 값을 초기 대표객체로 선정한다. 본 예에서는 <span class="math inline">\(K = 2\)</span>로 가정하자.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="nonhierarchical-clustering.html#cb514-1" aria-hidden="true" tabindex="-1"></a>medoids_ids <span class="ot">&lt;-</span> v_j <span class="sc">%&gt;%</span></span>
<span id="cb514-2"><a href="nonhierarchical-clustering.html#cb514-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sum_prop) <span class="sc">%&gt;%</span></span>
<span id="cb514-3"><a href="nonhierarchical-clustering.html#cb514-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb514-4"><a href="nonhierarchical-clustering.html#cb514-4" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>j</span>
<span id="cb514-5"><a href="nonhierarchical-clustering.html#cb514-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-6"><a href="nonhierarchical-clustering.html#cb514-6" aria-hidden="true" tabindex="-1"></a>medoids_ids</span></code></pre></div>
<pre><code>## [1] 4 5</code></pre>
<p>이후 객체를 배정하여 군집해를 얻는다. 위에서 정의했던 <code>assign_cluster</code> 함수를 재사용하자.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="nonhierarchical-clustering.html#cb516-1" aria-hidden="true" tabindex="-1"></a>cluster_solution <span class="ot">&lt;-</span> <span class="fu">assign_cluster</span>(</span>
<span id="cb516-2"><a href="nonhierarchical-clustering.html#cb516-2" aria-hidden="true" tabindex="-1"></a>  pairwise_distance_df, </span>
<span id="cb516-3"><a href="nonhierarchical-clustering.html#cb516-3" aria-hidden="true" tabindex="-1"></a>  medoids_ids</span>
<span id="cb516-4"><a href="nonhierarchical-clustering.html#cb516-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb516-5"><a href="nonhierarchical-clustering.html#cb516-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb516-6"><a href="nonhierarchical-clustering.html#cb516-6" aria-hidden="true" tabindex="-1"></a>cluster_solution</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   object distance cluster     
##    &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;       
## 1      1    10.4  {1, 2, 3, 4}
## 2      2     8.25 {1, 2, 3, 4}
## 3      3     2.83 {1, 2, 3, 4}
## 4      4     0    {1, 2, 3, 4}
## 5      5     0    {5, 6}      
## 6      6     1.41 {5, 6}</code></pre>
<p><strong>[단계 2]</strong> (대표객체의 수정) 현재의 군집에 배정된 객체들의 대표객체를 구하여 새로운 대표객체로 삼는다. 새로운 대표객체는 같은 군집에 배정된 다른 객체들로부터의 거리의 합이 최소가 되는 객체이다.</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="nonhierarchical-clustering.html#cb518-1" aria-hidden="true" tabindex="-1"></a>find_medoids <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, ids) {</span>
<span id="cb518-2"><a href="nonhierarchical-clustering.html#cb518-2" aria-hidden="true" tabindex="-1"></a>  distance_df <span class="sc">%&gt;%</span></span>
<span id="cb518-3"><a href="nonhierarchical-clustering.html#cb518-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb518-4"><a href="nonhierarchical-clustering.html#cb518-4" aria-hidden="true" tabindex="-1"></a>      item1 <span class="sc">%in%</span> ids, </span>
<span id="cb518-5"><a href="nonhierarchical-clustering.html#cb518-5" aria-hidden="true" tabindex="-1"></a>      item2 <span class="sc">%in%</span> ids</span>
<span id="cb518-6"><a href="nonhierarchical-clustering.html#cb518-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb518-7"><a href="nonhierarchical-clustering.html#cb518-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb518-8"><a href="nonhierarchical-clustering.html#cb518-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">total_distance =</span> <span class="fu">sum</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb518-9"><a href="nonhierarchical-clustering.html#cb518-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(total_distance) <span class="sc">%&gt;%</span></span>
<span id="cb518-10"><a href="nonhierarchical-clustering.html#cb518-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb518-11"><a href="nonhierarchical-clustering.html#cb518-11" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>item1</span>
<span id="cb518-12"><a href="nonhierarchical-clustering.html#cb518-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb518-13"><a href="nonhierarchical-clustering.html#cb518-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-14"><a href="nonhierarchical-clustering.html#cb518-14" aria-hidden="true" tabindex="-1"></a>cluster_objects <span class="ot">&lt;-</span> cluster_solution <span class="sc">%&gt;%</span></span>
<span id="cb518-15"><a href="nonhierarchical-clustering.html#cb518-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>cluster) <span class="sc">%&gt;%</span></span>
<span id="cb518-16"><a href="nonhierarchical-clustering.html#cb518-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span>.<span class="sc">$</span>object)</span>
<span id="cb518-17"><a href="nonhierarchical-clustering.html#cb518-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-18"><a href="nonhierarchical-clustering.html#cb518-18" aria-hidden="true" tabindex="-1"></a>medoids_ids <span class="ot">&lt;-</span> <span class="fu">map_int</span>(</span>
<span id="cb518-19"><a href="nonhierarchical-clustering.html#cb518-19" aria-hidden="true" tabindex="-1"></a>  cluster_objects, </span>
<span id="cb518-20"><a href="nonhierarchical-clustering.html#cb518-20" aria-hidden="true" tabindex="-1"></a>  find_medoids,</span>
<span id="cb518-21"><a href="nonhierarchical-clustering.html#cb518-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance_df =</span> pairwise_distance_df</span>
<span id="cb518-22"><a href="nonhierarchical-clustering.html#cb518-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb518-23"><a href="nonhierarchical-clustering.html#cb518-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-24"><a href="nonhierarchical-clustering.html#cb518-24" aria-hidden="true" tabindex="-1"></a>medoids_ids</span></code></pre></div>
<pre><code>## {1, 2, 3, 4}       {5, 6} 
##            2            5</code></pre>
<p><strong>[단계 3]</strong> (객체의 배정) 각 객체를 가장 가까운 대표객체에 배정하여 군집해를 얻는다. 군집해가 이전과 동일하면 Stop하고, 그렇지 않으면 [단계 2]를 반복한다.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="nonhierarchical-clustering.html#cb520-1" aria-hidden="true" tabindex="-1"></a>new_cluster_solution <span class="ot">&lt;-</span> <span class="fu">assign_cluster</span>(</span>
<span id="cb520-2"><a href="nonhierarchical-clustering.html#cb520-2" aria-hidden="true" tabindex="-1"></a>  pairwise_distance_df, </span>
<span id="cb520-3"><a href="nonhierarchical-clustering.html#cb520-3" aria-hidden="true" tabindex="-1"></a>  medoids_ids</span>
<span id="cb520-4"><a href="nonhierarchical-clustering.html#cb520-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb520-5"><a href="nonhierarchical-clustering.html#cb520-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-6"><a href="nonhierarchical-clustering.html#cb520-6" aria-hidden="true" tabindex="-1"></a>is_converge <span class="ot">&lt;-</span> <span class="fu">near</span>(</span>
<span id="cb520-7"><a href="nonhierarchical-clustering.html#cb520-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, </span>
<span id="cb520-8"><a href="nonhierarchical-clustering.html#cb520-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusteval::cluster_similarity(</span></span>
<span id="cb520-9"><a href="nonhierarchical-clustering.html#cb520-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   as.factor(cluster_solution$cluster),</span></span>
<span id="cb520-10"><a href="nonhierarchical-clustering.html#cb520-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   as.factor(new_cluster_solution$cluster),</span></span>
<span id="cb520-11"><a href="nonhierarchical-clustering.html#cb520-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   similarity = &quot;rand&quot;</span></span>
<span id="cb520-12"><a href="nonhierarchical-clustering.html#cb520-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb520-13"><a href="nonhierarchical-clustering.html#cb520-13" aria-hidden="true" tabindex="-1"></a>  flexclust<span class="sc">::</span><span class="fu">randIndex</span>(</span>
<span id="cb520-14"><a href="nonhierarchical-clustering.html#cb520-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(cluster_solution<span class="sc">$</span>cluster),</span>
<span id="cb520-15"><a href="nonhierarchical-clustering.html#cb520-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(new_cluster_solution<span class="sc">$</span>cluster)</span>
<span id="cb520-16"><a href="nonhierarchical-clustering.html#cb520-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb520-17"><a href="nonhierarchical-clustering.html#cb520-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb520-18"><a href="nonhierarchical-clustering.html#cb520-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-19"><a href="nonhierarchical-clustering.html#cb520-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(is_converge)</span></code></pre></div>
<pre><code>##   ARI 
## FALSE</code></pre>
<p>위의 경우 첫 번째 iteration에서 군집해가 수정되었으므로 다음 iteration을 수행한다.</p>
<div id="kmeans-like-user-defined-functions" class="section level4" number="13.3.4.1">
<h4><span class="header-section-number">13.3.4.1</span> R 스크립트 구현</h4>
<p>위 일련의 과정들을 수행하는 R 함수 스크립트를 구현해보자.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="nonhierarchical-clustering.html#cb522-1" aria-hidden="true" tabindex="-1"></a>init_medoids <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, <span class="at">k =</span> <span class="dv">1</span>) {</span>
<span id="cb522-2"><a href="nonhierarchical-clustering.html#cb522-2" aria-hidden="true" tabindex="-1"></a>  object_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(distance_df<span class="sc">$</span>item1)</span>
<span id="cb522-3"><a href="nonhierarchical-clustering.html#cb522-3" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">min</span>(k, <span class="fu">length</span>(object_ids))</span>
<span id="cb522-4"><a href="nonhierarchical-clustering.html#cb522-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb522-5"><a href="nonhierarchical-clustering.html#cb522-5" aria-hidden="true" tabindex="-1"></a>  v_j <span class="ot">&lt;-</span> distance_df <span class="sc">%&gt;%</span></span>
<span id="cb522-6"><a href="nonhierarchical-clustering.html#cb522-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item2) <span class="sc">%&gt;%</span></span>
<span id="cb522-7"><a href="nonhierarchical-clustering.html#cb522-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> distance <span class="sc">/</span> <span class="fu">sum</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb522-8"><a href="nonhierarchical-clustering.html#cb522-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb522-9"><a href="nonhierarchical-clustering.html#cb522-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb522-10"><a href="nonhierarchical-clustering.html#cb522-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">sum_prop =</span> <span class="fu">sum</span>(prop)) <span class="sc">%&gt;%</span></span>
<span id="cb522-11"><a href="nonhierarchical-clustering.html#cb522-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">j =</span> item1)</span>
<span id="cb522-12"><a href="nonhierarchical-clustering.html#cb522-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb522-13"><a href="nonhierarchical-clustering.html#cb522-13" aria-hidden="true" tabindex="-1"></a>  medoids_ids <span class="ot">&lt;-</span> v_j <span class="sc">%&gt;%</span></span>
<span id="cb522-14"><a href="nonhierarchical-clustering.html#cb522-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(sum_prop) <span class="sc">%&gt;%</span></span>
<span id="cb522-15"><a href="nonhierarchical-clustering.html#cb522-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>k) <span class="sc">%&gt;%</span></span>
<span id="cb522-16"><a href="nonhierarchical-clustering.html#cb522-16" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>j</span>
<span id="cb522-17"><a href="nonhierarchical-clustering.html#cb522-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb522-18"><a href="nonhierarchical-clustering.html#cb522-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(medoids_ids)</span>
<span id="cb522-19"><a href="nonhierarchical-clustering.html#cb522-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb522-20"><a href="nonhierarchical-clustering.html#cb522-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-21"><a href="nonhierarchical-clustering.html#cb522-21" aria-hidden="true" tabindex="-1"></a>assign_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, medoids_ids) {</span>
<span id="cb522-22"><a href="nonhierarchical-clustering.html#cb522-22" aria-hidden="true" tabindex="-1"></a>  distance_df <span class="sc">%&gt;%</span></span>
<span id="cb522-23"><a href="nonhierarchical-clustering.html#cb522-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb522-24"><a href="nonhierarchical-clustering.html#cb522-24" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>item1 <span class="sc">%in%</span> medoids_ids,</span>
<span id="cb522-25"><a href="nonhierarchical-clustering.html#cb522-25" aria-hidden="true" tabindex="-1"></a>      item2 <span class="sc">%in%</span> medoids_ids</span>
<span id="cb522-26"><a href="nonhierarchical-clustering.html#cb522-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb522-27"><a href="nonhierarchical-clustering.html#cb522-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb522-28"><a href="nonhierarchical-clustering.html#cb522-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(distance) <span class="sc">%&gt;%</span></span>
<span id="cb522-29"><a href="nonhierarchical-clustering.html#cb522-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb522-30"><a href="nonhierarchical-clustering.html#cb522-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb522-31"><a href="nonhierarchical-clustering.html#cb522-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb522-32"><a href="nonhierarchical-clustering.html#cb522-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb522-33"><a href="nonhierarchical-clustering.html#cb522-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">item1 =</span> medoids_ids,</span>
<span id="cb522-34"><a href="nonhierarchical-clustering.html#cb522-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">item2 =</span> medoids_ids,</span>
<span id="cb522-35"><a href="nonhierarchical-clustering.html#cb522-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">distance =</span> <span class="dv">0</span></span>
<span id="cb522-36"><a href="nonhierarchical-clustering.html#cb522-36" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb522-37"><a href="nonhierarchical-clustering.html#cb522-37" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb522-38"><a href="nonhierarchical-clustering.html#cb522-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">object =</span> item1) <span class="sc">%&gt;%</span></span>
<span id="cb522-39"><a href="nonhierarchical-clustering.html#cb522-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(object) <span class="sc">%&gt;%</span></span>
<span id="cb522-40"><a href="nonhierarchical-clustering.html#cb522-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item2) <span class="sc">%&gt;%</span></span>
<span id="cb522-41"><a href="nonhierarchical-clustering.html#cb522-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">str_c</span>(<span class="st">&quot;{&quot;</span>, <span class="fu">str_c</span>(object, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;}&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb522-42"><a href="nonhierarchical-clustering.html#cb522-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb522-43"><a href="nonhierarchical-clustering.html#cb522-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>item2)</span>
<span id="cb522-44"><a href="nonhierarchical-clustering.html#cb522-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb522-45"><a href="nonhierarchical-clustering.html#cb522-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-46"><a href="nonhierarchical-clustering.html#cb522-46" aria-hidden="true" tabindex="-1"></a>find_medoids <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, ids) {</span>
<span id="cb522-47"><a href="nonhierarchical-clustering.html#cb522-47" aria-hidden="true" tabindex="-1"></a>  distance_df <span class="sc">%&gt;%</span></span>
<span id="cb522-48"><a href="nonhierarchical-clustering.html#cb522-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb522-49"><a href="nonhierarchical-clustering.html#cb522-49" aria-hidden="true" tabindex="-1"></a>      item1 <span class="sc">%in%</span> ids, </span>
<span id="cb522-50"><a href="nonhierarchical-clustering.html#cb522-50" aria-hidden="true" tabindex="-1"></a>      item2 <span class="sc">%in%</span> ids</span>
<span id="cb522-51"><a href="nonhierarchical-clustering.html#cb522-51" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb522-52"><a href="nonhierarchical-clustering.html#cb522-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb522-53"><a href="nonhierarchical-clustering.html#cb522-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">total_distance =</span> <span class="fu">sum</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb522-54"><a href="nonhierarchical-clustering.html#cb522-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(total_distance) <span class="sc">%&gt;%</span></span>
<span id="cb522-55"><a href="nonhierarchical-clustering.html#cb522-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb522-56"><a href="nonhierarchical-clustering.html#cb522-56" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>item1</span>
<span id="cb522-57"><a href="nonhierarchical-clustering.html#cb522-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb522-58"><a href="nonhierarchical-clustering.html#cb522-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-59"><a href="nonhierarchical-clustering.html#cb522-59" aria-hidden="true" tabindex="-1"></a>kmeans_like_kmedoids <span class="ot">&lt;-</span> <span class="cf">function</span>(distance_df, <span class="at">k =</span> <span class="dv">1</span>) {</span>
<span id="cb522-60"><a href="nonhierarchical-clustering.html#cb522-60" aria-hidden="true" tabindex="-1"></a>  medoids_ids <span class="ot">&lt;-</span> <span class="fu">init_medoids</span>(distance_df, k)</span>
<span id="cb522-61"><a href="nonhierarchical-clustering.html#cb522-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb522-62"><a href="nonhierarchical-clustering.html#cb522-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb522-63"><a href="nonhierarchical-clustering.html#cb522-63" aria-hidden="true" tabindex="-1"></a>    cluster_solution <span class="ot">&lt;-</span> <span class="fu">assign_cluster</span>(distance_df, medoids_ids)</span>
<span id="cb522-64"><a href="nonhierarchical-clustering.html#cb522-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb522-65"><a href="nonhierarchical-clustering.html#cb522-65" aria-hidden="true" tabindex="-1"></a>    cluster_objects <span class="ot">&lt;-</span> cluster_solution <span class="sc">%&gt;%</span></span>
<span id="cb522-66"><a href="nonhierarchical-clustering.html#cb522-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">split</span>(.<span class="sc">$</span>cluster) <span class="sc">%&gt;%</span></span>
<span id="cb522-67"><a href="nonhierarchical-clustering.html#cb522-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map</span>(<span class="sc">~</span>.<span class="sc">$</span>object)</span>
<span id="cb522-68"><a href="nonhierarchical-clustering.html#cb522-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb522-69"><a href="nonhierarchical-clustering.html#cb522-69" aria-hidden="true" tabindex="-1"></a>    medoids_ids <span class="ot">&lt;-</span> <span class="fu">map_int</span>(</span>
<span id="cb522-70"><a href="nonhierarchical-clustering.html#cb522-70" aria-hidden="true" tabindex="-1"></a>      cluster_objects, </span>
<span id="cb522-71"><a href="nonhierarchical-clustering.html#cb522-71" aria-hidden="true" tabindex="-1"></a>      find_medoids,</span>
<span id="cb522-72"><a href="nonhierarchical-clustering.html#cb522-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">distance_df =</span> distance_df</span>
<span id="cb522-73"><a href="nonhierarchical-clustering.html#cb522-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb522-74"><a href="nonhierarchical-clustering.html#cb522-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb522-75"><a href="nonhierarchical-clustering.html#cb522-75" aria-hidden="true" tabindex="-1"></a>    new_cluster_solution <span class="ot">&lt;-</span> <span class="fu">assign_cluster</span>(distance_df, medoids_ids)</span>
<span id="cb522-76"><a href="nonhierarchical-clustering.html#cb522-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb522-77"><a href="nonhierarchical-clustering.html#cb522-77" aria-hidden="true" tabindex="-1"></a>    is_converge <span class="ot">&lt;-</span> <span class="fu">near</span>(</span>
<span id="cb522-78"><a href="nonhierarchical-clustering.html#cb522-78" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb522-79"><a href="nonhierarchical-clustering.html#cb522-79" aria-hidden="true" tabindex="-1"></a>      flexclust<span class="sc">::</span><span class="fu">randIndex</span>(</span>
<span id="cb522-80"><a href="nonhierarchical-clustering.html#cb522-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.factor</span>(cluster_solution<span class="sc">$</span>cluster),</span>
<span id="cb522-81"><a href="nonhierarchical-clustering.html#cb522-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.factor</span>(new_cluster_solution<span class="sc">$</span>cluster)</span>
<span id="cb522-82"><a href="nonhierarchical-clustering.html#cb522-82" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb522-83"><a href="nonhierarchical-clustering.html#cb522-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb522-84"><a href="nonhierarchical-clustering.html#cb522-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb522-85"><a href="nonhierarchical-clustering.html#cb522-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_converge) <span class="cf">break</span></span>
<span id="cb522-86"><a href="nonhierarchical-clustering.html#cb522-86" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb522-87"><a href="nonhierarchical-clustering.html#cb522-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb522-88"><a href="nonhierarchical-clustering.html#cb522-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(medoids_ids)</span>
<span id="cb522-89"><a href="nonhierarchical-clustering.html#cb522-89" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>위에서 정의한 함수 <code>kmeans_like_kmedoids</code>를 Table <a href="nonhierarchical-clustering.html#tab:pam-train-data">13.2</a>의 데이터에 적용한 군집결과 및 군집 대표객체는 아래와 같이 얻어진다.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="nonhierarchical-clustering.html#cb523-1" aria-hidden="true" tabindex="-1"></a>pairwise_distance_df <span class="ot">&lt;-</span> <span class="fu">dist</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">upper =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb523-2"><a href="nonhierarchical-clustering.html#cb523-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb523-3"><a href="nonhierarchical-clustering.html#cb523-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.factor, <span class="sc">~</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb523-4"><a href="nonhierarchical-clustering.html#cb523-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-5"><a href="nonhierarchical-clustering.html#cb523-5" aria-hidden="true" tabindex="-1"></a>medoids_ids <span class="ot">&lt;-</span> <span class="fu">kmeans_like_kmedoids</span>(pairwise_distance_df, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb523-6"><a href="nonhierarchical-clustering.html#cb523-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-7"><a href="nonhierarchical-clustering.html#cb523-7" aria-hidden="true" tabindex="-1"></a>medoids_ids</span></code></pre></div>
<pre><code>##       {1, 2} {3, 4, 5, 6} 
##            1            5</code></pre>
</div>
</div>
</div>
<div id="fuzzy-kmeans" class="section level2" number="13.4">
<h2><span class="header-section-number">13.4</span> 퍼지 K-means 알고리즘</h2>
<p>이 방법은 K-means 알고리즘과 유사하나, 하나의 객체가 여러 군집에 속할 가능성을 허용하는 확률 또는 이를 확장한 퍼지(fuzzy) 개념을 도입한 것이다. 객체 <span class="math inline">\(i\)</span>가 군집 <span class="math inline">\(j\)</span>에 속할 확률 <span class="math inline">\(P_{ij}\)</span>를 구하는 문제이다.</p>
<div id="fuzzy-kmeans-basic-script" class="section level3" number="13.4.1">
<h3><span class="header-section-number">13.4.1</span> 기본 R 스크립트</h3>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="nonhierarchical-clustering.html#cb525-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb525-2"><a href="nonhierarchical-clustering.html#cb525-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb525-3"><a href="nonhierarchical-clustering.html#cb525-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">14</span>, <span class="dv">11</span>, <span class="dv">15</span>, <span class="dv">7</span>, <span class="dv">13</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb525-4"><a href="nonhierarchical-clustering.html#cb525-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">13</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">15</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb525-5"><a href="nonhierarchical-clustering.html#cb525-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb525-6"><a href="nonhierarchical-clustering.html#cb525-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-7"><a href="nonhierarchical-clustering.html#cb525-7" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb525-8"><a href="nonhierarchical-clustering.html#cb525-8" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb525-9"><a href="nonhierarchical-clustering.html#cb525-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb525-10"><a href="nonhierarchical-clustering.html#cb525-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>),</span>
<span id="cb525-11"><a href="nonhierarchical-clustering.html#cb525-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb525-12"><a href="nonhierarchical-clustering.html#cb525-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;객체번호&#39;</span>, </span>
<span id="cb525-13"><a href="nonhierarchical-clustering.html#cb525-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;사용경력($x_1$)&#39;</span>, </span>
<span id="cb525-14"><a href="nonhierarchical-clustering.html#cb525-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;사용시간($x_2$)&#39;</span></span>
<span id="cb525-15"><a href="nonhierarchical-clustering.html#cb525-15" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb525-16"><a href="nonhierarchical-clustering.html#cb525-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&#39;PC 사용자 데이터&#39;</span></span>
<span id="cb525-17"><a href="nonhierarchical-clustering.html#cb525-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:fuzzy-kmeans-data">Table 13.3: </span>PC 사용자 데이터</caption>
<thead>
<tr class="header">
<th align="right">객체번호</th>
<th align="right">사용경력(<span class="math inline">\(x_1\)</span>)</th>
<th align="right">사용시간(<span class="math inline">\(x_2\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">8</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">14</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">11</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">7</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">13</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">5</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="nonhierarchical-clustering.html#cb526-1" aria-hidden="true" tabindex="-1"></a>cluster<span class="sc">::</span><span class="fu">fanny</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">k =</span> <span class="dv">3</span>, <span class="at">metric =</span> <span class="st">&quot;SqEuclidean&quot;</span>)</span></code></pre></div>
<pre><code>## Fuzzy Clustering object of class &#39;fanny&#39; :                      
## m.ship.expon.        2
## objective     18.37061
## tolerance        1e-15
## iterations          12
## converged            1
## maxit              500
## n                   10
## Membership coefficients (in %, rounded):
##       [,1] [,2] [,3]
##  [1,]   98    1    1
##  [2,]   96    3    2
##  [3,]    1   99    1
##  [4,]   12   80    8
##  [5,]    2   96    2
##  [6,]   98    1    1
##  [7,]    1   99    1
##  [8,]    3    3   94
##  [9,]    0    0   99
## [10,]    1    1   98
## Fuzzyness coefficients:
## dunn_coeff normalized 
##  0.9225653  0.8838480 
## Closest hard clustering:
##  [1] 1 1 2 2 2 1 2 3 3 3
## 
## Available components:
##  [1] &quot;membership&quot;  &quot;coeff&quot;       &quot;memb.exp&quot;    &quot;clustering&quot;  &quot;k.crisp&quot;    
##  [6] &quot;objective&quot;   &quot;convergence&quot; &quot;diss&quot;        &quot;call&quot;        &quot;silinfo&quot;    
## [11] &quot;data&quot;</code></pre>
</div>
<div id="fuzzy-kmeans-algorithm" class="section level3" number="13.4.2">
<h3><span class="header-section-number">13.4.2</span> 알고리즘</h3>
<p><strong>[단계 0]</strong> 초기 <span class="math inline">\(K\)</span>개의 군집을 임의로 결정한다.</p>
<p><span class="math display">\[\begin{equation*}
P_{ij} = \begin{cases}
1 &amp; \text{ if object $i$ belongs to cluster $j$}\\
0 &amp; \text{ otherwise}
\end{cases}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="nonhierarchical-clustering.html#cb528-1" aria-hidden="true" tabindex="-1"></a>init_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">k =</span> <span class="dv">1</span>) {</span>
<span id="cb528-2"><a href="nonhierarchical-clustering.html#cb528-2" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">min</span>(k, <span class="fu">nrow</span>(df))</span>
<span id="cb528-3"><a href="nonhierarchical-clustering.html#cb528-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb528-4"><a href="nonhierarchical-clustering.html#cb528-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb528-5"><a href="nonhierarchical-clustering.html#cb528-5" aria-hidden="true" tabindex="-1"></a>    cluster_ind <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(k, <span class="at">size =</span> <span class="fu">nrow</span>(df), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb528-6"><a href="nonhierarchical-clustering.html#cb528-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(cluster_ind)) <span class="sc">==</span> k) <span class="cf">break</span></span>
<span id="cb528-7"><a href="nonhierarchical-clustering.html#cb528-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb528-8"><a href="nonhierarchical-clustering.html#cb528-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb528-9"><a href="nonhierarchical-clustering.html#cb528-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfc</span>(<span class="fu">unique</span>(cluster_ind), <span class="sc">~</span> <span class="fu">as.double</span>(cluster_ind <span class="sc">==</span> .))</span>
<span id="cb528-10"><a href="nonhierarchical-clustering.html#cb528-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb528-11"><a href="nonhierarchical-clustering.html#cb528-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-12"><a href="nonhierarchical-clustering.html#cb528-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4000</span>)</span>
<span id="cb528-13"><a href="nonhierarchical-clustering.html#cb528-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-14"><a href="nonhierarchical-clustering.html#cb528-14" aria-hidden="true" tabindex="-1"></a>cluster_membership <span class="ot">&lt;-</span> <span class="fu">init_cluster</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">k =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## New names:
## * NA -&gt; ...1
## * NA -&gt; ...2
## * NA -&gt; ...3</code></pre>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="nonhierarchical-clustering.html#cb530-1" aria-hidden="true" tabindex="-1"></a>cluster_membership</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##     ...1  ...2  ...3
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     0     0
##  2     1     0     0
##  3     0     1     0
##  4     1     0     0
##  5     0     0     1
##  6     0     1     0
##  7     0     0     1
##  8     0     1     0
##  9     1     0     0
## 10     1     0     0</code></pre>
<p><strong>[단계 1]</strong> 각 군집의 중심좌표를 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{c}_j = \frac{\sum_{i = 1}^{n} P_{ij}^{m} \mathbf{x}_i}{\sum_{i = 1}^{n} P_{ij}^{m}}
\end{equation*}\]</span></p>
<p>여기에서 상수 <span class="math inline">\(m\)</span>은 1보다 큰 값을 사용한다.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="nonhierarchical-clustering.html#cb532-1" aria-hidden="true" tabindex="-1"></a>find_center <span class="ot">&lt;-</span> <span class="cf">function</span>(df, p, m) {</span>
<span id="cb532-2"><a href="nonhierarchical-clustering.html#cb532-2" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> p <span class="sc">^</span> m</span>
<span id="cb532-3"><a href="nonhierarchical-clustering.html#cb532-3" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb532-4"><a href="nonhierarchical-clustering.html#cb532-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize_all</span>(weighted.mean, <span class="at">w =</span> wt)</span>
<span id="cb532-5"><a href="nonhierarchical-clustering.html#cb532-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb532-6"><a href="nonhierarchical-clustering.html#cb532-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-7"><a href="nonhierarchical-clustering.html#cb532-7" aria-hidden="true" tabindex="-1"></a>cluster_df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(cluster_membership, find_center, <span class="at">df =</span> df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">m =</span> <span class="dv">2</span>)</span>
<span id="cb532-8"><a href="nonhierarchical-clustering.html#cb532-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-9"><a href="nonhierarchical-clustering.html#cb532-9" aria-hidden="true" tabindex="-1"></a>cluster_df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      x1    x2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  6.2   8   
## 2  8.67  8.33
## 3 14     6.5</code></pre>
<p><strong>[단계 2]</strong> 군집 membership 계수 <span class="math inline">\(P_{ij}\)</span>를 업데이트한다.</p>
<p><span class="math display">\[\begin{equation*}
P_{ij} = \frac{d(\mathbf{x}_i, \mathbf{c}_j)^{-\frac{1}{m - 1}}}{\sum_{a = 1}^{K} d(\mathbf{x}_i, \mathbf{c}_a)^{-\frac{1}{m - 1}}}
\end{equation*}\]</span></p>
<p>여기에서 거리함수 <span class="math inline">\(d()\)</span>는 제곱 유클리드 거리를 사용한다.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="nonhierarchical-clustering.html#cb534-1" aria-hidden="true" tabindex="-1"></a>update_membership <span class="ot">&lt;-</span> <span class="cf">function</span>(df, cluster_df, m) {</span>
<span id="cb534-2"><a href="nonhierarchical-clustering.html#cb534-2" aria-hidden="true" tabindex="-1"></a>  distance_mat <span class="ot">&lt;-</span> flexclust<span class="sc">::</span><span class="fu">dist2</span>(df, cluster_df)  <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb534-3"><a href="nonhierarchical-clustering.html#cb534-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb534-4"><a href="nonhierarchical-clustering.html#cb534-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> distance_mat <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">/</span> (m <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb534-5"><a href="nonhierarchical-clustering.html#cb534-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">/</span><span class="st">`</span>(<span class="fu">rowSums</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb534-6"><a href="nonhierarchical-clustering.html#cb534-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="st">&quot;minimal&quot;</span>)</span>
<span id="cb534-7"><a href="nonhierarchical-clustering.html#cb534-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb534-8"><a href="nonhierarchical-clustering.html#cb534-8" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb534-9"><a href="nonhierarchical-clustering.html#cb534-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb534-10"><a href="nonhierarchical-clustering.html#cb534-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-11"><a href="nonhierarchical-clustering.html#cb534-11" aria-hidden="true" tabindex="-1"></a><span class="fu">update_membership</span>(df[, <span class="sc">-</span><span class="dv">1</span>], cluster_df, <span class="at">m =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##         ``      ``    ``
##      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 0.451   0.414   0.135
##  2 0.380   0.483   0.137
##  3 0.00381 0.00730 0.989
##  4 0.139   0.576   0.285
##  5 0.0152  0.0285  0.956
##  6 0.406   0.427   0.166
##  7 0.0231  0.0479  0.929
##  8 0.574   0.311   0.115
##  9 0.542   0.315   0.143
## 10 0.508   0.325   0.166</code></pre>
</div>
<div id="fuzzy-kmeans-script-implement" class="section level3" number="13.4.3">
<h3><span class="header-section-number">13.4.3</span> R 스크립트 구현</h3>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="nonhierarchical-clustering.html#cb536-1" aria-hidden="true" tabindex="-1"></a>fuzzy_kmeans <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">m =</span> <span class="dv">2</span>, <span class="at">max_iter =</span> 1000L, <span class="at">tol =</span> <span class="fl">1e-9</span>) {</span>
<span id="cb536-2"><a href="nonhierarchical-clustering.html#cb536-2" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">min</span>(k, <span class="fu">nrow</span>(df))</span>
<span id="cb536-3"><a href="nonhierarchical-clustering.html#cb536-3" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> 0L</span>
<span id="cb536-4"><a href="nonhierarchical-clustering.html#cb536-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb536-5"><a href="nonhierarchical-clustering.html#cb536-5" aria-hidden="true" tabindex="-1"></a>  cluster_membership <span class="ot">&lt;-</span> <span class="fu">init_cluster</span>(df, k)</span>
<span id="cb536-6"><a href="nonhierarchical-clustering.html#cb536-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb536-7"><a href="nonhierarchical-clustering.html#cb536-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i <span class="sc">&lt;</span> max_iter) {</span>
<span id="cb536-8"><a href="nonhierarchical-clustering.html#cb536-8" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> 1L</span>
<span id="cb536-9"><a href="nonhierarchical-clustering.html#cb536-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb536-10"><a href="nonhierarchical-clustering.html#cb536-10" aria-hidden="true" tabindex="-1"></a>    cluster_df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(cluster_membership, find_center, <span class="at">df =</span> df, <span class="at">m =</span> m)</span>
<span id="cb536-11"><a href="nonhierarchical-clustering.html#cb536-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb536-12"><a href="nonhierarchical-clustering.html#cb536-12" aria-hidden="true" tabindex="-1"></a>    new_cluster_membership <span class="ot">&lt;-</span> <span class="fu">update_membership</span>(df, cluster_df, m)</span>
<span id="cb536-13"><a href="nonhierarchical-clustering.html#cb536-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb536-14"><a href="nonhierarchical-clustering.html#cb536-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">max</span>(<span class="fu">abs</span>(cluster_membership <span class="sc">-</span> new_cluster_membership)) <span class="sc">&lt;</span> tol) <span class="cf">break</span></span>
<span id="cb536-15"><a href="nonhierarchical-clustering.html#cb536-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb536-16"><a href="nonhierarchical-clustering.html#cb536-16" aria-hidden="true" tabindex="-1"></a>    cluster_membership <span class="ot">&lt;-</span> new_cluster_membership</span>
<span id="cb536-17"><a href="nonhierarchical-clustering.html#cb536-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb536-18"><a href="nonhierarchical-clustering.html#cb536-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb536-19"><a href="nonhierarchical-clustering.html#cb536-19" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb536-20"><a href="nonhierarchical-clustering.html#cb536-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_iteration =</span> i,</span>
<span id="cb536-21"><a href="nonhierarchical-clustering.html#cb536-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> cluster_df,</span>
<span id="cb536-22"><a href="nonhierarchical-clustering.html#cb536-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">membership =</span> cluster_membership <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb536-23"><a href="nonhierarchical-clustering.html#cb536-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb536-24"><a href="nonhierarchical-clustering.html#cb536-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb536-25"><a href="nonhierarchical-clustering.html#cb536-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (res)</span>
<span id="cb536-26"><a href="nonhierarchical-clustering.html#cb536-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="nonhierarchical-clustering.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4000</span>)</span>
<span id="cb537-2"><a href="nonhierarchical-clustering.html#cb537-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-3"><a href="nonhierarchical-clustering.html#cb537-3" aria-hidden="true" tabindex="-1"></a>fuzzy_kmeans_solution <span class="ot">&lt;-</span> <span class="fu">fuzzy_kmeans</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">k =</span> <span class="dv">3</span>, <span class="at">m =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## New names:
## * NA -&gt; ...1
## * NA -&gt; ...2
## * NA -&gt; ...3</code></pre>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="nonhierarchical-clustering.html#cb539-1" aria-hidden="true" tabindex="-1"></a>fuzzy_kmeans_solution<span class="sc">$</span>n_iteration</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="nonhierarchical-clustering.html#cb541-1" aria-hidden="true" tabindex="-1"></a>fuzzy_kmeans_solution<span class="sc">$</span>center</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      x1    x2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  3.64  2.98
## 2  7.00 14.0 
## 3 13.4   6.63</code></pre>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="nonhierarchical-clustering.html#cb543-1" aria-hidden="true" tabindex="-1"></a>fuzzy_kmeans_solution<span class="sc">$</span>membership</span></code></pre></div>
<pre><code>##                                          
##  [1,] 0.007809655 0.983147737 0.009042608
##  [2,] 0.015726915 0.957515486 0.026757600
##  [3,] 0.006068358 0.006268614 0.987663029
##  [4,] 0.078772454 0.120672309 0.800555237
##  [5,] 0.017165082 0.022105992 0.960728926
##  [6,] 0.006532987 0.984345339 0.009121674
##  [7,] 0.005945712 0.005766360 0.988287928
##  [8,] 0.939278603 0.026072757 0.034648640
##  [9,] 0.993661877 0.002989486 0.003348637
## [10,] 0.981125198 0.008481303 0.010393499</code></pre>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="nonhierarchical-clustering.html#cb545-1" aria-hidden="true" tabindex="-1"></a>fuzzy_kmeans_solution<span class="sc">$</span>membership <span class="sc">%&gt;%</span></span>
<span id="cb545-2"><a href="nonhierarchical-clustering.html#cb545-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">1</span>, which.max)</span></code></pre></div>
<pre><code>##  [1] 2 2 3 3 3 2 3 1 1 1</code></pre>
</div>
</div>
<div id="model-based-clustering" class="section level2" number="13.5">
<h2><span class="header-section-number">13.5</span> 모형기반 군집방법</h2>
<p>모형기반 군집방법(model-based clustering)에서는 각 객체가 혼합분포(mixture)를 따른다고 가정하여 객체의 군집배정변수를 통계적으로 추정하는 것이다.</p>
<div id="model-based-clustering-basic-script" class="section level3" number="13.5.1">
<h3><span class="header-section-number">13.5.1</span> 기본 R script</h3>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="nonhierarchical-clustering.html#cb547-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb547-2"><a href="nonhierarchical-clustering.html#cb547-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb547-3"><a href="nonhierarchical-clustering.html#cb547-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">12</span>),</span>
<span id="cb547-4"><a href="nonhierarchical-clustering.html#cb547-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb547-5"><a href="nonhierarchical-clustering.html#cb547-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb547-6"><a href="nonhierarchical-clustering.html#cb547-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb547-7"><a href="nonhierarchical-clustering.html#cb547-7" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb547-8"><a href="nonhierarchical-clustering.html#cb547-8" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb547-9"><a href="nonhierarchical-clustering.html#cb547-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb547-10"><a href="nonhierarchical-clustering.html#cb547-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>),</span>
<span id="cb547-11"><a href="nonhierarchical-clustering.html#cb547-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb547-12"><a href="nonhierarchical-clustering.html#cb547-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;객체번호&#39;</span>, </span>
<span id="cb547-13"><a href="nonhierarchical-clustering.html#cb547-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$x_1$&#39;</span>, </span>
<span id="cb547-14"><a href="nonhierarchical-clustering.html#cb547-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$x_2$&#39;</span></span>
<span id="cb547-15"><a href="nonhierarchical-clustering.html#cb547-15" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb547-16"><a href="nonhierarchical-clustering.html#cb547-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&#39;모형기반 군집 학습 데이터&#39;</span></span>
<span id="cb547-17"><a href="nonhierarchical-clustering.html#cb547-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:model-based-clustering-data">Table 13.4: </span>모형기반 군집 학습 데이터</caption>
<thead>
<tr class="header">
<th align="right">객체번호</th>
<th align="right"><span class="math inline">\(x_1\)</span></th>
<th align="right"><span class="math inline">\(x_2\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">4</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">6</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">6</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">10</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">11</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">12</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">12</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>Table <a href="nonhierarchical-clustering.html#tab:model-based-clustering-data">13.4</a>의 7개의 객체를 두 개의 군집에 배정하는 간단한 R 스크립트는 아래와 같다. 여기에서 <code>mclust::meVII</code>는 각 군집의 분산-공분산 행렬은 서로 다르되, 각 변수의 분산이 동일하며 공분산은 0이라 가정한다.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="nonhierarchical-clustering.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1024</span>)</span>
<span id="cb548-2"><a href="nonhierarchical-clustering.html#cb548-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-3"><a href="nonhierarchical-clustering.html#cb548-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집 개수</span></span>
<span id="cb548-4"><a href="nonhierarchical-clustering.html#cb548-4" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb548-5"><a href="nonhierarchical-clustering.html#cb548-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-6"><a href="nonhierarchical-clustering.html#cb548-6" aria-hidden="true" tabindex="-1"></a><span class="co"># z_ik 값 초기화</span></span>
<span id="cb548-7"><a href="nonhierarchical-clustering.html#cb548-7" aria-hidden="true" tabindex="-1"></a>init_z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="fu">nrow</span>(df) <span class="sc">*</span> K), <span class="at">ncol =</span> K) <span class="sc">%&gt;%</span></span>
<span id="cb548-8"><a href="nonhierarchical-clustering.html#cb548-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">/</span><span class="st">`</span>(<span class="fu">apply</span>(., <span class="dv">1</span>, sum))</span>
<span id="cb548-9"><a href="nonhierarchical-clustering.html#cb548-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-10"><a href="nonhierarchical-clustering.html#cb548-10" aria-hidden="true" tabindex="-1"></a><span class="co"># EM 알고리즘 - 분산-공분산 행렬: unequal volume (V), spherical(II) </span></span>
<span id="cb548-11"><a href="nonhierarchical-clustering.html#cb548-11" aria-hidden="true" tabindex="-1"></a>sol <span class="ot">&lt;-</span> mclust<span class="sc">::</span><span class="fu">meVII</span>(<span class="at">data =</span> df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">z =</span> init_z)</span>
<span id="cb548-12"><a href="nonhierarchical-clustering.html#cb548-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-13"><a href="nonhierarchical-clustering.html#cb548-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집 사후확률</span></span>
<span id="cb548-14"><a href="nonhierarchical-clustering.html#cb548-14" aria-hidden="true" tabindex="-1"></a>sol<span class="sc">$</span>z</span></code></pre></div>
<pre><code>##              [,1]         [,2]
## [1,] 7.596402e-28 1.000000e+00
## [2,] 8.254183e-27 1.000000e+00
## [3,] 9.463816e-36 1.000000e+00
## [4,] 1.000000e+00 6.832084e-20
## [5,] 1.000000e+00 1.473491e-25
## [6,] 1.000000e+00 4.876251e-31
## [7,] 1.000000e+00 1.480388e-20</code></pre>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="nonhierarchical-clustering.html#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 혼합분포</span></span>
<span id="cb550-2"><a href="nonhierarchical-clustering.html#cb550-2" aria-hidden="true" tabindex="-1"></a>sol<span class="sc">$</span>parameters</span></code></pre></div>
<pre><code>## $pro
## [1] 0.5714286 0.4285714
## 
## $mean
##     [,1]      [,2]
## x1 11.25  5.333333
## x2  3.50 13.333333
## 
## $variance
## $variance$modelName
## [1] &quot;VII&quot;
## 
## $variance$d
## [1] 2
## 
## $variance$G
## [1] 2
## 
## $variance$sigma
## , , 1
## 
##         x1      x2
## x1 0.96875 0.00000
## x2 0.00000 0.96875
## 
## , , 2
## 
##          x1       x2
## x1 1.222222 0.000000
## x2 0.000000 1.222222
## 
## 
## $variance$sigmasq
## [1] 0.968750 1.222222
## 
## $variance$scale
## [1] 0.968750 1.222222
## 
## 
## $Vinv
## NULL</code></pre>
</div>
<div id="model-based-clustering-em" class="section level3" number="13.5.2">
<h3><span class="header-section-number">13.5.2</span> EM 알고리즘</h3>
<p>우선, 필요한 기호를 다음과 같이 정의하자.</p>
<ul>
<li><span class="math inline">\(f_k(\mathbf{x} \, | \, \theta_k)\)</span>: 군집 <span class="math inline">\(k\)</span>에 속하는 객체 <span class="math inline">\(\mathbf{x}\)</span>의 확률밀도함수(<span class="math inline">\(\theta_k\)</span>는 관련 파라미터)</li>
<li><span class="math inline">\(\tau_k\)</span>: 임의의 객체가 군집 <span class="math inline">\(k\)</span>에 속할 사전확률 (<span class="math inline">\(\tau_k \geq 0, \, \sum_{k = 1}^{K} \tau = 1\)</span>)</li>
</ul>
<p>이 때, 임의의 객체 <span class="math inline">\(\mathbf{x}\)</span>는 다음과 같은 혼합 확률밀도함수를 갖는다.</p>
<p><span class="math display">\[\begin{equation*}
f(\mathbf{x} \, | \, \boldsymbol\theta) = \sum_{k = 1}^{K} \tau_k f_k(\mathbf{x} \, | \, \theta_k)
\end{equation*}\]</span></p>
<p>본 장에서는 <span class="math inline">\(f_k\)</span>가 다변량 정규분포를 나타낸다고 가정하자.</p>
<p>추가로, 각 객체가 속하는 군집에 대한 지시변수 <span class="math inline">\(z_{ik}\)</span>를 아래와 같이 정의하자.</p>
<p><span class="math display">\[\begin{equation*}
z_{ik} = \begin{cases}
1 &amp; \text{ if object $i$ belongs to cluster $k$} \\
0 &amp; \text{ otherwise}
\end{cases}
\end{equation*}\]</span></p>
<p>이 <span class="math inline">\(z_{ik}\)</span> 변수는 실제값이 관측되지 않는 변수이므로, 최우추정법을 이용하여 그 기대값, 즉 객체 <span class="math inline">\(i\)</span>가 군집 <span class="math inline">\(k\)</span>에 속할 확률을 추정한다. 보다 자세한 설명은 교재 <span class="citation">(<a href="#ref-jun2012datamining" role="doc-biblioref">전치혁 2012</a>)</span> 참조.</p>
<p>앞의 <a href="nonhierarchical-clustering.html#model-based-clustering-basic-script">13.5.1</a>장에서 수행했던 예제를 단계별로 살펴보기로 하자.</p>
<p><strong>[단계 0]</strong> <span class="math inline">\(\hat{z}_{ik}\)</span>를 초기화한다.</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="nonhierarchical-clustering.html#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1024</span>)</span>
<span id="cb552-2"><a href="nonhierarchical-clustering.html#cb552-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-3"><a href="nonhierarchical-clustering.html#cb552-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집 개수</span></span>
<span id="cb552-4"><a href="nonhierarchical-clustering.html#cb552-4" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb552-5"><a href="nonhierarchical-clustering.html#cb552-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-6"><a href="nonhierarchical-clustering.html#cb552-6" aria-hidden="true" tabindex="-1"></a><span class="co"># z_ik 추정값 초기화</span></span>
<span id="cb552-7"><a href="nonhierarchical-clustering.html#cb552-7" aria-hidden="true" tabindex="-1"></a>z_hat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="fu">nrow</span>(df) <span class="sc">*</span> K), <span class="at">ncol =</span> K) <span class="sc">%&gt;%</span></span>
<span id="cb552-8"><a href="nonhierarchical-clustering.html#cb552-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">/</span><span class="st">`</span>(<span class="fu">apply</span>(., <span class="dv">1</span>, sum)) <span class="sc">%&gt;%</span></span>
<span id="cb552-9"><a href="nonhierarchical-clustering.html#cb552-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb552-10"><a href="nonhierarchical-clustering.html#cb552-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="fu">str_c</span>(<span class="st">&quot;C&quot;</span>, <span class="dv">1</span><span class="sc">:</span>K))</span>
<span id="cb552-11"><a href="nonhierarchical-clustering.html#cb552-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-12"><a href="nonhierarchical-clustering.html#cb552-12" aria-hidden="true" tabindex="-1"></a>z_hat</span></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##       C1     C2
##    &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.406  0.594 
## 2 0.623  0.377 
## 3 0.372  0.628 
## 4 0.956  0.0444
## 5 0.0214 0.979 
## 6 0.681  0.319 
## 7 0.264  0.736</code></pre>
<p><strong>[단계 1]</strong> (M-step) <span class="math inline">\(\hat{z}_{ik}\)</span>를 바탕으로 파라미터를 추정한다.</p>
<p>우선 <span class="math inline">\(\tau_k\)</span>와 <span class="math inline">\(\boldsymbol\mu_k\)</span>를 다음과 같이 추정한다.</p>
<p><span class="math display">\[\begin{equation*}
\hat{\tau}_k = \frac{\sum_{i = 1}^{n} \hat{z}_{ik}}{n}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="nonhierarchical-clustering.html#cb554-1" aria-hidden="true" tabindex="-1"></a>tau_hat <span class="ot">&lt;-</span> <span class="fu">map</span>(z_hat, mean)</span>
<span id="cb554-2"><a href="nonhierarchical-clustering.html#cb554-2" aria-hidden="true" tabindex="-1"></a>tau_hat</span></code></pre></div>
<pre><code>## $C1
## [1] 0.4746762
## 
## $C2
## [1] 0.5253238</code></pre>
<p><span class="math display">\[\begin{equation*}
\hat{\boldsymbol\mu}_k = \frac{\sum_{i = 1}^{n} \hat{z}_{ik} \mathbf{x}_i}{\sum_{i = 1}^{n} \hat{z}_{ik}}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="nonhierarchical-clustering.html#cb556-1" aria-hidden="true" tabindex="-1"></a>mu_hat <span class="ot">&lt;-</span> <span class="fu">map</span>(z_hat, <span class="sc">~</span><span class="fu">colSums</span>(.<span class="sc">*</span>df[, <span class="sc">-</span><span class="dv">1</span>]) <span class="sc">/</span> <span class="fu">sum</span>(.))</span>
<span id="cb556-2"><a href="nonhierarchical-clustering.html#cb556-2" aria-hidden="true" tabindex="-1"></a>mu_hat</span></code></pre></div>
<pre><code>## $C1
##       x1       x2 
## 8.644042 7.559792 
## 
## $C2
##       x1       x2 
## 8.777757 7.853884</code></pre>
<p>분산-공분산 행렬 <span class="math inline">\(\boldsymbol\Sigma_k\)</span>의 추정은 분산-공분산 구조를 어떻게 가정하느냐에 따라 다르다. 우선, 일반적으로 분산-공분산 행렬 <span class="math inline">\(\boldsymbol\Sigma_k\)</span>는 아래와 같이 decompose할 수 있다 <span class="citation">(<a href="#ref-banfield1993model" role="doc-biblioref">Banfield and Raftery 1993</a>)</span>.</p>
<p><span class="math display">\[\begin{equation*}
\boldsymbol\Sigma_k = \lambda_k \mathbf{D}_k \mathbf{A}_k \mathbf{D}_k^\top
\end{equation*}\]</span></p>
<p>여기에서</p>
<ul>
<li><span class="math inline">\(\lambda_k = \det{\boldsymbol\Sigma_k}^{1 / 2}\)</span>; 군집 <span class="math inline">\(k\)</span>이 크기와 관련</li>
<li><span class="math inline">\(\mathbf{D}_k\)</span>: matrix of eigenvectors of <span class="math inline">\(\boldsymbol\Sigma_k\)</span>; 군집 <span class="math inline">\(k\)</span>의 방향(orientation)과 관련</li>
<li><span class="math inline">\(\mathbf{A}_k\)</span>: diagonal matrix s.t. <span class="math inline">\(\det{\mathbf{A}_k} = 1\)</span>; 군집 <span class="math inline">\(k\)</span>의 형태와 관련</li>
</ul>
<p>이다. <span class="math inline">\(\lambda_k\)</span>, <span class="math inline">\(\mathbf{D}_k\)</span> 및 <span class="math inline">\(\mathbf{A}_k\)</span>에 적용되는 제약조건에 따라 분산-공분산 모형을 정의할 수 있다. 아래는 본 장에서 다룰 세 가지 모형이다.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="nonhierarchical-clustering.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(</span>
<span id="cb558-2"><a href="nonhierarchical-clustering.html#cb558-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>model, <span class="sc">~</span>sigma,</span>
<span id="cb558-3"><a href="nonhierarchical-clustering.html#cb558-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;VII&quot;</span>, <span class="st">&quot;$</span><span class="sc">\\</span><span class="st">lambda_k </span><span class="sc">\\</span><span class="st">mathbf{I}$&quot;</span>,</span>
<span id="cb558-4"><a href="nonhierarchical-clustering.html#cb558-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;VEI&quot;</span>, <span class="st">&quot;$</span><span class="sc">\\</span><span class="st">lambda_k </span><span class="sc">\\</span><span class="st">mathbf{A}$&quot;</span>,</span>
<span id="cb558-5"><a href="nonhierarchical-clustering.html#cb558-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;VEE&quot;</span>, <span class="st">&quot;$</span><span class="sc">\\</span><span class="st">lambda_k </span><span class="sc">\\</span><span class="st">mathbf{D} </span><span class="sc">\\</span><span class="st">mathbf{A} </span><span class="sc">\\</span><span class="st">mathbf{D}^</span><span class="sc">\\</span><span class="st">top$&quot;</span></span>
<span id="cb558-6"><a href="nonhierarchical-clustering.html#cb558-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb558-7"><a href="nonhierarchical-clustering.html#cb558-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb558-8"><a href="nonhierarchical-clustering.html#cb558-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb558-9"><a href="nonhierarchical-clustering.html#cb558-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&#39;c&#39;</span>, <span class="st">&#39;c&#39;</span>),</span>
<span id="cb558-10"><a href="nonhierarchical-clustering.html#cb558-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb558-11"><a href="nonhierarchical-clustering.html#cb558-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;분산-공분산 모형&#39;</span>, </span>
<span id="cb558-12"><a href="nonhierarchical-clustering.html#cb558-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$</span><span class="sc">\\</span><span class="st">boldsymbol</span><span class="sc">\\</span><span class="st">Sigma_k$&#39;</span></span>
<span id="cb558-13"><a href="nonhierarchical-clustering.html#cb558-13" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb558-14"><a href="nonhierarchical-clustering.html#cb558-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&#39;Within-group 분산-공분산 모형&#39;</span></span>
<span id="cb558-15"><a href="nonhierarchical-clustering.html#cb558-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:within-group-cov-models">Table 13.5: </span>Within-group 분산-공분산 모형</caption>
<thead>
<tr class="header">
<th align="center">분산-공분산 모형</th>
<th align="center"><span class="math inline">\(\boldsymbol\Sigma_k\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">VII</td>
<td align="center"><span class="math inline">\(\lambda_k \mathbf{I}\)</span></td>
</tr>
<tr class="even">
<td align="center">VEI</td>
<td align="center"><span class="math inline">\(\lambda_k \mathbf{A}\)</span></td>
</tr>
<tr class="odd">
<td align="center">VEE</td>
<td align="center"><span class="math inline">\(\lambda_k \mathbf{D} \mathbf{A} \mathbf{D}^\top\)</span></td>
</tr>
</tbody>
</table>
<p>즉,</p>
<ul>
<li>“VII”
<ul>
<li>for all <span class="math inline">\(k\)</span>,<span class="math inline">\(\mathbf{D}_k = \mathbf{I}\)</span></li>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{A}_k = \mathbf{I}\)</span></li>
</ul></li>
<li>“VEI”
<ul>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{D}_k = \mathbf{I}\)</span></li>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{A}_k = \mathbf{A}\)</span></li>
</ul></li>
<li>“VEE”
<ul>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{D}_k = \mathbf{D}\)</span></li>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{A}_k = \mathbf{A}\)</span></li>
</ul></li>
</ul>
<p><span class="citation"><a href="#ref-celeux1995gaussian" role="doc-biblioref">Celeux and Govaert</a> (<a href="#ref-celeux1995gaussian" role="doc-biblioref">1995</a>)</span> 에 각 분산-공분산 모형에 대한 추정값을 얻는 반복적 알고리즘이 소개되어 있으며, 이는 교재 <span class="citation">(<a href="#ref-jun2012datamining" role="doc-biblioref">전치혁 2012</a>)</span>에도 설명되어 있다.</p>
<p>우선, 각 군집 <span class="math inline">\(k\)</span> 내에서의 scatter matrix를 아래와 같이 계산한다.</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{W}_k = \sum_{i = 1}^{n} \hat{z}_{ik} (\mathbf{x}_i - \hat{\boldsymbol\mu}_k)(\mathbf{x}_i - \hat{\boldsymbol\mu}_k)^\top
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="nonhierarchical-clustering.html#cb559-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(df[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb559-2"><a href="nonhierarchical-clustering.html#cb559-2" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">map</span>(mu_hat, </span>
<span id="cb559-3"><a href="nonhierarchical-clustering.html#cb559-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">pmap_dfc</span>(<span class="fu">list</span>(<span class="at">x =</span> df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">mu =</span> .),</span>
<span id="cb559-4"><a href="nonhierarchical-clustering.html#cb559-4" aria-hidden="true" tabindex="-1"></a>             <span class="cf">function</span>(x, mu) x <span class="sc">-</span> mu)) <span class="sc">%&gt;%</span></span>
<span id="cb559-5"><a href="nonhierarchical-clustering.html#cb559-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(as.matrix, <span class="at">nrow =</span> p, <span class="at">ncol =</span> p) <span class="sc">%&gt;%</span></span>
<span id="cb559-6"><a href="nonhierarchical-clustering.html#cb559-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(z_hat, <span class="sc">~</span> <span class="fu">t</span>(.x) <span class="sc">%*%</span> (.y <span class="sc">*</span> .x))</span>
<span id="cb559-7"><a href="nonhierarchical-clustering.html#cb559-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-8"><a href="nonhierarchical-clustering.html#cb559-8" aria-hidden="true" tabindex="-1"></a>W</span></code></pre></div>
<pre><code>## $C1
##           x1        x2
## x1  28.22794 -44.46516
## x2 -44.46516  82.36848
## 
## $C2
##           x1        x2
## x1  37.16942 -53.17491
## x2 -53.17491  92.90912</code></pre>
<p>이후 분산-공분산 모형에 따라 아래와 같이 각 군집의 분산-공분산 행렬을 추정한다.</p>
<p>[VII의 경우] 반복 업데이트의 과정 없이 closed-form으로 해가 존재한다.</p>
<p><span class="math display">\[\begin{equation*}
\lambda_k = \frac{Tr(\mathbf{W}_k)}{p \sum_{i = 1}^{n} \hat{z}_{ik}}
\end{equation*}\]</span></p>
<p><span class="math display">\[\begin{equation*}
\boldsymbol\Sigma_k = \lambda_k \mathbf{I}
\end{equation*}\]</span></p>
<p>이 때 <span class="math inline">\(p\)</span>는 관측값의 차원수이다 (<span class="math inline">\(\mathbf{x} \in \mathbb{R}^p\)</span>).</p>
<p>[VEI의 경우]</p>
<p>VEI-0. 행렬 <span class="math inline">\(\mathbf{B} = \mathbf{I}\)</span>로 초기화한다.</p>
<p>VEI-1. <span class="math inline">\(\lambda_k\)</span>값을 아래와 같이 계산한다.</p>
<p><span class="math display">\[\begin{equation*}
\lambda_k = \frac{Tr(\mathbf{W}_k \mathbf{B}^{-1})}{p \sum_{i = 1}^{n} \hat{z}_{ik}}
\end{equation*}\]</span></p>
<p>VEI-2. 행렬 <span class="math inline">\(\mathbf{B}\)</span>를 아래와 같이 업데이트한다.</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{B} = \frac{diag\left( \sum_{k = 1}^{K} \frac{\mathbf{W}_k}{\lambda_k} \right)}{\left( \det diag\left( \sum_{k = 1}^{K} \frac{\mathbf{W}_k}{\lambda_k} \right) \right)^{1 / p}}
\end{equation*}\]</span></p>
<p>VEI-3. 결과가 수렴하면 종료, 그렇지 않으면 VEI-1로 돌아간다. 최종 수렴한 결과를 통해 각 군집의 분산-공분산 행렬을 아래와 같이 얻는다.</p>
<p><span class="math display">\[\begin{equation*}
\boldsymbol\Sigma_k = \lambda_k \mathbf{B}
\end{equation*}\]</span></p>
<p>[VEE의 경우]</p>
<p>VEE-0. 행렬 <span class="math inline">\(\mathbf{C} = \mathbf{I}\)</span>로 초기화한다.</p>
<p>VEE-1. <span class="math inline">\(\lambda_k\)</span>값을 아래와 같이 계산한다.</p>
<p><span class="math display">\[\begin{equation*}
\lambda_k = \frac{Tr(\mathbf{W}_k \mathbf{C}^{-1})}{p \sum_{i = 1}^{n} \hat{z}_{ik}}
\end{equation*}\]</span></p>
<p>VEE-2. 행렬 <span class="math inline">\(\mathbf{C}\)</span>를 아래와 같이 업데이트한다.</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{C} = \frac{\sum_{k = 1}^{K} \frac{\mathbf{W}_k}{\lambda_k}}{\left( \det \sum_{k = 1}^{K} \frac{\mathbf{W}_k}{\lambda_k} \right)^{1 / p}}
\end{equation*}\]</span></p>
<p>VEE-3. 결과가 수렴하면 종료, 그렇지 않으면 VEE-1로 돌아간다. 최종 수렴한 결과를 통해 각 군집의 분산-공분산 행렬을 아래와 같이 얻는다.</p>
<p><span class="math display">\[\begin{equation*}
\boldsymbol\Sigma_k = \lambda_k \mathbf{C}
\end{equation*}\]</span></p>
<p>위 각 분산-공분산 모형을 추정 과정에 대한 설명은, 보다 일반화된 분산-공분산 구조 <span class="math inline">\(\lambda_k \mathbf{D}_k \mathbf{A}_k \mathbf{D}_k^\top\)</span>을 추정하는 과정을 각 모형에 추가되는 제약에 따라 조금 더 단순하게 표현한 것이다. 보다 자세한 내용은 <span class="citation"><a href="#ref-celeux1995gaussian" role="doc-biblioref">Celeux and Govaert</a> (<a href="#ref-celeux1995gaussian" role="doc-biblioref">1995</a>)</span> 참조.</p>
<p>아래와 같이 군집 내 분산-공분산 행렬을 추정하는 함수 <code>estimate_mixture_cov</code>를 구현해보자. 해당 함수는 3개의 입력변수를 사용한다.</p>
<ul>
<li><code>modelName</code>: 분산-공분산 모형 이름. “VII,” “VEI,” “VEE” 중 하나를 선택한다.</li>
<li><code>W</code>: <code>K</code>개의 scatter matrix (<span class="math inline">\(\mathbf{W}_1, \cdots, \mathbf{W}_K\)</span>)를 원소로 지니는 리스트 (<code>list</code>)</li>
<li><code>z</code>: <span class="math inline">\(z_{ik}\)</span> 값을 지닌 데이터 프레임 (<code>data.frame</code>). <span class="math inline">\(n\)</span>개의 행과 <span class="math inline">\(K\)</span>개의 열로 이루어진다. 즉, 행은 각 관측객체를 나타내며, 열은 각 군집을 나타낸다.</li>
</ul>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="nonhierarchical-clustering.html#cb561-1" aria-hidden="true" tabindex="-1"></a>estimate_mixture_cov <span class="ot">&lt;-</span> <span class="cf">function</span>(modelName, W, z) {</span>
<span id="cb561-2"><a href="nonhierarchical-clustering.html#cb561-2" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(z)</span>
<span id="cb561-3"><a href="nonhierarchical-clustering.html#cb561-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(W[[<span class="dv">1</span>]])</span>
<span id="cb561-4"><a href="nonhierarchical-clustering.html#cb561-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-5"><a href="nonhierarchical-clustering.html#cb561-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 초기화</span></span>
<span id="cb561-6"><a href="nonhierarchical-clustering.html#cb561-6" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="sc">~</span> <span class="fu">diag</span>(<span class="dv">1</span>, p))</span>
<span id="cb561-7"><a href="nonhierarchical-clustering.html#cb561-7" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="sc">~</span> <span class="fu">diag</span>(<span class="dv">1</span>, p))</span>
<span id="cb561-8"><a href="nonhierarchical-clustering.html#cb561-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb561-9"><a href="nonhierarchical-clustering.html#cb561-9" aria-hidden="true" tabindex="-1"></a>  get_lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(W, z, D, A, p) {</span>
<span id="cb561-10"><a href="nonhierarchical-clustering.html#cb561-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pmap</span>(</span>
<span id="cb561-11"><a href="nonhierarchical-clustering.html#cb561-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(W, z, D, A),</span>
<span id="cb561-12"><a href="nonhierarchical-clustering.html#cb561-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(W, z, D, A, p)</span>
<span id="cb561-13"><a href="nonhierarchical-clustering.html#cb561-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(<span class="fu">diag</span>(W <span class="sc">%*%</span> D <span class="sc">%*%</span> <span class="fu">solve</span>(A) <span class="sc">%*%</span> <span class="fu">t</span>(D))) <span class="sc">/</span> (<span class="fu">sum</span>(z) <span class="sc">*</span> p),</span>
<span id="cb561-14"><a href="nonhierarchical-clustering.html#cb561-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">p =</span> p</span>
<span id="cb561-15"><a href="nonhierarchical-clustering.html#cb561-15" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb561-16"><a href="nonhierarchical-clustering.html#cb561-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb561-17"><a href="nonhierarchical-clustering.html#cb561-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb561-18"><a href="nonhierarchical-clustering.html#cb561-18" aria-hidden="true" tabindex="-1"></a>  objective_value <span class="ot">&lt;-</span> <span class="cf">function</span>(W, z, lambda, D, A, p) {</span>
<span id="cb561-19"><a href="nonhierarchical-clustering.html#cb561-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pmap_dbl</span>(</span>
<span id="cb561-20"><a href="nonhierarchical-clustering.html#cb561-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(W, z, lambda, D, A),</span>
<span id="cb561-21"><a href="nonhierarchical-clustering.html#cb561-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(W, z, lambda, D, A, p)</span>
<span id="cb561-22"><a href="nonhierarchical-clustering.html#cb561-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(<span class="fu">diag</span>(W <span class="sc">%*%</span> D <span class="sc">%*%</span> <span class="fu">solve</span>(A) <span class="sc">%*%</span> <span class="fu">t</span>(D))) <span class="sc">/</span> lambda <span class="sc">+</span></span>
<span id="cb561-23"><a href="nonhierarchical-clustering.html#cb561-23" aria-hidden="true" tabindex="-1"></a>        p <span class="sc">*</span> <span class="fu">sum</span>(z) <span class="sc">*</span> <span class="fu">log</span>(lambda),</span>
<span id="cb561-24"><a href="nonhierarchical-clustering.html#cb561-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">p =</span> p</span>
<span id="cb561-25"><a href="nonhierarchical-clustering.html#cb561-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb561-26"><a href="nonhierarchical-clustering.html#cb561-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>()</span>
<span id="cb561-27"><a href="nonhierarchical-clustering.html#cb561-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb561-28"><a href="nonhierarchical-clustering.html#cb561-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb561-29"><a href="nonhierarchical-clustering.html#cb561-29" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> 0L</span>
<span id="cb561-30"><a href="nonhierarchical-clustering.html#cb561-30" aria-hidden="true" tabindex="-1"></a>  obj <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb561-31"><a href="nonhierarchical-clustering.html#cb561-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb561-32"><a href="nonhierarchical-clustering.html#cb561-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(<span class="cn">TRUE</span>) {</span>
<span id="cb561-33"><a href="nonhierarchical-clustering.html#cb561-33" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> 1L</span>
<span id="cb561-34"><a href="nonhierarchical-clustering.html#cb561-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb561-35"><a href="nonhierarchical-clustering.html#cb561-35" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> <span class="fu">get_lambda</span>(W, z, D, A, p)</span>
<span id="cb561-36"><a href="nonhierarchical-clustering.html#cb561-36" aria-hidden="true" tabindex="-1"></a>    new_obj <span class="ot">&lt;-</span> <span class="fu">objective_value</span>(W, z, lambda, D, A, p)</span>
<span id="cb561-37"><a href="nonhierarchical-clustering.html#cb561-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb561-38"><a href="nonhierarchical-clustering.html#cb561-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (obj <span class="sc">-</span> new_obj <span class="sc">&lt;</span> <span class="fl">1e-9</span>) <span class="cf">break</span></span>
<span id="cb561-39"><a href="nonhierarchical-clustering.html#cb561-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb561-40"><a href="nonhierarchical-clustering.html#cb561-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (modelName <span class="sc">==</span> <span class="st">&quot;VII&quot;</span>) {</span>
<span id="cb561-41"><a href="nonhierarchical-clustering.html#cb561-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb561-42"><a href="nonhierarchical-clustering.html#cb561-42" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (modelName <span class="sc">==</span> <span class="st">&quot;VEI&quot;</span>) {</span>
<span id="cb561-43"><a href="nonhierarchical-clustering.html#cb561-43" aria-hidden="true" tabindex="-1"></a>      B <span class="ot">&lt;-</span> <span class="fu">map2</span>(W, lambda, <span class="sc">~</span> <span class="fu">diag</span>(.x) <span class="sc">/</span> .y) <span class="sc">%&gt;%</span> </span>
<span id="cb561-44"><a href="nonhierarchical-clustering.html#cb561-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">reduce</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb561-45"><a href="nonhierarchical-clustering.html#cb561-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">diag</span>() <span class="sc">%&gt;%</span></span>
<span id="cb561-46"><a href="nonhierarchical-clustering.html#cb561-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">/</span><span class="st">`</span>(<span class="fu">det</span>(.) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> p))</span>
<span id="cb561-47"><a href="nonhierarchical-clustering.html#cb561-47" aria-hidden="true" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="sc">~</span> B)</span>
<span id="cb561-48"><a href="nonhierarchical-clustering.html#cb561-48" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (modelName <span class="sc">==</span> <span class="st">&quot;VEE&quot;</span>) {</span>
<span id="cb561-49"><a href="nonhierarchical-clustering.html#cb561-49" aria-hidden="true" tabindex="-1"></a>      C <span class="ot">&lt;-</span> <span class="fu">map2</span>(W, lambda, <span class="sc">~</span> .x <span class="sc">/</span> .y) <span class="sc">%&gt;%</span> </span>
<span id="cb561-50"><a href="nonhierarchical-clustering.html#cb561-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">reduce</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb561-51"><a href="nonhierarchical-clustering.html#cb561-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">/</span><span class="st">`</span>(<span class="fu">det</span>(.) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> p))</span>
<span id="cb561-52"><a href="nonhierarchical-clustering.html#cb561-52" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb561-53"><a href="nonhierarchical-clustering.html#cb561-53" aria-hidden="true" tabindex="-1"></a>      s <span class="ot">&lt;-</span> <span class="fu">svd</span>(C)</span>
<span id="cb561-54"><a href="nonhierarchical-clustering.html#cb561-54" aria-hidden="true" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="sc">~</span> <span class="fu">diag</span>(s<span class="sc">$</span>d))</span>
<span id="cb561-55"><a href="nonhierarchical-clustering.html#cb561-55" aria-hidden="true" tabindex="-1"></a>      D <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="sc">~</span> s<span class="sc">$</span>u)</span>
<span id="cb561-56"><a href="nonhierarchical-clustering.html#cb561-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb561-57"><a href="nonhierarchical-clustering.html#cb561-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;Model &quot;</span>, modelName, <span class="st">&quot; is not supported yet.&quot;</span>)</span>
<span id="cb561-58"><a href="nonhierarchical-clustering.html#cb561-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb561-59"><a href="nonhierarchical-clustering.html#cb561-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb561-60"><a href="nonhierarchical-clustering.html#cb561-60" aria-hidden="true" tabindex="-1"></a>    obj <span class="ot">&lt;-</span> new_obj</span>
<span id="cb561-61"><a href="nonhierarchical-clustering.html#cb561-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb561-62"><a href="nonhierarchical-clustering.html#cb561-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-63"><a href="nonhierarchical-clustering.html#cb561-63" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">pmap</span>(</span>
<span id="cb561-64"><a href="nonhierarchical-clustering.html#cb561-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(lambda, D, A),</span>
<span id="cb561-65"><a href="nonhierarchical-clustering.html#cb561-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(lambda, D, A) lambda <span class="sc">*</span> (D <span class="sc">%*%</span> A <span class="sc">%*%</span> <span class="fu">t</span>(D))</span>
<span id="cb561-66"><a href="nonhierarchical-clustering.html#cb561-66" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb561-67"><a href="nonhierarchical-clustering.html#cb561-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-68"><a href="nonhierarchical-clustering.html#cb561-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span>(</span>
<span id="cb561-69"><a href="nonhierarchical-clustering.html#cb561-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">volume =</span> lambda,</span>
<span id="cb561-70"><a href="nonhierarchical-clustering.html#cb561-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> A,</span>
<span id="cb561-71"><a href="nonhierarchical-clustering.html#cb561-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">orientation =</span> D,</span>
<span id="cb561-72"><a href="nonhierarchical-clustering.html#cb561-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sigma =</span> Sigma</span>
<span id="cb561-73"><a href="nonhierarchical-clustering.html#cb561-73" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb561-74"><a href="nonhierarchical-clustering.html#cb561-74" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>초기값으로 주어진 <span class="math inline">\(\hat{z}_{ik}\)</span> 를 이용하여 “VII” 구조의 분산-공분산 행렬을 구해보자.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="nonhierarchical-clustering.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">estimate_mixture_cov</span>(<span class="st">&quot;VII&quot;</span>, W, z_hat)</span></code></pre></div>
<pre><code>## $volume
## $volume$C1
## [1] 16.64239
## 
## $volume$C2
## [1] 17.68685
## 
## 
## $shape
## $shape[[1]]
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1
## 
## $shape[[2]]
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1
## 
## 
## $orientation
## $orientation[[1]]
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1
## 
## $orientation[[2]]
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1
## 
## 
## $Sigma
## $Sigma$C1
##          [,1]     [,2]
## [1,] 16.64239  0.00000
## [2,]  0.00000 16.64239
## 
## $Sigma$C2
##          [,1]     [,2]
## [1,] 17.68685  0.00000
## [2,]  0.00000 17.68685</code></pre>
<p>위 <code>estimate_mixture_cov</code> 함수에서 “VII”보다 일반화된 “VEI”와 “VEE” 분산-공분산 모형에 대한 추정도 구현되어 있다.</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="nonhierarchical-clustering.html#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate_mixture_cov(&quot;VEI&quot;, W, z_hat)</span></span>
<span id="cb564-2"><a href="nonhierarchical-clustering.html#cb564-2" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate_mixture_cov(&quot;VEE&quot;, W, z_hat)</span></span></code></pre></div>
<p>위 일련의 파리미터 추정을 하나의 함수 <code>GMM_Mstep</code>으로 아래와 같이 구성해보자.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="nonhierarchical-clustering.html#cb565-1" aria-hidden="true" tabindex="-1"></a>GMM_Mstep <span class="ot">&lt;-</span> <span class="cf">function</span>(df, z, <span class="at">modelName =</span> <span class="st">&quot;VII&quot;</span>) {</span>
<span id="cb565-2"><a href="nonhierarchical-clustering.html#cb565-2" aria-hidden="true" tabindex="-1"></a>  tau <span class="ot">&lt;-</span> <span class="fu">map</span>(z, mean)</span>
<span id="cb565-3"><a href="nonhierarchical-clustering.html#cb565-3" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">map</span>(z, <span class="sc">~</span><span class="fu">colSums</span>(. <span class="sc">*</span> df) <span class="sc">/</span> <span class="fu">sum</span>(.))</span>
<span id="cb565-4"><a href="nonhierarchical-clustering.html#cb565-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb565-5"><a href="nonhierarchical-clustering.html#cb565-5" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(df)</span>
<span id="cb565-6"><a href="nonhierarchical-clustering.html#cb565-6" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">map</span>(mu, <span class="sc">~</span><span class="fu">pmap_dfc</span>(</span>
<span id="cb565-7"><a href="nonhierarchical-clustering.html#cb565-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">x =</span> df, <span class="at">mu =</span> .), <span class="cf">function</span>(x, mu) x <span class="sc">-</span> mu)) <span class="sc">%&gt;%</span></span>
<span id="cb565-8"><a href="nonhierarchical-clustering.html#cb565-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(as.matrix, <span class="at">nrow =</span> p, <span class="at">ncol =</span> p) <span class="sc">%&gt;%</span></span>
<span id="cb565-9"><a href="nonhierarchical-clustering.html#cb565-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(z, <span class="sc">~</span> <span class="fu">t</span>(.x) <span class="sc">%*%</span> (.y <span class="sc">*</span> .x))</span>
<span id="cb565-10"><a href="nonhierarchical-clustering.html#cb565-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb565-11"><a href="nonhierarchical-clustering.html#cb565-11" aria-hidden="true" tabindex="-1"></a>  var_cov <span class="ot">&lt;-</span> <span class="fu">estimate_mixture_cov</span>(modelName, W, z)</span>
<span id="cb565-12"><a href="nonhierarchical-clustering.html#cb565-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb565-13"><a href="nonhierarchical-clustering.html#cb565-13" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb565-14"><a href="nonhierarchical-clustering.html#cb565-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau =</span> tau,</span>
<span id="cb565-15"><a href="nonhierarchical-clustering.html#cb565-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu =</span> mu,</span>
<span id="cb565-16"><a href="nonhierarchical-clustering.html#cb565-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sigma =</span> var_cov<span class="sc">$</span>Sigma</span>
<span id="cb565-17"><a href="nonhierarchical-clustering.html#cb565-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb565-18"><a href="nonhierarchical-clustering.html#cb565-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb565-19"><a href="nonhierarchical-clustering.html#cb565-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (res)</span>
<span id="cb565-20"><a href="nonhierarchical-clustering.html#cb565-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb565-21"><a href="nonhierarchical-clustering.html#cb565-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-22"><a href="nonhierarchical-clustering.html#cb565-22" aria-hidden="true" tabindex="-1"></a>Mstep_res <span class="ot">&lt;-</span> <span class="fu">GMM_Mstep</span>(df[, <span class="sc">-</span><span class="dv">1</span>], z_hat)</span>
<span id="cb565-23"><a href="nonhierarchical-clustering.html#cb565-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-24"><a href="nonhierarchical-clustering.html#cb565-24" aria-hidden="true" tabindex="-1"></a>Mstep_res</span></code></pre></div>
<pre><code>## $tau
## $tau$C1
## [1] 0.4746762
## 
## $tau$C2
## [1] 0.5253238
## 
## 
## $mu
## $mu$C1
##       x1       x2 
## 8.644042 7.559792 
## 
## $mu$C2
##       x1       x2 
## 8.777757 7.853884 
## 
## 
## $Sigma
## $Sigma$C1
##          [,1]     [,2]
## [1,] 16.64239  0.00000
## [2,]  0.00000 16.64239
## 
## $Sigma$C2
##          [,1]     [,2]
## [1,] 17.68685  0.00000
## [2,]  0.00000 17.68685</code></pre>
<p><strong>[단계 2]</strong> (E-step) M-step에서의 파라미터 추정치를 바탕으로 <span class="math inline">\(\hat{z}_{ik}\)</span>를 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
\hat{z}_{ik} = \frac{\hat{\tau}_k f_k(\mathbf{x}_i \, | \, \hat{\boldsymbol{\mu}}_k, \hat{\boldsymbol{\Sigma}}_k)}{\sum_{l = 1}^{K} \hat{\tau}_l f_l(\mathbf{x}_i \, | \, \hat{\boldsymbol{\mu}}_l, \hat{\boldsymbol{\Sigma}}_l)}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="nonhierarchical-clustering.html#cb567-1" aria-hidden="true" tabindex="-1"></a>GMM_Estep <span class="ot">&lt;-</span> <span class="cf">function</span>(df, tau, mu, Sigma) {</span>
<span id="cb567-2"><a href="nonhierarchical-clustering.html#cb567-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap_dfc</span>(<span class="fu">list</span>(<span class="at">tau =</span> tau, <span class="at">mu =</span> mu, <span class="at">Sigma =</span> Sigma),</span>
<span id="cb567-3"><a href="nonhierarchical-clustering.html#cb567-3" aria-hidden="true" tabindex="-1"></a>       <span class="cf">function</span>(df, tau, mu, Sigma) </span>
<span id="cb567-4"><a href="nonhierarchical-clustering.html#cb567-4" aria-hidden="true" tabindex="-1"></a>         tau <span class="sc">*</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(df, <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma),</span>
<span id="cb567-5"><a href="nonhierarchical-clustering.html#cb567-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">df =</span> df) <span class="sc">%&gt;%</span></span>
<span id="cb567-6"><a href="nonhierarchical-clustering.html#cb567-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">/</span><span class="st">`</span>(<span class="fu">rowSums</span>(.))</span>
<span id="cb567-7"><a href="nonhierarchical-clustering.html#cb567-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb567-8"><a href="nonhierarchical-clustering.html#cb567-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-9"><a href="nonhierarchical-clustering.html#cb567-9" aria-hidden="true" tabindex="-1"></a>new_z_hat <span class="ot">&lt;-</span> <span class="fu">GMM_Estep</span>(df[, <span class="sc">-</span><span class="dv">1</span>], Mstep_res<span class="sc">$</span>tau, Mstep_res<span class="sc">$</span>mu, Mstep_res<span class="sc">$</span>Sigma)</span>
<span id="cb567-10"><a href="nonhierarchical-clustering.html#cb567-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-11"><a href="nonhierarchical-clustering.html#cb567-11" aria-hidden="true" tabindex="-1"></a>new_z_hat</span></code></pre></div>
<pre><code>##          C1        C2
## 1 0.4626878 0.5373122
## 2 0.4568716 0.5431284
## 3 0.4373551 0.5626449
## 4 0.4964082 0.5035918
## 5 0.4934276 0.5065724
## 6 0.4886741 0.5113259
## 7 0.4870085 0.5129915</code></pre>
<p><strong>[단계 3]</strong> 수렴조건을 만족하면 stop, 그렇지 않으면 [단계 1]을 반복한다. 일반적으로는 우도함수값의 변화량을 수렴조건으로 사용하나, 본 장에서는 간단하게 <span class="math inline">\(z_{ik}\)</span>값의 변화량을 기준으로 수렴을 판단하도록 하자.</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="nonhierarchical-clustering.html#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(z_hat <span class="sc">-</span> new_z_hat)) <span class="sc">&lt;</span> <span class="fl">1e-9</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>위 수식의 값이 <code>TRUE</code>이면 수렴, <code>FALSE</code>이면 [단계 1]을 반복한다.</p>
</div>
<div id="model-based-clustering-script-implement" class="section level3" number="13.5.3">
<h3><span class="header-section-number">13.5.3</span> R 스크립트 구현</h3>
<p>위 일련의 과정들을 포함하는 하나의 함수 <code>GMM_EM</code>을 아래와 같이 구현해보자. 앞에서 정의했던 함수 <code>GMM_Mstep</code> 및 <code>GMM_Estep</code>을 재사용한다.</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="nonhierarchical-clustering.html#cb571-1" aria-hidden="true" tabindex="-1"></a>GMM_EM <span class="ot">&lt;-</span> <span class="cf">function</span>(df, K, <span class="at">modelName =</span> <span class="st">&quot;VII&quot;</span>, <span class="at">tol =</span> <span class="fl">1e-9</span>) {</span>
<span id="cb571-2"><a href="nonhierarchical-clustering.html#cb571-2" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">min</span>(K, <span class="fu">nrow</span>(df))</span>
<span id="cb571-3"><a href="nonhierarchical-clustering.html#cb571-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb571-4"><a href="nonhierarchical-clustering.html#cb571-4" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> 0L  </span>
<span id="cb571-5"><a href="nonhierarchical-clustering.html#cb571-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb571-6"><a href="nonhierarchical-clustering.html#cb571-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># [단계 0] z_ik 추정값 초기화</span></span>
<span id="cb571-7"><a href="nonhierarchical-clustering.html#cb571-7" aria-hidden="true" tabindex="-1"></a>  z_hat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="fu">nrow</span>(df) <span class="sc">*</span> K), <span class="at">ncol =</span> K) <span class="sc">%&gt;%</span></span>
<span id="cb571-8"><a href="nonhierarchical-clustering.html#cb571-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">/</span><span class="st">`</span>(<span class="fu">apply</span>(., <span class="dv">1</span>, sum)) <span class="sc">%&gt;%</span></span>
<span id="cb571-9"><a href="nonhierarchical-clustering.html#cb571-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb571-10"><a href="nonhierarchical-clustering.html#cb571-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="fu">str_c</span>(<span class="st">&quot;C&quot;</span>, <span class="dv">1</span><span class="sc">:</span>K))</span>
<span id="cb571-11"><a href="nonhierarchical-clustering.html#cb571-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb571-12"><a href="nonhierarchical-clustering.html#cb571-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb571-13"><a href="nonhierarchical-clustering.html#cb571-13" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> 1L</span>
<span id="cb571-14"><a href="nonhierarchical-clustering.html#cb571-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb571-15"><a href="nonhierarchical-clustering.html#cb571-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [단계 1] M-step</span></span>
<span id="cb571-16"><a href="nonhierarchical-clustering.html#cb571-16" aria-hidden="true" tabindex="-1"></a>    Mstep_res <span class="ot">&lt;-</span> <span class="fu">GMM_Mstep</span>(df, z_hat, modelName)</span>
<span id="cb571-17"><a href="nonhierarchical-clustering.html#cb571-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb571-18"><a href="nonhierarchical-clustering.html#cb571-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [단계 2] E-step</span></span>
<span id="cb571-19"><a href="nonhierarchical-clustering.html#cb571-19" aria-hidden="true" tabindex="-1"></a>    new_z_hat <span class="ot">&lt;-</span> <span class="fu">GMM_Estep</span>(df, Mstep_res<span class="sc">$</span>tau, Mstep_res<span class="sc">$</span>mu, Mstep_res<span class="sc">$</span>Sigma)</span>
<span id="cb571-20"><a href="nonhierarchical-clustering.html#cb571-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb571-21"><a href="nonhierarchical-clustering.html#cb571-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [단계 3] 수렴조건 확인</span></span>
<span id="cb571-22"><a href="nonhierarchical-clustering.html#cb571-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">max</span>(<span class="fu">abs</span>(z_hat <span class="sc">-</span> new_z_hat)) <span class="sc">&lt;</span> tol) <span class="cf">break</span></span>
<span id="cb571-23"><a href="nonhierarchical-clustering.html#cb571-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb571-24"><a href="nonhierarchical-clustering.html#cb571-24" aria-hidden="true" tabindex="-1"></a>    z_hat <span class="ot">&lt;-</span> new_z_hat</span>
<span id="cb571-25"><a href="nonhierarchical-clustering.html#cb571-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb571-26"><a href="nonhierarchical-clustering.html#cb571-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb571-27"><a href="nonhierarchical-clustering.html#cb571-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span>(<span class="at">z =</span> z_hat, </span>
<span id="cb571-28"><a href="nonhierarchical-clustering.html#cb571-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">parameters =</span> Mstep_res,</span>
<span id="cb571-29"><a href="nonhierarchical-clustering.html#cb571-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">n_iteration =</span> i))</span>
<span id="cb571-30"><a href="nonhierarchical-clustering.html#cb571-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>위 함수를 학습데이터 Table <a href="nonhierarchical-clustering.html#tab:model-based-clustering-data">13.4</a>에 적용한 결과는 아래와 같다.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="nonhierarchical-clustering.html#cb572-1" aria-hidden="true" tabindex="-1"></a>VII_res <span class="ot">&lt;-</span> <span class="fu">GMM_EM</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, <span class="st">&quot;VII&quot;</span>)</span>
<span id="cb572-2"><a href="nonhierarchical-clustering.html#cb572-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-3"><a href="nonhierarchical-clustering.html#cb572-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집 멤버쉽</span></span>
<span id="cb572-4"><a href="nonhierarchical-clustering.html#cb572-4" aria-hidden="true" tabindex="-1"></a>VII_res<span class="sc">$</span>z</span></code></pre></div>
<pre><code>##             C1           C2
## 1 1.000000e+00 6.786307e-28
## 2 1.000000e+00 8.771316e-27
## 3 1.000000e+00 8.895007e-36
## 4 5.251505e-17 1.000000e+00
## 5 7.046079e-22 1.000000e+00
## 6 1.843399e-26 1.000000e+00
## 7 1.544788e-17 1.000000e+00</code></pre>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="nonhierarchical-clustering.html#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 혼합분포</span></span>
<span id="cb574-2"><a href="nonhierarchical-clustering.html#cb574-2" aria-hidden="true" tabindex="-1"></a>VII_res<span class="sc">$</span>parameters</span></code></pre></div>
<pre><code>## $tau
## $tau$C1
## [1] 0.4285714
## 
## $tau$C2
## [1] 0.5714286
## 
## 
## $mu
## $mu$C1
##        x1        x2 
##  5.333333 13.333333 
## 
## $mu$C2
##    x1    x2 
## 11.25  3.50 
## 
## 
## $Sigma
## $Sigma$C1
##          [,1]     [,2]
## [1,] 1.222222 0.000000
## [2,] 0.000000 1.222222
## 
## $Sigma$C2
##         [,1]    [,2]
## [1,] 0.96875 0.00000
## [2,] 0.00000 0.96875</code></pre>
</div>
<div id="r-packages-model-based-clustering" class="section level3" number="13.5.4">
<h3><span class="header-section-number">13.5.4</span> R 패키지 내 모형기반 군집분석</h3>
<p>R 패키지 <code>mclust</code>를 통해, 위에서 살펴본 VII, VEI, VEE 외에 보다 다양한 분산-공분산 모형을 가정한 군집분석을 수행할 수 있다 <span class="citation">(<a href="#ref-scrucca2016mclust" role="doc-biblioref">Scrucca et al. 2016</a>)</span>. 다음은 “EEI” 구조에 대한 수행 예이다.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="nonhierarchical-clustering.html#cb576-1" aria-hidden="true" tabindex="-1"></a>res_mclust_EEI <span class="ot">&lt;-</span> mclust<span class="sc">::</span><span class="fu">meEEI</span>(df[, <span class="sc">-</span><span class="dv">1</span>], z_hat)</span></code></pre></div>
<p>위 수행 결과 객체는 리스트 형태이며, 그 원소 중 <code>z</code>는 <span class="math inline">\(\hat{z}_{ik}\)</span>값을, <code>parameters</code>는 혼합분포 파라미터 추정값 (<span class="math inline">\(\hat{\tau}_k\)</span>, <span class="math inline">\(\hat{\boldsymbol\mu}_k\)</span>, <span class="math inline">\(\hat{\boldsymbol\Sigma}_k\)</span>)을 나타낸다.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="nonhierarchical-clustering.html#cb577-1" aria-hidden="true" tabindex="-1"></a>res_mclust_EEI<span class="sc">$</span>z</span></code></pre></div>
<pre><code>##              [,1]         [,2]
## [1,] 6.198742e-26 1.000000e+00
## [2,] 2.193775e-22 1.000000e+00
## [3,] 1.432979e-28 1.000000e+00
## [4,] 1.000000e+00 3.497777e-20
## [5,] 1.000000e+00 1.350932e-26
## [6,] 1.000000e+00 5.217649e-33
## [7,] 1.000000e+00 9.883335e-24</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="nonhierarchical-clustering.html#cb579-1" aria-hidden="true" tabindex="-1"></a>res_mclust_EEI<span class="sc">$</span>parameters</span></code></pre></div>
<pre><code>## $pro
## [1] 0.5714286 0.4285714
## 
## $mean
##     [,1]      [,2]
## x1 11.25  5.333333
## x2  3.50 13.333333
## 
## $variance
## $variance$modelName
## [1] &quot;EEI&quot;
## 
## $variance$d
## [1] 2
## 
## $variance$G
## [1] 2
## 
## $variance$sigma
## , , 1
## 
##           x1       x2
## x1 0.7738095 0.000000
## x2 0.0000000 1.380952
## 
## , , 2
## 
##           x1       x2
## x1 0.7738095 0.000000
## x2 0.0000000 1.380952
## 
## 
## $variance$Sigma
##           x1       x2
## x1 0.7738095 0.000000
## x2 0.0000000 1.380952
## 
## $variance$scale
## [1] 1.033728
## 
## $variance$shape
## [1] 0.7485618 1.3358950
## 
## 
## $Vinv
## NULL</code></pre>
<p><code>mclust</code> 패키지 내의 함수 <code>densityMclust</code>는 Bayesian information criterion (BIC)을 기준으로 최적의 혼합분포를 찾는 함수이다. 즉, 내부적으로 여러가지 분산-공분산 모형과 군집 수의 조합에 대한 군집분석을 수행한 뒤, 각 조합의 최종결과에서 얻어진 BIC 값을 기준으로 최적의 조합을 선정한다.</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="nonhierarchical-clustering.html#cb581-1" aria-hidden="true" tabindex="-1"></a>res_mclust_opt <span class="ot">&lt;-</span> mclust<span class="sc">::</span><span class="fu">densityMclust</span>(df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>함수 수행결과 객체의 <code>BIC</code> 원소가 나타내는 결과는 아래와 같다.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="nonhierarchical-clustering.html#cb582-1" aria-hidden="true" tabindex="-1"></a>res_mclust_opt<span class="sc">$</span>BIC</span></code></pre></div>
<pre><code>## Bayesian Information Criterion (BIC): 
##         EII       VII       EEI       VEI       EVI       VVI       EEE
## 1 -85.40006 -85.40006 -85.70851 -85.70851 -85.70851 -85.70851 -75.27433
## 2 -62.00992 -63.86240 -63.37677 -65.22485 -65.32204 -67.17013 -64.66516
## 3 -65.47796        NA -66.01911        NA        NA        NA -67.87781
## 4 -69.04346        NA -70.17240        NA        NA        NA -67.31282
## 5 -72.02226        NA -73.96817        NA        NA        NA        NA
## 6 -62.27998        NA -64.22589        NA        NA        NA        NA
## 7        NA        NA        NA        NA        NA        NA        NA
##         VEE       EVE       VVE       EEV       VEV       EVV       VVV
## 1 -75.27433 -75.27433 -75.27433 -75.27433 -75.27433 -75.27433 -75.27433
## 2 -66.60332 -65.06811 -66.92481 -65.42506 -67.34154 -66.55375 -68.44666
## 3        NA        NA        NA -71.48895        NA        NA        NA
## 4        NA        NA        NA        NA        NA        NA        NA
## 5        NA        NA        NA        NA        NA        NA        NA
## 6        NA        NA        NA        NA        NA        NA        NA
## 7        NA        NA        NA        NA        NA        NA        NA
## 
## Top 3 models based on the BIC criterion: 
##     EII,2     EII,6     EEI,2 
## -62.00992 -62.27998 -63.37677</code></pre>
<p>수행 결과 가장 큰 BIC 값을 지닌 최적의 조합은 EII 분산-공분산 모형으로 2개의 군집을 가정했을 때 얻어진다.</p>
<p><code>densityMclust</code> 함수 수행 결과 얻어진 혼합분포를 plotting해보자.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="nonhierarchical-clustering.html#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res_mclust_opt, <span class="at">what =</span> <span class="st">&quot;density&quot;</span>,</span>
<span id="cb584-2"><a href="nonhierarchical-clustering.html#cb584-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> df[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">points.cex =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mclust-opt-result-plot"></span>
<img src="data-mining-book_files/figure-html/mclust-opt-result-plot-1.png" alt="mclust::densityMclust 수행 결과 얻어진 혼합분포" width="672" />
<p class="caption">
Figure 13.2: mclust::densityMclust 수행 결과 얻어진 혼합분포
</p>
</div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-banfield1993model" class="csl-entry">
Banfield, Jeffrey D, and Adrian E Raftery. 1993. <span>“Model-Based Gaussian and Non-Gaussian Clustering.”</span> <em>Biometrics</em>, 803–21.
</div>
<div id="ref-celeux1995gaussian" class="csl-entry">
Celeux, Gilles, and Gérard Govaert. 1995. <span>“Gaussian Parsimonious Clustering Models.”</span> <em>Pattern Recognition</em> 28 (5): 781–93.
</div>
<div id="ref-kaufman1990finding" class="csl-entry">
Kaufman, L, and P. J. Rousseeuw. 1990. <span>“Finding Groups in Data: An Introduction to Cluster Analysis.”</span>
</div>
<div id="ref-park2009simple" class="csl-entry">
Park, Hae-Sang, and Chi-Hyuck Jun. 2009. <span>“A Simple and Fast Algorithm for k-Medoids Clustering.”</span> <em>Expert Systems with Applications</em> 36 (2): 3336–41.
</div>
<div id="ref-scrucca2016mclust" class="csl-entry">
Scrucca, Luca, Michael Fop, T Brendan Murphy, and Adrian E Raftery. 2016. <span>“Mclust 5: Clustering, Classification and Density Estimation Using Gaussian Finite Mixture Models.”</span> <em>The R Journal</em> 8 (1): 289.
</div>
<div id="ref-jun2012datamining" class="csl-entry">
전치혁. 2012. <em>데이터마이닝 기법과 응용</em>. 한나래출판사.
</div>
</div>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://r-data-mining-book.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
            </section>

          </div>
        </div>
      </div>
<a href="hierarchical-clustering.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cluster-solution-evaluation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
