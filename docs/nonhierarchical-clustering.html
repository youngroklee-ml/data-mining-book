<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 비계층적 군집방법 | 데이터마이닝 with R</title>
  <meta name="description" content="전치혁 교수님의 책 을 기반으로 한 R 예제" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 비계층적 군집방법 | 데이터마이닝 with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://youngroklee-ml.github.io/data-mining-book/" />
  
  <meta property="og:description" content="전치혁 교수님의 책 을 기반으로 한 R 예제" />
  <meta name="github-repo" content="youngroklee-ml/data-mining-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 비계층적 군집방법 | 데이터마이닝 with R" />
  
  <meta name="twitter:description" content="전치혁 교수님의 책 을 기반으로 한 R 예제" />
  

<meta name="author" content="전치혁, 이혜선, 이종석, 이영록" />


<meta name="date" content="2020-12-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hierarchical-clustering.html"/>
<link rel="next" href="cluster-solution-evaluation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">데이터마이닝 with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>개요</a></li>
<li class="chapter" data-level="1" data-path="datamining-overview.html"><a href="datamining-overview.html"><i class="fa fa-check"></i><b>1</b> 데이터마이닝 개요</a></li>
<li class="part"><span><b>I 1부 - 예측</b></span></li>
<li class="chapter" data-level="2" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>2</b> 회귀분석</a><ul>
<li class="chapter" data-level="2.1" data-path="regression.html"><a href="regression.html#regression-packages-install"><i class="fa fa-check"></i><b>2.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="2.2" data-path="regression.html"><a href="regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>2.2</b> 다중회귀모형</a></li>
<li class="chapter" data-level="2.3" data-path="regression.html"><a href="regression.html#regression-response-confidence-prediction"><i class="fa fa-check"></i><b>2.3</b> 반응치에 대한 추정 및 예측</a><ul>
<li class="chapter" data-level="2.3.1" data-path="regression.html"><a href="regression.html#regression-response-confidence"><i class="fa fa-check"></i><b>2.3.1</b> 평균반응치의 추정</a></li>
<li class="chapter" data-level="2.3.2" data-path="regression.html"><a href="regression.html#regression-response-prediction"><i class="fa fa-check"></i><b>2.3.2</b> 미래반응치의 예측</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="regression.html"><a href="regression.html#regression-indicator-variable"><i class="fa fa-check"></i><b>2.4</b> 지시변수와 회귀모형</a><ul>
<li class="chapter" data-level="2.4.1" data-path="regression.html"><a href="regression.html#regression-indicator-variable-basic-script"><i class="fa fa-check"></i><b>2.4.1</b> 기본 R 스트립트</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>3</b> 주성분분석</a><ul>
<li class="chapter" data-level="3.1" data-path="pca.html"><a href="pca.html#pca-packages-install"><i class="fa fa-check"></i><b>3.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="3.2" data-path="pca.html"><a href="pca.html#pca-matrix-factorization"><i class="fa fa-check"></i><b>3.2</b> 행렬의 분해</a><ul>
<li class="chapter" data-level="3.2.1" data-path="pca.html"><a href="pca.html#pca-matrix-factorization-basic-script"><i class="fa fa-check"></i><b>3.2.1</b> 기본 R 스트립트</a></li>
<li class="chapter" data-level="3.2.2" data-path="pca.html"><a href="pca.html#pca-ss"><i class="fa fa-check"></i><b>3.2.2</b> 변수의 변동과 제곱합</a></li>
<li class="chapter" data-level="3.2.3" data-path="pca.html"><a href="pca.html#pca-intro"><i class="fa fa-check"></i><b>3.2.3</b> 주성분의 이해 및 행렬의 분해</a></li>
<li class="chapter" data-level="3.2.4" data-path="pca.html"><a href="pca.html#pca-svd"><i class="fa fa-check"></i><b>3.2.4</b> 특이치분해 (Singular Value Decomposition)</a></li>
<li class="chapter" data-level="3.2.5" data-path="pca.html"><a href="pca.html#pca-spectral"><i class="fa fa-check"></i><b>3.2.5</b> 분광분해 (Spectral Decomposition)</a></li>
<li class="chapter" data-level="3.2.6" data-path="pca.html"><a href="pca.html#pca-nipals"><i class="fa fa-check"></i><b>3.2.6</b> NIPALS 알고리즘</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="pca.html"><a href="pca.html#pca-regression"><i class="fa fa-check"></i><b>3.3</b> 주성분 회귀분석</a><ul>
<li class="chapter" data-level="3.3.1" data-path="pca.html"><a href="pca.html#pcr-basic-script"><i class="fa fa-check"></i><b>3.3.1</b> 기본 R 스트립트</a></li>
<li class="chapter" data-level="3.3.2" data-path="pca.html"><a href="pca.html#pcr-regression-coefficient"><i class="fa fa-check"></i><b>3.3.2</b> 주성분 회귀계수 추정</a></li>
<li class="chapter" data-level="3.3.3" data-path="pca.html"><a href="pca.html#pcr-regression-transform"><i class="fa fa-check"></i><b>3.3.3</b> 회귀계수 선형변환</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plsr.html"><a href="plsr.html"><i class="fa fa-check"></i><b>4</b> 부분최소자승법</a><ul>
<li class="chapter" data-level="4.1" data-path="plsr.html"><a href="plsr.html#plsr-packages-install"><i class="fa fa-check"></i><b>4.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="4.2" data-path="plsr.html"><a href="plsr.html#plsr-single-target"><i class="fa fa-check"></i><b>4.2</b> 하나의 종속변수의 경우</a><ul>
<li class="chapter" data-level="4.2.1" data-path="plsr.html"><a href="plsr.html#plsr-basic-script"><i class="fa fa-check"></i><b>4.2.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="4.2.2" data-path="plsr.html"><a href="plsr.html#plsr-model"><i class="fa fa-check"></i><b>4.2.2</b> PLS 모형</a></li>
<li class="chapter" data-level="4.2.3" data-path="plsr.html"><a href="plsr.html#plsr-single-nipals"><i class="fa fa-check"></i><b>4.2.3</b> NIPALS 알고리즘</a></li>
<li class="chapter" data-level="4.2.4" data-path="plsr.html"><a href="plsr.html#plsr-single-transform"><i class="fa fa-check"></i><b>4.2.4</b> 회귀식 변환</a></li>
<li class="chapter" data-level="4.2.5" data-path="plsr.html"><a href="plsr.html#plsr-sst"><i class="fa fa-check"></i><b>4.2.5</b> 제곱합 분해</a></li>
<li class="chapter" data-level="4.2.6" data-path="plsr.html"><a href="plsr.html#plsr-variable-importance"><i class="fa fa-check"></i><b>4.2.6</b> 독립변수의 중요도</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-target"><i class="fa fa-check"></i><b>4.3</b> 다수의 종속변수의 경우</a><ul>
<li class="chapter" data-level="4.3.1" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-basic-script"><i class="fa fa-check"></i><b>4.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="4.3.2" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-model"><i class="fa fa-check"></i><b>4.3.2</b> PLS 모형</a></li>
<li class="chapter" data-level="4.3.3" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-nipals"><i class="fa fa-check"></i><b>4.3.3</b> NIPALS 알고리즘</a></li>
<li class="chapter" data-level="4.3.4" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-transform"><i class="fa fa-check"></i><b>4.3.4</b> 회귀식 변환</a></li>
<li class="chapter" data-level="4.3.5" data-path="plsr.html"><a href="plsr.html#plsr-multivariate-sst"><i class="fa fa-check"></i><b>4.3.5</b> 제곱합 분해</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II 2부 - 분류분석</b></span></li>
<li class="chapter" data-level="5" data-path="classification-analysis.html"><a href="classification-analysis.html"><i class="fa fa-check"></i><b>5</b> 분류분석 개요</a><ul>
<li class="chapter" data-level="5.1" data-path="classification-analysis.html"><a href="classification-analysis.html#classification-packages-install"><i class="fa fa-check"></i><b>5.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="5.2" data-path="classification-analysis.html"><a href="classification-analysis.html#classification-problem-methods"><i class="fa fa-check"></i><b>5.2</b> 분류문제 및 분류기법</a></li>
<li class="chapter" data-level="5.3" data-path="classification-analysis.html"><a href="classification-analysis.html#simple-classification-methods"><i class="fa fa-check"></i><b>5.3</b> 기본적인 분류기법</a><ul>
<li class="chapter" data-level="5.3.1" data-path="classification-analysis.html"><a href="classification-analysis.html#nearest-neighbor-classification"><i class="fa fa-check"></i><b>5.3.1</b> 인접객체법</a></li>
<li class="chapter" data-level="5.3.2" data-path="classification-analysis.html"><a href="classification-analysis.html#naive-bayes"><i class="fa fa-check"></i><b>5.3.2</b> 나이브 베이지안 분류법</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>6</b> 로지스틱 회귀분석</a><ul>
<li class="chapter" data-level="6.1" data-path="logistic-regression.html"><a href="logistic-regression.html#logistic-packages-install"><i class="fa fa-check"></i><b>6.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="6.2" data-path="logistic-regression.html"><a href="logistic-regression.html#binary-logistic-regression"><i class="fa fa-check"></i><b>6.2</b> 이분 로지스틱 회귀모형</a><ul>
<li class="chapter" data-level="6.2.1" data-path="logistic-regression.html"><a href="logistic-regression.html#bianry-logistic-reg-basic-script"><i class="fa fa-check"></i><b>6.2.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="6.2.2" data-path="logistic-regression.html"><a href="logistic-regression.html#binary-logistic-reg-model"><i class="fa fa-check"></i><b>6.2.2</b> 회귀모형</a></li>
<li class="chapter" data-level="6.2.3" data-path="logistic-regression.html"><a href="logistic-regression.html#binary-logistic-reg-estimation"><i class="fa fa-check"></i><b>6.2.3</b> 회귀계수 추정</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="logistic-regression.html"><a href="logistic-regression.html#nominal-logistic-regression"><i class="fa fa-check"></i><b>6.3</b> 명목 로지스틱 회귀모형</a><ul>
<li class="chapter" data-level="6.3.1" data-path="logistic-regression.html"><a href="logistic-regression.html#nominal-logistic-reg-basic-script"><i class="fa fa-check"></i><b>6.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="6.3.2" data-path="logistic-regression.html"><a href="logistic-regression.html#baseline-category-logit-model"><i class="fa fa-check"></i><b>6.3.2</b> 기준범주 로짓모형</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="logistic-regression.html"><a href="logistic-regression.html#ordinal-logistic-regression"><i class="fa fa-check"></i><b>6.4</b> 서열 로지스틱 회귀모형</a><ul>
<li class="chapter" data-level="6.4.1" data-path="logistic-regression.html"><a href="logistic-regression.html#ordinal-logistic-basic-script"><i class="fa fa-check"></i><b>6.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="6.4.2" data-path="logistic-regression.html"><a href="logistic-regression.html#cumulative-logit-model"><i class="fa fa-check"></i><b>6.4.2</b> 누적 로짓모형</a></li>
<li class="chapter" data-level="6.4.3" data-path="logistic-regression.html"><a href="logistic-regression.html#adjacent-categories-logit-model"><i class="fa fa-check"></i><b>6.4.3</b> 인근범주 로짓모형</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="da.html"><a href="da.html"><i class="fa fa-check"></i><b>7</b> 판별분석</a><ul>
<li class="chapter" data-level="7.1" data-path="da.html"><a href="da.html#da-overview"><i class="fa fa-check"></i><b>7.1</b> 개요</a></li>
<li class="chapter" data-level="7.2" data-path="da.html"><a href="da.html#da-packages-install"><i class="fa fa-check"></i><b>7.2</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="7.3" data-path="da.html"><a href="da.html#da-fisher"><i class="fa fa-check"></i><b>7.3</b> 피셔 방법</a><ul>
<li class="chapter" data-level="7.3.1" data-path="da.html"><a href="da.html#da-fisher-basic-script"><i class="fa fa-check"></i><b>7.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="7.3.2" data-path="da.html"><a href="da.html#피셔-판별함수"><i class="fa fa-check"></i><b>7.3.2</b> 피셔 판별함수</a></li>
<li class="chapter" data-level="7.3.3" data-path="da.html"><a href="da.html#분류-규칙"><i class="fa fa-check"></i><b>7.3.3</b> 분류 규칙</a></li>
<li class="chapter" data-level="7.3.4" data-path="da.html"><a href="da.html#r-패키지를-이용한-분류규칙-도출"><i class="fa fa-check"></i><b>7.3.4</b> R 패키지를 이용한 분류규칙 도출</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="da.html"><a href="da.html#lda"><i class="fa fa-check"></i><b>7.4</b> 의사결정론에 의한 선형분류규칙</a><ul>
<li class="chapter" data-level="7.4.1" data-path="da.html"><a href="da.html#lda-basic-script"><i class="fa fa-check"></i><b>7.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="7.4.2" data-path="da.html"><a href="da.html#lda-function"><i class="fa fa-check"></i><b>7.4.2</b> 선형판별함수</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="da.html"><a href="da.html#lda-misclassification-cost"><i class="fa fa-check"></i><b>7.5</b> 오분류비용을 고려한 분류규칙</a></li>
<li class="chapter" data-level="7.6" data-path="da.html"><a href="da.html#qda"><i class="fa fa-check"></i><b>7.6</b> 이차판별분석</a><ul>
<li class="chapter" data-level="7.6.1" data-path="da.html"><a href="da.html#qda-basic-script"><i class="fa fa-check"></i><b>7.6.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="7.6.2" data-path="da.html"><a href="da.html#qda-function"><i class="fa fa-check"></i><b>7.6.2</b> 이차 판별함수</a></li>
<li class="chapter" data-level="7.6.3" data-path="da.html"><a href="da.html#qda-discriminant-rule"><i class="fa fa-check"></i><b>7.6.3</b> 이차판별함수에 의한 분류</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="da.html"><a href="da.html#da-multiclass"><i class="fa fa-check"></i><b>7.7</b> 세 범주 이상의 분류</a><ul>
<li class="chapter" data-level="7.7.1" data-path="da.html"><a href="da.html#mutliclass-da-basic-script"><i class="fa fa-check"></i><b>7.7.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="7.7.2" data-path="da.html"><a href="da.html#mutliclass-generalized-discriminant-function"><i class="fa fa-check"></i><b>7.7.2</b> 일반화된 판별함수</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tree-based-method.html"><a href="tree-based-method.html"><i class="fa fa-check"></i><b>8</b> 트리기반 기법</a><ul>
<li class="chapter" data-level="8.1" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-overview"><i class="fa fa-check"></i><b>8.1</b> CART 개요</a></li>
<li class="chapter" data-level="8.2" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-packages-install"><i class="fa fa-check"></i><b>8.2</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="8.3" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-build"><i class="fa fa-check"></i><b>8.3</b> CART 트리 생성</a><ul>
<li class="chapter" data-level="8.3.1" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-basic-r-script"><i class="fa fa-check"></i><b>8.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="8.3.2" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-notation"><i class="fa fa-check"></i><b>8.3.2</b> 기호 정의</a></li>
<li class="chapter" data-level="8.3.3" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-impurity"><i class="fa fa-check"></i><b>8.3.3</b> 노드 및 트리의 불순도</a></li>
<li class="chapter" data-level="8.3.4" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-split"><i class="fa fa-check"></i><b>8.3.4</b> 분지기준</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-pruning-complete"><i class="fa fa-check"></i><b>8.4</b> 가지치기 및 최종 트리 선정</a><ul>
<li class="chapter" data-level="8.4.1" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-pruning"><i class="fa fa-check"></i><b>8.4.1</b> 가지치기</a></li>
<li class="chapter" data-level="8.4.2" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-best-tree"><i class="fa fa-check"></i><b>8.4.2</b> 최적 트리의 선정</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-r-pkg"><i class="fa fa-check"></i><b>8.5</b> R패키지 내 분류 트리 방법</a><ul>
<li class="chapter" data-level="8.5.1" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-r-pkg-split"><i class="fa fa-check"></i><b>8.5.1</b> 트리 확장</a></li>
<li class="chapter" data-level="8.5.2" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-r-pkg-pruning"><i class="fa fa-check"></i><b>8.5.2</b> 가지치기</a></li>
<li class="chapter" data-level="8.5.3" data-path="tree-based-method.html"><a href="tree-based-method.html#cart-r-pkg-param"><i class="fa fa-check"></i><b>8.5.3</b> 파라미터값 결정</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="svm.html"><a href="svm.html"><i class="fa fa-check"></i><b>9</b> 서포트 벡터 머신</a><ul>
<li class="chapter" data-level="9.1" data-path="svm.html"><a href="svm.html#svm-overview"><i class="fa fa-check"></i><b>9.1</b> 개요</a></li>
<li class="chapter" data-level="9.2" data-path="svm.html"><a href="svm.html#svm-packages-install"><i class="fa fa-check"></i><b>9.2</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="9.3" data-path="svm.html"><a href="svm.html#linear-svm-separable"><i class="fa fa-check"></i><b>9.3</b> 선형 SVM - 분리 가능 경우</a><ul>
<li class="chapter" data-level="9.3.1" data-path="svm.html"><a href="svm.html#linear-svm-separable-basic-script"><i class="fa fa-check"></i><b>9.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="9.3.2" data-path="svm.html"><a href="svm.html#linear-svm-notation"><i class="fa fa-check"></i><b>9.3.2</b> 기호 정의</a></li>
<li class="chapter" data-level="9.3.3" data-path="svm.html"><a href="svm.html#linear-svm-separable-hyperplane"><i class="fa fa-check"></i><b>9.3.3</b> 최적 하이퍼플레인</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="svm.html"><a href="svm.html#linear-svm-inseparable"><i class="fa fa-check"></i><b>9.4</b> 선형 SVM - 분리 불가능 경우</a><ul>
<li class="chapter" data-level="9.4.1" data-path="svm.html"><a href="svm.html#linear-svm-inseparable-basic-script"><i class="fa fa-check"></i><b>9.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="9.4.2" data-path="svm.html"><a href="svm.html#linear-svm-inseparable-hyperplane"><i class="fa fa-check"></i><b>9.4.2</b> 최적 하이퍼플레인</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="svm.html"><a href="svm.html#nonlinear-svm"><i class="fa fa-check"></i><b>9.5</b> 비선형 SVM</a><ul>
<li class="chapter" data-level="9.5.1" data-path="svm.html"><a href="svm.html#nonlinear-svm-basic-script"><i class="fa fa-check"></i><b>9.5.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="9.5.2" data-path="svm.html"><a href="svm.html#nonlinear-svm-hyperplane"><i class="fa fa-check"></i><b>9.5.2</b> 최적 하이퍼플레인</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="svm.html"><a href="svm.html#svm-r-pkg"><i class="fa fa-check"></i><b>9.6</b> R패키지 내 SVM</a><ul>
<li class="chapter" data-level="9.6.1" data-path="svm.html"><a href="svm.html#svm-kernel-function"><i class="fa fa-check"></i><b>9.6.1</b> 커널함수</a></li>
<li class="chapter" data-level="9.6.2" data-path="svm.html"><a href="svm.html#svm-nu-classification"><i class="fa fa-check"></i><b>9.6.2</b> <span class="math inline">\(\nu\)</span>-SVC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html"><i class="fa fa-check"></i><b>10</b> 분류규칙의 성능 평가</a><ul>
<li class="chapter" data-level="10.1" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#classifier-evaluation-packages-install"><i class="fa fa-check"></i><b>10.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="10.2" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#classifier-evaluation-misclassification-rate"><i class="fa fa-check"></i><b>10.2</b> 분류오류율</a></li>
<li class="chapter" data-level="10.3" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#precision-sensitivity-specificity"><i class="fa fa-check"></i><b>10.3</b> 정확도, 민감도 및 특이도</a><ul>
<li class="chapter" data-level="10.3.1" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#confusion-matrix-r-package"><i class="fa fa-check"></i><b>10.3.1</b> R 패키지 내 정오분류표</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#roc-curve"><i class="fa fa-check"></i><b>10.4</b> ROC 곡선</a></li>
<li class="chapter" data-level="10.5" data-path="classifier-evaluation.html"><a href="classifier-evaluation.html#gain-chart"><i class="fa fa-check"></i><b>10.5</b> 이익도표</a></li>
</ul></li>
<li class="part"><span><b>III 3부 - 군집분석</b></span></li>
<li class="chapter" data-level="11" data-path="clustering-overview.html"><a href="clustering-overview.html"><i class="fa fa-check"></i><b>11</b> 군집분석 개요</a><ul>
<li class="chapter" data-level="11.1" data-path="clustering-overview.html"><a href="clustering-overview.html#clustering-overview-packages-install"><i class="fa fa-check"></i><b>11.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="11.2" data-path="clustering-overview.html"><a href="clustering-overview.html#clustering-method"><i class="fa fa-check"></i><b>11.2</b> 군집분석 기법</a></li>
<li class="chapter" data-level="11.3" data-path="clustering-overview.html"><a href="clustering-overview.html#object-similarity-metric"><i class="fa fa-check"></i><b>11.3</b> 객체 간의 유사성 척도</a><ul>
<li class="chapter" data-level="11.3.1" data-path="clustering-overview.html"><a href="clustering-overview.html#object-distance-metric"><i class="fa fa-check"></i><b>11.3.1</b> 거리 관련 척도</a></li>
<li class="chapter" data-level="11.3.2" data-path="clustering-overview.html"><a href="clustering-overview.html#object-correlation-metric"><i class="fa fa-check"></i><b>11.3.2</b> 상관계수 관련 척도</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="clustering-overview.html"><a href="clustering-overview.html#category-similarity-metric"><i class="fa fa-check"></i><b>11.4</b> 범주형 객체의 유사성 척도</a><ul>
<li class="chapter" data-level="11.4.1" data-path="clustering-overview.html"><a href="clustering-overview.html#binary-similarity-metric"><i class="fa fa-check"></i><b>11.4.1</b> 이분형 변수의 경우</a></li>
<li class="chapter" data-level="11.4.2" data-path="clustering-overview.html"><a href="clustering-overview.html#ordinal-similarity-metric"><i class="fa fa-check"></i><b>11.4.2</b> 서열형 변수의 경우</a></li>
<li class="chapter" data-level="11.4.3" data-path="clustering-overview.html"><a href="clustering-overview.html#nominal-similarity-metric"><i class="fa fa-check"></i><b>11.4.3</b> 명목형 변수의 경우</a></li>
<li class="chapter" data-level="11.4.4" data-path="clustering-overview.html"><a href="clustering-overview.html#mixed-similarity-metric"><i class="fa fa-check"></i><b>11.4.4</b> 혼합형의 경우</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html"><i class="fa fa-check"></i><b>12</b> 계층적 군집방법</a><ul>
<li class="chapter" data-level="12.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#hierarchical-clustering-packages-install"><i class="fa fa-check"></i><b>12.1</b> 필요 R 패키지 설치</a></li>
<li class="chapter" data-level="12.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#distance-between-clusters"><i class="fa fa-check"></i><b>12.2</b> 군집 간 거리척도 및 연결법</a></li>
<li class="chapter" data-level="12.3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#linkage-method"><i class="fa fa-check"></i><b>12.3</b> 연결법의 군집 알고리즘</a><ul>
<li class="chapter" data-level="12.3.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#linkage-method-basic-script"><i class="fa fa-check"></i><b>12.3.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="12.3.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#linkage-method-algorithm"><i class="fa fa-check"></i><b>12.3.2</b> 연결법 군집 알고리즘</a></li>
<li class="chapter" data-level="12.3.3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#hclust"><i class="fa fa-check"></i><b>12.3.3</b> R 패키지 내 연결법</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#ward-method"><i class="fa fa-check"></i><b>12.4</b> 워드 방법</a><ul>
<li class="chapter" data-level="12.4.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#ward-method-basic-script"><i class="fa fa-check"></i><b>12.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="12.4.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#ward-method-algorithm"><i class="fa fa-check"></i><b>12.4.2</b> 워드 군집 알고리즘</a></li>
<li class="chapter" data-level="12.4.3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#ward-rpackages"><i class="fa fa-check"></i><b>12.4.3</b> R 패키지 내 워드 방법</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#diana"><i class="fa fa-check"></i><b>12.5</b> 분리적 방법 - 다이아나</a><ul>
<li class="chapter" data-level="12.5.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#diana-basic-script"><i class="fa fa-check"></i><b>12.5.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="12.5.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#diana-algorithm"><i class="fa fa-check"></i><b>12.5.2</b> 다이아나 알고리즘</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#hierarchical-cluster-number"><i class="fa fa-check"></i><b>12.6</b> 군집수의 결정</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html"><i class="fa fa-check"></i><b>13</b> 비계층적 군집방법</a><ul>
<li class="chapter" data-level="13.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#nonhierarchical-clustering-packages-install"><i class="fa fa-check"></i><b>13.1</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="13.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans"><i class="fa fa-check"></i><b>13.2</b> K-means 알고리즘</a><ul>
<li class="chapter" data-level="13.2.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans-basic-script"><i class="fa fa-check"></i><b>13.2.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="13.2.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans-algorithm"><i class="fa fa-check"></i><b>13.2.2</b> 알고리즘</a></li>
<li class="chapter" data-level="13.2.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans-user-defined-functions"><i class="fa fa-check"></i><b>13.2.3</b> R 스크립트 구현</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmedoids"><i class="fa fa-check"></i><b>13.3</b> K-medoids 군집방법</a><ul>
<li class="chapter" data-level="13.3.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#pam"><i class="fa fa-check"></i><b>13.3.1</b> PAM 알고리즘</a></li>
<li class="chapter" data-level="13.3.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#clara"><i class="fa fa-check"></i><b>13.3.2</b> CLARA 알고리즘</a></li>
<li class="chapter" data-level="13.3.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#clarans"><i class="fa fa-check"></i><b>13.3.3</b> CLARANS 알고리즘</a></li>
<li class="chapter" data-level="13.3.4" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#kmeans-like"><i class="fa fa-check"></i><b>13.3.4</b> K-means-like 알고리즘</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#fuzzy-kmeans"><i class="fa fa-check"></i><b>13.4</b> 퍼지 K-means 알고리즘</a><ul>
<li class="chapter" data-level="13.4.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#fuzzy-kmeans-basic-script"><i class="fa fa-check"></i><b>13.4.1</b> 기본 R 스크립트</a></li>
<li class="chapter" data-level="13.4.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#fuzzy-kmeans-algorithm"><i class="fa fa-check"></i><b>13.4.2</b> 알고리즘</a></li>
<li class="chapter" data-level="13.4.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#fuzzy-kmeans-script-implement"><i class="fa fa-check"></i><b>13.4.3</b> R 스크립트 구현</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#model-based-clustering"><i class="fa fa-check"></i><b>13.5</b> 모형기반 군집방법</a><ul>
<li class="chapter" data-level="13.5.1" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#model-based-clustering-basic-script"><i class="fa fa-check"></i><b>13.5.1</b> 기본 R script</a></li>
<li class="chapter" data-level="13.5.2" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#model-based-clustering-em"><i class="fa fa-check"></i><b>13.5.2</b> EM 알고리즘</a></li>
<li class="chapter" data-level="13.5.3" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#model-based-clustering-script-implement"><i class="fa fa-check"></i><b>13.5.3</b> R 스크립트 구현</a></li>
<li class="chapter" data-level="13.5.4" data-path="nonhierarchical-clustering.html"><a href="nonhierarchical-clustering.html#r-packages-model-based-clustering"><i class="fa fa-check"></i><b>13.5.4</b> R 패키지 내 모형기반 군집분석</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html"><i class="fa fa-check"></i><b>14</b> 군집해의 평가 및 해석</a><ul>
<li class="chapter" data-level="14.1" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-solution-evaluation-packages-install"><i class="fa fa-check"></i><b>14.1</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="14.2" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-solution-evaluation-metric"><i class="fa fa-check"></i><b>14.2</b> 군집해의 평가</a><ul>
<li class="chapter" data-level="14.2.1" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-evaluation-external-index"><i class="fa fa-check"></i><b>14.2.1</b> 외부평가지수</a></li>
<li class="chapter" data-level="14.2.2" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-evaluation-internal-index"><i class="fa fa-check"></i><b>14.2.2</b> 내부평가지수</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="cluster-solution-evaluation.html"><a href="cluster-solution-evaluation.html#cluster-solution-interpretation"><i class="fa fa-check"></i><b>14.3</b> 군집해의 해석</a></li>
</ul></li>
<li class="part"><span><b>IV 4부 - 연관규칙</b></span></li>
<li class="chapter" data-level="15" data-path="association-rule.html"><a href="association-rule.html"><i class="fa fa-check"></i><b>15</b> 연관규칙</a><ul>
<li class="chapter" data-level="15.1" data-path="association-rule.html"><a href="association-rule.html#association-packages-install"><i class="fa fa-check"></i><b>15.1</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="15.2" data-path="association-rule.html"><a href="association-rule.html#association-rule-definition-metric"><i class="fa fa-check"></i><b>15.2</b> 연관규칙의 정의 및 성능척도</a><ul>
<li class="chapter" data-level="15.2.1" data-path="association-rule.html"><a href="association-rule.html#association-rule-support"><i class="fa fa-check"></i><b>15.2.1</b> 지지도</a></li>
<li class="chapter" data-level="15.2.2" data-path="association-rule.html"><a href="association-rule.html#association-rule-confidence"><i class="fa fa-check"></i><b>15.2.2</b> 신뢰도</a></li>
<li class="chapter" data-level="15.2.3" data-path="association-rule.html"><a href="association-rule.html#association-rule-lift"><i class="fa fa-check"></i><b>15.2.3</b> 개선도</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="association-rule.html"><a href="association-rule.html#association-rule-exploration"><i class="fa fa-check"></i><b>15.3</b> 연관규칙의 탐사</a><ul>
<li class="chapter" data-level="15.3.1" data-path="association-rule.html"><a href="association-rule.html#apriori-large-itemsets"><i class="fa fa-check"></i><b>15.3.1</b> 빈발항목집합 생성</a></li>
<li class="chapter" data-level="15.3.2" data-path="association-rule.html"><a href="association-rule.html#apriori-rule-exploration"><i class="fa fa-check"></i><b>15.3.2</b> 규칙의 탐사</a></li>
<li class="chapter" data-level="15.3.3" data-path="association-rule.html"><a href="association-rule.html#apriori-r-package"><i class="fa fa-check"></i><b>15.3.3</b> R 패키지 내 Apriori</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="association-rule.html"><a href="association-rule.html#association-sequential-pattern"><i class="fa fa-check"></i><b>15.4</b> 순차적 패턴의 탐사</a><ul>
<li class="chapter" data-level="15.4.1" data-path="association-rule.html"><a href="association-rule.html#association-aprioriall"><i class="fa fa-check"></i><b>15.4.1</b> AprioriAll 알고리즘</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="recommender-system.html"><a href="recommender-system.html"><i class="fa fa-check"></i><b>16</b> 추천시스템</a><ul>
<li class="chapter" data-level="16.1" data-path="recommender-system.html"><a href="recommender-system.html#recommender-packages-install"><i class="fa fa-check"></i><b>16.1</b> 필요 R package 설치</a></li>
<li class="chapter" data-level="16.2" data-path="recommender-system.html"><a href="recommender-system.html#content-based-recommender"><i class="fa fa-check"></i><b>16.2</b> 내용기반 추천시스템</a></li>
<li class="chapter" data-level="16.3" data-path="recommender-system.html"><a href="recommender-system.html#collaborative-filtering"><i class="fa fa-check"></i><b>16.3</b> 협업 필터링</a></li>
<li class="chapter" data-level="16.4" data-path="recommender-system.html"><a href="recommender-system.html#market-basket"><i class="fa fa-check"></i><b>16.4</b> 시장바구니 데이터를 이용한 협업 필터링</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">데이터마이닝 with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nonhierarchical-clustering" class="section level1">
<h1><span class="header-section-number">Chapter 13</span> 비계층적 군집방법</h1>
<p>비계층적 군집방법(Nonhierarchical clustering)은 분할방법(Partitioning method)이라고도 하는데, 군집의 수 <span class="math inline">\(K\)</span>를 사전에 지정하고 대상 객체들을 적절한 군집에 배정하는 방법이다. 즉, 이 방법은 <span class="math inline">\(n\)</span>개의 객체를 <span class="math inline">\(K\)</span>개의 군집에 할당하는 최적화 문제로 간주할 수 있다. 본 장에서는 분할방법의 대표적인 K-means 알고리즘, K-medoids 군집방법, 퍼지 K-means 알고리즘, 그리고 모형기반 군집방법에 대하여 주로 알아본다.</p>
<div id="nonhierarchical-clustering-packages-install" class="section level2">
<h2><span class="header-section-number">13.1</span> 필요 R package 설치</h2>
<p>본 장에서 필요한 R 패키지들은 아래와 같다.</p>
<table>
<thead>
<tr class="header">
<th align="left">package</th>
<th align="left">version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">1.3.0</td>
</tr>
<tr class="even">
<td align="left">stats</td>
<td align="left">4.0.3</td>
</tr>
<tr class="odd">
<td align="left">cluster</td>
<td align="left">2.1.0</td>
</tr>
<tr class="even">
<td align="left">flexclust</td>
<td align="left">1.4-0</td>
</tr>
<tr class="odd">
<td align="left">mclust</td>
<td align="left">5.4.7</td>
</tr>
<tr class="even">
<td align="left">mvtnorm</td>
<td align="left">1.1-1</td>
</tr>
</tbody>
</table>
</div>
<div id="kmeans" class="section level2">
<h2><span class="header-section-number">13.2</span> K-means 알고리즘</h2>
<p>K-means 알고리즘은 비계층적 군집방법 중 가장 널리 사용되는 것으로 <span class="math inline">\(K\)</span>개 군집의 중심좌표를 고려하여 각 객체를 가까운 군집에 배정하는 반복적 알고리즘이다.</p>
<div id="kmeans-basic-script" class="section level3">
<h3><span class="header-section-number">13.2.1</span> 기본 R 스크립트</h3>
<p>10명에 대한 PC의 사용경력(<span class="math inline">\(x_1\)</span>)과 주당 사용시간(<span class="math inline">\(x_2\)</span>)이 다음과 같다.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="nonhierarchical-clustering.html#cb462-1"></a>df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb462-2"><a href="nonhierarchical-clustering.html#cb462-2"></a>  <span class="op">~</span>id, <span class="op">~</span>x1, <span class="op">~</span>x2,</span>
<span id="cb462-3"><a href="nonhierarchical-clustering.html#cb462-3"></a>  <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">14</span>,</span>
<span id="cb462-4"><a href="nonhierarchical-clustering.html#cb462-4"></a>  <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">13</span>,</span>
<span id="cb462-5"><a href="nonhierarchical-clustering.html#cb462-5"></a>  <span class="dv">3</span>, <span class="dv">14</span>, <span class="dv">6</span>,</span>
<span id="cb462-6"><a href="nonhierarchical-clustering.html#cb462-6"></a>  <span class="dv">4</span>, <span class="dv">11</span>, <span class="dv">8</span>,</span>
<span id="cb462-7"><a href="nonhierarchical-clustering.html#cb462-7"></a>  <span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">7</span>,</span>
<span id="cb462-8"><a href="nonhierarchical-clustering.html#cb462-8"></a>  <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">15</span>,</span>
<span id="cb462-9"><a href="nonhierarchical-clustering.html#cb462-9"></a>  <span class="dv">7</span>, <span class="dv">13</span>, <span class="dv">6</span>,</span>
<span id="cb462-10"><a href="nonhierarchical-clustering.html#cb462-10"></a>  <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">4</span>,</span>
<span id="cb462-11"><a href="nonhierarchical-clustering.html#cb462-11"></a>  <span class="dv">9</span>, <span class="dv">3</span>, <span class="dv">3</span>,</span>
<span id="cb462-12"><a href="nonhierarchical-clustering.html#cb462-12"></a>  <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">2</span></span>
<span id="cb462-13"><a href="nonhierarchical-clustering.html#cb462-13"></a>)</span>
<span id="cb462-14"><a href="nonhierarchical-clustering.html#cb462-14"></a></span>
<span id="cb462-15"><a href="nonhierarchical-clustering.html#cb462-15"></a>df <span class="op">%&gt;%</span></span>
<span id="cb462-16"><a href="nonhierarchical-clustering.html#cb462-16"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb462-17"><a href="nonhierarchical-clustering.html#cb462-17"></a>    <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb462-18"><a href="nonhierarchical-clustering.html#cb462-18"></a>    <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>),</span>
<span id="cb462-19"><a href="nonhierarchical-clustering.html#cb462-19"></a>    <span class="dt">col.names =</span> <span class="kw">c</span>(</span>
<span id="cb462-20"><a href="nonhierarchical-clustering.html#cb462-20"></a>      <span class="st">&#39;객체번호&#39;</span>, </span>
<span id="cb462-21"><a href="nonhierarchical-clustering.html#cb462-21"></a>      <span class="st">&#39;사용경력($x_1$)&#39;</span>, <span class="st">&#39;사용시간($x_2$)&#39;</span></span>
<span id="cb462-22"><a href="nonhierarchical-clustering.html#cb462-22"></a>      ),</span>
<span id="cb462-23"><a href="nonhierarchical-clustering.html#cb462-23"></a>    <span class="dt">caption =</span> <span class="st">&#39;PC 사용 데이터&#39;</span></span>
<span id="cb462-24"><a href="nonhierarchical-clustering.html#cb462-24"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:kmeans-train-data">Table 13.1: </span>PC 사용 데이터</caption>
<thead>
<tr class="header">
<th align="right">객체번호</th>
<th align="right">사용경력(<span class="math inline">\(x_1\)</span>)</th>
<th align="right">사용시간(<span class="math inline">\(x_2\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">8</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">14</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">11</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">7</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">13</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">5</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>아래와 같이 <code>stats</code> 패키지의 <code>kmeans</code> 함수를 이용하여 K-means 알고리즘 수행 결과를 얻을 수 있다. 아래 스크립트는 군집 수가 <span class="math inline">\(K = 3\)</span>라 가정하여 수행한 예이다.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="nonhierarchical-clustering.html#cb463-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb463-2"><a href="nonhierarchical-clustering.html#cb463-2"></a>kmeans_solution &lt;-<span class="st"> </span><span class="kw">kmeans</span>(<span class="dt">x =</span> df[, <span class="dv">-1</span>], <span class="dt">centers =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>위 스크립트 실행 결과 도출된 군집 중심좌표는 위에서 얻어진 <code>kmeans</code> 클래스 객체의 <code>centers</code>값에 저장된다.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="nonhierarchical-clustering.html#cb464-1"></a>kmeans_solution<span class="op">$</span>centers</span></code></pre></div>
<pre><code>##          x1    x2
## 1 13.250000  6.75
## 2  3.666667  3.00
## 3  7.000000 14.00</code></pre>
<p>또한 각 학습 데이터가 속한 군집은 <code>cluster</code>값에 저장된다.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="nonhierarchical-clustering.html#cb466-1"></a>kmeans_solution<span class="op">$</span>cluster</span></code></pre></div>
<pre><code>##  [1] 3 3 1 1 1 3 1 2 2 2</code></pre>
<p>객체의 군집결과는 아래와 같이 도식화하여 보일 수 있다.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="nonhierarchical-clustering.html#cb468-1"></a>df <span class="op">%&gt;%</span></span>
<span id="cb468-2"><a href="nonhierarchical-clustering.html#cb468-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cluster =</span> <span class="kw">as.factor</span>(kmeans_solution<span class="op">$</span>cluster)) <span class="op">%&gt;%</span></span>
<span id="cb468-3"><a href="nonhierarchical-clustering.html#cb468-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2)) <span class="op">+</span></span>
<span id="cb468-4"><a href="nonhierarchical-clustering.html#cb468-4"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> id, <span class="dt">color =</span> cluster))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:kmeans-cluster"></span>
<img src="data-mining-book_files/figure-html/kmeans-cluster-1.png" alt="K-means 수행 결과" width="672" />
<p class="caption">
Figure 13.1: K-means 수행 결과
</p>
</div>
</div>
<div id="kmeans-algorithm" class="section level3">
<h3><span class="header-section-number">13.2.2</span> 알고리즘</h3>
<p>K-means 알고리즘의 구체적 절차는 아래와 같다. Table <a href="nonhierarchical-clustering.html#tab:kmeans-train-data">13.1</a>에 대한 각 단계의 결과를 함께 살펴보자.</p>
<p><strong>[단계 0] (초기 객체 선정)</strong> 어떤 규칙에 의하여 <span class="math inline">\(K\)</span>개의 객체의 좌표를 초기 군집의 중심좌표(centroid)로 선정한다. 군집 <span class="math inline">\(j\)</span>의 중심좌표를 <span class="math inline">\(\mathbf{c}_j = \left(\bar{x}^{(j)}_1, \cdots, \bar{x}^{(j)}_p\right)^\top\)</span>라 하자. 초기 군집 중심좌표 <span class="math inline">\(\mathbf{c}_1, \cdots, \mathbf{c}_K\)</span>를 선정하는 방법은 예를 들어 다음과 같은 규칙이 사용된다.</p>
<ul>
<li>무작위 방법: 대상 객체 중 무작위로 <span class="math inline">\(K\)</span>개를 선정한다.</li>
<li>외각 객체 선정: 전체 객체의 중심좌표에서 가장 멀리 위치하는 <span class="math inline">\(K\)</span>개의 객체를 선정한다.</li>
</ul>
<p>[단계 0] 무작위 방법을 이용하여 Table <a href="nonhierarchical-clustering.html#tab:kmeans-train-data">13.1</a>으로부터 3개의 객체를 초기 군집 중심좌표로 선정하자.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="nonhierarchical-clustering.html#cb469-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb469-2"><a href="nonhierarchical-clustering.html#cb469-2"></a></span>
<span id="cb469-3"><a href="nonhierarchical-clustering.html#cb469-3"></a>init_cluster &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">k =</span> <span class="dv">1</span>) {</span>
<span id="cb469-4"><a href="nonhierarchical-clustering.html#cb469-4"></a>  k &lt;-<span class="st"> </span><span class="kw">min</span>(k, <span class="kw">nrow</span>(df))</span>
<span id="cb469-5"><a href="nonhierarchical-clustering.html#cb469-5"></a>  </span>
<span id="cb469-6"><a href="nonhierarchical-clustering.html#cb469-6"></a>  df <span class="op">%&gt;%</span></span>
<span id="cb469-7"><a href="nonhierarchical-clustering.html#cb469-7"></a><span class="st">    </span><span class="kw">sample_n</span>(k)</span>
<span id="cb469-8"><a href="nonhierarchical-clustering.html#cb469-8"></a>}</span>
<span id="cb469-9"><a href="nonhierarchical-clustering.html#cb469-9"></a></span>
<span id="cb469-10"><a href="nonhierarchical-clustering.html#cb469-10"></a>cluster_df &lt;-<span class="st"> </span><span class="kw">init_cluster</span>(df[, <span class="dv">-1</span>], <span class="dv">3</span>)</span>
<span id="cb469-11"><a href="nonhierarchical-clustering.html#cb469-11"></a></span>
<span id="cb469-12"><a href="nonhierarchical-clustering.html#cb469-12"></a>cluster_df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      x1    x2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1    14     6
## 2     3     2
## 3     8    13</code></pre>
<p><strong>[단계 1] (객체의 군집 배정)</strong> 각 객체에 대하여 <span class="math inline">\(K\)</span>개의 군집 중심좌표(centroid)와의 거리(주로 유클리드 거리 사용)를 산출한 후 가장 가까운 군집에 그 객체를 배정한다.</p>
<p><span class="math display">\[\begin{equation*}
a_{ij} = \begin{cases}
1 &amp; \text{if } j = \arg\,\max_k d(\mathbf{x}_i, \mathbf{c}_k)\\
0 &amp; \text{otherwise}
\end{cases}, \, i = 1, \cdots, n, \, j = 1, \cdots, K
\end{equation*}\]</span></p>
<p>각 객체에 대하여 3개의 군집 중심좌표와의 거리를 산출해보면 아래와 같다.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="nonhierarchical-clustering.html#cb471-1"></a>flexclust<span class="op">::</span><span class="kw">dist2</span>(df[, <span class="dv">-1</span>], cluster_df)</span></code></pre></div>
<pre><code>##            [,1]      [,2]      [,3]
##  [1,] 11.313708 12.369317  2.236068
##  [2,]  9.219544 12.083046  0.000000
##  [3,]  0.000000 11.704700  9.219544
##  [4,]  3.605551 10.000000  5.830952
##  [5,]  1.414214 13.000000  9.219544
##  [6,] 11.401754 13.601471  2.236068
##  [7,]  1.000000 10.770330  8.602325
##  [8,]  9.219544  2.828427  9.486833
##  [9,] 11.401754  1.000000 11.180340
## [10,] 11.704700  0.000000 12.083046</code></pre>
<p>이에 각 객체들에 대해 거리가 가장 가까운 군집에 그 객체를 배정한다.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="nonhierarchical-clustering.html#cb473-1"></a>assign_cluster &lt;-<span class="st"> </span><span class="cf">function</span>(df, cluster_df) {</span>
<span id="cb473-2"><a href="nonhierarchical-clustering.html#cb473-2"></a>  cluster_ind &lt;-<span class="st"> </span>flexclust<span class="op">::</span><span class="kw">dist2</span>(df, cluster_df) <span class="op">%&gt;%</span></span>
<span id="cb473-3"><a href="nonhierarchical-clustering.html#cb473-3"></a><span class="st">    </span><span class="kw">apply</span>(<span class="dv">1</span>, which.min)</span>
<span id="cb473-4"><a href="nonhierarchical-clustering.html#cb473-4"></a>  </span>
<span id="cb473-5"><a href="nonhierarchical-clustering.html#cb473-5"></a>  <span class="kw">map</span>(<span class="kw">unique</span>(cluster_ind), <span class="op">~</span><span class="kw">which</span>(cluster_ind <span class="op">==</span><span class="st"> </span>.))</span>
<span id="cb473-6"><a href="nonhierarchical-clustering.html#cb473-6"></a>}</span>
<span id="cb473-7"><a href="nonhierarchical-clustering.html#cb473-7"></a></span>
<span id="cb473-8"><a href="nonhierarchical-clustering.html#cb473-8"></a>cluster_objects &lt;-<span class="st"> </span><span class="kw">assign_cluster</span>(df[, <span class="dv">-1</span>], cluster_df)</span>
<span id="cb473-9"><a href="nonhierarchical-clustering.html#cb473-9"></a></span>
<span id="cb473-10"><a href="nonhierarchical-clustering.html#cb473-10"></a>cluster_objects</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 6
## 
## [[2]]
## [1] 3 4 5 7
## 
## [[3]]
## [1]  8  9 10</code></pre>
<p><strong>[단계 2] (군집 중심좌표의 산출)</strong> 새로운 군집에 대한 중심좌표를 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
\bar{x}^{(j)}_l = \frac{\sum_{i} a_{ij} x_{li}}{\sum_{i} a_{ij}}, \, l = 1, \cdots, p, \, j = 1, \cdots, K
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="nonhierarchical-clustering.html#cb475-1"></a>find_center &lt;-<span class="st"> </span><span class="cf">function</span>(df, cluster) {</span>
<span id="cb475-2"><a href="nonhierarchical-clustering.html#cb475-2"></a>  <span class="kw">map_dfr</span>(cluster, <span class="op">~</span>df[., ] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(mean)) </span>
<span id="cb475-3"><a href="nonhierarchical-clustering.html#cb475-3"></a>}</span>
<span id="cb475-4"><a href="nonhierarchical-clustering.html#cb475-4"></a></span>
<span id="cb475-5"><a href="nonhierarchical-clustering.html#cb475-5"></a>new_cluster_df &lt;-<span class="st"> </span><span class="kw">find_center</span>(df[, <span class="dv">-1</span>], cluster_objects)</span>
<span id="cb475-6"><a href="nonhierarchical-clustering.html#cb475-6"></a></span>
<span id="cb475-7"><a href="nonhierarchical-clustering.html#cb475-7"></a>new_cluster_df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      x1    x2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  7    14   
## 2 13.2   6.75
## 3  3.67  3</code></pre>
<p><strong>[단계 3] (수렴 조건 점검)</strong> 새로 산출된 중심좌표값과 이전 좌표값을 비교하여 수렴 조건 내에 들면 마치며, 그렇지 않으면 단계 1을 반복한다.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="nonhierarchical-clustering.html#cb477-1"></a><span class="kw">identical</span>(cluster_df, new_cluster_df)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>위의 경우, 군집 중심좌표가 다르므로 다음 iteration을 진행한다.</p>
</div>
<div id="kmeans-user-defined-functions" class="section level3">
<h3><span class="header-section-number">13.2.3</span> R 스크립트 구현</h3>
<p>위의 과정을 군집해가 수렴할 때까지 반복하도록 아래와 같이 R 스크립트를 구현해보자.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="nonhierarchical-clustering.html#cb479-1"></a>init_cluster &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">k =</span> <span class="dv">1</span>) {</span>
<span id="cb479-2"><a href="nonhierarchical-clustering.html#cb479-2"></a>  k &lt;-<span class="st"> </span><span class="kw">min</span>(k, <span class="kw">nrow</span>(df))</span>
<span id="cb479-3"><a href="nonhierarchical-clustering.html#cb479-3"></a>  </span>
<span id="cb479-4"><a href="nonhierarchical-clustering.html#cb479-4"></a>  df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(k)</span>
<span id="cb479-5"><a href="nonhierarchical-clustering.html#cb479-5"></a>}</span>
<span id="cb479-6"><a href="nonhierarchical-clustering.html#cb479-6"></a></span>
<span id="cb479-7"><a href="nonhierarchical-clustering.html#cb479-7"></a>assign_cluster &lt;-<span class="st"> </span><span class="cf">function</span>(df, cluster_df) {</span>
<span id="cb479-8"><a href="nonhierarchical-clustering.html#cb479-8"></a>  cluster_ind &lt;-<span class="st"> </span>flexclust<span class="op">::</span><span class="kw">dist2</span>(df, cluster_df) <span class="op">%&gt;%</span></span>
<span id="cb479-9"><a href="nonhierarchical-clustering.html#cb479-9"></a><span class="st">    </span><span class="kw">apply</span>(<span class="dv">1</span>, which.min)</span>
<span id="cb479-10"><a href="nonhierarchical-clustering.html#cb479-10"></a>  </span>
<span id="cb479-11"><a href="nonhierarchical-clustering.html#cb479-11"></a>  <span class="kw">map</span>(<span class="kw">unique</span>(cluster_ind), <span class="op">~</span><span class="kw">which</span>(cluster_ind <span class="op">==</span><span class="st"> </span>.))</span>
<span id="cb479-12"><a href="nonhierarchical-clustering.html#cb479-12"></a>}</span>
<span id="cb479-13"><a href="nonhierarchical-clustering.html#cb479-13"></a></span>
<span id="cb479-14"><a href="nonhierarchical-clustering.html#cb479-14"></a>find_center &lt;-<span class="st"> </span><span class="cf">function</span>(df, cluster) {</span>
<span id="cb479-15"><a href="nonhierarchical-clustering.html#cb479-15"></a>  <span class="kw">map_dfr</span>(cluster, <span class="op">~</span>df[., ] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(mean)) </span>
<span id="cb479-16"><a href="nonhierarchical-clustering.html#cb479-16"></a>}</span>
<span id="cb479-17"><a href="nonhierarchical-clustering.html#cb479-17"></a></span>
<span id="cb479-18"><a href="nonhierarchical-clustering.html#cb479-18"></a>kmeans_cluster &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">k =</span> <span class="dv">1</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb479-19"><a href="nonhierarchical-clustering.html#cb479-19"></a>  k &lt;-<span class="st"> </span><span class="kw">min</span>(k, <span class="kw">nrow</span>(df))</span>
<span id="cb479-20"><a href="nonhierarchical-clustering.html#cb479-20"></a>  </span>
<span id="cb479-21"><a href="nonhierarchical-clustering.html#cb479-21"></a>  i &lt;-<span class="st"> </span>0L</span>
<span id="cb479-22"><a href="nonhierarchical-clustering.html#cb479-22"></a>  </span>
<span id="cb479-23"><a href="nonhierarchical-clustering.html#cb479-23"></a>  <span class="co">## 단계 0</span></span>
<span id="cb479-24"><a href="nonhierarchical-clustering.html#cb479-24"></a>  cluster_df &lt;-<span class="st"> </span><span class="kw">init_cluster</span>(df, k)</span>
<span id="cb479-25"><a href="nonhierarchical-clustering.html#cb479-25"></a>  </span>
<span id="cb479-26"><a href="nonhierarchical-clustering.html#cb479-26"></a>  <span class="cf">while</span>(<span class="ot">TRUE</span>) {</span>
<span id="cb479-27"><a href="nonhierarchical-clustering.html#cb479-27"></a>    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb479-28"><a href="nonhierarchical-clustering.html#cb479-28"></a>    </span>
<span id="cb479-29"><a href="nonhierarchical-clustering.html#cb479-29"></a>    <span class="co">## 단계 1</span></span>
<span id="cb479-30"><a href="nonhierarchical-clustering.html#cb479-30"></a>    cluster_objects &lt;-<span class="st"> </span><span class="kw">assign_cluster</span>(df, cluster_df)</span>
<span id="cb479-31"><a href="nonhierarchical-clustering.html#cb479-31"></a>    <span class="cf">if</span> (verbose) { <span class="co"># 군집해 출력</span></span>
<span id="cb479-32"><a href="nonhierarchical-clustering.html#cb479-32"></a>      <span class="kw">cat</span>(<span class="st">&quot;Iteration&quot;</span>, i, <span class="st">&quot;:&quot;</span>, </span>
<span id="cb479-33"><a href="nonhierarchical-clustering.html#cb479-33"></a>          <span class="kw">map</span>(cluster_objects, <span class="op">~</span><span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;{&quot;</span>, <span class="kw">str_c</span>(., <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;}&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb479-34"><a href="nonhierarchical-clustering.html#cb479-34"></a><span class="st">            </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>),</span>
<span id="cb479-35"><a href="nonhierarchical-clustering.html#cb479-35"></a>          <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb479-36"><a href="nonhierarchical-clustering.html#cb479-36"></a>      )</span>
<span id="cb479-37"><a href="nonhierarchical-clustering.html#cb479-37"></a>    }</span>
<span id="cb479-38"><a href="nonhierarchical-clustering.html#cb479-38"></a>    </span>
<span id="cb479-39"><a href="nonhierarchical-clustering.html#cb479-39"></a>    <span class="co">## 단계 2</span></span>
<span id="cb479-40"><a href="nonhierarchical-clustering.html#cb479-40"></a>    new_cluster_df &lt;-<span class="st"> </span><span class="kw">find_center</span>(df, cluster_objects)</span>
<span id="cb479-41"><a href="nonhierarchical-clustering.html#cb479-41"></a></span>
<span id="cb479-42"><a href="nonhierarchical-clustering.html#cb479-42"></a>    <span class="co">## 단계 3</span></span>
<span id="cb479-43"><a href="nonhierarchical-clustering.html#cb479-43"></a>    <span class="cf">if</span>(<span class="kw">identical</span>(cluster_df, new_cluster_df)) <span class="cf">break</span></span>
<span id="cb479-44"><a href="nonhierarchical-clustering.html#cb479-44"></a>    </span>
<span id="cb479-45"><a href="nonhierarchical-clustering.html#cb479-45"></a>    cluster_df &lt;-<span class="st"> </span>new_cluster_df</span>
<span id="cb479-46"><a href="nonhierarchical-clustering.html#cb479-46"></a>  }</span>
<span id="cb479-47"><a href="nonhierarchical-clustering.html#cb479-47"></a>  </span>
<span id="cb479-48"><a href="nonhierarchical-clustering.html#cb479-48"></a>  res &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb479-49"><a href="nonhierarchical-clustering.html#cb479-49"></a>    <span class="dt">cluster_centers =</span> cluster_df,</span>
<span id="cb479-50"><a href="nonhierarchical-clustering.html#cb479-50"></a>    <span class="dt">assgined_objects =</span> cluster_objects,</span>
<span id="cb479-51"><a href="nonhierarchical-clustering.html#cb479-51"></a>    <span class="dt">n_iteration =</span> i</span>
<span id="cb479-52"><a href="nonhierarchical-clustering.html#cb479-52"></a>  )</span>
<span id="cb479-53"><a href="nonhierarchical-clustering.html#cb479-53"></a>  </span>
<span id="cb479-54"><a href="nonhierarchical-clustering.html#cb479-54"></a>  <span class="kw">return</span> (res)</span>
<span id="cb479-55"><a href="nonhierarchical-clustering.html#cb479-55"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="nonhierarchical-clustering.html#cb480-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb480-2"><a href="nonhierarchical-clustering.html#cb480-2"></a></span>
<span id="cb480-3"><a href="nonhierarchical-clustering.html#cb480-3"></a>kmeans_solution &lt;-<span class="st"> </span><span class="kw">kmeans_cluster</span>(df[, <span class="dv">-1</span>], <span class="dt">k =</span> <span class="dv">3</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Iteration 1 : {1, 2, 6}, {3, 4, 5, 7}, {8, 9, 10} 
## Iteration 2 : {1, 2, 6}, {3, 4, 5, 7}, {8, 9, 10}</code></pre>
<p>위와 같이 2번째 Iteration에서 군집해가 수렴하였으며, 최종 군집해는 아래와 같다.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="nonhierarchical-clustering.html#cb482-1"></a>kmeans_solution<span class="op">$</span>assgined_objects</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 6
## 
## [[2]]
## [1] 3 4 5 7
## 
## [[3]]
## [1]  8  9 10</code></pre>
</div>
</div>
<div id="kmedoids" class="section level2">
<h2><span class="header-section-number">13.3</span> K-medoids 군집방법</h2>
<p>K-means 알고리즘에서는 각 군집의 중심좌표(centroid)를 군집 중심으로 고려하고 있는 반면, K-medoids 군집방법에서는 각 군집의 대표객체를 군집 중심으로 고려한다.</p>
<p>K-medoids 군집방법의 알고리즘으로 잘 알려진 것에는 다음과 같은 것들이 있다.</p>
<ol style="list-style-type: decimal">
<li>PAM(Partitioning Around Medoids)</li>
<li>CLARA(Clustering LARge Applications)</li>
<li>CLARANS(Clustering Large Applications based on RANdomized Search)</li>
<li>K-means-like 알고리즘</li>
</ol>
<div id="pam" class="section level3">
<h3><span class="header-section-number">13.3.1</span> PAM 알고리즘</h3>
<p>PAM 알고리즘은 <span class="citation">Kaufman and Rousseeuw (<a href="#ref-kaufman1990finding" role="doc-biblioref">1990</a>)</span> 에 의하여 발표된 것으로, 초기 대표객체를 선정하는 방법인 <strong>BUILD</strong>와 더 나은 군집해를 찾아나가는 과정인 <strong>SWAP</strong>의 두 부분으로 구성되어 있다.</p>
<div id="pam-basic-script" class="section level4">
<h4><span class="header-section-number">13.3.1.1</span> 기본 R 스크립트</h4>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="nonhierarchical-clustering.html#cb484-1"></a>df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb484-2"><a href="nonhierarchical-clustering.html#cb484-2"></a>  <span class="op">~</span>id, <span class="op">~</span>x1, <span class="op">~</span>x2,</span>
<span id="cb484-3"><a href="nonhierarchical-clustering.html#cb484-3"></a>  <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>,</span>
<span id="cb484-4"><a href="nonhierarchical-clustering.html#cb484-4"></a>  <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>,</span>
<span id="cb484-5"><a href="nonhierarchical-clustering.html#cb484-5"></a>  <span class="dv">3</span>, <span class="dv">11</span>, <span class="dv">8</span>,</span>
<span id="cb484-6"><a href="nonhierarchical-clustering.html#cb484-6"></a>  <span class="dv">4</span>, <span class="dv">13</span>, <span class="dv">6</span>,</span>
<span id="cb484-7"><a href="nonhierarchical-clustering.html#cb484-7"></a>  <span class="dv">5</span>, <span class="dv">14</span>, <span class="dv">6</span>,</span>
<span id="cb484-8"><a href="nonhierarchical-clustering.html#cb484-8"></a>  <span class="dv">6</span>, <span class="dv">15</span>, <span class="dv">7</span></span>
<span id="cb484-9"><a href="nonhierarchical-clustering.html#cb484-9"></a>)</span>
<span id="cb484-10"><a href="nonhierarchical-clustering.html#cb484-10"></a></span>
<span id="cb484-11"><a href="nonhierarchical-clustering.html#cb484-11"></a>df <span class="op">%&gt;%</span></span>
<span id="cb484-12"><a href="nonhierarchical-clustering.html#cb484-12"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb484-13"><a href="nonhierarchical-clustering.html#cb484-13"></a>    <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb484-14"><a href="nonhierarchical-clustering.html#cb484-14"></a>    <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>),</span>
<span id="cb484-15"><a href="nonhierarchical-clustering.html#cb484-15"></a>    <span class="dt">col.names =</span> <span class="kw">c</span>(</span>
<span id="cb484-16"><a href="nonhierarchical-clustering.html#cb484-16"></a>      <span class="st">&#39;객체번호&#39;</span>, </span>
<span id="cb484-17"><a href="nonhierarchical-clustering.html#cb484-17"></a>      <span class="st">&#39;사용경력($x_1$)&#39;</span>, <span class="st">&#39;사용시간($x_2$)&#39;</span></span>
<span id="cb484-18"><a href="nonhierarchical-clustering.html#cb484-18"></a>      ),</span>
<span id="cb484-19"><a href="nonhierarchical-clustering.html#cb484-19"></a>    <span class="dt">caption =</span> <span class="st">&#39;PC 사용자 데이터&#39;</span></span>
<span id="cb484-20"><a href="nonhierarchical-clustering.html#cb484-20"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:pam-train-data">Table 13.2: </span>PC 사용자 데이터</caption>
<thead>
<tr class="header">
<th align="right">객체번호</th>
<th align="right">사용경력(<span class="math inline">\(x_1\)</span>)</th>
<th align="right">사용시간(<span class="math inline">\(x_2\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">5</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">11</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">13</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">14</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
<p>PAM 알고리즘은 <code>cluster</code> 패키지 내의 함수 <code>pam</code>을 이용하여 아래와 같이 간단하게 실행할 수 있다.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="nonhierarchical-clustering.html#cb485-1"></a>pam_solution &lt;-<span class="st"> </span>cluster<span class="op">::</span><span class="kw">pam</span>(df[, <span class="dv">-1</span>], <span class="dt">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>얻어진 <code>pam</code> 객체의 원소 <code>id.med</code>는 몇 번째 객체가 군집의 대표객체로 선정되었는지를 나타낸다.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="nonhierarchical-clustering.html#cb486-1"></a>pam_solution<span class="op">$</span>id.med</span></code></pre></div>
<pre><code>## [1] 2 5</code></pre>
<p>또한 <code>pam</code> 객체의 원소 <code>clustering</code>은 각 객체가 어떠한 군집에 할당되었는지를 보여준다.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="nonhierarchical-clustering.html#cb488-1"></a>pam_solution<span class="op">$</span>clustering</span></code></pre></div>
<pre><code>## [1] 1 1 2 2 2 2</code></pre>
</div>
<div id="pam-algorithm" class="section level4">
<h4><span class="header-section-number">13.3.1.2</span> PAM 알고리즘</h4>
<p>PAM 알고리즘의 각 단계를 Table <a href="nonhierarchical-clustering.html#tab:pam-train-data">13.2</a>의 예제 데이터에 적용하여 살펴보기로 하자.</p>
<div id="pam-build" class="section level5">
<h5><span class="header-section-number">13.3.1.2.1</span> BUILD</h5>
<p>BUILD는 다음 절차들을 거쳐서 <span class="math inline">\(K\)</span>개의 초기 대표객체를 구하는 과정이다.</p>
<p><strong>[단계 0]</strong> 우선 각 객체별로 다른 객체 간의 거리를 구한 후, 그 합이 가장 작은 객체 하나를 대표객체로 선정한다. 선정된 대표객체집합을 <span class="math inline">\(M\)</span>이라 하자.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="nonhierarchical-clustering.html#cb490-1"></a>pairwise_distance_df &lt;-<span class="st"> </span><span class="kw">dist</span>(df[, <span class="dv">-1</span>], <span class="dt">upper =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb490-2"><a href="nonhierarchical-clustering.html#cb490-2"></a><span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb490-3"><a href="nonhierarchical-clustering.html#cb490-3"></a><span class="st">  </span><span class="kw">mutate_if</span>(is.factor, <span class="op">~</span><span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(.)))</span>
<span id="cb490-4"><a href="nonhierarchical-clustering.html#cb490-4"></a></span>
<span id="cb490-5"><a href="nonhierarchical-clustering.html#cb490-5"></a>M_idx &lt;-<span class="st"> </span>pairwise_distance_df <span class="op">%&gt;%</span></span>
<span id="cb490-6"><a href="nonhierarchical-clustering.html#cb490-6"></a><span class="st">  </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb490-7"><a href="nonhierarchical-clustering.html#cb490-7"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_distance =</span> <span class="kw">sum</span>(distance)) <span class="op">%&gt;%</span></span>
<span id="cb490-8"><a href="nonhierarchical-clustering.html#cb490-8"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">1</span>, sum_distance) <span class="op">%&gt;%</span></span>
<span id="cb490-9"><a href="nonhierarchical-clustering.html#cb490-9"></a><span class="st">  </span>.<span class="op">$</span>item1</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="nonhierarchical-clustering.html#cb492-1"></a>M &lt;-<span class="st"> </span>df[M_idx, ]</span>
<span id="cb492-2"><a href="nonhierarchical-clustering.html#cb492-2"></a></span>
<span id="cb492-3"><a href="nonhierarchical-clustering.html#cb492-3"></a>M</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##      id    x1    x2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     4    13     6</code></pre>
<p><strong>[단계 1]</strong> 대표객체로 선정되지 않은 객체 <span class="math inline">\(j\)</span>에 대하여, 이전에 대표객체로 선정된 객체들 중 객체 <span class="math inline">\(j\)</span>에 가장 가까운 거리 <span class="math inline">\(D_j\)</span>를 구한다. 즉,</p>
<p><span class="math display">\[\begin{equation*}
D_j = \min_{k \in M} d(j, k), \, j \notin M
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="nonhierarchical-clustering.html#cb494-1"></a>D_j &lt;-<span class="st"> </span>pairwise_distance_df <span class="op">%&gt;%</span></span>
<span id="cb494-2"><a href="nonhierarchical-clustering.html#cb494-2"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb494-3"><a href="nonhierarchical-clustering.html#cb494-3"></a>    <span class="op">!</span>item1 <span class="op">%in%</span><span class="st"> </span>M<span class="op">$</span>id,</span>
<span id="cb494-4"><a href="nonhierarchical-clustering.html#cb494-4"></a>    item2 <span class="op">%in%</span><span class="st"> </span>M<span class="op">$</span>id</span>
<span id="cb494-5"><a href="nonhierarchical-clustering.html#cb494-5"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb494-6"><a href="nonhierarchical-clustering.html#cb494-6"></a><span class="st">  </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb494-7"><a href="nonhierarchical-clustering.html#cb494-7"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">1</span>, distance) <span class="op">%&gt;%</span></span>
<span id="cb494-8"><a href="nonhierarchical-clustering.html#cb494-8"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb494-9"><a href="nonhierarchical-clustering.html#cb494-9"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">D_j =</span> distance) <span class="op">%&gt;%</span></span>
<span id="cb494-10"><a href="nonhierarchical-clustering.html#cb494-10"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>item2)</span>
<span id="cb494-11"><a href="nonhierarchical-clustering.html#cb494-11"></a></span>
<span id="cb494-12"><a href="nonhierarchical-clustering.html#cb494-12"></a>D_j</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   item1   D_j
##   &lt;int&gt; &lt;dbl&gt;
## 1     1 10.4 
## 2     2  8.25
## 3     3  2.83
## 4     5  1   
## 5     6  2.24</code></pre>
<p>그리고 대표객체로 선정되지 않은 두 객체 <span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span>에 대하여 다음을 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
C_{ji} = \max \left(D_j - d(j, i), 0\right)
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="nonhierarchical-clustering.html#cb496-1"></a>d_ji &lt;-<span class="st"> </span>pairwise_distance_df <span class="op">%&gt;%</span></span>
<span id="cb496-2"><a href="nonhierarchical-clustering.html#cb496-2"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb496-3"><a href="nonhierarchical-clustering.html#cb496-3"></a>    <span class="op">!</span>item1 <span class="op">%in%</span><span class="st"> </span>M<span class="op">$</span>id,</span>
<span id="cb496-4"><a href="nonhierarchical-clustering.html#cb496-4"></a>    <span class="op">!</span>item2 <span class="op">%in%</span><span class="st"> </span>M<span class="op">$</span>id</span>
<span id="cb496-5"><a href="nonhierarchical-clustering.html#cb496-5"></a>  )</span>
<span id="cb496-6"><a href="nonhierarchical-clustering.html#cb496-6"></a></span>
<span id="cb496-7"><a href="nonhierarchical-clustering.html#cb496-7"></a>C_ji &lt;-<span class="st"> </span>D_j <span class="op">%&gt;%</span></span>
<span id="cb496-8"><a href="nonhierarchical-clustering.html#cb496-8"></a><span class="st">  </span><span class="kw">inner_join</span>(d_ji, <span class="dt">by =</span> <span class="st">&quot;item1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb496-9"><a href="nonhierarchical-clustering.html#cb496-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">C_ji =</span> <span class="kw">pmax</span>(D_j <span class="op">-</span><span class="st"> </span>distance, <span class="dv">0</span>))</span>
<span id="cb496-10"><a href="nonhierarchical-clustering.html#cb496-10"></a></span>
<span id="cb496-11"><a href="nonhierarchical-clustering.html#cb496-11"></a>C_ji</span></code></pre></div>
<pre><code>## # A tibble: 20 x 5
##    item1   D_j item2 distance  C_ji
##    &lt;int&gt; &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1     1 10.4      2     2.24 8.20 
##  2     1 10.4      3     9.43 1.01 
##  3     1 10.4      5    11.4  0    
##  4     1 10.4      6    12.6  0    
##  5     2  8.25     1     2.24 6.01 
##  6     2  8.25     3     7.21 1.04 
##  7     2  8.25     5     9.22 0    
##  8     2  8.25     6    10.4  0    
##  9     3  2.83     1     9.43 0    
## 10     3  2.83     2     7.21 0    
## 11     3  2.83     5     3.61 0    
## 12     3  2.83     6     4.12 0    
## 13     5  1        1    11.4  0    
## 14     5  1        2     9.22 0    
## 15     5  1        3     3.61 0    
## 16     5  1        6     1.41 0    
## 17     6  2.24     1    12.6  0    
## 18     6  2.24     2    10.4  0    
## 19     6  2.24     3     4.12 0    
## 20     6  2.24     5     1.41 0.822</code></pre>
<p>이는 객체 <span class="math inline">\(i\)</span>가 추가로 대표객체가 된다고 할 때, 객체 <span class="math inline">\(j\)</span>의 입장에서 거리 감소량이다.</p>
<p><strong>[단계 2]</strong> 다음과 같이 거리감소량이 가장 큰 객체 <span class="math inline">\(m\)</span>을 대표객체에 포함시키고,</p>
<p><span class="math display">\[\begin{equation*}
m = \arg\,\max_{i \notin M} \sum_{j \notin M} C_{ji}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="nonhierarchical-clustering.html#cb498-1"></a>m &lt;-<span class="st"> </span>C_ji <span class="op">%&gt;%</span></span>
<span id="cb498-2"><a href="nonhierarchical-clustering.html#cb498-2"></a><span class="st">  </span><span class="kw">group_by</span>(item2) <span class="op">%&gt;%</span></span>
<span id="cb498-3"><a href="nonhierarchical-clustering.html#cb498-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_C_ji =</span> <span class="kw">sum</span>(C_ji)) <span class="op">%&gt;%</span></span>
<span id="cb498-4"><a href="nonhierarchical-clustering.html#cb498-4"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, sum_C_ji) <span class="op">%&gt;%</span></span>
<span id="cb498-5"><a href="nonhierarchical-clustering.html#cb498-5"></a><span class="st">  </span>.<span class="op">$</span>item2</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="nonhierarchical-clustering.html#cb500-1"></a>m</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>대표객체집합을 수정한다.</p>
<p><span class="math display">\[\begin{equation*}
M \leftarrow M \cup \{m\}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="nonhierarchical-clustering.html#cb502-1"></a>M &lt;-<span class="st"> </span>M <span class="op">%&gt;%</span></span>
<span id="cb502-2"><a href="nonhierarchical-clustering.html#cb502-2"></a><span class="st">  </span><span class="kw">bind_rows</span>(df[m, ])</span></code></pre></div>
<p><strong>[단계 3]</strong> <span class="math inline">\(K\)</span>개의 대표객체가 선정되었으면 Stop, 그렇지 않은 경우에는 [단계 1]로 되돌아간다.</p>
</div>
<div id="pam-swap" class="section level5">
<h5><span class="header-section-number">13.3.1.2.2</span> SWAP</h5>
<p>SWAP은 대표객체로 선정되어 있는 객체 <span class="math inline">\(i\)</span>와 선정되지 않은 객체 <span class="math inline">\(h\)</span>를 교환할 때 목적함수의 변화량을 산출해 더 나은 목적함수값을 찾아가는 과정이다.</p>
<p><strong>[단계 1]</strong> 객체 <span class="math inline">\(i\)</span>와 객체 <span class="math inline">\(h\)</span>를 교환할 때 목적함수의 변화량을 산출하기 위하여 우선, 대표객체로 선정되지 않은 임의의 객체 <span class="math inline">\(j \neq h\)</span>에서의 변화량을 다음과 같이 산출한다.</p>
<p><span class="math display">\[\begin{eqnarray*}
C_{jih} &amp;=&amp; \text{($i$와 $h$를 교환 후 객체 $j$와 대표객체와의 거리)}\\
 &amp; &amp; - \text{(교환 전 객체 $j$와 대표객체와의 거리)},\\
 &amp; &amp; \, (j \notin M, i \in M, h \notin M)
\end{eqnarray*}\]</span></p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="nonhierarchical-clustering.html#cb503-1"></a><span class="co"># 교환 전 각 객체와 대표 객체와의 거리</span></span>
<span id="cb503-2"><a href="nonhierarchical-clustering.html#cb503-2"></a>D_j &lt;-<span class="st"> </span>pairwise_distance_df <span class="op">%&gt;%</span></span>
<span id="cb503-3"><a href="nonhierarchical-clustering.html#cb503-3"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb503-4"><a href="nonhierarchical-clustering.html#cb503-4"></a>    <span class="op">!</span>item1 <span class="op">%in%</span><span class="st"> </span>M<span class="op">$</span>id,</span>
<span id="cb503-5"><a href="nonhierarchical-clustering.html#cb503-5"></a>    item2 <span class="op">%in%</span><span class="st"> </span>M<span class="op">$</span>id</span>
<span id="cb503-6"><a href="nonhierarchical-clustering.html#cb503-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb503-7"><a href="nonhierarchical-clustering.html#cb503-7"></a><span class="st">  </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb503-8"><a href="nonhierarchical-clustering.html#cb503-8"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">1</span>, distance) <span class="op">%&gt;%</span></span>
<span id="cb503-9"><a href="nonhierarchical-clustering.html#cb503-9"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb503-10"><a href="nonhierarchical-clustering.html#cb503-10"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">j =</span> item1) <span class="op">%&gt;%</span></span>
<span id="cb503-11"><a href="nonhierarchical-clustering.html#cb503-11"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>item2)</span>
<span id="cb503-12"><a href="nonhierarchical-clustering.html#cb503-12"></a></span>
<span id="cb503-13"><a href="nonhierarchical-clustering.html#cb503-13"></a>D_j</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##       j distance
##   &lt;int&gt;    &lt;dbl&gt;
## 1     1     2.24
## 2     3     2.83
## 3     5     1   
## 4     6     2.24</code></pre>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="nonhierarchical-clustering.html#cb505-1"></a><span class="co"># 교환할 객체</span></span>
<span id="cb505-2"><a href="nonhierarchical-clustering.html#cb505-2"></a>swap_ids &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb505-3"><a href="nonhierarchical-clustering.html#cb505-3"></a>  <span class="dt">i =</span> <span class="kw">rep</span>(M<span class="op">$</span>id, <span class="dt">each =</span> <span class="kw">nrow</span>(df) <span class="op">-</span><span class="st"> </span><span class="kw">nrow</span>(M)),</span>
<span id="cb505-4"><a href="nonhierarchical-clustering.html#cb505-4"></a>  <span class="dt">h =</span> <span class="kw">rep</span>(<span class="kw">setdiff</span>(df<span class="op">$</span>id, M<span class="op">$</span>id), <span class="kw">nrow</span>(M))</span>
<span id="cb505-5"><a href="nonhierarchical-clustering.html#cb505-5"></a>)</span>
<span id="cb505-6"><a href="nonhierarchical-clustering.html#cb505-6"></a></span>
<span id="cb505-7"><a href="nonhierarchical-clustering.html#cb505-7"></a><span class="co"># 교환 후 각 객체와 대표 객체와의 거리</span></span>
<span id="cb505-8"><a href="nonhierarchical-clustering.html#cb505-8"></a>update_distance &lt;-<span class="st"> </span><span class="cf">function</span>(i, h, distance_df, center_ids) {</span>
<span id="cb505-9"><a href="nonhierarchical-clustering.html#cb505-9"></a>  new_center_ids &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">setdiff</span>(center_ids, i), h)</span>
<span id="cb505-10"><a href="nonhierarchical-clustering.html#cb505-10"></a></span>
<span id="cb505-11"><a href="nonhierarchical-clustering.html#cb505-11"></a>  res &lt;-<span class="st"> </span>distance_df <span class="op">%&gt;%</span></span>
<span id="cb505-12"><a href="nonhierarchical-clustering.html#cb505-12"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb505-13"><a href="nonhierarchical-clustering.html#cb505-13"></a>      <span class="op">!</span>item1 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(center_ids, h),</span>
<span id="cb505-14"><a href="nonhierarchical-clustering.html#cb505-14"></a>      item2 <span class="op">%in%</span><span class="st"> </span>new_center_ids</span>
<span id="cb505-15"><a href="nonhierarchical-clustering.html#cb505-15"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb505-16"><a href="nonhierarchical-clustering.html#cb505-16"></a><span class="st">    </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb505-17"><a href="nonhierarchical-clustering.html#cb505-17"></a><span class="st">    </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">1</span>, distance) <span class="op">%&gt;%</span></span>
<span id="cb505-18"><a href="nonhierarchical-clustering.html#cb505-18"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb505-19"><a href="nonhierarchical-clustering.html#cb505-19"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">j =</span> item1) <span class="op">%&gt;%</span></span>
<span id="cb505-20"><a href="nonhierarchical-clustering.html#cb505-20"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>item2) <span class="op">%&gt;%</span></span>
<span id="cb505-21"><a href="nonhierarchical-clustering.html#cb505-21"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb505-22"><a href="nonhierarchical-clustering.html#cb505-22"></a>      <span class="dt">i =</span> i,</span>
<span id="cb505-23"><a href="nonhierarchical-clustering.html#cb505-23"></a>      <span class="dt">h =</span> h</span>
<span id="cb505-24"><a href="nonhierarchical-clustering.html#cb505-24"></a>    )</span>
<span id="cb505-25"><a href="nonhierarchical-clustering.html#cb505-25"></a>  </span>
<span id="cb505-26"><a href="nonhierarchical-clustering.html#cb505-26"></a>  <span class="kw">return</span>(res)</span>
<span id="cb505-27"><a href="nonhierarchical-clustering.html#cb505-27"></a>}</span>
<span id="cb505-28"><a href="nonhierarchical-clustering.html#cb505-28"></a></span>
<span id="cb505-29"><a href="nonhierarchical-clustering.html#cb505-29"></a>D_jih &lt;-<span class="st"> </span><span class="kw">pmap_dfr</span>(</span>
<span id="cb505-30"><a href="nonhierarchical-clustering.html#cb505-30"></a>  swap_ids, </span>
<span id="cb505-31"><a href="nonhierarchical-clustering.html#cb505-31"></a>  update_distance,</span>
<span id="cb505-32"><a href="nonhierarchical-clustering.html#cb505-32"></a>  <span class="dt">distance_df =</span> pairwise_distance_df,</span>
<span id="cb505-33"><a href="nonhierarchical-clustering.html#cb505-33"></a>  <span class="dt">center_ids =</span> M<span class="op">$</span>id</span>
<span id="cb505-34"><a href="nonhierarchical-clustering.html#cb505-34"></a>  )</span>
<span id="cb505-35"><a href="nonhierarchical-clustering.html#cb505-35"></a></span>
<span id="cb505-36"><a href="nonhierarchical-clustering.html#cb505-36"></a>D_jih</span></code></pre></div>
<pre><code>## # A tibble: 24 x 4
##        j distance     i     h
##    &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     3     7.21     4     1
##  2     5     9.22     4     1
##  3     6    10.4      4     1
##  4     1     2.24     4     3
##  5     5     3.61     4     3
##  6     6     4.12     4     3
##  7     1     2.24     4     5
##  8     3     3.61     4     5
##  9     6     1.41     4     5
## 10     1     2.24     4     6
## # … with 14 more rows</code></pre>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="nonhierarchical-clustering.html#cb507-1"></a><span class="co"># 거리의 변화량</span></span>
<span id="cb507-2"><a href="nonhierarchical-clustering.html#cb507-2"></a>C_jih &lt;-<span class="st"> </span>D_j <span class="op">%&gt;%</span></span>
<span id="cb507-3"><a href="nonhierarchical-clustering.html#cb507-3"></a><span class="st">  </span><span class="kw">inner_join</span>(D_jih, <span class="dt">by =</span> <span class="st">&quot;j&quot;</span>, <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_new&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb507-4"><a href="nonhierarchical-clustering.html#cb507-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff_distance =</span> distance_new <span class="op">-</span><span class="st"> </span>distance)</span>
<span id="cb507-5"><a href="nonhierarchical-clustering.html#cb507-5"></a></span>
<span id="cb507-6"><a href="nonhierarchical-clustering.html#cb507-6"></a>C_jih</span></code></pre></div>
<pre><code>## # A tibble: 24 x 6
##        j distance distance_new     i     h diff_distance
##    &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1     1     2.24         2.24     4     3         0    
##  2     1     2.24         2.24     4     5         0    
##  3     1     2.24         2.24     4     6         0    
##  4     1     2.24         9.43     2     3         7.20 
##  5     1     2.24        10.4      2     5         8.20 
##  6     1     2.24        10.4      2     6         8.20 
##  7     3     2.83         7.21     4     1         4.38 
##  8     3     2.83         3.61     4     5         0.777
##  9     3     2.83         4.12     4     6         1.29 
## 10     3     2.83         2.83     2     1         0    
## # … with 14 more rows</code></pre>
<p><strong>[단계 2]</strong> 대표객체 <span class="math inline">\(i\)</span>를 <span class="math inline">\(h\)</span>로 교환하는 경우 총 변화량은 다음과 같다.</p>
<p><span class="math display">\[\begin{equation*}
T_{ih} = \sum_{j} C_{jih}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="nonhierarchical-clustering.html#cb509-1"></a>T_ih &lt;-<span class="st"> </span>C_jih <span class="op">%&gt;%</span></span>
<span id="cb509-2"><a href="nonhierarchical-clustering.html#cb509-2"></a><span class="st">  </span><span class="kw">group_by</span>(i, h) <span class="op">%&gt;%</span></span>
<span id="cb509-3"><a href="nonhierarchical-clustering.html#cb509-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total_diff_distance =</span> <span class="kw">sum</span>(diff_distance))</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;i&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="nonhierarchical-clustering.html#cb511-1"></a>T_ih</span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
## # Groups:   i [2]
##       i     h total_diff_distance
##   &lt;dbl&gt; &lt;dbl&gt;               &lt;dbl&gt;
## 1     2     1              0     
## 2     2     3              7.20  
## 3     2     5              7.38  
## 4     2     6              8.20  
## 5     4     1             20.8   
## 6     4     3              4.49  
## 7     4     5             -0.0447
## 8     4     6              1.71</code></pre>
<p>이 때 <span class="math inline">\(\min_{i, h} T_{ih}\)</span>에 대응하는 객체 <span class="math inline">\(i^*\)</span>와 <span class="math inline">\(h^*\)</span>를 찾아 <span class="math inline">\(T_{i^*h^*} &lt; 0\)</span>이면 교환한 후에 다시 [단계 1]으로 돌아가고, <span class="math inline">\(T_{i^*h^*} \geq 0\)</span>이면 교환하지 않고 stop.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="nonhierarchical-clustering.html#cb513-1"></a>swap_ih &lt;-<span class="st"> </span>T_ih <span class="op">%&gt;%</span></span>
<span id="cb513-2"><a href="nonhierarchical-clustering.html#cb513-2"></a><span class="st">  </span><span class="kw">filter</span>(total_diff_distance <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb513-3"><a href="nonhierarchical-clustering.html#cb513-3"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">1</span>, total_diff_distance)</span>
<span id="cb513-4"><a href="nonhierarchical-clustering.html#cb513-4"></a></span>
<span id="cb513-5"><a href="nonhierarchical-clustering.html#cb513-5"></a>swap_ih</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
## # Groups:   i [1]
##       i     h total_diff_distance
##   &lt;dbl&gt; &lt;dbl&gt;               &lt;dbl&gt;
## 1     4     5             -0.0447</code></pre>
<p>본 예제의 경우 객체 4 대신 객체 5가 새로운 대표객체로 선택되고, 다시 [단계 1]로 넘어간다.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="nonhierarchical-clustering.html#cb515-1"></a>M &lt;-<span class="st"> </span>M <span class="op">%&gt;%</span></span>
<span id="cb515-2"><a href="nonhierarchical-clustering.html#cb515-2"></a><span class="st">  </span><span class="kw">anti_join</span>(df[swap_ih<span class="op">$</span>i, ]) <span class="op">%&gt;%</span></span>
<span id="cb515-3"><a href="nonhierarchical-clustering.html#cb515-3"></a><span class="st">  </span><span class="kw">bind_rows</span>(df[swap_ih<span class="op">$</span>h, ])</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;id&quot;, &quot;x1&quot;, &quot;x2&quot;)</code></pre>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="nonhierarchical-clustering.html#cb517-1"></a>M</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##      id    x1    x2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     2     5     4
## 2     5    14     6</code></pre>
<p>SWAP 과정이 종료된 후, 최종 군집해는 각 객체를 가장 가까운 대표객체가 속한 군집에 할당함으로써 얻어진다.</p>
</div>
</div>
<div id="pam-user-defined-functions" class="section level4">
<h4><span class="header-section-number">13.3.1.3</span> R 스크립트 구현</h4>
<p>일련의 과정을 함수로 구현해보자.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="nonhierarchical-clustering.html#cb519-1"></a><span class="co"># 각 객체로부터 가장 가까운 대표객체까지의 거리</span></span>
<span id="cb519-2"><a href="nonhierarchical-clustering.html#cb519-2"></a>distance_from_medoids &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, medoids_ids) {</span>
<span id="cb519-3"><a href="nonhierarchical-clustering.html#cb519-3"></a>  distance_df <span class="op">%&gt;%</span></span>
<span id="cb519-4"><a href="nonhierarchical-clustering.html#cb519-4"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb519-5"><a href="nonhierarchical-clustering.html#cb519-5"></a>      <span class="op">!</span>item1 <span class="op">%in%</span><span class="st"> </span>medoids_ids,</span>
<span id="cb519-6"><a href="nonhierarchical-clustering.html#cb519-6"></a>      item2 <span class="op">%in%</span><span class="st"> </span>medoids_ids</span>
<span id="cb519-7"><a href="nonhierarchical-clustering.html#cb519-7"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb519-8"><a href="nonhierarchical-clustering.html#cb519-8"></a><span class="st">    </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb519-9"><a href="nonhierarchical-clustering.html#cb519-9"></a><span class="st">    </span><span class="kw">arrange</span>(distance) <span class="op">%&gt;%</span></span>
<span id="cb519-10"><a href="nonhierarchical-clustering.html#cb519-10"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb519-11"><a href="nonhierarchical-clustering.html#cb519-11"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb519-12"><a href="nonhierarchical-clustering.html#cb519-12"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">j =</span> item1) <span class="op">%&gt;%</span></span>
<span id="cb519-13"><a href="nonhierarchical-clustering.html#cb519-13"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>item2)</span>
<span id="cb519-14"><a href="nonhierarchical-clustering.html#cb519-14"></a>}</span>
<span id="cb519-15"><a href="nonhierarchical-clustering.html#cb519-15"></a></span>
<span id="cb519-16"><a href="nonhierarchical-clustering.html#cb519-16"></a><span class="co"># k개의 초기 대표객체를 선정</span></span>
<span id="cb519-17"><a href="nonhierarchical-clustering.html#cb519-17"></a>build_medoids &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, <span class="dt">k =</span> 1L) {</span>
<span id="cb519-18"><a href="nonhierarchical-clustering.html#cb519-18"></a>  k  &lt;-<span class="st"> </span><span class="kw">min</span>(k, <span class="kw">length</span>(<span class="kw">unique</span>(distance_df<span class="op">$</span>item1)))</span>
<span id="cb519-19"><a href="nonhierarchical-clustering.html#cb519-19"></a></span>
<span id="cb519-20"><a href="nonhierarchical-clustering.html#cb519-20"></a>  <span class="co"># 첫 번째 대표객체 선정</span></span>
<span id="cb519-21"><a href="nonhierarchical-clustering.html#cb519-21"></a>  medoids_ids &lt;-<span class="st"> </span>distance_df <span class="op">%&gt;%</span></span>
<span id="cb519-22"><a href="nonhierarchical-clustering.html#cb519-22"></a><span class="st">    </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb519-23"><a href="nonhierarchical-clustering.html#cb519-23"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">sum_distance =</span> <span class="kw">sum</span>(distance)) <span class="op">%&gt;%</span></span>
<span id="cb519-24"><a href="nonhierarchical-clustering.html#cb519-24"></a><span class="st">    </span><span class="kw">arrange</span>(sum_distance) <span class="op">%&gt;%</span></span>
<span id="cb519-25"><a href="nonhierarchical-clustering.html#cb519-25"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb519-26"><a href="nonhierarchical-clustering.html#cb519-26"></a><span class="st">    </span>.<span class="op">$</span>item1</span>
<span id="cb519-27"><a href="nonhierarchical-clustering.html#cb519-27"></a>  </span>
<span id="cb519-28"><a href="nonhierarchical-clustering.html#cb519-28"></a>  <span class="cf">while</span> (<span class="kw">length</span>(medoids_ids) <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb519-29"><a href="nonhierarchical-clustering.html#cb519-29"></a>    D_j &lt;-<span class="st"> </span><span class="kw">distance_from_medoids</span>(distance_df, medoids_ids)</span>
<span id="cb519-30"><a href="nonhierarchical-clustering.html#cb519-30"></a></span>
<span id="cb519-31"><a href="nonhierarchical-clustering.html#cb519-31"></a>    d_ji &lt;-<span class="st"> </span>distance_df <span class="op">%&gt;%</span></span>
<span id="cb519-32"><a href="nonhierarchical-clustering.html#cb519-32"></a><span class="st">      </span><span class="kw">filter</span>(</span>
<span id="cb519-33"><a href="nonhierarchical-clustering.html#cb519-33"></a>        <span class="op">!</span>item1 <span class="op">%in%</span><span class="st"> </span>medoids_ids,</span>
<span id="cb519-34"><a href="nonhierarchical-clustering.html#cb519-34"></a>        <span class="op">!</span>item2 <span class="op">%in%</span><span class="st"> </span>medoids_ids</span>
<span id="cb519-35"><a href="nonhierarchical-clustering.html#cb519-35"></a>      ) <span class="op">%&gt;%</span></span>
<span id="cb519-36"><a href="nonhierarchical-clustering.html#cb519-36"></a><span class="st">      </span><span class="kw">rename</span>(<span class="dt">j =</span> item1, <span class="dt">i =</span> item2)</span>
<span id="cb519-37"><a href="nonhierarchical-clustering.html#cb519-37"></a></span>
<span id="cb519-38"><a href="nonhierarchical-clustering.html#cb519-38"></a>    <span class="co"># 거리 감소량</span></span>
<span id="cb519-39"><a href="nonhierarchical-clustering.html#cb519-39"></a>    C_ji &lt;-<span class="st"> </span>D_j <span class="op">%&gt;%</span></span>
<span id="cb519-40"><a href="nonhierarchical-clustering.html#cb519-40"></a><span class="st">      </span><span class="kw">inner_join</span>(d_ji, <span class="dt">by =</span> <span class="st">&quot;j&quot;</span>,</span>
<span id="cb519-41"><a href="nonhierarchical-clustering.html#cb519-41"></a>                 <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_new&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb519-42"><a href="nonhierarchical-clustering.html#cb519-42"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">diff_distance =</span> <span class="kw">pmax</span>(distance <span class="op">-</span><span class="st"> </span>distance_new, <span class="dv">0</span>))</span>
<span id="cb519-43"><a href="nonhierarchical-clustering.html#cb519-43"></a>    </span>
<span id="cb519-44"><a href="nonhierarchical-clustering.html#cb519-44"></a>    <span class="co"># 거리 감소량이 가장 큰 객체 선택</span></span>
<span id="cb519-45"><a href="nonhierarchical-clustering.html#cb519-45"></a>    m &lt;-<span class="st"> </span>C_ji <span class="op">%&gt;%</span></span>
<span id="cb519-46"><a href="nonhierarchical-clustering.html#cb519-46"></a><span class="st">      </span><span class="kw">group_by</span>(i) <span class="op">%&gt;%</span></span>
<span id="cb519-47"><a href="nonhierarchical-clustering.html#cb519-47"></a><span class="st">      </span><span class="kw">summarize</span>(<span class="dt">total_diff_distance =</span> <span class="kw">sum</span>(diff_distance)) <span class="op">%&gt;%</span></span>
<span id="cb519-48"><a href="nonhierarchical-clustering.html#cb519-48"></a><span class="st">      </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_diff_distance)) <span class="op">%&gt;%</span></span>
<span id="cb519-49"><a href="nonhierarchical-clustering.html#cb519-49"></a><span class="st">      </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb519-50"><a href="nonhierarchical-clustering.html#cb519-50"></a><span class="st">      </span>.<span class="op">$</span>i</span>
<span id="cb519-51"><a href="nonhierarchical-clustering.html#cb519-51"></a>    </span>
<span id="cb519-52"><a href="nonhierarchical-clustering.html#cb519-52"></a>    <span class="co"># 대표객체에 추가</span></span>
<span id="cb519-53"><a href="nonhierarchical-clustering.html#cb519-53"></a>    medoids_ids &lt;-<span class="st"> </span><span class="kw">c</span>(medoids_ids, m)</span>
<span id="cb519-54"><a href="nonhierarchical-clustering.html#cb519-54"></a>  }</span>
<span id="cb519-55"><a href="nonhierarchical-clustering.html#cb519-55"></a>  </span>
<span id="cb519-56"><a href="nonhierarchical-clustering.html#cb519-56"></a>  <span class="kw">return</span>(medoids_ids)</span>
<span id="cb519-57"><a href="nonhierarchical-clustering.html#cb519-57"></a>}</span>
<span id="cb519-58"><a href="nonhierarchical-clustering.html#cb519-58"></a></span>
<span id="cb519-59"><a href="nonhierarchical-clustering.html#cb519-59"></a><span class="co"># 교환 후 각 객체와 대표 객체와의 거리</span></span>
<span id="cb519-60"><a href="nonhierarchical-clustering.html#cb519-60"></a>update_distance &lt;-<span class="st"> </span><span class="cf">function</span>(i, h, distance_df, medoids_ids) {</span>
<span id="cb519-61"><a href="nonhierarchical-clustering.html#cb519-61"></a>  new_medoids_ids &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">setdiff</span>(medoids_ids, i), h)</span>
<span id="cb519-62"><a href="nonhierarchical-clustering.html#cb519-62"></a></span>
<span id="cb519-63"><a href="nonhierarchical-clustering.html#cb519-63"></a>  res &lt;-<span class="st"> </span><span class="kw">distance_from_medoids</span>(distance_df, new_medoids_ids) <span class="op">%&gt;%</span></span>
<span id="cb519-64"><a href="nonhierarchical-clustering.html#cb519-64"></a><span class="st">    </span><span class="kw">filter</span>(j <span class="op">!=</span><span class="st"> </span>h) <span class="op">%&gt;%</span></span>
<span id="cb519-65"><a href="nonhierarchical-clustering.html#cb519-65"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb519-66"><a href="nonhierarchical-clustering.html#cb519-66"></a>      <span class="dt">i =</span> i,</span>
<span id="cb519-67"><a href="nonhierarchical-clustering.html#cb519-67"></a>      <span class="dt">h =</span> h</span>
<span id="cb519-68"><a href="nonhierarchical-clustering.html#cb519-68"></a>    )</span>
<span id="cb519-69"><a href="nonhierarchical-clustering.html#cb519-69"></a></span>
<span id="cb519-70"><a href="nonhierarchical-clustering.html#cb519-70"></a>  <span class="kw">return</span>(res)</span>
<span id="cb519-71"><a href="nonhierarchical-clustering.html#cb519-71"></a>}</span>
<span id="cb519-72"><a href="nonhierarchical-clustering.html#cb519-72"></a></span>
<span id="cb519-73"><a href="nonhierarchical-clustering.html#cb519-73"></a><span class="co"># 교환할 medoid 선택</span></span>
<span id="cb519-74"><a href="nonhierarchical-clustering.html#cb519-74"></a>swap_medoids &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, medoids_ids) {</span>
<span id="cb519-75"><a href="nonhierarchical-clustering.html#cb519-75"></a>  observation_ids &lt;-<span class="st"> </span><span class="kw">unique</span>(distance_df<span class="op">$</span>item1)</span>
<span id="cb519-76"><a href="nonhierarchical-clustering.html#cb519-76"></a>  </span>
<span id="cb519-77"><a href="nonhierarchical-clustering.html#cb519-77"></a>  <span class="co"># 교환 전 각 객체와 대표 객체와의 거리</span></span>
<span id="cb519-78"><a href="nonhierarchical-clustering.html#cb519-78"></a>  D_j &lt;-<span class="st"> </span><span class="kw">distance_from_medoids</span>(distance_df, medoids_ids)</span>
<span id="cb519-79"><a href="nonhierarchical-clustering.html#cb519-79"></a>  </span>
<span id="cb519-80"><a href="nonhierarchical-clustering.html#cb519-80"></a>  <span class="co"># 교환할 객체</span></span>
<span id="cb519-81"><a href="nonhierarchical-clustering.html#cb519-81"></a>  swap_ids &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb519-82"><a href="nonhierarchical-clustering.html#cb519-82"></a>    <span class="dt">i =</span> <span class="kw">rep</span>(medoids_ids, </span>
<span id="cb519-83"><a href="nonhierarchical-clustering.html#cb519-83"></a>            <span class="dt">each =</span> <span class="kw">length</span>(observation_ids) <span class="op">-</span><span class="st"> </span><span class="kw">length</span>(medoids_ids)),</span>
<span id="cb519-84"><a href="nonhierarchical-clustering.html#cb519-84"></a>    <span class="dt">h =</span> <span class="kw">rep</span>(<span class="kw">setdiff</span>(observation_ids, medoids_ids), </span>
<span id="cb519-85"><a href="nonhierarchical-clustering.html#cb519-85"></a>            <span class="kw">length</span>(medoids_ids))</span>
<span id="cb519-86"><a href="nonhierarchical-clustering.html#cb519-86"></a>  )</span>
<span id="cb519-87"><a href="nonhierarchical-clustering.html#cb519-87"></a>  </span>
<span id="cb519-88"><a href="nonhierarchical-clustering.html#cb519-88"></a>  D_jih &lt;-<span class="st"> </span><span class="kw">pmap_dfr</span>(</span>
<span id="cb519-89"><a href="nonhierarchical-clustering.html#cb519-89"></a>    swap_ids, </span>
<span id="cb519-90"><a href="nonhierarchical-clustering.html#cb519-90"></a>    update_distance,</span>
<span id="cb519-91"><a href="nonhierarchical-clustering.html#cb519-91"></a>    <span class="dt">distance_df =</span> distance_df,</span>
<span id="cb519-92"><a href="nonhierarchical-clustering.html#cb519-92"></a>    <span class="dt">medoids_ids =</span> medoids_ids</span>
<span id="cb519-93"><a href="nonhierarchical-clustering.html#cb519-93"></a>  )</span>
<span id="cb519-94"><a href="nonhierarchical-clustering.html#cb519-94"></a>  </span>
<span id="cb519-95"><a href="nonhierarchical-clustering.html#cb519-95"></a>  <span class="co"># 거리의 변화량</span></span>
<span id="cb519-96"><a href="nonhierarchical-clustering.html#cb519-96"></a>  C_jih &lt;-<span class="st"> </span>D_j <span class="op">%&gt;%</span></span>
<span id="cb519-97"><a href="nonhierarchical-clustering.html#cb519-97"></a><span class="st">    </span><span class="kw">inner_join</span>(D_jih, <span class="dt">by =</span> <span class="st">&quot;j&quot;</span>, <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_new&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb519-98"><a href="nonhierarchical-clustering.html#cb519-98"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">diff_distance =</span> distance_new <span class="op">-</span><span class="st"> </span>distance)</span>
<span id="cb519-99"><a href="nonhierarchical-clustering.html#cb519-99"></a>  </span>
<span id="cb519-100"><a href="nonhierarchical-clustering.html#cb519-100"></a>  T_ih &lt;-<span class="st"> </span>C_jih <span class="op">%&gt;%</span></span>
<span id="cb519-101"><a href="nonhierarchical-clustering.html#cb519-101"></a><span class="st">    </span><span class="kw">group_by</span>(i, h) <span class="op">%&gt;%</span></span>
<span id="cb519-102"><a href="nonhierarchical-clustering.html#cb519-102"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">total_diff_distance =</span> <span class="kw">sum</span>(diff_distance))</span>
<span id="cb519-103"><a href="nonhierarchical-clustering.html#cb519-103"></a>  </span>
<span id="cb519-104"><a href="nonhierarchical-clustering.html#cb519-104"></a>  swap_ih &lt;-<span class="st"> </span>T_ih <span class="op">%&gt;%</span></span>
<span id="cb519-105"><a href="nonhierarchical-clustering.html#cb519-105"></a><span class="st">    </span><span class="kw">filter</span>(total_diff_distance <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb519-106"><a href="nonhierarchical-clustering.html#cb519-106"></a><span class="st">    </span><span class="kw">arrange</span>(total_diff_distance) <span class="op">%&gt;%</span></span>
<span id="cb519-107"><a href="nonhierarchical-clustering.html#cb519-107"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>)</span>
<span id="cb519-108"><a href="nonhierarchical-clustering.html#cb519-108"></a>  </span>
<span id="cb519-109"><a href="nonhierarchical-clustering.html#cb519-109"></a>  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">remove =</span> swap_ih<span class="op">$</span>i, <span class="dt">add =</span> swap_ih<span class="op">$</span>h))</span>
<span id="cb519-110"><a href="nonhierarchical-clustering.html#cb519-110"></a>}</span>
<span id="cb519-111"><a href="nonhierarchical-clustering.html#cb519-111"></a></span>
<span id="cb519-112"><a href="nonhierarchical-clustering.html#cb519-112"></a><span class="co"># 전체 PAM 알고리즘</span></span>
<span id="cb519-113"><a href="nonhierarchical-clustering.html#cb519-113"></a>pam_medoids &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, <span class="dt">k =</span> 1L) {</span>
<span id="cb519-114"><a href="nonhierarchical-clustering.html#cb519-114"></a>  <span class="co"># BUILD</span></span>
<span id="cb519-115"><a href="nonhierarchical-clustering.html#cb519-115"></a>  medoids_ids &lt;-<span class="st"> </span><span class="kw">build_medoids</span>(distance_df, k)</span>
<span id="cb519-116"><a href="nonhierarchical-clustering.html#cb519-116"></a>  k &lt;-<span class="st"> </span><span class="kw">length</span>(medoids_ids)</span>
<span id="cb519-117"><a href="nonhierarchical-clustering.html#cb519-117"></a>  </span>
<span id="cb519-118"><a href="nonhierarchical-clustering.html#cb519-118"></a>  <span class="co"># SWAP</span></span>
<span id="cb519-119"><a href="nonhierarchical-clustering.html#cb519-119"></a>  <span class="cf">while</span> (<span class="ot">TRUE</span>) {</span>
<span id="cb519-120"><a href="nonhierarchical-clustering.html#cb519-120"></a>    swap_medoids &lt;-<span class="st"> </span><span class="kw">swap_medoids</span>(distance_df, medoids_ids)</span>
<span id="cb519-121"><a href="nonhierarchical-clustering.html#cb519-121"></a>    <span class="cf">if</span> (<span class="kw">is_empty</span>(swap_medoids<span class="op">$</span>remove)) {</span>
<span id="cb519-122"><a href="nonhierarchical-clustering.html#cb519-122"></a>      <span class="cf">break</span></span>
<span id="cb519-123"><a href="nonhierarchical-clustering.html#cb519-123"></a>    } <span class="cf">else</span> {</span>
<span id="cb519-124"><a href="nonhierarchical-clustering.html#cb519-124"></a>      medoids_ids &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb519-125"><a href="nonhierarchical-clustering.html#cb519-125"></a>        <span class="kw">setdiff</span>(medoids_ids, swap_medoids<span class="op">$</span>remove),</span>
<span id="cb519-126"><a href="nonhierarchical-clustering.html#cb519-126"></a>        swap_medoids<span class="op">$</span>add</span>
<span id="cb519-127"><a href="nonhierarchical-clustering.html#cb519-127"></a>      )</span>
<span id="cb519-128"><a href="nonhierarchical-clustering.html#cb519-128"></a>    }</span>
<span id="cb519-129"><a href="nonhierarchical-clustering.html#cb519-129"></a>  }</span>
<span id="cb519-130"><a href="nonhierarchical-clustering.html#cb519-130"></a>  </span>
<span id="cb519-131"><a href="nonhierarchical-clustering.html#cb519-131"></a>  <span class="kw">return</span> (medoids_ids)</span>
<span id="cb519-132"><a href="nonhierarchical-clustering.html#cb519-132"></a>}</span></code></pre></div>
<p>위 구현한 함수를 이용하여 아래와 같이 PAM을 실행해보자.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="nonhierarchical-clustering.html#cb520-1"></a>pairwise_distance_df &lt;-<span class="st"> </span><span class="kw">dist</span>(df[, <span class="dv">-1</span>], <span class="dt">upper =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb520-2"><a href="nonhierarchical-clustering.html#cb520-2"></a><span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb520-3"><a href="nonhierarchical-clustering.html#cb520-3"></a><span class="st">  </span><span class="kw">mutate_if</span>(is.factor, <span class="op">~</span><span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(.)))</span>
<span id="cb520-4"><a href="nonhierarchical-clustering.html#cb520-4"></a></span>
<span id="cb520-5"><a href="nonhierarchical-clustering.html#cb520-5"></a>medoids_ids &lt;-<span class="st"> </span><span class="kw">pam_medoids</span>(pairwise_distance_df, <span class="dt">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;i&#39; (override with `.groups` argument)
## `summarise()` regrouping output by &#39;i&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="nonhierarchical-clustering.html#cb523-1"></a>df[medoids_ids, ]</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##      id    x1    x2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     2     5     4
## 2     5    14     6</code></pre>
<p>위와 같이 2개의 대표객체 2, 5가 선정된다.</p>
<p>최종 군집해는 각 객체를 가장 가까운 대표객체가 속한 군집에 할당함으로써 얻어진다.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="nonhierarchical-clustering.html#cb525-1"></a>assign_cluster &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, medoids_ids) {</span>
<span id="cb525-2"><a href="nonhierarchical-clustering.html#cb525-2"></a>  distance_df <span class="op">%&gt;%</span></span>
<span id="cb525-3"><a href="nonhierarchical-clustering.html#cb525-3"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb525-4"><a href="nonhierarchical-clustering.html#cb525-4"></a>      <span class="op">!</span>item1 <span class="op">%in%</span><span class="st"> </span>medoids_ids,</span>
<span id="cb525-5"><a href="nonhierarchical-clustering.html#cb525-5"></a>      item2 <span class="op">%in%</span><span class="st"> </span>medoids_ids</span>
<span id="cb525-6"><a href="nonhierarchical-clustering.html#cb525-6"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb525-7"><a href="nonhierarchical-clustering.html#cb525-7"></a><span class="st">    </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb525-8"><a href="nonhierarchical-clustering.html#cb525-8"></a><span class="st">    </span><span class="kw">arrange</span>(distance) <span class="op">%&gt;%</span></span>
<span id="cb525-9"><a href="nonhierarchical-clustering.html#cb525-9"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb525-10"><a href="nonhierarchical-clustering.html#cb525-10"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb525-11"><a href="nonhierarchical-clustering.html#cb525-11"></a><span class="st">    </span><span class="kw">bind_rows</span>(</span>
<span id="cb525-12"><a href="nonhierarchical-clustering.html#cb525-12"></a>      <span class="kw">tibble</span>(</span>
<span id="cb525-13"><a href="nonhierarchical-clustering.html#cb525-13"></a>        <span class="dt">item1 =</span> medoids_ids,</span>
<span id="cb525-14"><a href="nonhierarchical-clustering.html#cb525-14"></a>        <span class="dt">item2 =</span> medoids_ids,</span>
<span id="cb525-15"><a href="nonhierarchical-clustering.html#cb525-15"></a>        <span class="dt">distance =</span> <span class="dv">0</span></span>
<span id="cb525-16"><a href="nonhierarchical-clustering.html#cb525-16"></a>      )</span>
<span id="cb525-17"><a href="nonhierarchical-clustering.html#cb525-17"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb525-18"><a href="nonhierarchical-clustering.html#cb525-18"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">object =</span> item1) <span class="op">%&gt;%</span></span>
<span id="cb525-19"><a href="nonhierarchical-clustering.html#cb525-19"></a><span class="st">    </span><span class="kw">arrange</span>(object) <span class="op">%&gt;%</span></span>
<span id="cb525-20"><a href="nonhierarchical-clustering.html#cb525-20"></a><span class="st">    </span><span class="kw">group_by</span>(item2) <span class="op">%&gt;%</span></span>
<span id="cb525-21"><a href="nonhierarchical-clustering.html#cb525-21"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">cluster =</span> <span class="kw">str_c</span>(<span class="st">&quot;{&quot;</span>, <span class="kw">str_c</span>(object, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;}&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb525-22"><a href="nonhierarchical-clustering.html#cb525-22"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb525-23"><a href="nonhierarchical-clustering.html#cb525-23"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>item2)</span>
<span id="cb525-24"><a href="nonhierarchical-clustering.html#cb525-24"></a>}</span>
<span id="cb525-25"><a href="nonhierarchical-clustering.html#cb525-25"></a></span>
<span id="cb525-26"><a href="nonhierarchical-clustering.html#cb525-26"></a><span class="kw">assign_cluster</span>(pairwise_distance_df, medoids_ids)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   object distance cluster     
##    &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;       
## 1      1     2.24 {1, 2}      
## 2      2     0    {1, 2}      
## 3      3     3.61 {3, 4, 5, 6}
## 4      4     1    {3, 4, 5, 6}
## 5      5     0    {3, 4, 5, 6}
## 6      6     1.41 {3, 4, 5, 6}</code></pre>
</div>
</div>
<div id="clara" class="section level3">
<h3><span class="header-section-number">13.3.2</span> CLARA 알고리즘</h3>
<p>PAM 알고리즘은 SWAP 부분에서 모든 가능한 경우를 고려하기 때문에, 전체 객체 수가 많은 경우 계산 시간이 매우 길다는 단점이 있다. 이를 보완하기 위해 CLARA는 적절한 수의 객체를 샘플링한 후 이들에 대해 PAM 알고리즘을 적용하여 중심객체를 선정하는 방법이다. 이러한 샘플링을 여러 번 한 후, 이 중 가장 좋은 결과를 택하는 것인데, 반복수는 5번으로 충분한 것으로 분석되고 있다.</p>
<p>자세한 내용은 교재 <span class="citation">(전치혁 <a href="#ref-jun2012datamining" role="doc-biblioref">2012</a>)</span> 참조</p>
<div id="clara-basic-script" class="section level4">
<h4><span class="header-section-number">13.3.2.1</span> 기본 R 스크립트</h4>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="nonhierarchical-clustering.html#cb527-1"></a>clara_solution &lt;-<span class="st"> </span>cluster<span class="op">::</span><span class="kw">clara</span>(df[, <span class="dv">-1</span>], <span class="dt">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>얻어진 <code>clara</code> 객체의 원소 <code>i.med</code>는 몇 번째 객체가 군집의 대표객체로 선정되었는지를 나타낸다.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="nonhierarchical-clustering.html#cb528-1"></a>clara_solution<span class="op">$</span>i.med</span></code></pre></div>
<pre><code>## [1] 2 5</code></pre>
<p>또한 <code>clara</code> 객체의 원소 <code>clustering</code>은 각 객체가 어떠한 군집에 할당되었는지를 보여준다.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="nonhierarchical-clustering.html#cb530-1"></a>clara_solution<span class="op">$</span>clustering</span></code></pre></div>
<pre><code>## [1] 1 1 2 2 2 2</code></pre>
</div>
</div>
<div id="clarans" class="section level3">
<h3><span class="header-section-number">13.3.3</span> CLARANS 알고리즘</h3>
<p>교재 <span class="citation">(전치혁 <a href="#ref-jun2012datamining" role="doc-biblioref">2012</a>)</span> 참조</p>
</div>
<div id="kmeans-like" class="section level3">
<h3><span class="header-section-number">13.3.4</span> K-means-like 알고리즘</h3>
<p>본 알고리즘은 PAM 알고리즘의 단점을 보완하고자 <span class="citation">Park and Jun (<a href="#ref-park2009simple" role="doc-biblioref">2009</a>)</span> 에 의해 제안된 것으로, 대표객체를 반복적으로 수정하는데 K-means 알고리즘의 작동 원리를 모방한 K-medoids 군집 방법이다. 따라서 간단하며 계산 시간이 빠른 것이 장점이라 하겠다. 이 알고리즘은 다음과 같이 3단계로 구성되어 있다. 알고리즘의 각 단계를 Table <a href="nonhierarchical-clustering.html#tab:pam-train-data">13.2</a>의 예제 데이터에 적용하여 살펴보기로 하자.</p>
<p><strong>[단계 1]</strong> (초기 대표객체 선정) <span class="math inline">\(K\)</span>개의 초기 대표객체를 선정하며, 각 객체를 가장 가까운 대표객체에 배정하여 초기 군집해를 얻는다.</p>
<p>객체들 간의 거리 <span class="math inline">\(d(i, j), \, i, j = 1, \cdots, n\)</span>를 구한다.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="nonhierarchical-clustering.html#cb532-1"></a>pairwise_distance_df &lt;-<span class="st"> </span><span class="kw">dist</span>(df[, <span class="dv">-1</span>], <span class="dt">upper =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb532-2"><a href="nonhierarchical-clustering.html#cb532-2"></a><span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb532-3"><a href="nonhierarchical-clustering.html#cb532-3"></a><span class="st">  </span><span class="kw">mutate_if</span>(is.factor, <span class="op">~</span><span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(.)))</span></code></pre></div>
<p>각 객체 <span class="math inline">\(j = 1, \cdots, n\)</span>에 대하여 다음을 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
v_j = \sum_{i = 1}^{n} \frac{d(i, j)}{\sum_{k = 1}^{n} d(i, k)}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="nonhierarchical-clustering.html#cb533-1"></a>v_j &lt;-<span class="st"> </span>pairwise_distance_df <span class="op">%&gt;%</span></span>
<span id="cb533-2"><a href="nonhierarchical-clustering.html#cb533-2"></a><span class="st">  </span><span class="kw">group_by</span>(item2) <span class="op">%&gt;%</span></span>
<span id="cb533-3"><a href="nonhierarchical-clustering.html#cb533-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> distance <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(distance)) <span class="op">%&gt;%</span></span>
<span id="cb533-4"><a href="nonhierarchical-clustering.html#cb533-4"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb533-5"><a href="nonhierarchical-clustering.html#cb533-5"></a><span class="st">  </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb533-6"><a href="nonhierarchical-clustering.html#cb533-6"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_prop =</span> <span class="kw">sum</span>(prop)) <span class="op">%&gt;%</span></span>
<span id="cb533-7"><a href="nonhierarchical-clustering.html#cb533-7"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">j =</span> item1)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="nonhierarchical-clustering.html#cb535-1"></a>v_j</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##       j sum_prop
##   &lt;int&gt;    &lt;dbl&gt;
## 1     1    1.67 
## 2     2    1.33 
## 3     3    0.781
## 4     4    0.661
## 5     5    0.713
## 6     6    0.849</code></pre>
<p>이후 <span class="math inline">\(v_j\)</span>값들을 오름차순으로 정렬하여 가장 작은 <span class="math inline">\(K\)</span>개의 값을 초기 대표객체로 선정한다. 본 예에서는 <span class="math inline">\(K = 2\)</span>로 가정하자.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="nonhierarchical-clustering.html#cb537-1"></a>medoids_ids &lt;-<span class="st"> </span>v_j <span class="op">%&gt;%</span></span>
<span id="cb537-2"><a href="nonhierarchical-clustering.html#cb537-2"></a><span class="st">  </span><span class="kw">arrange</span>(sum_prop) <span class="op">%&gt;%</span></span>
<span id="cb537-3"><a href="nonhierarchical-clustering.html#cb537-3"></a><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb537-4"><a href="nonhierarchical-clustering.html#cb537-4"></a><span class="st">  </span>.<span class="op">$</span>j</span>
<span id="cb537-5"><a href="nonhierarchical-clustering.html#cb537-5"></a></span>
<span id="cb537-6"><a href="nonhierarchical-clustering.html#cb537-6"></a>medoids_ids</span></code></pre></div>
<pre><code>## [1] 4 5</code></pre>
<p>이후 객체를 배정하여 군집해를 얻는다. 위에서 정의했던 <code>assign_cluster</code> 함수를 재사용하자.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="nonhierarchical-clustering.html#cb539-1"></a>cluster_solution &lt;-<span class="st"> </span><span class="kw">assign_cluster</span>(</span>
<span id="cb539-2"><a href="nonhierarchical-clustering.html#cb539-2"></a>  pairwise_distance_df, </span>
<span id="cb539-3"><a href="nonhierarchical-clustering.html#cb539-3"></a>  medoids_ids</span>
<span id="cb539-4"><a href="nonhierarchical-clustering.html#cb539-4"></a>  )</span>
<span id="cb539-5"><a href="nonhierarchical-clustering.html#cb539-5"></a></span>
<span id="cb539-6"><a href="nonhierarchical-clustering.html#cb539-6"></a>cluster_solution</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   object distance cluster     
##    &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;       
## 1      1    10.4  {1, 2, 3, 4}
## 2      2     8.25 {1, 2, 3, 4}
## 3      3     2.83 {1, 2, 3, 4}
## 4      4     0    {1, 2, 3, 4}
## 5      5     0    {5, 6}      
## 6      6     1.41 {5, 6}</code></pre>
<p><strong>[단계 2]</strong> (대표객체의 수정) 현재의 군집에 배정된 객체들의 대표객체를 구하여 새로운 대표객체로 삼는다. 새로운 대표객체는 같은 군집에 배정된 다른 객체들로부터의 거리의 합이 최소가 되는 객체이다.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="nonhierarchical-clustering.html#cb541-1"></a>find_medoids &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, ids) {</span>
<span id="cb541-2"><a href="nonhierarchical-clustering.html#cb541-2"></a>  distance_df <span class="op">%&gt;%</span></span>
<span id="cb541-3"><a href="nonhierarchical-clustering.html#cb541-3"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb541-4"><a href="nonhierarchical-clustering.html#cb541-4"></a>      item1 <span class="op">%in%</span><span class="st"> </span>ids, </span>
<span id="cb541-5"><a href="nonhierarchical-clustering.html#cb541-5"></a>      item2 <span class="op">%in%</span><span class="st"> </span>ids</span>
<span id="cb541-6"><a href="nonhierarchical-clustering.html#cb541-6"></a>      ) <span class="op">%&gt;%</span></span>
<span id="cb541-7"><a href="nonhierarchical-clustering.html#cb541-7"></a><span class="st">    </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb541-8"><a href="nonhierarchical-clustering.html#cb541-8"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">total_distance =</span> <span class="kw">sum</span>(distance)) <span class="op">%&gt;%</span></span>
<span id="cb541-9"><a href="nonhierarchical-clustering.html#cb541-9"></a><span class="st">    </span><span class="kw">arrange</span>(total_distance) <span class="op">%&gt;%</span></span>
<span id="cb541-10"><a href="nonhierarchical-clustering.html#cb541-10"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb541-11"><a href="nonhierarchical-clustering.html#cb541-11"></a><span class="st">    </span>.<span class="op">$</span>item1</span>
<span id="cb541-12"><a href="nonhierarchical-clustering.html#cb541-12"></a>}</span>
<span id="cb541-13"><a href="nonhierarchical-clustering.html#cb541-13"></a></span>
<span id="cb541-14"><a href="nonhierarchical-clustering.html#cb541-14"></a>cluster_objects &lt;-<span class="st"> </span>cluster_solution <span class="op">%&gt;%</span></span>
<span id="cb541-15"><a href="nonhierarchical-clustering.html#cb541-15"></a><span class="st">  </span><span class="kw">split</span>(.<span class="op">$</span>cluster) <span class="op">%&gt;%</span></span>
<span id="cb541-16"><a href="nonhierarchical-clustering.html#cb541-16"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span>.<span class="op">$</span>object)</span>
<span id="cb541-17"><a href="nonhierarchical-clustering.html#cb541-17"></a></span>
<span id="cb541-18"><a href="nonhierarchical-clustering.html#cb541-18"></a>medoids_ids &lt;-<span class="st"> </span><span class="kw">map_int</span>(</span>
<span id="cb541-19"><a href="nonhierarchical-clustering.html#cb541-19"></a>  cluster_objects, </span>
<span id="cb541-20"><a href="nonhierarchical-clustering.html#cb541-20"></a>  find_medoids,</span>
<span id="cb541-21"><a href="nonhierarchical-clustering.html#cb541-21"></a>  <span class="dt">distance_df =</span> pairwise_distance_df</span>
<span id="cb541-22"><a href="nonhierarchical-clustering.html#cb541-22"></a>)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="nonhierarchical-clustering.html#cb543-1"></a>medoids_ids</span></code></pre></div>
<pre><code>## {1, 2, 3, 4}       {5, 6} 
##            2            5</code></pre>
<p><strong>[단계 3]</strong> (객체의 배정) 각 객체를 가장 가까운 대표객체에 배정하여 군집해를 얻는다. 군집해가 이전과 동일하면 Stop하고, 그렇지 않으면 [단계 2]를 반복한다.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="nonhierarchical-clustering.html#cb545-1"></a>new_cluster_solution &lt;-<span class="st"> </span><span class="kw">assign_cluster</span>(</span>
<span id="cb545-2"><a href="nonhierarchical-clustering.html#cb545-2"></a>  pairwise_distance_df, </span>
<span id="cb545-3"><a href="nonhierarchical-clustering.html#cb545-3"></a>  medoids_ids</span>
<span id="cb545-4"><a href="nonhierarchical-clustering.html#cb545-4"></a>  )</span>
<span id="cb545-5"><a href="nonhierarchical-clustering.html#cb545-5"></a></span>
<span id="cb545-6"><a href="nonhierarchical-clustering.html#cb545-6"></a>is_converge &lt;-<span class="st"> </span><span class="kw">near</span>(</span>
<span id="cb545-7"><a href="nonhierarchical-clustering.html#cb545-7"></a>  <span class="dv">1</span>, </span>
<span id="cb545-8"><a href="nonhierarchical-clustering.html#cb545-8"></a>  <span class="co"># clusteval::cluster_similarity(</span></span>
<span id="cb545-9"><a href="nonhierarchical-clustering.html#cb545-9"></a>  <span class="co">#   as.factor(cluster_solution$cluster),</span></span>
<span id="cb545-10"><a href="nonhierarchical-clustering.html#cb545-10"></a>  <span class="co">#   as.factor(new_cluster_solution$cluster),</span></span>
<span id="cb545-11"><a href="nonhierarchical-clustering.html#cb545-11"></a>  <span class="co">#   similarity = &quot;rand&quot;</span></span>
<span id="cb545-12"><a href="nonhierarchical-clustering.html#cb545-12"></a>  <span class="co"># )</span></span>
<span id="cb545-13"><a href="nonhierarchical-clustering.html#cb545-13"></a>  flexclust<span class="op">::</span><span class="kw">randIndex</span>(</span>
<span id="cb545-14"><a href="nonhierarchical-clustering.html#cb545-14"></a>    <span class="kw">as.factor</span>(cluster_solution<span class="op">$</span>cluster),</span>
<span id="cb545-15"><a href="nonhierarchical-clustering.html#cb545-15"></a>    <span class="kw">as.factor</span>(new_cluster_solution<span class="op">$</span>cluster)</span>
<span id="cb545-16"><a href="nonhierarchical-clustering.html#cb545-16"></a>  )</span>
<span id="cb545-17"><a href="nonhierarchical-clustering.html#cb545-17"></a>)</span>
<span id="cb545-18"><a href="nonhierarchical-clustering.html#cb545-18"></a></span>
<span id="cb545-19"><a href="nonhierarchical-clustering.html#cb545-19"></a><span class="kw">print</span>(is_converge)</span></code></pre></div>
<pre><code>##   ARI 
## FALSE</code></pre>
<p>위의 경우 첫 번째 iteration에서 군집해가 수정되었으므로 다음 iteration을 수행한다.</p>
<div id="kmeans-like-user-defined-functions" class="section level4">
<h4><span class="header-section-number">13.3.4.1</span> R 스크립트 구현</h4>
<p>위 일련의 과정들을 수행하는 R 함수 스크립트를 구현해보자.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="nonhierarchical-clustering.html#cb547-1"></a>init_medoids &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, <span class="dt">k =</span> <span class="dv">1</span>) {</span>
<span id="cb547-2"><a href="nonhierarchical-clustering.html#cb547-2"></a>  object_ids &lt;-<span class="st"> </span><span class="kw">unique</span>(distance_df<span class="op">$</span>item1)</span>
<span id="cb547-3"><a href="nonhierarchical-clustering.html#cb547-3"></a>  k &lt;-<span class="st"> </span><span class="kw">min</span>(k, <span class="kw">length</span>(object_ids))</span>
<span id="cb547-4"><a href="nonhierarchical-clustering.html#cb547-4"></a>  </span>
<span id="cb547-5"><a href="nonhierarchical-clustering.html#cb547-5"></a>  v_j &lt;-<span class="st"> </span>distance_df <span class="op">%&gt;%</span></span>
<span id="cb547-6"><a href="nonhierarchical-clustering.html#cb547-6"></a><span class="st">    </span><span class="kw">group_by</span>(item2) <span class="op">%&gt;%</span></span>
<span id="cb547-7"><a href="nonhierarchical-clustering.html#cb547-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">prop =</span> distance <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(distance)) <span class="op">%&gt;%</span></span>
<span id="cb547-8"><a href="nonhierarchical-clustering.html#cb547-8"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb547-9"><a href="nonhierarchical-clustering.html#cb547-9"></a><span class="st">    </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb547-10"><a href="nonhierarchical-clustering.html#cb547-10"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">sum_prop =</span> <span class="kw">sum</span>(prop)) <span class="op">%&gt;%</span></span>
<span id="cb547-11"><a href="nonhierarchical-clustering.html#cb547-11"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">j =</span> item1)</span>
<span id="cb547-12"><a href="nonhierarchical-clustering.html#cb547-12"></a>  </span>
<span id="cb547-13"><a href="nonhierarchical-clustering.html#cb547-13"></a>  medoids_ids &lt;-<span class="st"> </span>v_j <span class="op">%&gt;%</span></span>
<span id="cb547-14"><a href="nonhierarchical-clustering.html#cb547-14"></a><span class="st">    </span><span class="kw">arrange</span>(sum_prop) <span class="op">%&gt;%</span></span>
<span id="cb547-15"><a href="nonhierarchical-clustering.html#cb547-15"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>k) <span class="op">%&gt;%</span></span>
<span id="cb547-16"><a href="nonhierarchical-clustering.html#cb547-16"></a><span class="st">    </span>.<span class="op">$</span>j</span>
<span id="cb547-17"><a href="nonhierarchical-clustering.html#cb547-17"></a>  </span>
<span id="cb547-18"><a href="nonhierarchical-clustering.html#cb547-18"></a>  <span class="kw">return</span>(medoids_ids)</span>
<span id="cb547-19"><a href="nonhierarchical-clustering.html#cb547-19"></a>}</span>
<span id="cb547-20"><a href="nonhierarchical-clustering.html#cb547-20"></a></span>
<span id="cb547-21"><a href="nonhierarchical-clustering.html#cb547-21"></a>assign_cluster &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, medoids_ids) {</span>
<span id="cb547-22"><a href="nonhierarchical-clustering.html#cb547-22"></a>  distance_df <span class="op">%&gt;%</span></span>
<span id="cb547-23"><a href="nonhierarchical-clustering.html#cb547-23"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb547-24"><a href="nonhierarchical-clustering.html#cb547-24"></a>      <span class="op">!</span>item1 <span class="op">%in%</span><span class="st"> </span>medoids_ids,</span>
<span id="cb547-25"><a href="nonhierarchical-clustering.html#cb547-25"></a>      item2 <span class="op">%in%</span><span class="st"> </span>medoids_ids</span>
<span id="cb547-26"><a href="nonhierarchical-clustering.html#cb547-26"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb547-27"><a href="nonhierarchical-clustering.html#cb547-27"></a><span class="st">    </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb547-28"><a href="nonhierarchical-clustering.html#cb547-28"></a><span class="st">    </span><span class="kw">arrange</span>(distance) <span class="op">%&gt;%</span></span>
<span id="cb547-29"><a href="nonhierarchical-clustering.html#cb547-29"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb547-30"><a href="nonhierarchical-clustering.html#cb547-30"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb547-31"><a href="nonhierarchical-clustering.html#cb547-31"></a><span class="st">    </span><span class="kw">bind_rows</span>(</span>
<span id="cb547-32"><a href="nonhierarchical-clustering.html#cb547-32"></a>      <span class="kw">tibble</span>(</span>
<span id="cb547-33"><a href="nonhierarchical-clustering.html#cb547-33"></a>        <span class="dt">item1 =</span> medoids_ids,</span>
<span id="cb547-34"><a href="nonhierarchical-clustering.html#cb547-34"></a>        <span class="dt">item2 =</span> medoids_ids,</span>
<span id="cb547-35"><a href="nonhierarchical-clustering.html#cb547-35"></a>        <span class="dt">distance =</span> <span class="dv">0</span></span>
<span id="cb547-36"><a href="nonhierarchical-clustering.html#cb547-36"></a>      )</span>
<span id="cb547-37"><a href="nonhierarchical-clustering.html#cb547-37"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb547-38"><a href="nonhierarchical-clustering.html#cb547-38"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">object =</span> item1) <span class="op">%&gt;%</span></span>
<span id="cb547-39"><a href="nonhierarchical-clustering.html#cb547-39"></a><span class="st">    </span><span class="kw">arrange</span>(object) <span class="op">%&gt;%</span></span>
<span id="cb547-40"><a href="nonhierarchical-clustering.html#cb547-40"></a><span class="st">    </span><span class="kw">group_by</span>(item2) <span class="op">%&gt;%</span></span>
<span id="cb547-41"><a href="nonhierarchical-clustering.html#cb547-41"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">cluster =</span> <span class="kw">str_c</span>(<span class="st">&quot;{&quot;</span>, <span class="kw">str_c</span>(object, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;}&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb547-42"><a href="nonhierarchical-clustering.html#cb547-42"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb547-43"><a href="nonhierarchical-clustering.html#cb547-43"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>item2)</span>
<span id="cb547-44"><a href="nonhierarchical-clustering.html#cb547-44"></a>}</span>
<span id="cb547-45"><a href="nonhierarchical-clustering.html#cb547-45"></a></span>
<span id="cb547-46"><a href="nonhierarchical-clustering.html#cb547-46"></a>find_medoids &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, ids) {</span>
<span id="cb547-47"><a href="nonhierarchical-clustering.html#cb547-47"></a>  distance_df <span class="op">%&gt;%</span></span>
<span id="cb547-48"><a href="nonhierarchical-clustering.html#cb547-48"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb547-49"><a href="nonhierarchical-clustering.html#cb547-49"></a>      item1 <span class="op">%in%</span><span class="st"> </span>ids, </span>
<span id="cb547-50"><a href="nonhierarchical-clustering.html#cb547-50"></a>      item2 <span class="op">%in%</span><span class="st"> </span>ids</span>
<span id="cb547-51"><a href="nonhierarchical-clustering.html#cb547-51"></a>      ) <span class="op">%&gt;%</span></span>
<span id="cb547-52"><a href="nonhierarchical-clustering.html#cb547-52"></a><span class="st">    </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></span>
<span id="cb547-53"><a href="nonhierarchical-clustering.html#cb547-53"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">total_distance =</span> <span class="kw">sum</span>(distance)) <span class="op">%&gt;%</span></span>
<span id="cb547-54"><a href="nonhierarchical-clustering.html#cb547-54"></a><span class="st">    </span><span class="kw">arrange</span>(total_distance) <span class="op">%&gt;%</span></span>
<span id="cb547-55"><a href="nonhierarchical-clustering.html#cb547-55"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb547-56"><a href="nonhierarchical-clustering.html#cb547-56"></a><span class="st">    </span>.<span class="op">$</span>item1</span>
<span id="cb547-57"><a href="nonhierarchical-clustering.html#cb547-57"></a>}</span>
<span id="cb547-58"><a href="nonhierarchical-clustering.html#cb547-58"></a></span>
<span id="cb547-59"><a href="nonhierarchical-clustering.html#cb547-59"></a>kmeans_like_kmedoids &lt;-<span class="st"> </span><span class="cf">function</span>(distance_df, <span class="dt">k =</span> <span class="dv">1</span>) {</span>
<span id="cb547-60"><a href="nonhierarchical-clustering.html#cb547-60"></a>  medoids_ids &lt;-<span class="st"> </span><span class="kw">init_medoids</span>(distance_df, k)</span>
<span id="cb547-61"><a href="nonhierarchical-clustering.html#cb547-61"></a>  </span>
<span id="cb547-62"><a href="nonhierarchical-clustering.html#cb547-62"></a>  <span class="cf">while</span> (<span class="ot">TRUE</span>) {</span>
<span id="cb547-63"><a href="nonhierarchical-clustering.html#cb547-63"></a>    cluster_solution &lt;-<span class="st"> </span><span class="kw">assign_cluster</span>(distance_df, medoids_ids)</span>
<span id="cb547-64"><a href="nonhierarchical-clustering.html#cb547-64"></a>    </span>
<span id="cb547-65"><a href="nonhierarchical-clustering.html#cb547-65"></a>    cluster_objects &lt;-<span class="st"> </span>cluster_solution <span class="op">%&gt;%</span></span>
<span id="cb547-66"><a href="nonhierarchical-clustering.html#cb547-66"></a><span class="st">      </span><span class="kw">split</span>(.<span class="op">$</span>cluster) <span class="op">%&gt;%</span></span>
<span id="cb547-67"><a href="nonhierarchical-clustering.html#cb547-67"></a><span class="st">      </span><span class="kw">map</span>(<span class="op">~</span>.<span class="op">$</span>object)</span>
<span id="cb547-68"><a href="nonhierarchical-clustering.html#cb547-68"></a>    </span>
<span id="cb547-69"><a href="nonhierarchical-clustering.html#cb547-69"></a>    medoids_ids &lt;-<span class="st"> </span><span class="kw">map_int</span>(</span>
<span id="cb547-70"><a href="nonhierarchical-clustering.html#cb547-70"></a>      cluster_objects, </span>
<span id="cb547-71"><a href="nonhierarchical-clustering.html#cb547-71"></a>      find_medoids,</span>
<span id="cb547-72"><a href="nonhierarchical-clustering.html#cb547-72"></a>      <span class="dt">distance_df =</span> distance_df</span>
<span id="cb547-73"><a href="nonhierarchical-clustering.html#cb547-73"></a>    )</span>
<span id="cb547-74"><a href="nonhierarchical-clustering.html#cb547-74"></a>    </span>
<span id="cb547-75"><a href="nonhierarchical-clustering.html#cb547-75"></a>    new_cluster_solution &lt;-<span class="st"> </span><span class="kw">assign_cluster</span>(distance_df, medoids_ids)</span>
<span id="cb547-76"><a href="nonhierarchical-clustering.html#cb547-76"></a>    </span>
<span id="cb547-77"><a href="nonhierarchical-clustering.html#cb547-77"></a>    is_converge &lt;-<span class="st"> </span><span class="kw">near</span>(</span>
<span id="cb547-78"><a href="nonhierarchical-clustering.html#cb547-78"></a>      <span class="dv">1</span>, </span>
<span id="cb547-79"><a href="nonhierarchical-clustering.html#cb547-79"></a>      flexclust<span class="op">::</span><span class="kw">randIndex</span>(</span>
<span id="cb547-80"><a href="nonhierarchical-clustering.html#cb547-80"></a>        <span class="kw">as.factor</span>(cluster_solution<span class="op">$</span>cluster),</span>
<span id="cb547-81"><a href="nonhierarchical-clustering.html#cb547-81"></a>        <span class="kw">as.factor</span>(new_cluster_solution<span class="op">$</span>cluster)</span>
<span id="cb547-82"><a href="nonhierarchical-clustering.html#cb547-82"></a>      )</span>
<span id="cb547-83"><a href="nonhierarchical-clustering.html#cb547-83"></a>    )</span>
<span id="cb547-84"><a href="nonhierarchical-clustering.html#cb547-84"></a>    </span>
<span id="cb547-85"><a href="nonhierarchical-clustering.html#cb547-85"></a>    <span class="cf">if</span> (is_converge) <span class="cf">break</span></span>
<span id="cb547-86"><a href="nonhierarchical-clustering.html#cb547-86"></a>  }</span>
<span id="cb547-87"><a href="nonhierarchical-clustering.html#cb547-87"></a>  </span>
<span id="cb547-88"><a href="nonhierarchical-clustering.html#cb547-88"></a>  <span class="kw">return</span>(medoids_ids)</span>
<span id="cb547-89"><a href="nonhierarchical-clustering.html#cb547-89"></a>}</span></code></pre></div>
<p>위에서 정의한 함수 <code>kmeans_like_kmedoids</code>를 Table <a href="nonhierarchical-clustering.html#tab:pam-train-data">13.2</a>의 데이터에 적용한 군집결과 및 군집 대표객체는 아래와 같이 얻어진다.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="nonhierarchical-clustering.html#cb548-1"></a>pairwise_distance_df &lt;-<span class="st"> </span><span class="kw">dist</span>(df[, <span class="dv">-1</span>], <span class="dt">upper =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb548-2"><a href="nonhierarchical-clustering.html#cb548-2"></a><span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb548-3"><a href="nonhierarchical-clustering.html#cb548-3"></a><span class="st">  </span><span class="kw">mutate_if</span>(is.factor, <span class="op">~</span><span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(.)))</span>
<span id="cb548-4"><a href="nonhierarchical-clustering.html#cb548-4"></a></span>
<span id="cb548-5"><a href="nonhierarchical-clustering.html#cb548-5"></a>medoids_ids &lt;-<span class="st"> </span><span class="kw">kmeans_like_kmedoids</span>(pairwise_distance_df, <span class="dt">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
## `summarise()` ungrouping output (override with `.groups` argument)
## `summarise()` ungrouping output (override with `.groups` argument)
## `summarise()` ungrouping output (override with `.groups` argument)
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="nonhierarchical-clustering.html#cb550-1"></a>medoids_ids</span></code></pre></div>
<pre><code>##       {1, 2} {3, 4, 5, 6} 
##            1            5</code></pre>
</div>
</div>
</div>
<div id="fuzzy-kmeans" class="section level2">
<h2><span class="header-section-number">13.4</span> 퍼지 K-means 알고리즘</h2>
<p>이 방법은 K-means 알고리즘과 유사하나, 하나의 객체가 여러 군집에 속할 가능성을 허용하는 확률 또는 이를 확장한 퍼지(fuzzy) 개념을 도입한 것이다. 객체 <span class="math inline">\(i\)</span>가 군집 <span class="math inline">\(j\)</span>에 속할 확률 <span class="math inline">\(P_{ij}\)</span>를 구하는 문제이다.</p>
<div id="fuzzy-kmeans-basic-script" class="section level3">
<h3><span class="header-section-number">13.4.1</span> 기본 R 스크립트</h3>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="nonhierarchical-clustering.html#cb552-1"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb552-2"><a href="nonhierarchical-clustering.html#cb552-2"></a>  <span class="dt">id =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</span>
<span id="cb552-3"><a href="nonhierarchical-clustering.html#cb552-3"></a>  <span class="dt">x1 =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">14</span>, <span class="dv">11</span>, <span class="dv">15</span>, <span class="dv">7</span>, <span class="dv">13</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb552-4"><a href="nonhierarchical-clustering.html#cb552-4"></a>  <span class="dt">x2 =</span> <span class="kw">c</span>(<span class="dv">14</span>, <span class="dv">13</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">15</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb552-5"><a href="nonhierarchical-clustering.html#cb552-5"></a>)</span>
<span id="cb552-6"><a href="nonhierarchical-clustering.html#cb552-6"></a></span>
<span id="cb552-7"><a href="nonhierarchical-clustering.html#cb552-7"></a>df <span class="op">%&gt;%</span></span>
<span id="cb552-8"><a href="nonhierarchical-clustering.html#cb552-8"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb552-9"><a href="nonhierarchical-clustering.html#cb552-9"></a>    <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb552-10"><a href="nonhierarchical-clustering.html#cb552-10"></a>    <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>),</span>
<span id="cb552-11"><a href="nonhierarchical-clustering.html#cb552-11"></a>    <span class="dt">col.names =</span> <span class="kw">c</span>(</span>
<span id="cb552-12"><a href="nonhierarchical-clustering.html#cb552-12"></a>      <span class="st">&#39;객체번호&#39;</span>, </span>
<span id="cb552-13"><a href="nonhierarchical-clustering.html#cb552-13"></a>      <span class="st">&#39;사용경력($x_1$)&#39;</span>, </span>
<span id="cb552-14"><a href="nonhierarchical-clustering.html#cb552-14"></a>      <span class="st">&#39;사용시간($x_2$)&#39;</span></span>
<span id="cb552-15"><a href="nonhierarchical-clustering.html#cb552-15"></a>      ),</span>
<span id="cb552-16"><a href="nonhierarchical-clustering.html#cb552-16"></a>    <span class="dt">caption =</span> <span class="st">&#39;PC 사용자 데이터&#39;</span></span>
<span id="cb552-17"><a href="nonhierarchical-clustering.html#cb552-17"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:fuzzy-kmeans-data">Table 13.3: </span>PC 사용자 데이터</caption>
<thead>
<tr class="header">
<th align="right">객체번호</th>
<th align="right">사용경력(<span class="math inline">\(x_1\)</span>)</th>
<th align="right">사용시간(<span class="math inline">\(x_2\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">8</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">14</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">11</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">7</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">13</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">5</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="nonhierarchical-clustering.html#cb553-1"></a>cluster<span class="op">::</span><span class="kw">fanny</span>(df[, <span class="dv">-1</span>], <span class="dt">k =</span> <span class="dv">3</span>, <span class="dt">metric =</span> <span class="st">&quot;SqEuclidean&quot;</span>)</span></code></pre></div>
<pre><code>## Fuzzy Clustering object of class &#39;fanny&#39; :                      
## m.ship.expon.        2
## objective     18.37061
## tolerance        1e-15
## iterations          12
## converged            1
## maxit              500
## n                   10
## Membership coefficients (in %, rounded):
##       [,1] [,2] [,3]
##  [1,]   98    1    1
##  [2,]   96    3    2
##  [3,]    1   99    1
##  [4,]   12   80    8
##  [5,]    2   96    2
##  [6,]   98    1    1
##  [7,]    1   99    1
##  [8,]    3    3   94
##  [9,]    0    0   99
## [10,]    1    1   98
## Fuzzyness coefficients:
## dunn_coeff normalized 
##  0.9225653  0.8838480 
## Closest hard clustering:
##  [1] 1 1 2 2 2 1 2 3 3 3
## 
## Available components:
##  [1] &quot;membership&quot;  &quot;coeff&quot;       &quot;memb.exp&quot;    &quot;clustering&quot;  &quot;k.crisp&quot;    
##  [6] &quot;objective&quot;   &quot;convergence&quot; &quot;diss&quot;        &quot;call&quot;        &quot;silinfo&quot;    
## [11] &quot;data&quot;</code></pre>
</div>
<div id="fuzzy-kmeans-algorithm" class="section level3">
<h3><span class="header-section-number">13.4.2</span> 알고리즘</h3>
<p><strong>[단계 0]</strong> 초기 <span class="math inline">\(K\)</span>개의 군집을 임의로 결정한다.</p>
<p><span class="math display">\[\begin{equation*}
P_{ij} = \begin{cases}
1 &amp; \text{ if object $i$ belongs to cluster $j$}\\
0 &amp; \text{ otherwise}
\end{cases}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="nonhierarchical-clustering.html#cb555-1"></a>init_cluster &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">k =</span> <span class="dv">1</span>) {</span>
<span id="cb555-2"><a href="nonhierarchical-clustering.html#cb555-2"></a>  k &lt;-<span class="st"> </span><span class="kw">min</span>(k, <span class="kw">nrow</span>(df))</span>
<span id="cb555-3"><a href="nonhierarchical-clustering.html#cb555-3"></a>  </span>
<span id="cb555-4"><a href="nonhierarchical-clustering.html#cb555-4"></a>  <span class="cf">while</span> (<span class="ot">TRUE</span>) {</span>
<span id="cb555-5"><a href="nonhierarchical-clustering.html#cb555-5"></a>    cluster_ind &lt;-<span class="st"> </span><span class="kw">sample.int</span>(k, <span class="dt">size =</span> <span class="kw">nrow</span>(df), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb555-6"><a href="nonhierarchical-clustering.html#cb555-6"></a>    <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">unique</span>(cluster_ind)) <span class="op">==</span><span class="st"> </span>k) <span class="cf">break</span></span>
<span id="cb555-7"><a href="nonhierarchical-clustering.html#cb555-7"></a>  }</span>
<span id="cb555-8"><a href="nonhierarchical-clustering.html#cb555-8"></a>  </span>
<span id="cb555-9"><a href="nonhierarchical-clustering.html#cb555-9"></a>  <span class="kw">map_dfc</span>(<span class="kw">unique</span>(cluster_ind), <span class="op">~</span><span class="st"> </span><span class="kw">as.double</span>(cluster_ind <span class="op">==</span><span class="st"> </span>.))</span>
<span id="cb555-10"><a href="nonhierarchical-clustering.html#cb555-10"></a>}</span>
<span id="cb555-11"><a href="nonhierarchical-clustering.html#cb555-11"></a></span>
<span id="cb555-12"><a href="nonhierarchical-clustering.html#cb555-12"></a><span class="kw">set.seed</span>(<span class="dv">4000</span>)</span>
<span id="cb555-13"><a href="nonhierarchical-clustering.html#cb555-13"></a></span>
<span id="cb555-14"><a href="nonhierarchical-clustering.html#cb555-14"></a>cluster_membership &lt;-<span class="st"> </span><span class="kw">init_cluster</span>(df[, <span class="dv">-1</span>], <span class="dt">k =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## New names:
## * NA -&gt; ...1
## * NA -&gt; ...2
## * NA -&gt; ...3</code></pre>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="nonhierarchical-clustering.html#cb557-1"></a>cluster_membership</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##     ...1  ...2  ...3
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     0     0
##  2     1     0     0
##  3     0     1     0
##  4     1     0     0
##  5     0     0     1
##  6     0     1     0
##  7     0     0     1
##  8     0     1     0
##  9     1     0     0
## 10     1     0     0</code></pre>
<p><strong>[단계 1]</strong> 각 군집의 중심좌표를 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{c}_j = \frac{\sum_{i = 1}^{n} P_{ij}^{m} \mathbf{x}_i}{\sum_{i = 1}^{n} P_{ij}^{m}}
\end{equation*}\]</span></p>
<p>여기에서 상수 <span class="math inline">\(m\)</span>은 1보다 큰 값을 사용한다.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="nonhierarchical-clustering.html#cb559-1"></a>find_center &lt;-<span class="st"> </span><span class="cf">function</span>(df, p, m) {</span>
<span id="cb559-2"><a href="nonhierarchical-clustering.html#cb559-2"></a>  wt &lt;-<span class="st"> </span>p <span class="op">^</span><span class="st"> </span>m</span>
<span id="cb559-3"><a href="nonhierarchical-clustering.html#cb559-3"></a>  df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb559-4"><a href="nonhierarchical-clustering.html#cb559-4"></a><span class="st">    </span><span class="kw">summarize_all</span>(weighted.mean, <span class="dt">w =</span> wt)</span>
<span id="cb559-5"><a href="nonhierarchical-clustering.html#cb559-5"></a>}</span>
<span id="cb559-6"><a href="nonhierarchical-clustering.html#cb559-6"></a></span>
<span id="cb559-7"><a href="nonhierarchical-clustering.html#cb559-7"></a>cluster_df &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(cluster_membership, find_center, <span class="dt">df =</span> df[, <span class="dv">-1</span>], <span class="dt">m =</span> <span class="dv">2</span>)</span>
<span id="cb559-8"><a href="nonhierarchical-clustering.html#cb559-8"></a></span>
<span id="cb559-9"><a href="nonhierarchical-clustering.html#cb559-9"></a>cluster_df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      x1    x2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  6.2   8   
## 2  8.67  8.33
## 3 14     6.5</code></pre>
<p><strong>[단계 2]</strong> 군집 membership 계수 <span class="math inline">\(P_{ij}\)</span>를 업데이트한다.</p>
<p><span class="math display">\[\begin{equation*}
P_{ij} = \frac{d(\mathbf{x}_i, \mathbf{c}_j)^{-\frac{1}{m - 1}}}{\sum_{a = 1}^{K} d(\mathbf{x}_i, \mathbf{c}_a)^{-\frac{1}{m - 1}}}
\end{equation*}\]</span></p>
<p>여기에서 거리함수 <span class="math inline">\(d()\)</span>는 제곱 유클리드 거리를 사용한다.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="nonhierarchical-clustering.html#cb561-1"></a>update_membership &lt;-<span class="st"> </span><span class="cf">function</span>(df, cluster_df, m) {</span>
<span id="cb561-2"><a href="nonhierarchical-clustering.html#cb561-2"></a>  distance_mat &lt;-<span class="st"> </span>flexclust<span class="op">::</span><span class="kw">dist2</span>(df, cluster_df)  <span class="op">^</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb561-3"><a href="nonhierarchical-clustering.html#cb561-3"></a>  </span>
<span id="cb561-4"><a href="nonhierarchical-clustering.html#cb561-4"></a>  p &lt;-<span class="st"> </span>distance_mat <span class="op">^</span><span class="st"> </span>(<span class="op">-</span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(m <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb561-5"><a href="nonhierarchical-clustering.html#cb561-5"></a><span class="st">    `</span><span class="dt">/</span><span class="st">`</span>(<span class="kw">rowSums</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb561-6"><a href="nonhierarchical-clustering.html#cb561-6"></a><span class="st">    </span><span class="kw">as_tibble</span>(<span class="dt">.name_repair =</span> <span class="st">&quot;minimal&quot;</span>)</span>
<span id="cb561-7"><a href="nonhierarchical-clustering.html#cb561-7"></a>  </span>
<span id="cb561-8"><a href="nonhierarchical-clustering.html#cb561-8"></a>  p</span>
<span id="cb561-9"><a href="nonhierarchical-clustering.html#cb561-9"></a>}</span>
<span id="cb561-10"><a href="nonhierarchical-clustering.html#cb561-10"></a></span>
<span id="cb561-11"><a href="nonhierarchical-clustering.html#cb561-11"></a><span class="kw">update_membership</span>(df[, <span class="dv">-1</span>], cluster_df, <span class="dt">m =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##         ``      ``    ``
##      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 0.451   0.414   0.135
##  2 0.380   0.483   0.137
##  3 0.00381 0.00730 0.989
##  4 0.139   0.576   0.285
##  5 0.0152  0.0285  0.956
##  6 0.406   0.427   0.166
##  7 0.0231  0.0479  0.929
##  8 0.574   0.311   0.115
##  9 0.542   0.315   0.143
## 10 0.508   0.325   0.166</code></pre>
</div>
<div id="fuzzy-kmeans-script-implement" class="section level3">
<h3><span class="header-section-number">13.4.3</span> R 스크립트 구현</h3>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="nonhierarchical-clustering.html#cb563-1"></a>fuzzy_kmeans &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">k =</span> <span class="dv">1</span>, <span class="dt">m =</span> <span class="dv">2</span>, <span class="dt">max_iter =</span> 1000L, <span class="dt">tol =</span> <span class="fl">1e-9</span>) {</span>
<span id="cb563-2"><a href="nonhierarchical-clustering.html#cb563-2"></a>  k &lt;-<span class="st"> </span><span class="kw">min</span>(k, <span class="kw">nrow</span>(df))</span>
<span id="cb563-3"><a href="nonhierarchical-clustering.html#cb563-3"></a>  i &lt;-<span class="st"> </span>0L</span>
<span id="cb563-4"><a href="nonhierarchical-clustering.html#cb563-4"></a>  </span>
<span id="cb563-5"><a href="nonhierarchical-clustering.html#cb563-5"></a>  cluster_membership &lt;-<span class="st"> </span><span class="kw">init_cluster</span>(df, k)</span>
<span id="cb563-6"><a href="nonhierarchical-clustering.html#cb563-6"></a>  </span>
<span id="cb563-7"><a href="nonhierarchical-clustering.html#cb563-7"></a>  <span class="cf">while</span> (i <span class="op">&lt;</span><span class="st"> </span>max_iter) {</span>
<span id="cb563-8"><a href="nonhierarchical-clustering.html#cb563-8"></a>    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb563-9"><a href="nonhierarchical-clustering.html#cb563-9"></a>    </span>
<span id="cb563-10"><a href="nonhierarchical-clustering.html#cb563-10"></a>    cluster_df &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(cluster_membership, find_center, <span class="dt">df =</span> df, <span class="dt">m =</span> m)</span>
<span id="cb563-11"><a href="nonhierarchical-clustering.html#cb563-11"></a>    </span>
<span id="cb563-12"><a href="nonhierarchical-clustering.html#cb563-12"></a>    new_cluster_membership &lt;-<span class="st"> </span><span class="kw">update_membership</span>(df, cluster_df, m)</span>
<span id="cb563-13"><a href="nonhierarchical-clustering.html#cb563-13"></a>    </span>
<span id="cb563-14"><a href="nonhierarchical-clustering.html#cb563-14"></a>    <span class="cf">if</span> (<span class="kw">max</span>(<span class="kw">abs</span>(cluster_membership <span class="op">-</span><span class="st"> </span>new_cluster_membership)) <span class="op">&lt;</span><span class="st"> </span>tol) <span class="cf">break</span></span>
<span id="cb563-15"><a href="nonhierarchical-clustering.html#cb563-15"></a>    </span>
<span id="cb563-16"><a href="nonhierarchical-clustering.html#cb563-16"></a>    cluster_membership &lt;-<span class="st"> </span>new_cluster_membership</span>
<span id="cb563-17"><a href="nonhierarchical-clustering.html#cb563-17"></a>  }</span>
<span id="cb563-18"><a href="nonhierarchical-clustering.html#cb563-18"></a>  </span>
<span id="cb563-19"><a href="nonhierarchical-clustering.html#cb563-19"></a>  res &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb563-20"><a href="nonhierarchical-clustering.html#cb563-20"></a>    <span class="dt">n_iteration =</span> i,</span>
<span id="cb563-21"><a href="nonhierarchical-clustering.html#cb563-21"></a>    <span class="dt">center =</span> cluster_df,</span>
<span id="cb563-22"><a href="nonhierarchical-clustering.html#cb563-22"></a>    <span class="dt">membership =</span> cluster_membership <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.matrix</span>()</span>
<span id="cb563-23"><a href="nonhierarchical-clustering.html#cb563-23"></a>  )</span>
<span id="cb563-24"><a href="nonhierarchical-clustering.html#cb563-24"></a>  </span>
<span id="cb563-25"><a href="nonhierarchical-clustering.html#cb563-25"></a>  <span class="kw">return</span> (res)</span>
<span id="cb563-26"><a href="nonhierarchical-clustering.html#cb563-26"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="nonhierarchical-clustering.html#cb564-1"></a><span class="kw">set.seed</span>(<span class="dv">4000</span>)</span>
<span id="cb564-2"><a href="nonhierarchical-clustering.html#cb564-2"></a></span>
<span id="cb564-3"><a href="nonhierarchical-clustering.html#cb564-3"></a>fuzzy_kmeans_solution &lt;-<span class="st"> </span><span class="kw">fuzzy_kmeans</span>(df[, <span class="dv">-1</span>], <span class="dt">k =</span> <span class="dv">3</span>, <span class="dt">m =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## New names:
## * NA -&gt; ...1
## * NA -&gt; ...2
## * NA -&gt; ...3</code></pre>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="nonhierarchical-clustering.html#cb566-1"></a>fuzzy_kmeans_solution<span class="op">$</span>n_iteration</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="nonhierarchical-clustering.html#cb568-1"></a>fuzzy_kmeans_solution<span class="op">$</span>center</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      x1    x2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  3.64  2.98
## 2  7.00 14.0 
## 3 13.4   6.63</code></pre>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="nonhierarchical-clustering.html#cb570-1"></a>fuzzy_kmeans_solution<span class="op">$</span>membership</span></code></pre></div>
<pre><code>##                                          
##  [1,] 0.007809655 0.983147737 0.009042608
##  [2,] 0.015726915 0.957515486 0.026757600
##  [3,] 0.006068358 0.006268614 0.987663029
##  [4,] 0.078772454 0.120672309 0.800555237
##  [5,] 0.017165082 0.022105992 0.960728926
##  [6,] 0.006532987 0.984345339 0.009121674
##  [7,] 0.005945712 0.005766360 0.988287928
##  [8,] 0.939278603 0.026072757 0.034648640
##  [9,] 0.993661877 0.002989486 0.003348637
## [10,] 0.981125198 0.008481303 0.010393499</code></pre>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="nonhierarchical-clustering.html#cb572-1"></a>fuzzy_kmeans_solution<span class="op">$</span>membership <span class="op">%&gt;%</span></span>
<span id="cb572-2"><a href="nonhierarchical-clustering.html#cb572-2"></a><span class="st">  </span><span class="kw">apply</span>(<span class="dv">1</span>, which.max)</span></code></pre></div>
<pre><code>##  [1] 2 2 3 3 3 2 3 1 1 1</code></pre>
</div>
</div>
<div id="model-based-clustering" class="section level2">
<h2><span class="header-section-number">13.5</span> 모형기반 군집방법</h2>
<p>모형기반 군집방법(model-based clustering)에서는 각 객체가 혼합분포(mixture)를 따른다고 가정하여 객체의 군집배정변수를 통계적으로 추정하는 것이다.</p>
<div id="model-based-clustering-basic-script" class="section level3">
<h3><span class="header-section-number">13.5.1</span> 기본 R script</h3>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="nonhierarchical-clustering.html#cb574-1"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb574-2"><a href="nonhierarchical-clustering.html#cb574-2"></a>  <span class="dt">id =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>),</span>
<span id="cb574-3"><a href="nonhierarchical-clustering.html#cb574-3"></a>  <span class="dt">x1 =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">12</span>),</span>
<span id="cb574-4"><a href="nonhierarchical-clustering.html#cb574-4"></a>  <span class="dt">x2 =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb574-5"><a href="nonhierarchical-clustering.html#cb574-5"></a>)</span>
<span id="cb574-6"><a href="nonhierarchical-clustering.html#cb574-6"></a></span>
<span id="cb574-7"><a href="nonhierarchical-clustering.html#cb574-7"></a>df <span class="op">%&gt;%</span></span>
<span id="cb574-8"><a href="nonhierarchical-clustering.html#cb574-8"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb574-9"><a href="nonhierarchical-clustering.html#cb574-9"></a>    <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb574-10"><a href="nonhierarchical-clustering.html#cb574-10"></a>    <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>, <span class="st">&#39;r&#39;</span>),</span>
<span id="cb574-11"><a href="nonhierarchical-clustering.html#cb574-11"></a>    <span class="dt">col.names =</span> <span class="kw">c</span>(</span>
<span id="cb574-12"><a href="nonhierarchical-clustering.html#cb574-12"></a>      <span class="st">&#39;객체번호&#39;</span>, </span>
<span id="cb574-13"><a href="nonhierarchical-clustering.html#cb574-13"></a>      <span class="st">&#39;$x_1$&#39;</span>, </span>
<span id="cb574-14"><a href="nonhierarchical-clustering.html#cb574-14"></a>      <span class="st">&#39;$x_2$&#39;</span></span>
<span id="cb574-15"><a href="nonhierarchical-clustering.html#cb574-15"></a>      ),</span>
<span id="cb574-16"><a href="nonhierarchical-clustering.html#cb574-16"></a>    <span class="dt">caption =</span> <span class="st">&#39;모형기반 군집 학습 데이터&#39;</span></span>
<span id="cb574-17"><a href="nonhierarchical-clustering.html#cb574-17"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:model-based-clustering-data">Table 13.4: </span>모형기반 군집 학습 데이터</caption>
<thead>
<tr class="header">
<th align="right">객체번호</th>
<th align="right"><span class="math inline">\(x_1\)</span></th>
<th align="right"><span class="math inline">\(x_2\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">4</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">6</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">6</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">10</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">11</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">12</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">12</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>Table <a href="nonhierarchical-clustering.html#tab:model-based-clustering-data">13.4</a>의 7개의 객체를 두 개의 군집에 배정하는 간단한 R 스크립트는 아래와 같다. 여기에서 <code>mclust::meVII</code>는 각 군집의 분산-공분산 행렬은 서로 다르되, 각 변수의 분산이 동일하며 공분산은 0이라 가정한다.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="nonhierarchical-clustering.html#cb575-1"></a><span class="kw">set.seed</span>(<span class="dv">1024</span>)</span>
<span id="cb575-2"><a href="nonhierarchical-clustering.html#cb575-2"></a></span>
<span id="cb575-3"><a href="nonhierarchical-clustering.html#cb575-3"></a><span class="co"># 군집 개수</span></span>
<span id="cb575-4"><a href="nonhierarchical-clustering.html#cb575-4"></a>K &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb575-5"><a href="nonhierarchical-clustering.html#cb575-5"></a></span>
<span id="cb575-6"><a href="nonhierarchical-clustering.html#cb575-6"></a><span class="co"># z_ik 값 초기화</span></span>
<span id="cb575-7"><a href="nonhierarchical-clustering.html#cb575-7"></a>init_z &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="kw">nrow</span>(df) <span class="op">*</span><span class="st"> </span>K), <span class="dt">ncol =</span> K) <span class="op">%&gt;%</span></span>
<span id="cb575-8"><a href="nonhierarchical-clustering.html#cb575-8"></a><span class="st">  `</span><span class="dt">/</span><span class="st">`</span>(<span class="kw">apply</span>(., <span class="dv">1</span>, sum))</span>
<span id="cb575-9"><a href="nonhierarchical-clustering.html#cb575-9"></a></span>
<span id="cb575-10"><a href="nonhierarchical-clustering.html#cb575-10"></a><span class="co"># EM 알고리즘 - 분산-공분산 행렬: unequal volume (V), spherical(II) </span></span>
<span id="cb575-11"><a href="nonhierarchical-clustering.html#cb575-11"></a>sol &lt;-<span class="st"> </span>mclust<span class="op">::</span><span class="kw">meVII</span>(<span class="dt">data =</span> df[, <span class="dv">-1</span>], <span class="dt">z =</span> init_z)</span>
<span id="cb575-12"><a href="nonhierarchical-clustering.html#cb575-12"></a></span>
<span id="cb575-13"><a href="nonhierarchical-clustering.html#cb575-13"></a><span class="co"># 군집 사후확률</span></span>
<span id="cb575-14"><a href="nonhierarchical-clustering.html#cb575-14"></a>sol<span class="op">$</span>z</span></code></pre></div>
<pre><code>##              [,1]         [,2]
## [1,] 7.596402e-28 1.000000e+00
## [2,] 8.254183e-27 1.000000e+00
## [3,] 9.463816e-36 1.000000e+00
## [4,] 1.000000e+00 6.832084e-20
## [5,] 1.000000e+00 1.473491e-25
## [6,] 1.000000e+00 4.876251e-31
## [7,] 1.000000e+00 1.480388e-20</code></pre>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="nonhierarchical-clustering.html#cb577-1"></a><span class="co"># 혼합분포</span></span>
<span id="cb577-2"><a href="nonhierarchical-clustering.html#cb577-2"></a>sol<span class="op">$</span>parameters</span></code></pre></div>
<pre><code>## $pro
## [1] 0.5714286 0.4285714
## 
## $mean
##     [,1]      [,2]
## x1 11.25  5.333333
## x2  3.50 13.333333
## 
## $variance
## $variance$modelName
## [1] &quot;VII&quot;
## 
## $variance$d
## [1] 2
## 
## $variance$G
## [1] 2
## 
## $variance$sigma
## , , 1
## 
##         x1      x2
## x1 0.96875 0.00000
## x2 0.00000 0.96875
## 
## , , 2
## 
##          x1       x2
## x1 1.222222 0.000000
## x2 0.000000 1.222222
## 
## 
## $variance$sigmasq
## [1] 0.968750 1.222222
## 
## $variance$scale
## [1] 0.968750 1.222222
## 
## 
## $Vinv
## NULL</code></pre>
</div>
<div id="model-based-clustering-em" class="section level3">
<h3><span class="header-section-number">13.5.2</span> EM 알고리즘</h3>
<p>우선, 필요한 기호를 다음과 같이 정의하자.</p>
<ul>
<li><span class="math inline">\(f_k(\mathbf{x} \, | \, \theta_k)\)</span>: 군집 <span class="math inline">\(k\)</span>에 속하는 객체 <span class="math inline">\(\mathbf{x}\)</span>의 확률밀도함수(<span class="math inline">\(\theta_k\)</span>는 관련 파라미터)</li>
<li><span class="math inline">\(\tau_k\)</span>: 임의의 객체가 군집 <span class="math inline">\(k\)</span>에 속할 사전확률 (<span class="math inline">\(\tau_k \geq 0, \, \sum_{k = 1}^{K} \tau = 1\)</span>)</li>
</ul>
<p>이 때, 임의의 객체 <span class="math inline">\(\mathbf{x}\)</span>는 다음과 같은 혼합 확률밀도함수를 갖는다.</p>
<p><span class="math display">\[\begin{equation*}
f(\mathbf{x} \, | \, \boldsymbol\theta) = \sum_{k = 1}^{K} \tau_k f_k(\mathbf{x} \, | \, \theta_k)
\end{equation*}\]</span></p>
<p>본 장에서는 <span class="math inline">\(f_k\)</span>가 다변량 정규분포를 나타낸다고 가정하자.</p>
<p>추가로, 각 객체가 속하는 군집에 대한 지시변수 <span class="math inline">\(z_{ik}\)</span>를 아래와 같이 정의하자.</p>
<p><span class="math display">\[\begin{equation*}
z_{ik} = \begin{cases}
1 &amp; \text{ if object $i$ belongs to cluster $k$} \\
0 &amp; \text{ otherwise}
\end{cases}
\end{equation*}\]</span></p>
<p>이 <span class="math inline">\(z_{ik}\)</span> 변수는 실제값이 관측되지 않는 변수이므로, 최우추정법을 이용하여 그 기대값, 즉 객체 <span class="math inline">\(i\)</span>가 군집 <span class="math inline">\(k\)</span>에 속할 확률을 추정한다. 보다 자세한 설명은 교재 <span class="citation">(전치혁 <a href="#ref-jun2012datamining" role="doc-biblioref">2012</a>)</span> 참조.</p>
<p>앞의 <a href="nonhierarchical-clustering.html#model-based-clustering-basic-script">13.5.1</a>장에서 수행했던 예제를 단계별로 살펴보기로 하자.</p>
<p><strong>[단계 0]</strong> <span class="math inline">\(\hat{z}_{ik}\)</span>를 초기화한다.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="nonhierarchical-clustering.html#cb579-1"></a><span class="kw">set.seed</span>(<span class="dv">1024</span>)</span>
<span id="cb579-2"><a href="nonhierarchical-clustering.html#cb579-2"></a></span>
<span id="cb579-3"><a href="nonhierarchical-clustering.html#cb579-3"></a><span class="co"># 군집 개수</span></span>
<span id="cb579-4"><a href="nonhierarchical-clustering.html#cb579-4"></a>K &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb579-5"><a href="nonhierarchical-clustering.html#cb579-5"></a></span>
<span id="cb579-6"><a href="nonhierarchical-clustering.html#cb579-6"></a><span class="co"># z_ik 추정값 초기화</span></span>
<span id="cb579-7"><a href="nonhierarchical-clustering.html#cb579-7"></a>z_hat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="kw">nrow</span>(df) <span class="op">*</span><span class="st"> </span>K), <span class="dt">ncol =</span> K) <span class="op">%&gt;%</span></span>
<span id="cb579-8"><a href="nonhierarchical-clustering.html#cb579-8"></a><span class="st">  `</span><span class="dt">/</span><span class="st">`</span>(<span class="kw">apply</span>(., <span class="dv">1</span>, sum)) <span class="op">%&gt;%</span></span>
<span id="cb579-9"><a href="nonhierarchical-clustering.html#cb579-9"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb579-10"><a href="nonhierarchical-clustering.html#cb579-10"></a><span class="st">  `</span><span class="dt">names&lt;-</span><span class="st">`</span>(<span class="kw">str_c</span>(<span class="st">&quot;C&quot;</span>, <span class="dv">1</span><span class="op">:</span>K))</span>
<span id="cb579-11"><a href="nonhierarchical-clustering.html#cb579-11"></a></span>
<span id="cb579-12"><a href="nonhierarchical-clustering.html#cb579-12"></a>z_hat</span></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##       C1     C2
##    &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.406  0.594 
## 2 0.623  0.377 
## 3 0.372  0.628 
## 4 0.956  0.0444
## 5 0.0214 0.979 
## 6 0.681  0.319 
## 7 0.264  0.736</code></pre>
<p><strong>[단계 1]</strong> (M-step) <span class="math inline">\(\hat{z}_{ik}\)</span>를 바탕으로 파라미터를 추정한다.</p>
<p>우선 <span class="math inline">\(\tau_k\)</span>와 <span class="math inline">\(\boldsymbol\mu_k\)</span>를 다음과 같이 추정한다.</p>
<p><span class="math display">\[\begin{equation*}
\hat{\tau}_k = \frac{\sum_{i = 1}^{n} \hat{z}_{ik}}{n}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="nonhierarchical-clustering.html#cb581-1"></a>tau_hat &lt;-<span class="st"> </span><span class="kw">map</span>(z_hat, mean)</span>
<span id="cb581-2"><a href="nonhierarchical-clustering.html#cb581-2"></a>tau_hat</span></code></pre></div>
<pre><code>## $C1
## [1] 0.4746762
## 
## $C2
## [1] 0.5253238</code></pre>
<p><span class="math display">\[\begin{equation*}
\hat{\boldsymbol\mu}_k = \frac{\sum_{i = 1}^{n} \hat{z}_{ik} \mathbf{x}_i}{\sum_{i = 1}^{n} \hat{z}_{ik}}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="nonhierarchical-clustering.html#cb583-1"></a>mu_hat &lt;-<span class="st"> </span><span class="kw">map</span>(z_hat, <span class="op">~</span><span class="kw">colSums</span>(.<span class="op">*</span>df[, <span class="dv">-1</span>]) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(.))</span>
<span id="cb583-2"><a href="nonhierarchical-clustering.html#cb583-2"></a>mu_hat</span></code></pre></div>
<pre><code>## $C1
##       x1       x2 
## 8.644042 7.559792 
## 
## $C2
##       x1       x2 
## 8.777757 7.853884</code></pre>
<p>분산-공분산 행렬 <span class="math inline">\(\boldsymbol\Sigma_k\)</span>의 추정은 분산-공분산 구조를 어떻게 가정하느냐에 따라 다르다. 우선, 일반적으로 분산-공분산 행렬 <span class="math inline">\(\boldsymbol\Sigma_k\)</span>는 아래와 같이 decompose할 수 있다 <span class="citation">(Banfield and Raftery <a href="#ref-banfield1993model" role="doc-biblioref">1993</a>)</span>.</p>
<p><span class="math display">\[\begin{equation*}
\boldsymbol\Sigma_k = \lambda_k \mathbf{D}_k \mathbf{A}_k \mathbf{D}_k^\top
\end{equation*}\]</span></p>
<p>여기에서</p>
<ul>
<li><span class="math inline">\(\lambda_k = \det{\boldsymbol\Sigma_k}^{1 / 2}\)</span>; 군집 <span class="math inline">\(k\)</span>이 크기와 관련</li>
<li><span class="math inline">\(\mathbf{D}_k\)</span>: matrix of eigenvectors of <span class="math inline">\(\boldsymbol\Sigma_k\)</span>; 군집 <span class="math inline">\(k\)</span>의 방향(orientation)과 관련</li>
<li><span class="math inline">\(\mathbf{A}_k\)</span>: diagonal matrix s.t. <span class="math inline">\(\det{\mathbf{A}_k} = 1\)</span>; 군집 <span class="math inline">\(k\)</span>의 형태와 관련</li>
</ul>
<p>이다. <span class="math inline">\(\lambda_k\)</span>, <span class="math inline">\(\mathbf{D}_k\)</span> 및 <span class="math inline">\(\mathbf{A}_k\)</span>에 적용되는 제약조건에 따라 분산-공분산 모형을 정의할 수 있다. 아래는 본 장에서 다룰 세 가지 모형이다.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="nonhierarchical-clustering.html#cb585-1"></a><span class="kw">tribble</span>(</span>
<span id="cb585-2"><a href="nonhierarchical-clustering.html#cb585-2"></a>  <span class="op">~</span>model, <span class="op">~</span>sigma,</span>
<span id="cb585-3"><a href="nonhierarchical-clustering.html#cb585-3"></a>  <span class="st">&quot;VII&quot;</span>, <span class="st">&quot;$</span><span class="ch">\\</span><span class="st">lambda_k </span><span class="ch">\\</span><span class="st">mathbf{I}$&quot;</span>,</span>
<span id="cb585-4"><a href="nonhierarchical-clustering.html#cb585-4"></a>  <span class="st">&quot;VEI&quot;</span>, <span class="st">&quot;$</span><span class="ch">\\</span><span class="st">lambda_k </span><span class="ch">\\</span><span class="st">mathbf{A}$&quot;</span>,</span>
<span id="cb585-5"><a href="nonhierarchical-clustering.html#cb585-5"></a>  <span class="st">&quot;VEE&quot;</span>, <span class="st">&quot;$</span><span class="ch">\\</span><span class="st">lambda_k </span><span class="ch">\\</span><span class="st">mathbf{D} </span><span class="ch">\\</span><span class="st">mathbf{A} </span><span class="ch">\\</span><span class="st">mathbf{D}^</span><span class="ch">\\</span><span class="st">top$&quot;</span></span>
<span id="cb585-6"><a href="nonhierarchical-clustering.html#cb585-6"></a>) <span class="op">%&gt;%</span></span>
<span id="cb585-7"><a href="nonhierarchical-clustering.html#cb585-7"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb585-8"><a href="nonhierarchical-clustering.html#cb585-8"></a>    <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb585-9"><a href="nonhierarchical-clustering.html#cb585-9"></a>    <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&#39;c&#39;</span>, <span class="st">&#39;c&#39;</span>),</span>
<span id="cb585-10"><a href="nonhierarchical-clustering.html#cb585-10"></a>    <span class="dt">col.names =</span> <span class="kw">c</span>(</span>
<span id="cb585-11"><a href="nonhierarchical-clustering.html#cb585-11"></a>      <span class="st">&#39;분산-공분산 모형&#39;</span>, </span>
<span id="cb585-12"><a href="nonhierarchical-clustering.html#cb585-12"></a>      <span class="st">&#39;$</span><span class="ch">\\</span><span class="st">boldsymbol</span><span class="ch">\\</span><span class="st">Sigma_k$&#39;</span></span>
<span id="cb585-13"><a href="nonhierarchical-clustering.html#cb585-13"></a>      ),</span>
<span id="cb585-14"><a href="nonhierarchical-clustering.html#cb585-14"></a>    <span class="dt">caption =</span> <span class="st">&#39;Within-group 분산-공분산 모형&#39;</span></span>
<span id="cb585-15"><a href="nonhierarchical-clustering.html#cb585-15"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:within-group-cov-models">Table 13.5: </span>Within-group 분산-공분산 모형</caption>
<thead>
<tr class="header">
<th align="center">분산-공분산 모형</th>
<th align="center"><span class="math inline">\(\boldsymbol\Sigma_k\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">VII</td>
<td align="center"><span class="math inline">\(\lambda_k \mathbf{I}\)</span></td>
</tr>
<tr class="even">
<td align="center">VEI</td>
<td align="center"><span class="math inline">\(\lambda_k \mathbf{A}\)</span></td>
</tr>
<tr class="odd">
<td align="center">VEE</td>
<td align="center"><span class="math inline">\(\lambda_k \mathbf{D} \mathbf{A} \mathbf{D}^\top\)</span></td>
</tr>
</tbody>
</table>
<p>즉,</p>
<ul>
<li>“VII”
<ul>
<li>for all <span class="math inline">\(k\)</span>,<span class="math inline">\(\mathbf{D}_k = \mathbf{I}\)</span></li>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{A}_k = \mathbf{I}\)</span></li>
</ul></li>
<li>“VEI”
<ul>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{D}_k = \mathbf{I}\)</span></li>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{A}_k = \mathbf{A}\)</span></li>
</ul></li>
<li>“VEE”
<ul>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{D}_k = \mathbf{D}\)</span></li>
<li>for all <span class="math inline">\(k\)</span>, <span class="math inline">\(\mathbf{A}_k = \mathbf{A}\)</span></li>
</ul></li>
</ul>
<p><span class="citation">Celeux and Govaert (<a href="#ref-celeux1995gaussian" role="doc-biblioref">1995</a>)</span> 에 각 분산-공분산 모형에 대한 추정값을 얻는 반복적 알고리즘이 소개되어 있으며, 이는 교재 <span class="citation">(전치혁 <a href="#ref-jun2012datamining" role="doc-biblioref">2012</a>)</span>에도 설명되어 있다.</p>
<p>우선, 각 군집 <span class="math inline">\(k\)</span> 내에서의 scatter matrix를 아래와 같이 계산한다.</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{W}_k = \sum_{i = 1}^{n} \hat{z}_{ik} (\mathbf{x}_i - \hat{\boldsymbol\mu}_k)(\mathbf{x}_i - \hat{\boldsymbol\mu}_k)^\top
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="nonhierarchical-clustering.html#cb586-1"></a>p &lt;-<span class="st"> </span><span class="kw">ncol</span>(df[, <span class="dv">-1</span>])</span>
<span id="cb586-2"><a href="nonhierarchical-clustering.html#cb586-2"></a>W &lt;-<span class="st"> </span><span class="kw">map</span>(mu_hat, </span>
<span id="cb586-3"><a href="nonhierarchical-clustering.html#cb586-3"></a>    <span class="op">~</span><span class="kw">pmap_dfc</span>(<span class="kw">list</span>(<span class="dt">x =</span> df[, <span class="dv">-1</span>], <span class="dt">mu =</span> .),</span>
<span id="cb586-4"><a href="nonhierarchical-clustering.html#cb586-4"></a>             <span class="cf">function</span>(x, mu) x <span class="op">-</span><span class="st"> </span>mu)) <span class="op">%&gt;%</span></span>
<span id="cb586-5"><a href="nonhierarchical-clustering.html#cb586-5"></a><span class="st">  </span><span class="kw">map</span>(as.matrix, <span class="dt">nrow =</span> p, <span class="dt">ncol =</span> p) <span class="op">%&gt;%</span></span>
<span id="cb586-6"><a href="nonhierarchical-clustering.html#cb586-6"></a><span class="st">  </span><span class="kw">map2</span>(z_hat, <span class="op">~</span><span class="st"> </span><span class="kw">t</span>(.x) <span class="op">%*%</span><span class="st"> </span>(.y <span class="op">*</span><span class="st"> </span>.x))</span>
<span id="cb586-7"><a href="nonhierarchical-clustering.html#cb586-7"></a></span>
<span id="cb586-8"><a href="nonhierarchical-clustering.html#cb586-8"></a>W</span></code></pre></div>
<pre><code>## $C1
##           x1        x2
## x1  28.22794 -44.46516
## x2 -44.46516  82.36848
## 
## $C2
##           x1        x2
## x1  37.16942 -53.17491
## x2 -53.17491  92.90912</code></pre>
<p>이후 분산-공분산 모형에 따라 아래와 같이 각 군집의 분산-공분산 행렬을 추정한다.</p>
<p>[VII의 경우] 반복 업데이트의 과정 없이 closed-form으로 해가 존재한다.</p>
<p><span class="math display">\[\begin{equation*}
\lambda_k = \frac{Tr(\mathbf{W}_k)}{p \sum_{i = 1}^{n} \hat{z}_{ik}}
\end{equation*}\]</span></p>
<p><span class="math display">\[\begin{equation*}
\boldsymbol\Sigma_k = \lambda_k \mathbf{I}
\end{equation*}\]</span></p>
<p>이 때 <span class="math inline">\(p\)</span>는 관측값의 차원수이다 (<span class="math inline">\(\mathbf{x} \in \mathbb{R}^p\)</span>).</p>
<p>[VEI의 경우]</p>
<p>VEI-0. 행렬 <span class="math inline">\(\mathbf{B} = \mathbf{I}\)</span>로 초기화한다.</p>
<p>VEI-1. <span class="math inline">\(\lambda_k\)</span>값을 아래와 같이 계산한다.</p>
<p><span class="math display">\[\begin{equation*}
\lambda_k = \frac{Tr(\mathbf{W}_k \mathbf{B}^{-1})}{p \sum_{i = 1}^{n} \hat{z}_{ik}}
\end{equation*}\]</span></p>
<p>VEI-2. 행렬 <span class="math inline">\(\mathbf{B}\)</span>를 아래와 같이 업데이트한다.</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{B} = \frac{diag\left( \sum_{k = 1}^{K} \frac{\mathbf{W}_k}{\lambda_k} \right)}{\left( \det diag\left( \sum_{k = 1}^{K} \frac{\mathbf{W}_k}{\lambda_k} \right) \right)^{1 / p}}
\end{equation*}\]</span></p>
<p>VEI-3. 결과가 수렴하면 종료, 그렇지 않으면 VEI-1로 돌아간다. 최종 수렴한 결과를 통해 각 군집의 분산-공분산 행렬을 아래와 같이 얻는다.</p>
<p><span class="math display">\[\begin{equation*}
\boldsymbol\Sigma_k = \lambda_k \mathbf{B}
\end{equation*}\]</span></p>
<p>[VEE의 경우]</p>
<p>VEE-0. 행렬 <span class="math inline">\(\mathbf{C} = \mathbf{I}\)</span>로 초기화한다.</p>
<p>VEE-1. <span class="math inline">\(\lambda_k\)</span>값을 아래와 같이 계산한다.</p>
<p><span class="math display">\[\begin{equation*}
\lambda_k = \frac{Tr(\mathbf{W}_k \mathbf{C}^{-1})}{p \sum_{i = 1}^{n} \hat{z}_{ik}}
\end{equation*}\]</span></p>
<p>VEE-2. 행렬 <span class="math inline">\(\mathbf{C}\)</span>를 아래와 같이 업데이트한다.</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{C} = \frac{\sum_{k = 1}^{K} \frac{\mathbf{W}_k}{\lambda_k}}{\left( \det \sum_{k = 1}^{K} \frac{\mathbf{W}_k}{\lambda_k} \right)^{1 / p}}
\end{equation*}\]</span></p>
<p>VEE-3. 결과가 수렴하면 종료, 그렇지 않으면 VEE-1로 돌아간다. 최종 수렴한 결과를 통해 각 군집의 분산-공분산 행렬을 아래와 같이 얻는다.</p>
<p><span class="math display">\[\begin{equation*}
\boldsymbol\Sigma_k = \lambda_k \mathbf{C}
\end{equation*}\]</span></p>
<p>위 각 분산-공분산 모형을 추정 과정에 대한 설명은, 보다 일반화된 분산-공분산 구조 <span class="math inline">\(\lambda_k \mathbf{D}_k \mathbf{A}_k \mathbf{D}_k^\top\)</span>을 추정하는 과정을 각 모형에 추가되는 제약에 따라 조금 더 단순하게 표현한 것이다. 보다 자세한 내용은 <span class="citation">Celeux and Govaert (<a href="#ref-celeux1995gaussian" role="doc-biblioref">1995</a>)</span> 참조.</p>
<p>아래와 같이 군집 내 분산-공분산 행렬을 추정하는 함수 <code>estimate_mixture_cov</code>를 구현해보자. 해당 함수는 3개의 입력변수를 사용한다.</p>
<ul>
<li><code>modelName</code>: 분산-공분산 모형 이름. “VII”, “VEI”, “VEE” 중 하나를 선택한다.</li>
<li><code>W</code>: <code>K</code>개의 scatter matrix (<span class="math inline">\(\mathbf{W}_1, \cdots, \mathbf{W}_K\)</span>)를 원소로 지니는 리스트 (<code>list</code>)</li>
<li><code>z</code>: <span class="math inline">\(z_{ik}\)</span> 값을 지닌 데이터 프레임 (<code>data.frame</code>). <span class="math inline">\(n\)</span>개의 행과 <span class="math inline">\(K\)</span>개의 열로 이루어진다. 즉, 행은 각 관측객체를 나타내며, 열은 각 군집을 나타낸다.</li>
</ul>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="nonhierarchical-clustering.html#cb588-1"></a>estimate_mixture_cov &lt;-<span class="st"> </span><span class="cf">function</span>(modelName, W, z) {</span>
<span id="cb588-2"><a href="nonhierarchical-clustering.html#cb588-2"></a>  K &lt;-<span class="st"> </span><span class="kw">ncol</span>(z)</span>
<span id="cb588-3"><a href="nonhierarchical-clustering.html#cb588-3"></a>  p &lt;-<span class="st"> </span><span class="kw">ncol</span>(W[[<span class="dv">1</span>]])</span>
<span id="cb588-4"><a href="nonhierarchical-clustering.html#cb588-4"></a></span>
<span id="cb588-5"><a href="nonhierarchical-clustering.html#cb588-5"></a>  <span class="co"># 초기화</span></span>
<span id="cb588-6"><a href="nonhierarchical-clustering.html#cb588-6"></a>  D &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span>K, <span class="op">~</span><span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span>, p))</span>
<span id="cb588-7"><a href="nonhierarchical-clustering.html#cb588-7"></a>  A &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span>K, <span class="op">~</span><span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span>, p))</span>
<span id="cb588-8"><a href="nonhierarchical-clustering.html#cb588-8"></a>  </span>
<span id="cb588-9"><a href="nonhierarchical-clustering.html#cb588-9"></a>  get_lambda &lt;-<span class="st"> </span><span class="cf">function</span>(W, z, D, A, p) {</span>
<span id="cb588-10"><a href="nonhierarchical-clustering.html#cb588-10"></a>    <span class="kw">pmap</span>(</span>
<span id="cb588-11"><a href="nonhierarchical-clustering.html#cb588-11"></a>      <span class="kw">list</span>(W, z, D, A),</span>
<span id="cb588-12"><a href="nonhierarchical-clustering.html#cb588-12"></a>      <span class="cf">function</span>(W, z, D, A, p)</span>
<span id="cb588-13"><a href="nonhierarchical-clustering.html#cb588-13"></a>        <span class="kw">sum</span>(<span class="kw">diag</span>(W <span class="op">%*%</span><span class="st"> </span>D <span class="op">%*%</span><span class="st"> </span><span class="kw">solve</span>(A) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(D))) <span class="op">/</span><span class="st"> </span>(<span class="kw">sum</span>(z) <span class="op">*</span><span class="st"> </span>p),</span>
<span id="cb588-14"><a href="nonhierarchical-clustering.html#cb588-14"></a>      <span class="dt">p =</span> p</span>
<span id="cb588-15"><a href="nonhierarchical-clustering.html#cb588-15"></a>      )</span>
<span id="cb588-16"><a href="nonhierarchical-clustering.html#cb588-16"></a>  }</span>
<span id="cb588-17"><a href="nonhierarchical-clustering.html#cb588-17"></a>  </span>
<span id="cb588-18"><a href="nonhierarchical-clustering.html#cb588-18"></a>  objective_value &lt;-<span class="st"> </span><span class="cf">function</span>(W, z, lambda, D, A, p) {</span>
<span id="cb588-19"><a href="nonhierarchical-clustering.html#cb588-19"></a>    <span class="kw">pmap_dbl</span>(</span>
<span id="cb588-20"><a href="nonhierarchical-clustering.html#cb588-20"></a>      <span class="kw">list</span>(W, z, lambda, D, A),</span>
<span id="cb588-21"><a href="nonhierarchical-clustering.html#cb588-21"></a>      <span class="cf">function</span>(W, z, lambda, D, A, p)</span>
<span id="cb588-22"><a href="nonhierarchical-clustering.html#cb588-22"></a>        <span class="kw">sum</span>(<span class="kw">diag</span>(W <span class="op">%*%</span><span class="st"> </span>D <span class="op">%*%</span><span class="st"> </span><span class="kw">solve</span>(A) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(D))) <span class="op">/</span><span class="st"> </span>lambda <span class="op">+</span></span>
<span id="cb588-23"><a href="nonhierarchical-clustering.html#cb588-23"></a><span class="st">        </span>p <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(z) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(lambda),</span>
<span id="cb588-24"><a href="nonhierarchical-clustering.html#cb588-24"></a>      <span class="dt">p =</span> p</span>
<span id="cb588-25"><a href="nonhierarchical-clustering.html#cb588-25"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb588-26"><a href="nonhierarchical-clustering.html#cb588-26"></a><span class="st">      </span><span class="kw">sum</span>()</span>
<span id="cb588-27"><a href="nonhierarchical-clustering.html#cb588-27"></a>  }</span>
<span id="cb588-28"><a href="nonhierarchical-clustering.html#cb588-28"></a>  </span>
<span id="cb588-29"><a href="nonhierarchical-clustering.html#cb588-29"></a>  i &lt;-<span class="st"> </span>0L</span>
<span id="cb588-30"><a href="nonhierarchical-clustering.html#cb588-30"></a>  obj &lt;-<span class="st"> </span><span class="ot">Inf</span></span>
<span id="cb588-31"><a href="nonhierarchical-clustering.html#cb588-31"></a>  </span>
<span id="cb588-32"><a href="nonhierarchical-clustering.html#cb588-32"></a>  <span class="cf">while</span>(<span class="ot">TRUE</span>) {</span>
<span id="cb588-33"><a href="nonhierarchical-clustering.html#cb588-33"></a>    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb588-34"><a href="nonhierarchical-clustering.html#cb588-34"></a>    </span>
<span id="cb588-35"><a href="nonhierarchical-clustering.html#cb588-35"></a>    lambda &lt;-<span class="st"> </span><span class="kw">get_lambda</span>(W, z, D, A, p)</span>
<span id="cb588-36"><a href="nonhierarchical-clustering.html#cb588-36"></a>    new_obj &lt;-<span class="st"> </span><span class="kw">objective_value</span>(W, z, lambda, D, A, p)</span>
<span id="cb588-37"><a href="nonhierarchical-clustering.html#cb588-37"></a>    </span>
<span id="cb588-38"><a href="nonhierarchical-clustering.html#cb588-38"></a>    <span class="cf">if</span> (obj <span class="op">-</span><span class="st"> </span>new_obj <span class="op">&lt;</span><span class="st"> </span><span class="fl">1e-9</span>) <span class="cf">break</span></span>
<span id="cb588-39"><a href="nonhierarchical-clustering.html#cb588-39"></a>    </span>
<span id="cb588-40"><a href="nonhierarchical-clustering.html#cb588-40"></a>    <span class="cf">if</span> (modelName <span class="op">==</span><span class="st"> &quot;VII&quot;</span>) {</span>
<span id="cb588-41"><a href="nonhierarchical-clustering.html#cb588-41"></a>      </span>
<span id="cb588-42"><a href="nonhierarchical-clustering.html#cb588-42"></a>    } <span class="cf">else</span> <span class="cf">if</span> (modelName <span class="op">==</span><span class="st"> &quot;VEI&quot;</span>) {</span>
<span id="cb588-43"><a href="nonhierarchical-clustering.html#cb588-43"></a>      B &lt;-<span class="st"> </span><span class="kw">map2</span>(W, lambda, <span class="op">~</span><span class="st"> </span><span class="kw">diag</span>(.x) <span class="op">/</span><span class="st"> </span>.y) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb588-44"><a href="nonhierarchical-clustering.html#cb588-44"></a><span class="st">        </span><span class="kw">reduce</span>(<span class="st">`</span><span class="dt">+</span><span class="st">`</span>) <span class="op">%&gt;%</span></span>
<span id="cb588-45"><a href="nonhierarchical-clustering.html#cb588-45"></a><span class="st">        </span><span class="kw">diag</span>() <span class="op">%&gt;%</span></span>
<span id="cb588-46"><a href="nonhierarchical-clustering.html#cb588-46"></a><span class="st">        `</span><span class="dt">/</span><span class="st">`</span>(<span class="kw">det</span>(.) <span class="op">^</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>p))</span>
<span id="cb588-47"><a href="nonhierarchical-clustering.html#cb588-47"></a>      A &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span>K, <span class="op">~</span><span class="st"> </span>B)</span>
<span id="cb588-48"><a href="nonhierarchical-clustering.html#cb588-48"></a>    } <span class="cf">else</span> <span class="cf">if</span> (modelName <span class="op">==</span><span class="st"> &quot;VEE&quot;</span>) {</span>
<span id="cb588-49"><a href="nonhierarchical-clustering.html#cb588-49"></a>      C &lt;-<span class="st"> </span><span class="kw">map2</span>(W, lambda, <span class="op">~</span><span class="st"> </span>.x <span class="op">/</span><span class="st"> </span>.y) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb588-50"><a href="nonhierarchical-clustering.html#cb588-50"></a><span class="st">        </span><span class="kw">reduce</span>(<span class="st">`</span><span class="dt">+</span><span class="st">`</span>) <span class="op">%&gt;%</span></span>
<span id="cb588-51"><a href="nonhierarchical-clustering.html#cb588-51"></a><span class="st">        `</span><span class="dt">/</span><span class="st">`</span>(<span class="kw">det</span>(.) <span class="op">^</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>p))</span>
<span id="cb588-52"><a href="nonhierarchical-clustering.html#cb588-52"></a>      </span>
<span id="cb588-53"><a href="nonhierarchical-clustering.html#cb588-53"></a>      s &lt;-<span class="st"> </span><span class="kw">svd</span>(C)</span>
<span id="cb588-54"><a href="nonhierarchical-clustering.html#cb588-54"></a>      A &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span>K, <span class="op">~</span><span class="st"> </span><span class="kw">diag</span>(s<span class="op">$</span>d))</span>
<span id="cb588-55"><a href="nonhierarchical-clustering.html#cb588-55"></a>      D &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span>K, <span class="op">~</span><span class="st"> </span>s<span class="op">$</span>u)</span>
<span id="cb588-56"><a href="nonhierarchical-clustering.html#cb588-56"></a>    } <span class="cf">else</span> {</span>
<span id="cb588-57"><a href="nonhierarchical-clustering.html#cb588-57"></a>      <span class="kw">stop</span>(<span class="st">&quot;Model &quot;</span>, modelName, <span class="st">&quot; is not supported yet.&quot;</span>)</span>
<span id="cb588-58"><a href="nonhierarchical-clustering.html#cb588-58"></a>    }</span>
<span id="cb588-59"><a href="nonhierarchical-clustering.html#cb588-59"></a>    </span>
<span id="cb588-60"><a href="nonhierarchical-clustering.html#cb588-60"></a>    obj &lt;-<span class="st"> </span>new_obj</span>
<span id="cb588-61"><a href="nonhierarchical-clustering.html#cb588-61"></a>  }</span>
<span id="cb588-62"><a href="nonhierarchical-clustering.html#cb588-62"></a></span>
<span id="cb588-63"><a href="nonhierarchical-clustering.html#cb588-63"></a>  Sigma &lt;-<span class="st"> </span><span class="kw">pmap</span>(</span>
<span id="cb588-64"><a href="nonhierarchical-clustering.html#cb588-64"></a>    <span class="kw">list</span>(lambda, D, A),</span>
<span id="cb588-65"><a href="nonhierarchical-clustering.html#cb588-65"></a>    <span class="cf">function</span>(lambda, D, A) lambda <span class="op">*</span><span class="st"> </span>(D <span class="op">%*%</span><span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(D))</span>
<span id="cb588-66"><a href="nonhierarchical-clustering.html#cb588-66"></a>    )</span>
<span id="cb588-67"><a href="nonhierarchical-clustering.html#cb588-67"></a></span>
<span id="cb588-68"><a href="nonhierarchical-clustering.html#cb588-68"></a>  <span class="kw">return</span> (<span class="kw">list</span>(</span>
<span id="cb588-69"><a href="nonhierarchical-clustering.html#cb588-69"></a>    <span class="dt">volume =</span> lambda,</span>
<span id="cb588-70"><a href="nonhierarchical-clustering.html#cb588-70"></a>    <span class="dt">shape =</span> A,</span>
<span id="cb588-71"><a href="nonhierarchical-clustering.html#cb588-71"></a>    <span class="dt">orientation =</span> D,</span>
<span id="cb588-72"><a href="nonhierarchical-clustering.html#cb588-72"></a>    <span class="dt">Sigma =</span> Sigma</span>
<span id="cb588-73"><a href="nonhierarchical-clustering.html#cb588-73"></a>  ))</span>
<span id="cb588-74"><a href="nonhierarchical-clustering.html#cb588-74"></a>}</span></code></pre></div>
<p>초기값으로 주어진 <span class="math inline">\(\hat{z}_{ik}\)</span> 를 이용하여 “VII” 구조의 분산-공분산 행렬을 구해보자.</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="nonhierarchical-clustering.html#cb589-1"></a><span class="kw">estimate_mixture_cov</span>(<span class="st">&quot;VII&quot;</span>, W, z_hat)</span></code></pre></div>
<pre><code>## $volume
## $volume$C1
## [1] 16.64239
## 
## $volume$C2
## [1] 17.68685
## 
## 
## $shape
## $shape[[1]]
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1
## 
## $shape[[2]]
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1
## 
## 
## $orientation
## $orientation[[1]]
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1
## 
## $orientation[[2]]
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1
## 
## 
## $Sigma
## $Sigma$C1
##          [,1]     [,2]
## [1,] 16.64239  0.00000
## [2,]  0.00000 16.64239
## 
## $Sigma$C2
##          [,1]     [,2]
## [1,] 17.68685  0.00000
## [2,]  0.00000 17.68685</code></pre>
<p>위 <code>estimate_mixture_cov</code> 함수에서 “VII”보다 일반화된 “VEI”와 “VEE” 분산-공분산 모형에 대한 추정도 구현되어 있다.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="nonhierarchical-clustering.html#cb591-1"></a><span class="co"># estimate_mixture_cov(&quot;VEI&quot;, W, z_hat)</span></span>
<span id="cb591-2"><a href="nonhierarchical-clustering.html#cb591-2"></a><span class="co"># estimate_mixture_cov(&quot;VEE&quot;, W, z_hat)</span></span></code></pre></div>
<p>위 일련의 파리미터 추정을 하나의 함수 <code>GMM_Mstep</code>으로 아래와 같이 구성해보자.</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="nonhierarchical-clustering.html#cb592-1"></a>GMM_Mstep &lt;-<span class="st"> </span><span class="cf">function</span>(df, z, <span class="dt">modelName =</span> <span class="st">&quot;VII&quot;</span>) {</span>
<span id="cb592-2"><a href="nonhierarchical-clustering.html#cb592-2"></a>  tau &lt;-<span class="st"> </span><span class="kw">map</span>(z, mean)</span>
<span id="cb592-3"><a href="nonhierarchical-clustering.html#cb592-3"></a>  mu &lt;-<span class="st"> </span><span class="kw">map</span>(z, <span class="op">~</span><span class="kw">colSums</span>(. <span class="op">*</span><span class="st"> </span>df) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(.))</span>
<span id="cb592-4"><a href="nonhierarchical-clustering.html#cb592-4"></a>  </span>
<span id="cb592-5"><a href="nonhierarchical-clustering.html#cb592-5"></a>  p &lt;-<span class="st"> </span><span class="kw">ncol</span>(df)</span>
<span id="cb592-6"><a href="nonhierarchical-clustering.html#cb592-6"></a>  W &lt;-<span class="st"> </span><span class="kw">map</span>(mu, <span class="op">~</span><span class="kw">pmap_dfc</span>(</span>
<span id="cb592-7"><a href="nonhierarchical-clustering.html#cb592-7"></a>    <span class="kw">list</span>(<span class="dt">x =</span> df, <span class="dt">mu =</span> .), <span class="cf">function</span>(x, mu) x <span class="op">-</span><span class="st"> </span>mu)) <span class="op">%&gt;%</span></span>
<span id="cb592-8"><a href="nonhierarchical-clustering.html#cb592-8"></a><span class="st">  </span><span class="kw">map</span>(as.matrix, <span class="dt">nrow =</span> p, <span class="dt">ncol =</span> p) <span class="op">%&gt;%</span></span>
<span id="cb592-9"><a href="nonhierarchical-clustering.html#cb592-9"></a><span class="st">  </span><span class="kw">map2</span>(z, <span class="op">~</span><span class="st"> </span><span class="kw">t</span>(.x) <span class="op">%*%</span><span class="st"> </span>(.y <span class="op">*</span><span class="st"> </span>.x))</span>
<span id="cb592-10"><a href="nonhierarchical-clustering.html#cb592-10"></a>  </span>
<span id="cb592-11"><a href="nonhierarchical-clustering.html#cb592-11"></a>  var_cov &lt;-<span class="st"> </span><span class="kw">estimate_mixture_cov</span>(modelName, W, z)</span>
<span id="cb592-12"><a href="nonhierarchical-clustering.html#cb592-12"></a>  </span>
<span id="cb592-13"><a href="nonhierarchical-clustering.html#cb592-13"></a>  res &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb592-14"><a href="nonhierarchical-clustering.html#cb592-14"></a>    <span class="dt">tau =</span> tau,</span>
<span id="cb592-15"><a href="nonhierarchical-clustering.html#cb592-15"></a>    <span class="dt">mu =</span> mu,</span>
<span id="cb592-16"><a href="nonhierarchical-clustering.html#cb592-16"></a>    <span class="dt">Sigma =</span> var_cov<span class="op">$</span>Sigma</span>
<span id="cb592-17"><a href="nonhierarchical-clustering.html#cb592-17"></a>  )</span>
<span id="cb592-18"><a href="nonhierarchical-clustering.html#cb592-18"></a>  </span>
<span id="cb592-19"><a href="nonhierarchical-clustering.html#cb592-19"></a>  <span class="kw">return</span> (res)</span>
<span id="cb592-20"><a href="nonhierarchical-clustering.html#cb592-20"></a>}</span>
<span id="cb592-21"><a href="nonhierarchical-clustering.html#cb592-21"></a></span>
<span id="cb592-22"><a href="nonhierarchical-clustering.html#cb592-22"></a>Mstep_res &lt;-<span class="st"> </span><span class="kw">GMM_Mstep</span>(df[, <span class="dv">-1</span>], z_hat)</span>
<span id="cb592-23"><a href="nonhierarchical-clustering.html#cb592-23"></a></span>
<span id="cb592-24"><a href="nonhierarchical-clustering.html#cb592-24"></a>Mstep_res</span></code></pre></div>
<pre><code>## $tau
## $tau$C1
## [1] 0.4746762
## 
## $tau$C2
## [1] 0.5253238
## 
## 
## $mu
## $mu$C1
##       x1       x2 
## 8.644042 7.559792 
## 
## $mu$C2
##       x1       x2 
## 8.777757 7.853884 
## 
## 
## $Sigma
## $Sigma$C1
##          [,1]     [,2]
## [1,] 16.64239  0.00000
## [2,]  0.00000 16.64239
## 
## $Sigma$C2
##          [,1]     [,2]
## [1,] 17.68685  0.00000
## [2,]  0.00000 17.68685</code></pre>
<p><strong>[단계 2]</strong> (E-step) M-step에서의 파라미터 추정치를 바탕으로 <span class="math inline">\(\hat{z}_{ik}\)</span>를 산출한다.</p>
<p><span class="math display">\[\begin{equation*}
\hat{z}_{ik} = \frac{\hat{\tau}_k f_k(\mathbf{x}_i \, | \, \hat{\boldsymbol{\mu}}_k, \hat{\boldsymbol{\Sigma}}_k)}{\sum_{l = 1}^{K} \hat{\tau}_l f_l(\mathbf{x}_i \, | \, \hat{\boldsymbol{\mu}}_l, \hat{\boldsymbol{\Sigma}}_l)}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="nonhierarchical-clustering.html#cb594-1"></a>GMM_Estep &lt;-<span class="st"> </span><span class="cf">function</span>(df, tau, mu, Sigma) {</span>
<span id="cb594-2"><a href="nonhierarchical-clustering.html#cb594-2"></a>  <span class="kw">pmap_dfc</span>(<span class="kw">list</span>(<span class="dt">tau =</span> tau, <span class="dt">mu =</span> mu, <span class="dt">Sigma =</span> Sigma),</span>
<span id="cb594-3"><a href="nonhierarchical-clustering.html#cb594-3"></a>       <span class="cf">function</span>(df, tau, mu, Sigma) </span>
<span id="cb594-4"><a href="nonhierarchical-clustering.html#cb594-4"></a>         tau <span class="op">*</span><span class="st"> </span>mvtnorm<span class="op">::</span><span class="kw">dmvnorm</span>(df, <span class="dt">mean =</span> mu, <span class="dt">sigma =</span> Sigma),</span>
<span id="cb594-5"><a href="nonhierarchical-clustering.html#cb594-5"></a>       <span class="dt">df =</span> df) <span class="op">%&gt;%</span></span>
<span id="cb594-6"><a href="nonhierarchical-clustering.html#cb594-6"></a><span class="st">    `</span><span class="dt">/</span><span class="st">`</span>(<span class="kw">rowSums</span>(.))</span>
<span id="cb594-7"><a href="nonhierarchical-clustering.html#cb594-7"></a>}</span>
<span id="cb594-8"><a href="nonhierarchical-clustering.html#cb594-8"></a></span>
<span id="cb594-9"><a href="nonhierarchical-clustering.html#cb594-9"></a>new_z_hat &lt;-<span class="st"> </span><span class="kw">GMM_Estep</span>(df[, <span class="dv">-1</span>], Mstep_res<span class="op">$</span>tau, Mstep_res<span class="op">$</span>mu, Mstep_res<span class="op">$</span>Sigma)</span>
<span id="cb594-10"><a href="nonhierarchical-clustering.html#cb594-10"></a></span>
<span id="cb594-11"><a href="nonhierarchical-clustering.html#cb594-11"></a>new_z_hat</span></code></pre></div>
<pre><code>##          C1        C2
## 1 0.4626878 0.5373122
## 2 0.4568716 0.5431284
## 3 0.4373551 0.5626449
## 4 0.4964082 0.5035918
## 5 0.4934276 0.5065724
## 6 0.4886741 0.5113259
## 7 0.4870085 0.5129915</code></pre>
<p><strong>[단계 3]</strong> 수렴조건을 만족하면 stop, 그렇지 않으면 [단계 1]을 반복한다. 일반적으로는 우도함수값의 변화량을 수렴조건으로 사용하나, 본 장에서는 간단하게 <span class="math inline">\(z_{ik}\)</span>값의 변화량을 기준으로 수렴을 판단하도록 하자.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="nonhierarchical-clustering.html#cb596-1"></a><span class="kw">max</span>(<span class="kw">abs</span>(z_hat <span class="op">-</span><span class="st"> </span>new_z_hat)) <span class="op">&lt;</span><span class="st"> </span><span class="fl">1e-9</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>위 수식의 값이 <code>TRUE</code>이면 수렴, <code>FALSE</code>이면 [단계 1]을 반복한다.</p>
</div>
<div id="model-based-clustering-script-implement" class="section level3">
<h3><span class="header-section-number">13.5.3</span> R 스크립트 구현</h3>
<p>위 일련의 과정들을 포함하는 하나의 함수 <code>GMM_EM</code>을 아래와 같이 구현해보자. 앞에서 정의했던 함수 <code>GMM_Mstep</code> 및 <code>GMM_Estep</code>을 재사용한다.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="nonhierarchical-clustering.html#cb598-1"></a>GMM_EM &lt;-<span class="st"> </span><span class="cf">function</span>(df, K, <span class="dt">modelName =</span> <span class="st">&quot;VII&quot;</span>, <span class="dt">tol =</span> <span class="fl">1e-9</span>) {</span>
<span id="cb598-2"><a href="nonhierarchical-clustering.html#cb598-2"></a>  K &lt;-<span class="st"> </span><span class="kw">min</span>(K, <span class="kw">nrow</span>(df))</span>
<span id="cb598-3"><a href="nonhierarchical-clustering.html#cb598-3"></a>  </span>
<span id="cb598-4"><a href="nonhierarchical-clustering.html#cb598-4"></a>  i &lt;-<span class="st"> </span>0L  </span>
<span id="cb598-5"><a href="nonhierarchical-clustering.html#cb598-5"></a>  </span>
<span id="cb598-6"><a href="nonhierarchical-clustering.html#cb598-6"></a>  <span class="co"># [단계 0] z_ik 추정값 초기화</span></span>
<span id="cb598-7"><a href="nonhierarchical-clustering.html#cb598-7"></a>  z_hat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="kw">nrow</span>(df) <span class="op">*</span><span class="st"> </span>K), <span class="dt">ncol =</span> K) <span class="op">%&gt;%</span></span>
<span id="cb598-8"><a href="nonhierarchical-clustering.html#cb598-8"></a><span class="st">    `</span><span class="dt">/</span><span class="st">`</span>(<span class="kw">apply</span>(., <span class="dv">1</span>, sum)) <span class="op">%&gt;%</span></span>
<span id="cb598-9"><a href="nonhierarchical-clustering.html#cb598-9"></a><span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb598-10"><a href="nonhierarchical-clustering.html#cb598-10"></a><span class="st">    `</span><span class="dt">names&lt;-</span><span class="st">`</span>(<span class="kw">str_c</span>(<span class="st">&quot;C&quot;</span>, <span class="dv">1</span><span class="op">:</span>K))</span>
<span id="cb598-11"><a href="nonhierarchical-clustering.html#cb598-11"></a>  </span>
<span id="cb598-12"><a href="nonhierarchical-clustering.html#cb598-12"></a>  <span class="cf">while</span> (<span class="ot">TRUE</span>) {</span>
<span id="cb598-13"><a href="nonhierarchical-clustering.html#cb598-13"></a>    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb598-14"><a href="nonhierarchical-clustering.html#cb598-14"></a>    </span>
<span id="cb598-15"><a href="nonhierarchical-clustering.html#cb598-15"></a>    <span class="co"># [단계 1] M-step</span></span>
<span id="cb598-16"><a href="nonhierarchical-clustering.html#cb598-16"></a>    Mstep_res &lt;-<span class="st"> </span><span class="kw">GMM_Mstep</span>(df, z_hat, modelName)</span>
<span id="cb598-17"><a href="nonhierarchical-clustering.html#cb598-17"></a>    </span>
<span id="cb598-18"><a href="nonhierarchical-clustering.html#cb598-18"></a>    <span class="co"># [단계 2] E-step</span></span>
<span id="cb598-19"><a href="nonhierarchical-clustering.html#cb598-19"></a>    new_z_hat &lt;-<span class="st"> </span><span class="kw">GMM_Estep</span>(df, Mstep_res<span class="op">$</span>tau, Mstep_res<span class="op">$</span>mu, Mstep_res<span class="op">$</span>Sigma)</span>
<span id="cb598-20"><a href="nonhierarchical-clustering.html#cb598-20"></a>    </span>
<span id="cb598-21"><a href="nonhierarchical-clustering.html#cb598-21"></a>    <span class="co"># [단계 3] 수렴조건 확인</span></span>
<span id="cb598-22"><a href="nonhierarchical-clustering.html#cb598-22"></a>    <span class="cf">if</span> (<span class="kw">max</span>(<span class="kw">abs</span>(z_hat <span class="op">-</span><span class="st"> </span>new_z_hat)) <span class="op">&lt;</span><span class="st"> </span>tol) <span class="cf">break</span></span>
<span id="cb598-23"><a href="nonhierarchical-clustering.html#cb598-23"></a>    </span>
<span id="cb598-24"><a href="nonhierarchical-clustering.html#cb598-24"></a>    z_hat &lt;-<span class="st"> </span>new_z_hat</span>
<span id="cb598-25"><a href="nonhierarchical-clustering.html#cb598-25"></a>  }</span>
<span id="cb598-26"><a href="nonhierarchical-clustering.html#cb598-26"></a>  </span>
<span id="cb598-27"><a href="nonhierarchical-clustering.html#cb598-27"></a>  <span class="kw">return</span> (<span class="kw">list</span>(<span class="dt">z =</span> z_hat, </span>
<span id="cb598-28"><a href="nonhierarchical-clustering.html#cb598-28"></a>               <span class="dt">parameters =</span> Mstep_res,</span>
<span id="cb598-29"><a href="nonhierarchical-clustering.html#cb598-29"></a>               <span class="dt">n_iteration =</span> i))</span>
<span id="cb598-30"><a href="nonhierarchical-clustering.html#cb598-30"></a>}</span></code></pre></div>
<p>위 함수를 학습데이터 Table <a href="nonhierarchical-clustering.html#tab:model-based-clustering-data">13.4</a>에 적용한 결과는 아래와 같다.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="nonhierarchical-clustering.html#cb599-1"></a>VII_res &lt;-<span class="st"> </span><span class="kw">GMM_EM</span>(df[, <span class="dv">-1</span>], <span class="dv">2</span>, <span class="st">&quot;VII&quot;</span>)</span>
<span id="cb599-2"><a href="nonhierarchical-clustering.html#cb599-2"></a></span>
<span id="cb599-3"><a href="nonhierarchical-clustering.html#cb599-3"></a><span class="co"># 군집 멤버쉽</span></span>
<span id="cb599-4"><a href="nonhierarchical-clustering.html#cb599-4"></a>VII_res<span class="op">$</span>z</span></code></pre></div>
<pre><code>##             C1           C2
## 1 1.000000e+00 6.786307e-28
## 2 1.000000e+00 8.771316e-27
## 3 1.000000e+00 8.895007e-36
## 4 5.251505e-17 1.000000e+00
## 5 7.046079e-22 1.000000e+00
## 6 1.843399e-26 1.000000e+00
## 7 1.544788e-17 1.000000e+00</code></pre>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="nonhierarchical-clustering.html#cb601-1"></a><span class="co"># 혼합분포</span></span>
<span id="cb601-2"><a href="nonhierarchical-clustering.html#cb601-2"></a>VII_res<span class="op">$</span>parameters</span></code></pre></div>
<pre><code>## $tau
## $tau$C1
## [1] 0.4285714
## 
## $tau$C2
## [1] 0.5714286
## 
## 
## $mu
## $mu$C1
##        x1        x2 
##  5.333333 13.333333 
## 
## $mu$C2
##    x1    x2 
## 11.25  3.50 
## 
## 
## $Sigma
## $Sigma$C1
##          [,1]     [,2]
## [1,] 1.222222 0.000000
## [2,] 0.000000 1.222222
## 
## $Sigma$C2
##         [,1]    [,2]
## [1,] 0.96875 0.00000
## [2,] 0.00000 0.96875</code></pre>
</div>
<div id="r-packages-model-based-clustering" class="section level3">
<h3><span class="header-section-number">13.5.4</span> R 패키지 내 모형기반 군집분석</h3>
<p>R 패키지 <code>mclust</code>를 통해, 위에서 살펴본 VII, VEI, VEE 외에 보다 다양한 분산-공분산 모형을 가정한 군집분석을 수행할 수 있다 <span class="citation">(Scrucca et al. <a href="#ref-scrucca2016mclust" role="doc-biblioref">2016</a>)</span>. 다음은 “EEI” 구조에 대한 수행 예이다.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="nonhierarchical-clustering.html#cb603-1"></a>res_mclust_EEI &lt;-<span class="st"> </span>mclust<span class="op">::</span><span class="kw">meEEI</span>(df[, <span class="dv">-1</span>], z_hat)</span></code></pre></div>
<p>위 수행 결과 객체는 리스트 형태이며, 그 원소 중 <code>z</code>는 <span class="math inline">\(\hat{z}_{ik}\)</span>값을, <code>parameters</code>는 혼합분포 파라미터 추정값 (<span class="math inline">\(\hat{\tau}_k\)</span>, <span class="math inline">\(\hat{\boldsymbol\mu}_k\)</span>, <span class="math inline">\(\hat{\boldsymbol\Sigma}_k\)</span>)을 나타낸다.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="nonhierarchical-clustering.html#cb604-1"></a>res_mclust_EEI<span class="op">$</span>z</span></code></pre></div>
<pre><code>##              [,1]         [,2]
## [1,] 6.198742e-26 1.000000e+00
## [2,] 2.193775e-22 1.000000e+00
## [3,] 1.432979e-28 1.000000e+00
## [4,] 1.000000e+00 3.497777e-20
## [5,] 1.000000e+00 1.350932e-26
## [6,] 1.000000e+00 5.217649e-33
## [7,] 1.000000e+00 9.883335e-24</code></pre>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="nonhierarchical-clustering.html#cb606-1"></a>res_mclust_EEI<span class="op">$</span>parameters</span></code></pre></div>
<pre><code>## $pro
## [1] 0.5714286 0.4285714
## 
## $mean
##     [,1]      [,2]
## x1 11.25  5.333333
## x2  3.50 13.333333
## 
## $variance
## $variance$modelName
## [1] &quot;EEI&quot;
## 
## $variance$d
## [1] 2
## 
## $variance$G
## [1] 2
## 
## $variance$sigma
## , , 1
## 
##           x1       x2
## x1 0.7738095 0.000000
## x2 0.0000000 1.380952
## 
## , , 2
## 
##           x1       x2
## x1 0.7738095 0.000000
## x2 0.0000000 1.380952
## 
## 
## $variance$Sigma
##           x1       x2
## x1 0.7738095 0.000000
## x2 0.0000000 1.380952
## 
## $variance$scale
## [1] 1.033728
## 
## $variance$shape
## [1] 0.7485618 1.3358950
## 
## 
## $Vinv
## NULL</code></pre>
<p><code>mclust</code> 패키지 내의 함수 <code>densityMclust</code>는 Bayesian information criterion (BIC)을 기준으로 최적의 혼합분포를 찾는 함수이다. 즉, 내부적으로 여러가지 분산-공분산 모형과 군집 수의 조합에 대한 군집분석을 수행한 뒤, 각 조합의 최종결과에서 얻어진 BIC 값을 기준으로 최적의 조합을 선정한다.</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="nonhierarchical-clustering.html#cb608-1"></a>res_mclust_opt &lt;-<span class="st"> </span>mclust<span class="op">::</span><span class="kw">densityMclust</span>(df[, <span class="dv">-1</span>], <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>함수 수행결과 객체의 <code>BIC</code> 원소가 나타내는 결과는 아래와 같다.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="nonhierarchical-clustering.html#cb609-1"></a>res_mclust_opt<span class="op">$</span>BIC</span></code></pre></div>
<pre><code>## Bayesian Information Criterion (BIC): 
##         EII       VII       EEI       VEI       EVI       VVI       EEE       VEE
## 1 -85.40006 -85.40006 -85.70851 -85.70851 -85.70851 -85.70851 -75.27433 -75.27433
## 2 -62.00992 -63.86240 -63.37677 -65.22485 -65.32204 -67.17013 -64.66516 -66.60332
## 3 -65.47796        NA -66.01911        NA        NA        NA -67.87781        NA
## 4 -69.04346        NA -70.17240        NA        NA        NA -67.31282        NA
## 5 -72.02226        NA -73.96817        NA        NA        NA        NA        NA
## 6 -62.27998        NA -64.22589        NA        NA        NA        NA        NA
## 7        NA        NA        NA        NA        NA        NA        NA        NA
##         EVE       VVE       EEV       VEV       EVV       VVV
## 1 -75.27433 -75.27433 -75.27433 -75.27433 -75.27433 -75.27433
## 2 -65.06811 -66.92481 -65.42506 -67.34154 -66.55375 -68.44666
## 3        NA        NA -71.48895        NA        NA        NA
## 4        NA        NA        NA        NA        NA        NA
## 5        NA        NA        NA        NA        NA        NA
## 6        NA        NA        NA        NA        NA        NA
## 7        NA        NA        NA        NA        NA        NA
## 
## Top 3 models based on the BIC criterion: 
##     EII,2     EII,6     EEI,2 
## -62.00992 -62.27998 -63.37677</code></pre>
<p>수행 결과 가장 큰 BIC 값을 지닌 최적의 조합은 EII 분산-공분산 모형으로 2개의 군집을 가정했을 때 얻어진다.</p>
<p><code>densityMclust</code> 함수 수행 결과 얻어진 혼합분포를 plotting해보자.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="nonhierarchical-clustering.html#cb611-1"></a><span class="kw">plot</span>(res_mclust_opt, <span class="dt">what =</span> <span class="st">&quot;density&quot;</span>,</span>
<span id="cb611-2"><a href="nonhierarchical-clustering.html#cb611-2"></a>     <span class="dt">data =</span> df[, <span class="dv">-1</span>], <span class="dt">points.cex =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mclust-opt-result-plot"></span>
<img src="data-mining-book_files/figure-html/mclust-opt-result-plot-1.png" alt="mclust::densityMclust 수행 결과 얻어진 혼합분포" width="672" />
<p class="caption">
Figure 13.2: mclust::densityMclust 수행 결과 얻어진 혼합분포
</p>
</div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-banfield1993model">
<p>Banfield, Jeffrey D, and Adrian E Raftery. 1993. “Model-Based Gaussian and Non-Gaussian Clustering.” <em>Biometrics</em>, 803–21.</p>
</div>
<div id="ref-celeux1995gaussian">
<p>Celeux, Gilles, and Gérard Govaert. 1995. “Gaussian Parsimonious Clustering Models.” <em>Pattern Recognition</em> 28 (5): 781–93.</p>
</div>
<div id="ref-kaufman1990finding">
<p>Kaufman, L, and P. J. Rousseeuw. 1990. “Finding Groups in Data: An Introduction to Cluster Analysis.”</p>
</div>
<div id="ref-park2009simple">
<p>Park, Hae-Sang, and Chi-Hyuck Jun. 2009. “A Simple and Fast Algorithm for K-Medoids Clustering.” <em>Expert Systems with Applications</em> 36 (2): 3336–41.</p>
</div>
<div id="ref-scrucca2016mclust">
<p>Scrucca, Luca, Michael Fop, T Brendan Murphy, and Adrian E Raftery. 2016. “Mclust 5: Clustering, Classification and Density Estimation Using Gaussian Finite Mixture Models.” <em>The R Journal</em> 8 (1): 289.</p>
</div>
<div id="ref-jun2012datamining">
<p>전치혁. 2012. <em>데이터마이닝 기법과 응용</em>. 한나래출판사.</p>
</div>
</div>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://r-data-mining-book.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="hierarchical-clustering.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cluster-solution-evaluation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["data-mining-book.pdf"],
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
